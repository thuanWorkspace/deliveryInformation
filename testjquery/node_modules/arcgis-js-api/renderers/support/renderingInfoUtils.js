/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../Color","../visualVariables/support/visualVariableUtils"],(function(e,t,i){"use strict";function r(e,t){if(!e||e.symbol)return null;const i=t?.renderer;return e&&null!=i&&i.getObservationRenderer?i.getObservationRenderer(e):i}function n(e,t){if(null!=e.symbol)return e.symbol;const i=r(e,t);return null!=i&&"dot-density"!==i.type?i.getSymbol(e,t):null}function o(e,t){const o=r(e,t),l=n(e,t);if(null==l)return null;const a={renderer:o,symbol:l};if(null==o||!("visualVariables"in o)||!o.visualVariables)return a;const s=i.getVisualVariableValues(o,e,t)??[],u=["proportional","proportional","proportional"];for(const{variable:i,value:r}of s)switch(i.type){case"color":a.color=r.toRgba();break;case"size":if("outline"===i.target)a.outlineSize=r;else{const e=i.axis,t=i.useSymbolValue?"symbol-value":r;switch(e){case"width":u[0]=t;break;case"depth":u[1]=t;break;case"height":u[2]=t;break;case"width-and-depth":u[0]=u[1]=t;break;default:u[0]=u[1]=u[2]=t}}break;case"opacity":a.opacity=r;break;case"rotation":switch(i.axis){case"tilt":a.tilt=r;break;case"roll":a.roll=r;break;default:a.heading=r}}return"proportional"===u[0]&&"proportional"===u[1]&&"proportional"===u[2]||(a.size=u),a}async function l(e,t){if(null!=e.symbol)return e.symbol;const i=r(e,t);return null!=i?i.getSymbolAsync(e,t):null}async function a(e,n){const o=r(e,n),a=await l(e,n);if(!a)return null;const s={renderer:o,symbol:a};if(!o||!("visualVariables"in o)||!o.visualVariables)return s;const u=i.getVisualVariableValues(o,e,n)??[],c=["proportional","proportional","proportional"];for(const{variable:i,value:r}of u)if("color"===i.type)s.color=t.toUnitRGBA(r);else if("size"===i.type)if("outline"===i.target)s.outlineSize=r;else{const e=i.axis,t=i.useSymbolValue?"symbol-value":r;"width"===e?c[0]=t:"depth"===e?c[1]=t:"height"===e?c[2]=t:c[0]=c[1]="width-and-depth"===e?t:c[2]=t}else"opacity"===i.type?s.opacity=r:"rotation"===i.type&&"tilt"===i.axis?s.tilt=r:"rotation"===i.type&&"roll"===i.axis?s.roll=r:"rotation"===i.type&&(s.heading=r);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(s.size=c),s}function s(e,t=0){const i=e[t];return"number"==typeof i&&isFinite(i)?i:null}function u(e){for(let t=0;t<3;t++){const i=e[t];if("number"==typeof i)return isFinite(i)?i:0}return 0}e.getDriverAxisSizeValue=s,e.getDriverAxisSizeValueAny=u,e.getRenderer=r,e.getRenderingInfo=o,e.getRenderingInfoAsync=a,e.getSymbolAsync=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
