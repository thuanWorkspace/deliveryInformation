/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/Accessor","../../core/jsonMap","../../core/Logger","../../core/Warning","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","./ColorVariable","./OpacityVariable","./RotationVariable","./SizeVariable"],(function(e,s,a,r,t,o,i,l,n,c,p,u,b,h){"use strict";const V={color:p,size:h,opacity:u,rotation:b},y=new a.JSONMap({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),f=/^\[([^\]]+)\]$/i;let d=class extends s{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter((e=>!!e)),e?.length){for(const s of e)switch(s.type){case"color":this.colorVariables.push(s);break;case"opacity":this.opacityVariables.push(s);break;case"rotation":this.rotationVariables.push(s);break;case"size":this.sizeVariables.push(s)}if(this.sizeVariables.length){this.sizeVariables.some((e=>!!e.target))&&e.sort(((e,s)=>{let a=null;return a=e.target===s.target?0:e.target?1:-1,a}))}for(let s=0;s<e.length;s++){e[s].index=s}this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,s,a){const{rotationExpression:o,rotationType:i}=s,l=o?.match(f),n=l?.[1];if(n&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:i,field:n})),e)return e.map((e=>{const s=y.read(e.type),o=V[s];o||(r.getLogger(this).warn(`Unknown variable type: ${s}`),a?.messages&&a.messages.push(new t("visual-variable:unsupported",`visualVariable of type '${s}' is not supported`,{definition:e,context:a})));const i=new o;return i.read(e,a),i}))}writeVariables(e,s){const a=[];for(const r of e){const e=r.toJSON(s);e&&a.push(e)}return a}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};e.__decorate([o.property()],d.prototype,"visualVariables",null),d=e.__decorate([c.subclass("esri.renderers.visualVariables.VisualVariableFactory")],d);return d}));
