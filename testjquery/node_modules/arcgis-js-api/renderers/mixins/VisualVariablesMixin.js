/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../layers/support/fieldUtils","../support/randomRotationExpression","../visualVariables/ColorVariable","../visualVariables/OpacityVariable","../visualVariables/RotationVariable","../visualVariables/SizeVariable","../visualVariables/VisualVariable","../visualVariables/VisualVariableFactory"],(function(a,e,r,s,i,l,t,o,u,c,n,V,p,b,d,v,y){"use strict";const h={base:v,key:"type",typeMap:{opacity:p,color:V,rotation:b,size:d}},F=a=>{let s=class extends a{constructor(){super(...arguments),this._vvFactory=new y}set visualVariables(a){this._vvFactory.visualVariables=a,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(a,e,r){return this._vvFactory.readVariables(a,e,r)}writeVisualVariables(a,e,r,s){e[r]=this._vvFactory.writeVariables(a,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const a of this.visualVariables)if(a.arcadeRequired)return!0;return!1}hasVisualVariables(a,e){return a?this.getVisualVariablesForType(a,e).length>0:this.getVisualVariablesForType("size",e).length>0||this.getVisualVariablesForType("color",e).length>0||this.getVisualVariablesForType("opacity",e).length>0||this.getVisualVariablesForType("rotation",e).length>0}getVisualVariablesForType(a,e){const r=this.visualVariables;return r?r.filter((r=>r.type===a&&("string"==typeof e?r.target===e:!1!==e||!r.target))):[]}async collectVVRequiredFields(a,e){let r=[];this.visualVariables&&(r=r.concat(this.visualVariables));for(const s of r)s&&(s.field&&c.collectField(a,e,s.field),s.normalizationField&&c.collectField(a,e,s.normalizationField),s.valueExpression&&(g(s.valueExpression,a,e)||await c.collectArcadeFieldNames(a,e,s.valueExpression)))}};return e.__decorate([r.property({types:[h],value:null,json:{write:!0}})],s.prototype,"visualVariables",null),e.__decorate([t.reader("visualVariables",["visualVariables","rotationType","rotationExpression"])],s.prototype,"readVisualVariables",null),e.__decorate([u.writer("visualVariables")],s.prototype,"writeVisualVariables",null),s=e.__decorate([o.subclass("esri.renderers.mixins.VisualVariablesMixin")],s),s};function g(a,e,r){const s=n.matchRandomRotationExpression(a);return null!=s&&(c.collectField(e,r,s),!0)}a.VisualVariablesMixin=F,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})}));
