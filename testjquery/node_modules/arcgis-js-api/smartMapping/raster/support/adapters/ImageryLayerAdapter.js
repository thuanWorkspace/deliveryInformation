/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../../chunks/tslib.es6","../../../../geometry","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/decorators/subclass","../../../../layers/support/rasterFunctions/stretchUtils","../../../../rest/support/ImageHistogramParameters","./RasterLayerAdapter","../../../../geometry/Point"],(function(t,e,s,r,a,i,o,n,c,l,u){"use strict";let p=class extends l{generateRasterInfo(t){const e=t?.rasterFunction;try{return this.layer.generateRasterInfo(e,{signal:t?.signal})}catch{return Promise.resolve(this.layer.serviceRasterInfo)}}async estimateStatisticsHistograms(t){const{layer:e}=this,s=e.mosaicRule?.multidimensionalDefinition?.[0]?.variableName??"",r=`${t?.rasterFunction?.functionName??"default"}${s}`,a=this._statsCache.get(r);if(a)return a;let{width:i,height:o,pixelSize:l}=e.rasterInfo,p=1;for(;i>2e3||o>2e3;)i/=2,o/=2,p*=2;const m=t?.rasterFunction??e.rasterFunction,{fullExtent:h,mosaicRule:g}=e;l=new u(l.x*p,l.y*p,h.spatialReference);const y=new c({geometry:h,pixelSize:l,renderingRule:m,mosaicRule:g});let d;if(e.capabilities.operations.supportsComputeStatisticsHistograms)d=await e.computeStatisticsHistograms(y,t);else{const{histograms:s}=await e.computeHistograms(y,t);d={statistics:n.estimateStatisticsFromHistograms(s),histograms:s}}return d&&this._statsCache.put(r,d),d}supportsMultidirectionalHillshade(){return this.layer.version>=10.81}load(t){return this.addResolvingPromise(this.layer.load(t).then((()=>{this.generateRasterInfo({rasterFunction:this.rasterFunction,signal:t?.signal}).then((t=>this.rasterInfo=t))}))),Promise.resolve(this)}};t.__decorate([s.property()],p.prototype,"layer",void 0),p=t.__decorate([o.subclass("esri.smartMapping.support.adapters.ImageryLayerAdapter")],p);return p}));
