/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/Error","../../../intl/number","../../../renderers/support/rasterRendererHelper","../support/utils"],(function(e,r,a,t,s){"use strict";function n(e){const{rasterInfo:r,layer:a}=e,s=r.multidimensionalInfo?"imagery"===a.type?a.mosaicRule?.multidimensionalDefinition?.[0]?.variableName:a.multidimensionalDefinition?.[0]?.variableName:"";return t.getVariableRasterInfo(r,s)}async function o(e){const a=(e=await s.processRasterRendererParameters(e)).layer,o=n(a);if(o.bandCount>1)throw new r("raster-class-breaks-renderer:not-supported","Multiband raster is not supported");const{attributeTable:i}=o;e.field||(e.field=t.getField(i,"value")?.name??"value");const l=i?.fields.find((r=>r.name.toLowerCase()===e.field?.toLowerCase()));if(!l&&null==o.histograms&&(await a.updateRasterInfoWithEstimatedStats({rasterFunction:e.rasterFunction,signal:e.signal}),null==o.histograms))throw new r("raster-class-breaks-renderer:not-supported","Histograms or raster attribute table is required on the source raster. Unable to estimate histograms");const{colors:u,numClasses:m}=e;if(u&&m&&u.length!==m)throw new r("raster-class-breaks-renderer:not-supported","The size of the `colors` parameter does not match 'numClasses'");return e.classificationMethod||(e.classificationMethod="natural-breaks"),e}async function i(e){const a=n((e=await o(e)).layer),s=t.createClassBreaksRenderer(a,e);if(null==s)throw new r("raster-class-breaks-renderer:not-supported","Class breaks renderer is not supported on this data");const i={minValue:s.minValue,maxValue:s.classBreakInfos[s.classBreakInfos.length-1].maxValue,normalizationTotal:null,classBreakInfos:s.classBreakInfos.map((e=>{const r=l(e.minValue,e.maxValue);return e.label=r,{minValue:e.minValue,maxValue:e.maxValue,label:r}}))};return{renderer:s,classBreaksResult:i}}function l(e,r){return a.formatNumber(e,{maximumFractionDigits:3})+" - "+a.formatNumber(r,{maximumFractionDigits:3})}e.createRenderer=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
