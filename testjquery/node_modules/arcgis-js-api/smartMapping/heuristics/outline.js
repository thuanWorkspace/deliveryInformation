/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../core/Error","../../geometry/support/scaleUtils","../../renderers/visualVariables/SizeVariable","../statistics/spatialStatistics","../support/binningUtils","../support/adapters/support/layerUtils"],(function(e,i,t,a,n,r){"use strict";const s=[{size:10,width:0},{size:20,width:.5},{size:80,width:1},{size:250,width:2}];async function o(i){const{view:t}=i;if(!(i&&t&&i.layer))throw new e("outline:missing-parameters","'view' and 'layer' parameters are required");i.forBinning&&n.verifyBinningParams(i,"outline");const{layer:a,...s}=i,o=i.forBinning?r.binningCapableLayerTypes:r.featureCapableLayerTypes,l=r.createLayerAdapter(a,o,i.forBinning);if(!l)throw new e("outline:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(o).join(", "));const u={layerAdapter:l,...s,view:t};await t.when();const p=null!=u.signal?{signal:u.signal}:null;if(await l.load(p),"polygon"!==l.geometryType)throw new e("outline:not-supported",`outline is not supported for geometryType: ${l.geometryType}`);return u}function l(e,a){const n=e.avgSize,r=i.getScaleForResolution(1,a.spatialReference),o=s.map((e=>({size:e.width,value:Math.round(n/e.size*r)})));o.sort(((e,i)=>e.value-i.value));return{visualVariables:[new t({target:"outline",valueExpression:"$view.scale",stops:o})],opacity:.25}}async function u(i){const{layerAdapter:t,...n}=await o(i),r=-1,s=await t.getSampleFeatures({sampleSize:r,returnGeometry:!0,...n});if(!s?.length)throw new e("outline:insufficient-info","No features are available to calculate statistics");const u=await a({features:s,geometryType:t.geometryType});if(!(u&&"avgSize"in u&&u.avgSize))throw new e("outline:insufficient-info","average polygon size is invalid");return l({...u,avgSize:u.avgSize},n.view)}return u}));
