/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../PopupTemplate","../../core/Error","../../intl/messages","../../popup/ExpressionInfo","../../popup/FieldInfo","./support/utils","../statistics/support/predominanceUtils"],(function(e,n,t,i,s,o,r,a){"use strict";async function d(e){const{layer:n,renderer:i}=e;await n.load();const s=i||n.renderer;if("dot-density"!==s?.type)throw new t("dot-density-popup:invalid-parameters","renderer.type must be 'dot-density'");return{layer:n,renderer:s}}async function l(e,t){const{fieldInfos:i,expressionInfos:s}=await r.getFieldAndExpressionInfos({renderer:e,layer:t});return new n({content:await r.getContentFromFieldInfos(t,{fieldInfos:i,expressionInfos:s}),expressionInfos:s,fieldInfos:i})}async function f(e,t,i){const{fieldInfos:d,expressionInfos:l}=await r.getFieldAndExpressionInfos({renderer:e,layer:t}),f=d.filter((e=>!e.fieldName.includes(r.expressionFieldPrefix))),p={fieldInfo:new o({fieldName:"expression/dot-density-categories-list"}),expressionInfo:new s({name:"dot-density-categories-list",title:i.listOfCategories,expression:a.getArcadeForOrderedFields(f,l)})},c=new n({expressionInfos:[p.expressionInfo],fieldInfos:[p.fieldInfo],title:i.competingFields,content:`{${p.fieldInfo.fieldName}}`});return{name:"dot-density-categories-list",title:i.orderedListOfValues,value:c}}async function p(e,t,i){const{fieldInfos:d,expressionInfos:l}=await r.getFieldAndExpressionInfos({renderer:e,layer:t}),f=d.filter((e=>!e.fieldName.includes(r.expressionFieldPrefix))),p={fieldInfo:new o({fieldName:"expression/dot-density-category"}),expressionInfo:new s({name:"dot-density-category",title:i.predominantCategory,expression:a.getArcadeForPredominantCategoryAlias(f,l)})},c=new n({expressionInfos:[p.expressionInfo,...l],fieldInfos:[p.fieldInfo,...d],content:[{type:"text",text:`<div><b><font size="3">{${p.fieldInfo.fieldName}}</font></b></div>`},{type:"media",mediaInfos:{type:"pie-chart",title:i.competingFields,value:{fields:d.map((e=>e.fieldName))}}}]});return{name:"dot-density-category-chart",title:i.predominantCategoryWithChart,value:c}}async function c(e){const[{renderer:n,layer:t},s]=await Promise.all([d(e),i.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]);return{primaryTemplate:{name:"dot-density",title:s.dotDensity,value:await l(n,t)},secondaryTemplates:[await f(n,t,s),await p(n,t,s)]}}e.getTemplates=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
