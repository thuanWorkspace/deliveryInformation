/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../PopupTemplate","../../core/Error","../../intl/messages","../../intl/substitute","../../popup/ExpressionInfo","../../popup/FieldInfo","./support/utils","../statistics/support/predominanceUtils"],(function(e,n,t,o,i,r,s,f,a){"use strict";function l(e,n){return e.legendOptions?.title??n.competingFields}function d(e,n){return{fieldInfo:new s({fieldName:"expression/predominant-category"}),expressionInfo:new r({name:"predominant-category",title:n.predominantCategory,expression:a.getArcadeForPredominantCategoryAlias(e)})}}function p(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new s({fieldName:"expression/predominant-value",format:{digitSeparator:!0,places:1}}),expressionInfo:new r({name:"predominant-value",title:n.predominantCategoryValue,expression:a.getArcadeForPredominantCategoryValue(t),returnType:"number"})}}function m(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new s({fieldName:"expression/predominant-margin",format:{digitSeparator:!0,places:0}}),expressionInfo:new r({name:"predominant-margin",title:n.marginOfVictory,expression:a.getArcadeForPredominanceMargin(t),returnType:"number"})}}function u(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new s({fieldName:"expression/predominant-strength",format:{digitSeparator:!0,places:0}}),expressionInfo:new r({name:"predominant-strength",title:n.strengthOfPredominance,expression:a.getArcadeForStrengthOfPredominance(t),returnType:"number"})}}function I(e,n){return{fieldInfo:new s({fieldName:"expression/predominant-categories-list"}),expressionInfo:new r({name:"predominant-categories-list",title:n.listOfCategories,expression:a.getArcadeForOrderedFields(e)})}}function c(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new s({fieldName:"expression/predominant-total",format:{digitSeparator:!0,places:0}}),expressionInfo:new r({name:"predominant-total",title:n.sumOfCategories,expression:a.getArcadeForSumOfFields(t),returnType:"number"})}}function g(e,t){const o=d(e.fieldInfos,t),r=new n({expressionInfos:[o.expressionInfo],fieldInfos:[o.fieldInfo],content:i.substitute(t.predominantCategoryContent,{expression:`<b>{${o.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category",title:t.predominantCategory,value:r}}function x(e,t){const{fieldInfos:o}=e,r=d(o,t),s=p(o,t),f=new n({expressionInfos:[s.expressionInfo,r.expressionInfo],fieldInfos:[s.fieldInfo,r.fieldInfo],content:i.substitute(t.predominantCategoryValueContent,{expression1:`<b>{${r.fieldInfo.fieldName}}</b>`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value",title:t.predominantCategoryValue,value:f}}function y(e,t){const{fieldInfos:o}=e,r=d(o,t),s=p(o,t),f=m(o,t),a=new n({expressionInfos:[s.expressionInfo,r.expressionInfo,f.expressionInfo],fieldInfos:[s.fieldInfo,r.fieldInfo,f.fieldInfo],title:i.substitute(t.mostCommon,{expression:"{expression/predominant-category}"}),content:i.substitute(t.predominantCategoryValueMarginContent,{expression1:`<b>{${r.fieldInfo.fieldName}}</b>`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`,expression3:`<b>{${f.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value-margin",title:t.marginOfVictory,value:a}}function b(e,t){const{fieldInfos:o}=e,r=d(o,t),s=p(o,t),f=u(o,t),a=new n({expressionInfos:[s.expressionInfo,r.expressionInfo,f.expressionInfo],fieldInfos:[s.fieldInfo,r.fieldInfo,f.fieldInfo],content:i.substitute(t.predominantCategoryStrengthContent,{expression1:`{${s.fieldInfo.fieldName}}`,expression2:`<b>{${r.fieldInfo.fieldName}}</b>`,expression3:`<b>{${f.fieldInfo.fieldName}}%</b>`})});return{name:"predominant-category-strength",title:t.strengthOfPredominance,value:a}}function N(e,t){const{renderer:o,fieldInfos:r}=e,s=d(r,t),f=p(r,t),a=u(r,t),m=I(r,t),c=new n({expressionInfos:[s.expressionInfo,f.expressionInfo,a.expressionInfo,m.expressionInfo],fieldInfos:[s.fieldInfo,f.fieldInfo,a.fieldInfo,m.fieldInfo],title:l(o,t),content:[{type:"text",text:i.substitute(t.predominantCategoryStrengthContent,{expression1:`{${f.fieldInfo.fieldName}}`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`,expression3:`<b>{${a.fieldInfo.fieldName}}%</b>`})},{type:"text",text:`{${m.fieldInfo.fieldName}}`}]});return{name:"predominant-categories-list",title:t.orderedListOfValues,value:c}}function w(e,t){const{fieldInfos:o}=e,r=d(o,t),s=p(o,t),f=u(o,t),a=c(o,t),l=new n({expressionInfos:[s.expressionInfo,r.expressionInfo,a.expressionInfo,f.expressionInfo],fieldInfos:[s.fieldInfo,r.fieldInfo,a.fieldInfo,f.fieldInfo],content:i.substitute(t.predominantCategoryTotalStrengthContent,{expression1:`{${s.fieldInfo.fieldName}}`,expression2:`<b>{${r.fieldInfo.fieldName}}</b>`,expression3:`<b>{${f.fieldInfo.fieldName}}%</b>`,expression4:`{${a.fieldInfo.fieldName}}`})});return{name:"predominant-category-total-strength",title:t.predominantCategoryWithTotalAndStrength,value:l}}function C(e,t){const{renderer:o,fieldInfos:r}=e,s=d(r,t),f=p(r,t),a=u(r,t),m=new n({expressionInfos:[f.expressionInfo,s.expressionInfo,a.expressionInfo],fieldInfos:[f.fieldInfo,s.fieldInfo,a.fieldInfo],title:l(o,t),content:[{type:"text",text:i.substitute(t.predominantCategoryStrengthContent,{expression1:`{${f.fieldInfo.fieldName}}`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`,expression3:`<b>{${a.fieldInfo.fieldName}}%</b>`})},{type:"media",mediaInfos:{type:"pie-chart",value:{fields:r.map((e=>e.fieldName))}}}]});return{name:"predominant-category-chart",title:t.predominantCategoryWithChart,value:m}}function h(e,n){const o=e.authoringInfo,i="predominance"===o?.type?o.fields:[];if(!i?.length)throw new t("predominance-popup:insufficient-info","unable to find input fields in authoringInfo");return i.map((e=>f.getFieldInfo(n,e)))}async function $(e){const{layer:n,renderer:o}=e;await n.load();const i=o||n.renderer;if("unique-value"!==i?.type)throw new t("predmoinance-popup:invalid-parameters","renderer.type must be 'unique-value'");return{renderer:i,fieldInfos:h(i,n)}}async function v(e){const[n,t]=await Promise.all([$(e),o.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]);return[g(n,t),x(n,t),y(n,t),w(n,t),N(n,t),b(n,t),C(n,t)]}async function S(e){const[n,t]=await Promise.all([$(e),o.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]),i=N(n,t),r=await v(e);return{primaryTemplate:i,secondaryTemplates:r.filter((e=>e.name!==i.name))}}e.getAllTemplates=v,e.getTemplates=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
