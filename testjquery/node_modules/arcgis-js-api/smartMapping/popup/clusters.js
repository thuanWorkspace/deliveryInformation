/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../PopupTemplate","../../core/Error","../../intl/messages","./support/clusterUtils","../../views/2d/layers/support/clusterUtils"],(function(e,t,r,n,s,l){"use strict";async function i(e){const{layer:t,renderer:n}=e;await t.load();const s=n||t.renderer;if(!l.isClusterCompatibleRenderer(s))throw new r("clusters-popup:invalid-parameters","'renderer' is not valid");return{layer:t,renderer:s}}async function o(e){const[{renderer:r,layer:l},o]=await Promise.all([i(e),n.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]),a=await s.getContentAndInfos(l,r,o);if(null==a)return null;const u={name:"clusters",title:o.clusters.templateTitle,value:new t({fieldInfos:a.fieldInfos,expressionInfos:a.expressionInfos,content:a.content,title:o.clusters.clusterPopupTitle})},p=[],c=l.featureReduction,d=c&&"renderer"in c?c.renderer:null;if("pie-chart"===d?.type){const e=await s.getContentAndInfosForPieChart(l,d,o);null!=e&&p.push({name:"clusters-pie-chart",title:"clusters-pie-chart",value:new t({fieldInfos:e.fieldInfos,expressionInfos:e.expressionInfos,content:e.content,title:o.clusters.clusterPopupTitle})})}return{primaryTemplate:u,secondaryTemplates:p}}e.getTemplates=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
