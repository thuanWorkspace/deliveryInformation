/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../Color","../../../symbols","../../../core/Collection","../../../core/has","../../../core/Error","../../../intl/date","../../../renderers/support/numberUtils","../../../renderers/support/pointCloud/PointSizeSplatAlgorithm","../../heuristics/outline","../../statistics/classBreaks","../../statistics/summaryStatistics","../../support/utils","../../../symbols/edges/SketchEdges3D","../../../symbols/edges/SolidEdges3D","../../../time/timeZoneUtils","../../../views/support/colorUtils","../../../symbols/MeshSymbol3D","../../../symbols/FillSymbol3DLayer","../../../symbols/SimpleFillSymbol","../../../symbols/PolygonSymbol3D","../../../symbols/ExtrudeSymbol3DLayer","../../../symbols/SimpleLineSymbol","../../../symbols/LineSymbol3D","../../../symbols/LineSymbol3DLayer","../../../symbols/PathSymbol3DLayer","../../../symbols/SimpleMarkerSymbol","../../../symbols/PointSymbol3D","../../../symbols/IconSymbol3DLayer","../../../symbols/ObjectSymbol3DLayer"],(function(e,t,n,l,o,i,a,s,r,u,c,m,d,f,y,p,h,b,w,g,D,S,v,V,z,x,B,k,T,F){"use strict";const U=/^(\d+(\.\d+)?)\s*(%)$/i,L=[0,0,0,.4],I=new Set(["hours","minutes","seconds"]),A=[...d.defaultBasemapGroups.light,...d.defaultBasemapGroups.dark];function C(e,t,n,l){if("string"==typeof e){const t=n.getField(e);if(t&&d.isAnyDateField(t))return t.alias||t.name}else if("number"==typeof e||e instanceof Date){const o=null!=t&&I.has(t),i=o?"short-date-short-time":"short-date",s=a.convertDateFormatToIntlOptions(i);if(l&&o){const t=n.layer,{timeZone:o}=p.getTimeZoneFormattingOptions("preferredTimeZone"in t?t.preferredTimeZone:null,"datesInUnknownTimezone"in t&&t.datesInUnknownTimezone,l.timeZone,s,"date");return a.formatDate(e,{...s,timeZone:o,timeZoneName:p.shortTimeZoneName})}return a.formatDate(e,s)}return e}function M(e,t,n){return e+t>0&&0>e-t&&n<0?0:e}function Z(e,t,n,l,o){const i="90-10"===n&&t?{min:t.classBreakInfos[0].maxValue,max:t.classBreakInfos[t.classBreakInfos.length-1].minValue,avg:null,stddev:null}:e,{avg:a,stddev:s,min:r,max:u}=i,c=P(i,!!l,o??!0);let m=c?c[0]:r,d=c?c[1]:u;return c?{minDataValue:m,maxDataValue:d,defaultValuesUsed:!0}:("above"===n?m=M(a,s,r):"below"===n&&(d=M(a,s,r)),{minDataValue:m,maxDataValue:d,defaultValuesUsed:!1})}function P(e,t,n){let l,o;const i=R({statistics:e,isDate:t});return i.defaultValuesUsed?(l=i.min,o=i.max):!n||null!=e.avg&&e.stddev||(l=e.min,o=e.max),null!=l&&null!=o?[l,o]:null}function R(e){let t,n,l=e&&e.statistics;if(l||(l={}),null==l.min)if(e.isDate){const e=O();t=e[0],n=e[1]}else t=0,n=100;else if(l.min===l.max)if(e.isDate){const e=O(l.min);t=e[0],n=e[1]}else l.min<0?(t=2*l.min,n=0):l.min>0?(t=0,n=2*l.min):(t=0,n=100);return{min:null!=t?t:l.min,max:null!=n?n:l.max,defaultValuesUsed:null!=t||null!=n}}function O(e){const t=("number"==typeof e?new Date(e):new Date).getUTCFullYear();let n=Date.UTC(t,0,1,12,0,0,0),l=Date.UTC(t,11,31,12,0,0,0);return"number"==typeof e&&(e<n&&(n=e),e>l&&(l=e)),[n,l]}function j(e,n){const l=[],o=e.length;for(let i=0;i<n;i++)l.push(new t(e[i%o]));return l}function E({minDataValue:e,maxDataValue:t,defaultValuesUsed:n},l,o,i=!0){return n||"above"===o||"below"===o||"90-10"===o?Y(e,t,5):W(l,i)}function G(e,t){const{avg:n,stddev:l}=e,o=e.min,i=e.max;if(null==n||null==l){const[n,l]=P(e,t,!0);return Y(n,l,5)}const a=M(n,l,o),r=i-a,u=a-o,c=Math.max(r,u),m=a+c,d=a-c,f=a-c/2,y=c/2+a;return s.round([d,f,a,y,m],{strictBounds:!0})}function N(e,t){const{min:n,max:l}=t,[o,i,a,r,u]=e,c=null!=n&&o<n,m=null!=l&&u>l;if(null==n||null==l||!c&&!m)return e;const d=c?n:o,f=c?d+(a-d)/2:i,y=m?l:u,p=m?a+(y-a)/2:r;return s.round([d,f,a,p,y],{strictBounds:!0})}function Y(e,t,n){const l=(t-e)/(n-1),o=[e];for(let i=1;i<=n-2;i++)o.push(e+i*l);return o.push(t),s.round(o,{strictBounds:!0})}function W({min:e,max:t,avg:n,stddev:l},o=!0){if(null==e||null==t||null==n||null==l)return[];let i=n-l,a=n+l;i<e&&(i=e),a>t&&(a=t),o&&(n=i+(a-i)/2);let r=s.round([i,a],{strictBounds:!0});return i=r[0],a=r[1],r=[i,i+(n-i)/2,n,n+(a-n)/2,a],s.round(r,{strictBounds:!0})}function q(e,t,n){switch(t){case"point":case"multipoint":return n?"noDataSize"in e?e.noDataSize:null:"size"in e?e.size:null;case"polyline":return n?"noDataWidth"in e?e.noDataWidth:null:"width"in e?e.width:null;case"polygon":return"size"in e?e.size:null;default:return}}function $(e,t,n){switch(t){case"point":case"multipoint":case"polygon":{if(!("outline"in e))return null;const t={color:e.outline.color,width:e.outline.width};if(null!=n&&t.color){const e=t.color.clone();e.a=n,t.color=e}return t}default:return}}function H(e,t){const{type:n,size:o,color:i,outline:a}=t;let s;switch(e){case"point":case"multipoint":if("2d"===n)s=new B({color:i,size:o,outline:{color:a.color,width:a.width}});else if("3d-flat"===n)s=new k({symbolLayers:new l([new T({size:o,resource:{primitive:"circle"},material:{color:i},outline:{color:a.color,size:a.width}})])});else if(n?.includes("3d-volumetric")){const e="3d-volumetric-uniform"===n,a=new F({height:o,resource:{primitive:e?"sphere":"cylinder"},material:{color:i}});e||(a.width=t.widthAndDepth,a.depth=t.widthAndDepth),s=new k({symbolLayers:new l([a])})}break;case"polyline":"2d"===n?s=new v({color:i,width:o}):"3d-flat"===n?s=new V({symbolLayers:new l([new z({size:o,material:{color:i}})])}):"3d-volumetric"===n&&(s=new V({symbolLayers:new l([new x({width:"number"==typeof o?o:parseFloat(o),height:"number"==typeof o?o:parseFloat(o),material:{color:i}})])}));break;case"polygon":"2d"===n?s=new g({color:i,outline:{color:a.color,width:a.width}}):"3d-flat"===n?s=new D({symbolLayers:new l([new w({material:{color:i},outline:{color:a.color,size:a.width}})])}):"3d-volumetric"===n&&(s=new D({symbolLayers:new l([new S({size:o,material:{color:i}})])}));break;case"mesh":{const e=t.meshInfo?.colorMixMode,n=t.meshInfo?.edgesType;s=new b({symbolLayers:new l([new w({material:{color:i,colorMixMode:e||null},edges:"solid"===n?new y({color:L}):"sketch"===n?new f({color:L}):null})])});break}}return s}function J(e,t,n){const l=K({layer:e,fields:t});if(l.length)return new i(n,"Unknown fields: "+l.join(", ")+". You can only use fields defined in the layer schema");const o=Q({layer:e,fields:t});return o.length?new i(n,"Unsupported fields: "+o.join(", ")+". You can only use fields that are accessible to the renderer i.e. FieldUsageInfo.supportsRenderer must be true"):void 0}function K(e){const t=e.layer;return e.fields.filter((e=>!t.getField(e)))}function Q(e){const t=e.layer;return e.fields.filter((e=>{const n=t.getFieldUsageInfo(e);return!n||!n.supportsRenderer}))}async function X(e,t){const n={layer:e.layer,view:e.view,signal:e.signal},[l,o]=await Promise.all([c(e).catch(ie),t?u(n).catch(ie):null]),i=P({min:l?.minValue,max:l?.maxValue,avg:null,stddev:null},!1,!1);return{result:i?await c({...e,classificationMethod:"equal-interval",numClasses:1,analyzeData:!1,minValue:i[0],maxValue:i[1],normalizationTotal:i[0]+i[1]}):l,defaultValuesUsed:!!i,outlineResult:o}}function _(e){return m(e)}function ee(e,t){let{minSize:n,maxSize:l}=e;if("height"===t){n=((l-n)/2+n)/(2*2.3),l*=2}return{minSize:n,maxSize:l}}function te(e){return U.test(e)}function ne(e){if(null==e)return;const t=e.match(U),n=Number(t[1]);return"%"===t[3]?new r({scaleFactor:n/100}):void 0}function le(e,t,n,l){e.startTime=t instanceof Date?t.getTime():t,e.endTime=n instanceof Date?n.getTime():n,e.units=l,e.field="string"==typeof t?t:"string"==typeof n?n:null}async function oe(e,t){let n=null,l=null;if(!e&&!t)return{basemapId:n,basemapTheme:l};if(t&&(l=await h.getBackgroundColorTheme(t),e||(e=t.map?.basemap)),e&&(n=d.getBasemapId(e,A,!1),n&&!l)){const e=d.getBasemapGroup(n);null!=e&&(l=e)}return!n&&l&&(n="dark"===l?"dark-gray":"gray"),{basemapId:n,basemapTheme:l}}function ie(e){const t=e.name?.toLowerCase();if(!t||t?.includes(":insufficient-info")||t?.includes(":insufficient-data"))return null;throw e}e.clampAboveAndBelowStopValues=N,e.createColors=j,e.createDataValues=E,e.createDefaultStopValues=Y,e.createStopValues=W,e.createStopValuesForAboveBelow=G,e.createSymbol=H,e.errorCallback=ie,e.formatDate=C,e.getBaseValueForAboveBelow=M,e.getBasemapInfo=oe,e.getClassBreaks=X,e.getDataRange=Z,e.getDefaultDataRange=P,e.getPointSizeAlgorithm=ne,e.getSizeRangeForAxis=ee,e.getSummaryStatistics=_,e.getSymbolOutlineFromScheme=$,e.getSymbolSizeFromScheme=q,e.isValidPointSize=te,e.updateAgeRendererAuthoringInfoVV=le,e.verifyBasicFieldValidity=J,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
