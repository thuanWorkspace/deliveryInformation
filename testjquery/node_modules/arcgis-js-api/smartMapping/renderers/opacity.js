/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../core/Error","../../renderers/support/AuthoringInfo","../../renderers/support/AuthoringInfoVisualVariable","../../renderers/visualVariables/OpacityVariable","./support/utils","../statistics/summaryStatistics","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils"],(function(e,i,a,l,s,r,n,t,o,u){"use strict";async function p(e){if(!e?.layer||!(e.field||e.valueExpression||e.sqlExpression))throw new i("opacity-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.view)throw new i("opacity-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&t.verifyBinningParams(e,"opacity-visual-variable");const a={...e,layer:e.layer},l=e.forBinning?u.binningCapableLayerTypes:u.featureCapableLayerTypes,s=u.createLayerAdapter(a.layer,l,e.forBinning);if(!s)throw new i("opacity-visual-variable:invalid-parameters","'layer' must be one of these types: "+u.getLayerTypeLabels(l).join(", "));a.layer=s;const n=null!=a.signal?{signal:a.signal}:null;await s.load(n);const p=await o.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression}),d=r.verifyBasicFieldValidity(s,p,"opacity-visual-variable:invalid-parameters");if(d)throw d;return a}function d(e,i){const n=i.layer,t=i.field,u=t&&!("function"==typeof t)?n.getField(t):null,p=o.isAnyDateField(u),d=r.createStopValues(e),y=r.getDefaultDataRange(e,p,!0),v=y||[d[0],d[4]],c=new s({field:t,valueExpression:i.valueExpression,valueExpressionTitle:i.valueExpressionTitle,normalizationField:i.normalizationField,stops:[{value:v[0],opacity:.3},{value:v[1],opacity:1}],legendOptions:i.legendOptions}),f=new l({type:"opacity",minSliderValue:null!=i.minValue?i.minValue:e.min,maxSliderValue:null!=i.maxValue?i.maxValue:e.max}),m=new a({visualVariables:[f]});return Promise.resolve({visualVariable:c,statistics:e,defaultValuesUsed:!!y,authoringInfo:m})}async function y(e){const i=await p(e);let a=null;return a=i.statistics?i.statistics:await n({layer:i.layer,field:i.field,valueExpression:i.valueExpression,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,normalizationType:i.normalizationField?"field":void 0,normalizationField:i.normalizationField,minValue:i.minValue,maxValue:i.maxValue,view:i.view,signal:i.signal}),d(a,i)}e.createVisualVariable=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
