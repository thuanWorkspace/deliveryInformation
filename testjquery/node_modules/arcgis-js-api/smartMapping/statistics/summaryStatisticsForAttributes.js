/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../core/Error","./support/utils","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils"],(function(e,s,t,r,i){"use strict";async function a(a){if(!(a&&a.layer&&a.attributes))throw new e("summary-statistics-for-attributes:missing-parameters","'layer' and 'attributes' parameters are required");if(a.attributes.some((e=>!!e.valueExpression))&&!a.view)throw new e("summary-statistics-for-attributes:missing-parameters","View is required when 'valueExpression' is specified in attributes");a.forBinning&&t.verifyBinningParams(a,"summary-statistics-for-attributes");const{layer:n,...u}=a,l=[i.LayerType.CSVLayer,i.LayerType.FeatureLayer,i.LayerType.OGCFeatureLayer,i.LayerType.GeoJSONLayer,i.LayerType.WFSLayer],o=a.forBinning?i.binningCapableLayerTypes:l,p=i.createLayerAdapter(n,o,a.forBinning);if(!p)throw new e("summary-statistics-for-attributes:invalid-parameters","'layer' must be one of these types: "+i.getLayerTypeLabels(o).join(", "));const y={layerAdapter:p,...u};y.includeZeros=null==y.includeZeros||y.includeZeros,y.includeNegatives=null==y.includeNegatives||y.includeNegatives;const c=y.view,d=null!=y.signal?{signal:y.signal}:null;await Promise.all([c?.when(),p.load(d)]);const f=[];for(const e of y.attributes){const s=await r.getFieldsList({field:e.field,valueExpression:e.valueExpression});Array.prototype.push.apply(f,s)}const m=s.verifyBasicFieldValidity(p,f,"summary-statistics-for-attributes:invalid-parameters");if(m)throw m;return y}async function n(e){const{layerAdapter:t,...r}=await a(e),i=s.getSumOfAttributesExpr(r.attributes,r.includeZeros,r.includeNegatives);return t.summaryStatistics({valueExpression:i.valueExpression,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,view:r.view,signal:r.signal})}return n}));
