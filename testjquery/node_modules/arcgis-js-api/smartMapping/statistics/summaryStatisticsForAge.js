/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../core/Error","./summaryStatistics","./support/ageUtils","../support/adapters/support/layerUtils"],(function(e,a,t,r){"use strict";async function s(a){if(!(a&&a.layer&&a.startTime&&a.endTime&&a.unit))throw new e("summary-statistics-for-age:missing-parameters","'layer', 'startTime', 'endTime' and 'unit' parameters are required");const{layer:s,...i}=a,n=r.createLayerAdapter(s,r.featureCapableLayerTypes);if(!n)throw new e("summary-statistics-for-age:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(r.featureCapableLayerTypes).join(", "));const u={layerAdapter:n,...i},l=u.view,m=null!=u.signal?{signal:u.signal}:null;await Promise.all([l?.when(),n.load(m)]);const o=t.verifyDates(n,u.startTime,u.endTime,"summary-statistics-for-age:invalid-parameters");if(o)throw o;if(!u.unit||!t.supportedAgeUnits.includes(u.unit))throw new e("summary-statistics-for-age:invalid-parameters",`Supported units are: ${t.supportedAgeUnits.join(", ")}`);return u}async function i(e){const{layerAdapter:r,...i}=await s(e),{view:n,startTime:u,endTime:l,unit:m,minValue:o,maxValue:p,signal:y}=i,{valueExpression:d,statisticsQuery:c}=t.getAgeExpressions({layer:r,startTime:u,endTime:l,unit:m}),f={layer:r,valueExpression:d,...c,minValue:o,maxValue:p,view:n,signal:y};return a(f)}return i}));
