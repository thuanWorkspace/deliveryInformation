/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../support/arcadeOnDemand"],(function(e){"use strict";function t(e,t,n){return null!=e&&isFinite(e)&&((t??!0)||0!==e)&&((n??!0)||e>=0)}async function n(n){const{features:i,attributes:s,includeZeros:c,includeNegatives:l,view:o}=n;let a=0,r=0,u=1/0,f=-1/0,d=null;const g=new Map;for(let t=0;t<s.length;t++){const{valueExpression:n}=s[t];if(n){if(!d){const{arcadeUtils:t}=await e.loadArcade();d=t}g.set(t,d.createFunction(n))}}const p=o?d?.getViewInfo({viewingMode:"2d"===o.type?"map":o.viewingMode,scale:o.scale,spatialReference:o.spatialReference}):null;for(const e of i){const n=e.geometry,i=e.attributes;if(n){const v=n.extent;if(v){const n=v.width*v.height;if(n>0){let v=0;const w=d?.createExecContext(e,p,o?.timeZone);for(let e=0;e<s.length;e++){const{field:n,valueExpression:o}=s[e];let a=null;if(n)a=i[n];else if(o){const t=g.get(e);a=d.executeFunction(t,w)}t(a,c,l)&&(v+=a||0)}if(t(v,c,l)){const e=v/n;++a,r+=e,e<u&&(u=e),e>f&&(f=e)}}}}}return{minDensity:u!==1/0?u:null,maxDensity:f!==-1/0?f:null,avgDensity:a?r/a:null}}return n}));
