/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../core/has","./arcgisLayerUrl","../../rest/support/jsonUtils"],(function(e,t,o,s){"use strict";const r={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function a(e){const t=e?.supportedSpatialAggregationStatistics?.map((e=>e.toLowerCase()));return{envelope:!!t?.includes("envelopeaggregate"),centroid:!!t?.includes("centroidaggregate"),convexHull:!!t?.includes("convexhullaggregate")}}function p(e,t){const o=e?.supportedOperationsWithCacheHint?.map((e=>e.toLowerCase()));return!!o?.includes(t.toLowerCase())}function n(e,t){return{analytics:u(e),attachment:i(e),data:d(e),metadata:l(e),operations:c(e.capabilities,e,t),query:y(e,t),queryRelated:B(e),queryTopFeatures:m(e),editing:C(e)}}function u(e){return{supportsCacheHint:p(e.advancedQueryCapabilities,"queryAnalytics")}}function i(e){const t=e.attachmentProperties,o={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:p(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:s.readBoolean(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach((e=>{const t=r[e.name];t&&(o[t]=!!e.isEnabled)})),o}function d(e){return{isVersioned:s.readBoolean(e,"isDataVersioned",!1),supportsAttachment:s.readBoolean(e,"hasAttachments",!1),supportsM:s.readBoolean(e,"hasM",!1),supportsZ:s.readBoolean(e,"hasZ",!1)}}function l(e){return{supportsAdvancedFieldProperties:s.readBoolean(e,"supportsFieldDescriptionProperty",!1)}}function c(e,t,r){const a=e?e.toLowerCase().split(",").map((e=>e.trim())):[],p=r?o.parse(r):null,n=a.includes(null!=p&&"MapServer"===p.serverType?"data":"query"),u=a.includes("editing")&&!t.datesInUnknownTimezone;let i=u&&a.includes("create"),d=u&&a.includes("delete"),l=u&&a.includes("update");const c=a.includes("changetracking"),y=t.advancedQueryCapabilities;return u&&!(i||d||l)&&(i=d=l=!0),{supportsCalculate:s.readBoolean(t,"supportsCalculate",!1),supportsTruncate:s.readBoolean(t,"supportsTruncate",!1),supportsValidateSql:s.readBoolean(t,"supportsValidateSql",!1),supportsAdd:i,supportsDelete:d,supportsEditing:u,supportsChangeTracking:c,supportsQuery:n,supportsQueryAnalytics:s.readBoolean(y,"supportsQueryAnalytic",!1),supportsQueryAttachments:s.readBoolean(y,"supportsQueryAttachments",!1),supportsQueryTopFeatures:s.readBoolean(y,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:s.readBoolean(t,"supportsAttachmentsResizing",!1),supportsSync:a.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:s.readBoolean(t,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:s.readBoolean(t,"supportsAsyncConvert3D",!1)}}function y(e,r){const n=e.advancedQueryCapabilities,u=e.ownershipBasedAccessControlForFeatures,i=e.archivingInfo,d=e.currentVersion,l=r?.includes("MapServer"),c=!l||d>=t("mapserver-pbf-version-support"),y=o.isHostedAgolService(r),B=new Set((e.supportedQueryFormats??"").split(",").map((e=>e.toLowerCase().trim())));return{supportsStatistics:s.readBoolean(n,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:s.readBoolean(n,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:s.readBoolean(n,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:a(n),supportsCentroid:s.readBoolean(n,"supportsReturningGeometryCentroid",!1),supportsDistance:s.readBoolean(n,"supportsQueryWithDistance",!1),supportsDistinct:s.readBoolean(n,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:s.readBoolean(n,"supportsReturningQueryExtent",!1),supportsGeometryProperties:s.readBoolean(n,"supportsReturningGeometryProperties",!1),supportsHavingClause:s.readBoolean(n,"supportsHavingClause",!1),supportsOrderBy:s.readBoolean(n,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:s.readBoolean(n,"supportsPagination",!1),supportsQuantization:s.readBoolean(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:s.readBoolean(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:s.readBoolean(e,"supportsReturningQueryGeometry",!1),supportsResultType:s.readBoolean(n,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:s.readBoolean(n,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:s.readBoolean(n,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:s.readBoolean(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:s.readBoolean(n,"supportsTopFeaturesQuery",!1),supportsQueryByAnonymous:s.readBoolean(u,"allowAnonymousToQuery",!0),supportsQueryByOthers:s.readBoolean(u,"allowOthersToQuery",!0),supportsHistoricMoment:s.readBoolean(i,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:c&&B.has("pbf"),supportsDisjointSpatialRelationship:s.readBoolean(n,"supportsDisjointSpatialRel",!1),supportsCacheHint:s.readBoolean(n,"supportsQueryWithCacheHint",!1)||p(n,"query"),supportsDefaultSpatialReference:s.readBoolean(n,"supportsDefaultSR",!1),supportsCompactGeometry:y,supportsFullTextSearch:s.readBoolean(n,"supportsFullTextSearch",!1),maxRecordCountFactor:s.readNumber(e,"maxRecordCountFactor",void 0),maxRecordCount:s.readNumber(e,"maxRecordCount",void 0),standardMaxRecordCount:s.readNumber(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:s.readNumber(e,"tileMaxRecordCount",void 0)}}function B(e){const t=e.advancedQueryCapabilities,o=s.readBoolean(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:s.readBoolean(t,"supportsQueryRelatedPagination",!1),supportsCount:o,supportsOrderBy:o,supportsCacheHint:p(t,"queryRelated")}}function m(e){return{supportsCacheHint:p(e.advancedQueryCapabilities,"queryTopFilter")}}function C(e){const t=e.ownershipBasedAccessControlForFeatures,o=e?e.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:s.readBoolean(e,"allowGeometryUpdates",!0),supportsGlobalId:s.readBoolean(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:s.readBoolean(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:s.readBoolean(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:s.readBoolean(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:s.readBoolean(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:s.readBoolean(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:s.readBoolean(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:s.readBoolean(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:s.readBoolean(t,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:s.readBoolean(o,"supportsAsyncApplyEdits",!1),zDefault:s.readNumber(e,"zDefault",void 0)}}function g(e){return{operations:{supportsExportClip:s.readBoolean(e,"supportsExportClip",!1),supportsMensuration:s.readBoolean(e,"supportsMensuration",!1)},query:{supportsCoverageQuery:s.readBoolean(e,"supportsCoverageQuery",!1)}}}e.getFeatureLayerCapabilities=n,e.getVideoLayerCapabilities=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
