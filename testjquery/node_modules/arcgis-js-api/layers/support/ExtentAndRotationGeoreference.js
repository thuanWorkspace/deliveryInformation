/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/mathUtils","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../chunks/common","../../geometry/Extent","../../geometry/Polygon","../../geometry/projection","./GeoreferenceBase"],(function(e,t,r,n,o,s,c,a,i,l,u,p,x){"use strict";let y=class extends x{constructor(e){super(e),this.extent=null,this.rotation=0,this.type="extent-and-rotation"}get coords(){if(null==this.extent)return null;const{xmin:e,ymin:t,xmax:r,ymax:n,spatialReference:o}=this.extent;let s;if(this.rotation){const{x:o,y:c}=this.extent.center,a=h(o,c,this.rotation);s=[a(e,t),a(e,n),a(r,n),a(r,t)],s.push(s[0])}else s=[[e,t],[e,n],[r,n],[r,t],[e,t]];return new u({rings:[s],spatialReference:o})}set coords(e){if(null==e||null==this.extent)return;const r=this.extent.spatialReference;if(e=this.projectOrWarn(e,r),null==e?.extent)return;const{rings:[[n,o,s]],extent:{center:{x:c,y:a}}}=e,i=t.rad2deg(Math.PI/2-Math.atan2(o[1]-n[1],o[0]-n[0])),u=h(c,a,-i),[p,x]=u(n[0],n[1]),[y,m]=u(s[0],s[1]);this.extent=new l({xmin:p,ymin:x,xmax:y,ymax:m,spatialReference:r}),this.rotation=i}toSourceNormalized(e){const{extent:n,rotation:o}=this;if(null==e||null==n)return null;const{xmin:s,ymin:c,xmax:a,ymax:i,center:l,spatialReference:u}=n;e=e.normalize();const x=p.projectOrLoad(e,u).geometry;if(null==x)return null;let y=x.x,m=x.y;return o&&([y,m]=h(l.x,l.y,-o)(y,m)),r.createScreenPoint(t.scale(y,s,a,0,1),t.scale(m,i,c,0,1))}};function h(e,t,r){const n=i.toRadian(r),o=Math.cos(n),s=Math.sin(n);return(r,n)=>[o*(r-e)+s*(n-t)+e,o*(n-t)-s*(r-e)+t]}e.__decorate([n.property()],y.prototype,"coords",null),e.__decorate([n.property({type:l})],y.prototype,"extent",void 0),e.__decorate([n.property({type:Number})],y.prototype,"rotation",void 0),y=e.__decorate([a.subclass("esri.layers.support.ExtentAndRotationGeoreference")],y);return y}));
