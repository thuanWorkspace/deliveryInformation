/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../rasterDatasets/byteStreamUtils","../../../chunks/Jpg","./Lerc","./Lzw","./pixelRangeUtils","./TiffTags","./utils","../../../chunks/Zlib"],(function(e,t,n,a,i,s,r,l,o){"use strict";const f=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],u=4294967296,c=new Set([1,5,6,7,8,34712,34887]);function g(e,t){let n="unknown";return 3===e?n=64===t?"f64":"f32":1===e?1===t?n="u1":2===t?n="u2":4===t?n="u4":t<=8?n="u8":t<=16?n="u16":t<=32&&(n="u32"):2===e&&(t<=8?n="s8":t<=16?n="s16":t<=32&&(n="s32")),n}function h(e){let t=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f64":t=Float64Array;break;default:t=Float32Array}return t}function E(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function d(e,t){return e.get(t)?.values}function T(e,t){return e.get(t)?.values}function I(e,t){return e.get(t)?.values?.[0]}function w(e,t){return e.get(t)?.values?.[0]}function p(e,t,n,a=0,i=r.tiffTags,s=4){const l=8===s,o=l?C(new DataView(e,n,8),0,t):new DataView(e,n,2).getUint16(0,t),f=4+2*s,u=l?8:2,c=u+o*f;if(n+c>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:c};const g=n+c+4<=e.byteLength?v(new DataView(e,n+c,8===s?8:4),0,t,8===s):null,h=n+u,E=new Map;let d,T,I,w,p,y=0,S=0;for(let A=0;A<o;A++){T=new DataView(e,h+f*A,f),I=T.getUint16(0,t),p=T.getUint16(2,t),w=r.getTagName(I,i);const n=[];2===s?(y=T.getUint16(4,t),S=T.getUint16(6,t)):4===s?(y=T.getUint32(4,t),S=T.getUint32(8,t)):8===s&&(y=v(T,4,t,!0),S=v(T,12,t,!0),n.push(T.getUint32(12,t)),n.push(T.getUint32(16,t))),d={id:I,type:p,valueCount:y,valueOffset:S,valueOffsets:n,values:null},L(e,t,d,a,!1,s),E.set(w,d)}return{success:!0,ifd:E,nextIFD:g,requiredBufferSize:c}}const y=(e,t)=>a.decode(e,{inputOffset:t}).pixels[0];function S(e,t){if(1!==t&&2!==t&&4!==t)return e;const n=new Uint8Array(e),a=8/t,i=new Uint8Array(e.byteLength*a);let s=0;const r=2**t-1;for(let l=0;l<n.length;l++){const e=n[l];for(let n=0;n<a;n++)i[s++]=e<<t*n>>>8-t&r}return i.buffer}function A(e,t,a){const i=new n.JpegImage;i.parse(e),i.colorTransform=6===a?-1:0;const s=i.getData(i.width,i.height,1!==t&&4!==t);return new Uint8Array(s.buffer)}function M(e){const t=new o.Zlib(e).getBytes(),n=new ArrayBuffer(t.length),a=new Uint8Array(n);return a.set(t),a}async function m(e,t,n,s,r){const o=l.isPlatformLittleEndian===t,f=w(n,"BITSPERSAMPLE"),u=w(n,"SAMPLESPERPIXEL")??1,c=w(n,"PHOTOMETRICINTERPRETATION"),E=w(n,"SAMPLEFORMAT")??1,d=g(E,f),T=w(n,"COMPRESSION")??1,I=h(d);let p,m,P;if(34887===T)return await a.load(),y(e,s);if(1===T)p=e.slice(s,s+r),m=new Uint8Array(p);else if(8===T||32946===T)m=new Uint8Array(e,s,r),m=M(m),p=m.buffer;else if(6===T)m=new Uint8Array(e,s,r),m=A(m,u,c),p=m.buffer;else if(7===T){const t=n.get("JPEGTABLES").values,a=t.length-2;m=new Uint8Array(a+r-2);for(let e=0;e<a;e++)m[e]=t[e];const i=new Uint8Array(e,s+2,r-2);for(let e=0;e<i.length;e++)m[a+e]=i[e];m=A(m,u,c),p=m.buffer}else{if(5!==T)throw new Error("tiff-decode: unsupport compression "+T);m=i.decode(e,s,r,t),p=m.buffer}if(p=S(p,f),"u8"===d||"s8"===d||o)P=new I(p);else{p=new ArrayBuffer(m.length);const e=new Uint8Array(p);switch(d){case"u16":case"s16":for(let t=0;t<m.length;t+=2)e[t]=m[t+1],e[t+1]=m[t];break;case"u32":case"s32":case"f32":for(let t=0;t<m.length;t+=4)e[t]=m[t+3],e[t+1]=m[t+2],e[t+2]=m[t+1],e[t+3]=m[t]}P=new I(p)}const b=w(n,"PREDICTOR")??1,O=w(n,"TILEWIDTH"),x=w(n,"TILELENGTH");if(b>1&&(5===T||8===T||32946===T)&&O&&x){const e=R(n),t=new I(P.length);t.set(P),P=W(t,x,O,3===E&&3===b,e?1:u)}return P}async function P(e,t,n){const a=T(n,"TILEOFFSETS");if(void 0===a)return null;const i=T(n,"TILEBYTECOUNTS"),{width:s,height:r,pixelType:l,tileWidth:o,tileHeight:f}=D([n]),u=R(n,t),c=w(n,"SAMPLESPERPIXEL")||t.planes,g=s*r,E=w(n,"BITSPERSAMPLE"),d=34887===(w(n,"COMPRESSION")??1),I=h(l),p=[];for(let h=0;h<c;h++)p.push(new I(g));let y,S,A,M,P,b,O,x,L,U,N,k,C;const F=Math.ceil(s/o),v=new Uint8Array(g).fill(255);let G=!1;if(E%8==0)if(d&&u&&c>1){const l=Math.round(a.length/c);for(y=0;y<l;y++){b=Math.floor(y/F)*f,O=y%F*o,x=b*s+O;for(let l=0;l<c;l++){const u=y*c+l;for(0===i[u]?(A=null,G=!0):A=await m(e,t.littleEndian,n,a[u],i[u]),U=0,L=x,k=Math.min(o,s-O),N=Math.min(f,r-b),C=p[l],M=0;M<N;M++)for(L=x+M*s,U=M*o,P=0;P<k;P++,L++,U++)A?C[L]=A[U]:v[L]=0}}}else for(y=0;y<a.length;y++)for(b=Math.floor(y/F)*f,O=y%F*o,x=b*s+O,0===i[y]?(A=null,G=!0):A=await m(e,t.littleEndian,n,a[y],i[y]),U=0,L=x,k=Math.min(o,s-O),N=Math.min(f,r-b),S=0;S<c;S++)if(C=p[S],u||d)for(M=0;M<N;M++)for(L=x+M*s,U=o*f*S+M*o,P=0;P<k;P++,L++,U++)A?C[L]=A[U]:v[L]=0;else for(M=0;M<N;M++)for(L=x+M*s,U=M*o*c+S,P=0;P<k;P++,L++,U+=c)A?C[L]=A[U]:v[L]=0;return{width:s,height:r,pixelType:l,pixels:p,mask:G?v:void 0}}const b=(e,t,n)=>{const a=l.isPlatformLittleEndian===t.littleEndian,s=T(n,"STRIPOFFSETS");if(void 0===s)return null;const{width:r,height:o,pixelType:f}=D([n]),u=w(n,"SAMPLESPERPIXEL")||t.planes,c=w(n,"PHOTOMETRICINTERPRETATION"),g=r*o,E=w(n,"BITSPERSAMPLE"),d=h(f),I=new d(g*u),p=T(n,"STRIPBYTECOUNTS"),y=w(n,"ROWSPERSTRIP"),m=w(n,"COMPRESSION")??1;let P,b,O,x,L,R,U,N,k,C=y;if(E%8==0)for(P=0;P<s.length;P++){if(L=P*(y*r)*u,C=(P+1)*y>o?o-P*y:y,"u8"===f||"s8"===f||a)8===m||32946===m?(U=new Uint8Array(e,s[P],p[P]),U=M(U),R=U.buffer):6===m?(U=new Uint8Array(e,s[P],p[P]),U=A(U,u,c),R=U.buffer):5===m?(U=i.decode(e,s[P],p[P],t.littleEndian),R=U.buffer):(p[P]!==C*r*u*E/8&&console.log("strip byte counts is different than expected"),R=e.slice(s[P],s[P]+p[P])),R=S(R,E),x=new d(R);else{switch(6===m||8===m||32946===m?(U=new Uint8Array(e,s[P],p[P]),N=M(U),R=N.buffer):(p[P]!==C*r*u*E/8&&console.log("strip byte counts is different than expected"),R=new ArrayBuffer(p[P]),U=new Uint8Array(e,s[P],p[P]),N=new Uint8Array(R)),f){case"u16":case"s16":for(O=0;O<U.length;O+=2)N[O]=U[O+1],N[O+1]=U[O];break;case"u32":case"s32":case"f32":for(O=0;O<U.length;O+=4)N[O]=U[O+3],N[O+1]=U[O+2],N[O+2]=U[O+1],N[O+3]=U[O]}R=S(R,E),x=new d(R)}I.set(x,L)}const F=[];if(1===u)F.push(I);else for(P=0;P<u;P++){for(k=new d(g),b=0;b<g;b++)k[b]=I[b*u+P];F.push(k)}return{width:r,height:o,pixelType:f,pixels:F}},O=(e,t,n)=>{if(!(e&&e.length>0&&t&&n))return null;let a,i,s;const r=e[0].length,l=e.length,o=new Uint8Array(r);for(let f=0;f<l;f++)if(a=e[f],i=t[f],s=n[f],0===f)for(let e=0;e<r;e++)o[e]=a[e]<i||a[e]>s?0:1;else for(let e=0;e<r;e++)o[e]&&(o[e]=a[e]<i||a[e]>s?0:1);return o},x=e=>{if(!e)return null;const t=e.match(/<Item(.*?)Item>/gi);if(!t||0===t.length)return null;const n=new Map;let a,i,s,r,l;for(let I=0;I<t.length;I++)a=t[I],i=a.slice(6,a.indexOf(">")),r=a.indexOf("sample="),r>-1&&(l=a.slice(r+8,a.indexOf('"',r+8))),r=a.indexOf("name="),r>-1&&(i=a.slice(r+6,a.indexOf('"',r+6))),i&&(s=a.slice(a.indexOf(">")+1,a.indexOf("</Item>")).trim(),null!=l?n.has(i)?n.get(i)[l]=s:n.set(i,[s]):n.set(i,s)),l=null;const o=n.get("STATISTICS_MINIMUM"),f=n.get("STATISTICS_MAXIMUM"),u=n.get("STATISTICS_MEAN"),c=n.get("STATISTICS_STDDEV");let g=null;if(o&&f){g=[];for(let e=0;e<o.length;e++)g.push({min:parseFloat(o[e]),max:parseFloat(f[e]),avg:u&&parseFloat(u[e]),stddev:c&&parseFloat(c[e])})}const h=n.get("BandName"),E=n.get("WavelengthMin"),d=n.get("WavelengthMax");let T=null;if(h){T=[];for(let e=0;e<h.length;e++)T.push({BandName:h[e],WavelengthMin:E&&parseFloat(E[e]),WavelengthMax:d&&parseFloat(d[e])})}return{statistics:g,bandProperties:T,dataType:n.get("DataType"),rawMetadata:n}};function L(e,t,n,a=0,i=!1,s=4){if(n.values)return!0;const r=n.type,l=n.valueCount;let o=n.valueOffset,c=[];const g=f[r],h=8*g,E=l*g,d=l*f[r]*8;let T,I;const w=8===s?64:32,p=n.valueOffsets;if(d>w){if(E>(i?e.byteLength:e?e.byteLength-o+a:0))return n.offlineOffsetSize=[o,E],n.values=null,!1}if(d<=w){if(!t)if(w<=32)o>>>=32-d;else{const e=p?.length?p[0]:o>>>0,t=p?.length?p[1]:Math.round((o-e)/u);d<=32?(o=e>>>32-d,p[0]=o):(o=e*2**(32-d)+(t>>>32-d),p[0]=e,p[1]=t>>>32-d)}if(1===l&&h===w)c=[o];else if(64===w){const e=p?.length?p[0]:o>>>0,t=p?.length?p[1]:Math.round((o-e)/u);let n=e,a=32;for(I=1;I<=l;I++){const e=32-h*I%32;if(a<h){const i=n<<e>>>32-a,s=t<<32-a>>>32-a;n=t,c.push(i+s*2**(h-a)),a-=32-(h-a)}else c.push(n<<e>>>32-h),a-=h;0===a&&(a=32,n=t)}}else for(I=1;I<=l;I++){const e=32-h*I;c.push(o<<e>>>32-h)}}else{o-=a,i&&(o=0);for(let n=o;n<o+E;n+=g){switch(r){case 1:case 2:case 7:T=new DataView(e,n,1).getUint8(0);break;case 3:T=new DataView(e,n,2).getUint16(0,t);break;case 4:case 13:T=new DataView(e,n,4).getUint32(0,t);break;case 5:T=new DataView(e,n,4).getUint32(0,t)/new DataView(e,n+4,4).getUint32(0,t);break;case 6:T=new DataView(e,n,1).getInt8(0);break;case 8:T=new DataView(e,n,2).getInt16(0,t);break;case 9:T=new DataView(e,n,4).getInt32(0,t);break;case 10:T=new DataView(e,n,4).getInt32(0,t)/new DataView(e,n+4,4).getInt32(0,t);break;case 11:T=new DataView(e,n,4).getFloat32(0,t);break;case 12:T=new DataView(e,n,8).getFloat64(0,t);break;case 16:case 18:T=C(new DataView(e,n,8),0,t);break;case 17:T=F(new DataView(e,n,8),0,t);break;default:T=null}c.push(T)}}if(2===r){let e="";const t=c;for(c=[],I=0;I<t.length;I++)0===t[I]&&""!==e?(c.push(e),e=""):e+=String.fromCharCode(t[I]);""===e&&0!==c.length||c.push(e)}return n.values=c,!0}function D(e){const t=e[0],n=w(t,"TILEWIDTH"),a=w(t,"TILELENGTH"),i=w(t,"IMAGEWIDTH"),s=w(t,"IMAGELENGTH"),r=w(t,"BITSPERSAMPLE"),l=w(t,"SAMPLESPERPIXEL"),o=w(t,"SAMPLEFORMAT")??1,f=g(o,r),u=R(t),h=d(t,"GDAL_NODATA");let p=null;h?.length&&(p=h.map((e=>parseFloat(e))),p.some((e=>isNaN(e)))&&(p=null));const y=w(t,"COMPRESSION")??1;let S;switch(y){case 1:S="NONE";break;case 2:case 3:case 4:case 32771:S="CCITT";break;case 5:S="LZW";break;case 6:case 7:S="JPEG";break;case 32773:S="PACKBITS";break;case 8:case 32946:S="DEFLATE";break;case 34712:S="JPEG2000";break;case 34887:S="LERC";break;default:S=String(y)}let A=!0,M="";c.has(y)||(A=!1,M+="unsupported tag compression "+y),o>3&&(A=!1,M+="unsupported tag sampleFormat "+o),1!==r&&2!==r&&4!==r&&r%8!=0&&(A=!1,M+="unsupported tag bitsPerSample "+r);const m=I(t,"GEOASCIIPARAMS");let P;if(m){const e=m.split("|").find((e=>e.includes("ESRI PE String = "))),t=e?e.replace("ESRI PE String = ",""):"";P=t.startsWith("COMPD_CS")||t.startsWith("PROJCS")||t.startsWith("GEOGCS")?{wkid:null,wkt:t}:null}const b=T(t,"GEOTIEPOINTS"),O=T(t,"GEOPIXELSCALE"),L=T(t,"GEOTRANSMATRIX"),D=t.has("GEOKEYDIRECTORY")?t.get("GEOKEYDIRECTORY").data:null;let k,C,F=!1,v=!1;if(D){F=2===w(D,"GTRasterTypeGeoKey");const e=w(D,"GTModelTypeGeoKey");if(2===e){const e=w(D,"GeographicTypeGeoKey");e>=1024&&e<=32766&&(P={wkid:e}),P||32767!==e||(v=!0,P={wkid:4326})}else if(1===e){const e=w(D,"ProjectedCSTypeGeoKey");e>=1024&&e<=32766&&(P={wkid:e})}}if(O&&b&&b.length>=6?(k=[O[0],0,b[3]-b[0]*O[0],0,-Math.abs(O[1]),b[4]-b[1]*O[1]],F&&(k[2]-=.5*k[0]+.5*k[1],k[5]-=.5*k[3]+.5*k[4])):L&&16===L.length&&(k=F?[L[0],L[1],L[3]-.5*L[0],L[4],L[5],L[7]-.5*L[5]]:[L[0],L[1],L[3],L[4],L[5],L[7]]),k){const e=[{x:0,y:s},{x:0,y:0},{x:i,y:s},{x:i,y:0}];let t,n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;for(let i=0;i<e.length;i++)t=E(e[i],k),n=t.x>n?n:t.x,r=t.x<r?r:t.x,a=t.y>a?a:t.y,l=t.y<l?l:t.y;C={xmin:n,xmax:r,ymin:a,ymax:l,spatialReference:P}}else C={xmin:-.5,ymin:.5-s,xmax:i-.5,ymax:.5,spatialReference:P};v&&(C.xmax-C.xmin>400||Math.max(Math.abs(C.xmin),Math.abs(C.xmax))>361)&&(P=null,C.spatialReference=null);const G=U(e);let B,W,H,Y,_;if(G.length>0){H=Math.round(Math.log(i/w(G[0],"IMAGEWIDTH"))/Math.LN2);const e=G[G.length-1];Y=Math.round(Math.log(i/w(e,"IMAGEWIDTH"))/Math.LN2),B=w(e,"TILEWIDTH"),W=w(e,"TILELENGTH")}B=null!=Y&&Y>0?B||n:null,W=null!=Y&&Y>0?W||a:null,n&&(_=[{maxCol:Math.ceil(i/n)-1,maxRow:Math.ceil(s/a)-1,minRow:0,minCol:0}],G.forEach((e=>{_.push({maxCol:Math.ceil(w(e,"IMAGEWIDTH")/w(e,"TILEWIDTH"))-1,maxRow:Math.ceil(w(e,"IMAGELENGTH")/w(e,"TILELENGTH"))-1,minRow:0,minCol:0})})));const K=I(e[0],"GDAL_METADATA"),X=x(K);M+=" "+V({width:i,height:s,tileWidth:n,tileHeight:a,planes:l,ifds:e});return{width:i,height:s,tileWidth:n,tileHeight:a,planes:l,isBSQ:u,pixelType:f,compression:S,noData:p,hasMaskBand:N(e).length===G.length+1,isSupported:A,message:M,extent:C,isPseudoGeographic:v,affine:O?null:k,firstPyramidLevel:H,maximumPyramidLevel:Y,pyramidBlockWidth:B,pyramidBlockHeight:W,tileBoundary:_,metadata:X}}function R(e,t){const n=d(e,"PLANARCONFIGURATION");return n?2===n[0]:!!t&&t.isBSQ}function U(e){return e.filter((e=>1===w(e,"NEWSUBFILETYPE")))}function N(e){return e.filter((e=>{const t=4==(4&(w(e,"NEWSUBFILETYPE")??0)),n=4===w(e,"PHOTOMETRICINTERPRETATION");return t&&n}))}function k(e){const{littleEndian:t,isBigTiff:n,firstIFDPos:a}=G(e);let i=a;const s=[];do{const a=B(e,t,i,0,r.tiffTags,n?8:4);if(!a.success)break;s.push(a.ifd),i=a.nextIFD}while(i>0);return{...D(s),littleEndian:t,isBigTiff:n,ifds:s,pyramidIFDs:U(s),maskIFDs:N(s)}}function C(e,t,n){const a=e.getUint32(t,n),i=e.getUint32(t+4,n);return n?i*u+a:a*u+i}function F(e,t,n){let a=n?e.getInt32(t,n):e.getUint32(t,n),i=n?e.getUint32(t+4,n):e.getInt32(t+4,n);const s=(n?a:i)>=0?1:-1;n?a*=s:i*=s;return s*(n?i*u+a:a*u+i)}function v(e,t,n,a){return a?C(e,t,n):e.getUint32(t,n)}function G(e){const t=new DataView(e,0,16),n=t.getUint16(0,!1);let a=null;if(18761===n)a=!0;else{if(19789!==n)throw new Error("unexpected endianess byte");a=!1}const i=t.getUint16(2,a);if(42!==i&&43!==i)throw new Error("unexpected tiff identifier");let s=4;const r=43===i;if(r){const e=t.getUint16(s,a);if(s+=2,8!==e)throw new Error("unsupported bigtiff version");if(0!==t.getUint16(s,a))throw new Error("unsupported bigtiff version");s+=2}return{littleEndian:a,isBigTiff:r,firstIFDPos:v(t,s,a,r)}}function B(e,n,a,i=0,s=r.tiffTags,l=4){const o=p(e,n,a,i,s,l);let f;const u=o.ifd;if(u){if(r.ifdTags.forEach(((t,a)=>{u.has(a)&&(f=u.get(a),f.data=p(e,n,f.valueOffset-i,i,t).ifd)})),u.has("GEOKEYDIRECTORY")){f=u.get("GEOKEYDIRECTORY");const t=f.values;if(t&&t.length>4){const a=t[0]+"."+t[1]+"."+t[2];f.data=p(e,n,f.valueOffset+6-i,i,r.geoKeys,2).ifd,f.data&&f.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[a]})}}if(u.has("XMP")){f=u.get("XMP");const e=f.values;"number"==typeof e[0]&&7===f.type&&(f.values=[t.bytesToUTF8(new Uint8Array(e))])}}return o}function V(e){const{width:t,height:n,tileHeight:a,tileWidth:i}=e,s=e.planes,r=i?i*a:t*n,l=w(e.ifds[0],"BITSPERSAMPLE");let o="";return r*s>2**30/(l>8?l/8:1)&&(o=i?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),o}function W(e,t,n,a,i){const s=a?4:1,r=n*s*i;a&&(e=new Uint8Array(e.buffer));for(let f=0;f<t;f++){const t=f*r;for(let n=i;n<r;n++)e[t+n]+=e[t+n-i]}if(!a)return e;const l=new Uint8Array(e.length),o=n*i;for(let f=0;f<t;f++){const t=f*r;for(let n=0;n<o;n++)for(let a=0;a<s;a++)l[t+n*s+a]=e[t+n+(s-a-1)*o]}return new Float32Array(l.buffer)}async function H(e,t){const{headerInfo:n,ifd:a,offsets:i,sizes:r}=t,l=[];for(let s=0;s<i.length;s++){r[s];const t=await m(e,n.littleEndian,a,i[s],r[s]||e.byteLength);l.push(t)}const o=R(a,n),f=w(a,"BITSPERSAMPLE"),u=g(w(a,"SAMPLEFORMAT")??1,f),c=w(a,"SAMPLESPERPIXEL")||n.planes,E=h(u),d=w(a,"TILEWIDTH"),T=w(a,"TILELENGTH"),I=w(a,"COMPRESSION")??1,p=d*T;let y;const S=[];let A=l[0];const M=34887===I;for(let s=0;s<c;s++){if(y=new E(p),l.length===c)A=l[s],A.length===p&&(y=A);else if(A.length)if(o||M)y=A.length===p?A:A.slice(p*s,p*(s+1));else for(let e=0;e<p;e++)y[e]=A[e*c+s];S.push(y)}const P=n.noData?n.noData[0]:t.noDataValue,b=n.metadata?n.metadata.statistics:null,x=b?b.map((e=>e.min)):null,L=b?b.map((e=>e.max)):null,D={pixelType:u,width:d,height:T,pixels:S,noDataValue:P};return null!=P?s.convertNoDataToMask(D,P):x&&L&&t.applyMinMaxConstraint&&(D.mask=O(S,x,L)),D}async function Y(e,t={}){const n=t.pyramidLevel||0,a=t.headerInfo||k(e),{ifds:i,noData:r}=a;if(0===i.length)throw new Error("no valid image file directory");const l=V(a);if(l)throw l;let o=null;const f=-1===n?i[i.length-1]:i[n],u=r??t.noDataValue;return o=a.tileWidth?await P(e,a,f):b(e,a,f),o?(null!=u&&s.convertNoDataToMask(o,u),o):o}e.decode=Y,e.decodeTileOrStrip=H,e.getImageInfo=D,e.getMaskIFDs=N,e.getPyramidIFDs=U,e.isBSQConfig=R,e.parseFieldValues=L,e.parseHeader=k,e.parseIFD=B,e.parseSignature=G,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
