/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../geometry","../../geometry/support/spatialReferenceUtils","./ControlPointsGeoreference","../../geometry/Extent","../../geometry/Point"],(function(e,t,n,o,i,r){"use strict";const a=100,c=.5;async function s(e,t){e.loaded||await e.load();const{width:s,height:l}=e.content,{spatialReference:y}=t,f=n.getInfo(y);let p=!1;if(f){const e=f.valid[1]-f.valid[0];t.width>e&&(t=new i({xmin:f.valid[0],ymin:t.ymin,xmax:f.valid[1],ymax:t.ymax,spatialReference:t.spatialReference}),p=!0)}const x=t.expand(c),{center:d,width:u,height:P}=x,m=p||s>l?u:s/l*P,h=p||s>l?l/s*u:P,w=d.x-m/2,g=d.x+m/2,R=d.y+h/2,v=d.y-h/2;return new o({controlPoints:[{sourcePoint:{x:a,y:l-a},mapPoint:new r({x:w,y:v,spatialReference:y})},{sourcePoint:{x:a,y:a},mapPoint:new r({x:w,y:R,spatialReference:y})},{sourcePoint:{x:s-a,y:a},mapPoint:new r({x:g,y:R,spatialReference:y})},{sourcePoint:{x:s-a,y:l-a},mapPoint:new r({x:g,y:v,spatialReference:y})}],width:s,height:l})}function l(e){const t=e.georeference;if("control-points"!==t.type)return null;const n={wkid:0},{width:i,height:a}=t,c=t.controlPoints;return new o({controlPoints:c.map((e=>{const{x:t,y:o}=e.sourcePoint;return{sourcePoint:{x:t,y:o},mapPoint:new r({x:t,y:a-o,spatialReference:n})}})),width:i,height:a})}e.createDefaultControlPointsGeoreference=s,e.createLocalModeControlPointsGeoreference=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
