/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../PixelBlock","../rasterFunctionConstants","../rasterFormats/pixelRangeUtils"],(function(t,e,n,r){"use strict";const o=new Map;function a(t){return o.get(t)}o.set(n.localTrigonometricOperation.acos,[0,Math.PI]),o.set(n.localTrigonometricOperation.asin,[-Math.PI/2,Math.PI/2]),o.set(n.localTrigonometricOperation.atan,[-Math.PI/2,Math.PI/2]),o.set(n.localTrigonometricOperation.cos,[-1,1]),o.set(n.localTrigonometricOperation.sin,[-1,1]),o.set(n.localLogicalOperation.booleanAnd,[0,1]),o.set(n.localLogicalOperation.booleanNot,[0,1]),o.set(n.localLogicalOperation.booleanOr,[0,1]),o.set(n.localLogicalOperation.booleanXOr,[0,1]),o.set(n.localLogicalOperation.equalTo,[0,1]),o.set(n.localLogicalOperation.notEqual,[0,1]),o.set(n.localLogicalOperation.greaterThan,[0,1]),o.set(n.localLogicalOperation.greaterThanEqual,[0,1]),o.set(n.localLogicalOperation.lessThan,[0,1]),o.set(n.localLogicalOperation.lessThanEqual,[0,1]),o.set(n.localLogicalOperation.isNull,[0,1]);const l=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3];function s(t,e=!1){const n=t.map((t=>t.mask)),r=n.filter((t=>null!=t)),o=t[0].pixels[0].length;if(0===r.length)return new Uint8Array(o).fill(255);const a=r[0],l=new Uint8Array(a);if(1===r.length)return l;if(!e){for(let t=1;t<r.length;t++){const e=r[t];for(let t=0;t<l.length;t++)l[t]&&(l[t]=e[t]?255:0)}return l}if(r.length!==n.length)return new Uint8Array(o).fill(255);for(let s=1;s<r.length;s++){const t=r[s];for(let e=0;e<l.length;e++)0===l[e]&&(l[e]=t[e]?255:0)}return l}function c(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]+a[e]);return s}function i(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand("f32",a);return l.set(o),l}function f(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]-a[e]);return s}function u(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]*a[e]);return s}function h(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=Math.sign(o[e])*Math.floor(Math.abs(o[e])));return l}function g(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]/a[e]);return s}function p(t,e,n){return g(t,e,"f32")}function m(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=Math.floor(o[e]/a[e]));return s}function d(t,r,o,a){const l=t[0],s=l.length,c=e.createEmptyBand(o,s);if(a===n.localTrigonometricOperation.atanh){for(let t=0;t<s;t++)if(r[t]){const e=l[t];Math.abs(e)>=1?r[t]=0:c[t]=Math.atanh(e)}return c}const i=a===n.localTrigonometricOperation.asin?Math.asin:Math.acos;for(let e=0;e<s;e++)if(r[e]){const t=l[e];Math.abs(t)>1?r[e]=0:c[e]=i(t)}return c}function y(t,n,r,o){const[a]=t,l=a.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o(a[e]));return s}function M(t,n,r,o){const[a,l]=t,s=a.length,c=e.createEmptyBand(r,s);for(let e=0;e<s;e++)n&&!n[e]||(c[e]=o(a[e],l[e]));return c}function E(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]&a[e]);return s}function B(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]<<a[e]);return s}function O(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=~o[e]);return l}function w(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]|a[e]);return s}function T(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]>>a[e]);return s}function b(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]^a[e]);return s}function L(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]&&a[e]?1:0);return s}function x(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]?0:1);return l}function A(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]||a[e]?1:0);return s}function P(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=(o[e]?1:0)^(a[e]?1:0));return s}function k(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]===a[e]?1:0);return s}function N(t,n,r,o){const[a]=t,l=a.length,s=e.createEmptyBand(r,l),c=o===Math.E;for(let e=0;e<l;e++)n&&!n[e]||(s[e]=c?Math.exp(a[e]):o**a[e]);return s}function q(t,e,n){return N(t,e,n,10)}function U(t,e,n){return N(t,e,n,2)}function I(t,e,n){return N(t,e,n,Math.E)}function F(t,n,r,o){const[a]=t,l=a.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(a[e]<=0?n[e]=0:s[e]=o(a[e]));return s}function C(t,e,n){return F(t,e,n,Math.log10)}function S(t,e,n){return F(t,e,n,Math.log2)}function z(t,e,n){return F(t,e,n,Math.log)}function R(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]>a[e]?1:0);return s}function W(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]>=a[e]?1:0);return s}function j(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]<a[e]?1:0);return s}function v(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]<=a[e]?1:0);return s}function D(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);if(!n)return l;for(let e=0;e<a;e++)l[e]=n[e]?0:1;return l}function V(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]%a[e]);return s}function X(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=-o[e]);return l}function G(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(s[e]=o[e]===a[e]?0:1);return s}function H(t,n,r){const[o,a]=t,l=o.length,s=e.createEmptyBand(r,l),c=new Uint8Array(l);for(let e=0;e<l;e++)null!=n&&!n[e]||0!==o[e]||(s[e]=a[e],c[e]=255);return{band:s,mask:c}}function J(t,n,r){const[o,a,l]=t,s=o.length,c=e.createEmptyBand(r,s);for(let e=0;e<s;e++)n&&!n[e]||(c[e]=o[e]?a[e]:l[e]);return c}function K(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=a[e];for(let r=1;r<o;r++){const o=t[r][e];n<o&&(n=o)}s[e]=n}return s}function Q(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=a[e];for(let r=1;r<o;r++){const o=t[r][e];n>o&&(n=o)}s[e]=n}return s}function Y(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=a[e],r=n;for(let a=1;a<o;a++){const o=t[a][e];r<o?r=o:n>o&&(n=o)}s[e]=r-n}return s}function Z(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=0;for(let r=0;r<o;r++)n+=t[r][e];s[e]=n/o}return s}function $(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e])for(let n=0;n<o;n++){const r=t[n];s[e]+=r[e]}return s}function _(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e]){const n=new Float32Array(o);let r=0;for(let l=0;l<o;l++){const o=t[l];r+=o[e],n[l]=o[e]}r/=o;let a=0;for(let t=0;t<o;t++)a+=(n[t]-r)**2;s[e]=Math.sqrt(a/o)}return s}function tt(t,n,r){const o=t.length;if(o<2)return t[0];const a=Math.floor(o/2),[l]=t,s=l.length,c=e.createEmptyBand(r,s),i=new Float32Array(o),f=o%2==1;for(let e=0;e<s;e++)if(!n||n[e]){for(let n=0;n<o;n++)i[n]=t[n][e];i.sort(),c[e]=f?i[a]:(i[a]+i[a-1])/2}return c}function et(t,n,r){const[o,a]=t;if(null==a)return o;const l=o.length,s=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n[e]&&(o[e]===a[e]?s[e]=o[e]:n[e]=0);return s}function nt(t,n,r){const o=t.length;if(o<=2)return et(t,n,r);const a=t[0].length,l=e.createEmptyBand(r,a),s=new Map;for(let e=0;e<a;e++)if(!n||n[e]){let n;s.clear();for(let l=0;l<o;l++)n=t[l][e],s.set(n,s.has(n)?s.get(n)+1:1);let r=0,a=0;for(const t of s.keys())r=s.get(t),r>a&&(a=r,n=t);l[e]=n}return l}function rt(t,n,r){const o=t.length;if(o<=2)return et(t,n,r);const a=t[0].length,l=e.createEmptyBand(r,a),s=new Map;for(let e=0;e<a;e++)if(!n||n[e]){let n;s.clear();for(let l=0;l<o;l++)n=t[l][e],s.set(n,s.has(n)?s.get(n)+1:1);let r=0,a=t.length;for(const t of s.keys())r=s.get(t),r<a&&(a=r,n=t);l[e]=n}return l}function ot(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=e.createEmptyBand(r,l),c=new Set;for(let e=0;e<l;e++)if(!n||n[e]){let n;c.clear();for(let r=0;r<o;r++)n=t[r][e],c.add(n);s[e]=c.size}return s}const at=new Map,lt=new Map,st=new Map,ct=new Map;function it(){at.size||(at.set(4,Math.sqrt),at.set(6,Math.acos),at.set(7,Math.asin),at.set(8,Math.atan),at.set(9,Math.atanh),at.set(10,Math.abs),at.set(21,Math.cos),at.set(22,Math.cosh),at.set(48,Math.floor),at.set(49,Math.ceil),at.set(51,Math.sin),at.set(52,Math.sinh),at.set(56,Math.tan),at.set(57,Math.tanh),at.set(59,Math.acosh),at.set(60,Math.asinh),at.set(65,Math.floor),lt.set(5,Math.pow),lt.set(61,Math.atan2),st.set(1,c),st.set(2,f),st.set(3,u),st.set(11,E),st.set(12,B),st.set(13,O),st.set(14,w),st.set(15,T),st.set(16,b),st.set(17,L),st.set(18,x),st.set(19,A),st.set(20,P),st.set(23,g),st.set(24,k),st.set(25,I),st.set(26,q),st.set(27,U),st.set(28,R),st.set(29,W),st.set(30,h),st.set(31,D),st.set(32,i),st.set(33,j),st.set(34,v),st.set(35,z),st.set(36,C),st.set(37,S),st.set(44,V),st.set(45,X),st.set(46,G),st.set(64,p),st.set(65,m),st.set(76,J),st.set(78,J),ct.set(38,nt),ct.set(39,K),ct.set(40,Z),ct.set(41,tt),ct.set(42,Q),ct.set(43,rt),ct.set(47,Y),ct.set(54,_),ct.set(55,$),ct.set(58,ot),ct.set(66,nt),ct.set(67,K),ct.set(68,Z),ct.set(69,tt),ct.set(70,Q),ct.set(71,rt),ct.set(72,Y),ct.set(73,_),ct.set(74,$),ct.set(75,ot))}function ft(t,e,n,o){let[a,l]=r.getPixelValueRange(n);const s=n.startsWith("u")||n.startsWith("s");s&&(a-=1e-5,l+=1e-5);for(let r=0;r<e.length;r++)if(e[r]){const n=t[r];isNaN(n)||n<a||n>l?e[r]=0:o[r]=s?Math.round(n):n}}function ut(t,r,a={}){it();let l=s(t,r>=66&&r<=75);const{outputPixelType:c="f32"}=a,i=!ct.has(r)||a.processAsMultiband,f=i?t[0].pixels.length:1,u=[];for(let s=0;s<f;s++){const a=ct.has(r)&&!i?t.flatMap((t=>t.pixels)):t.map((t=>t.pixels[s]));let f,h=!0;if(r===n.localConditionalOperation.setNull){const t=H(a,l,c);f=t.band,l=t.mask,h=!1}else if(st.has(r)){f=st.get(r)(a,l,"f64")}else if(at.has(r))f=r===n.localTrigonometricOperation.asin||r===n.localTrigonometricOperation.acos||r===n.localTrigonometricOperation.atanh?d(a,l,"f64",r):y(a,l,"f64",at.get(r));else if(lt.has(r))f=M(a,l,"f64",lt.get(r));else if(ct.has(r)){f=ct.get(r)(a,l,"f64")}else f=a[0],h=!1;if(h&&r!==n.localLogicalOperation.isNull&&!o.has(r)){const t=e.createEmptyBand(c,f.length);l||(l=new Uint8Array(f.length).fill(255)),ft(f,l,c,t),f=t}u.push(f)}const h=t[0];return new e({width:h.width,height:h.height,pixelType:c,mask:r===n.localLogicalOperation.isNull?null:l,pixels:u})}t.getOutputDomain=a,t.local=ut,t.operandsCount=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
