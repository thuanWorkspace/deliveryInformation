/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/jsonMap","../PixelBlock","./customBandIndexUtils","./pixelUtils"],(function(n,e,t,r,a){"use strict";const l=new e.JSONMap({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});function o(n,e){if(!a.isValidPixelBlock(n))return n;const{equation:l,method:o}=e,i=e.bandIndexes.map((n=>n-1)),{pixels:s,mask:M}=n;let B;switch(o){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":B=c(M,s[i[0]],s[i[1]]);break;case"ndwi":B=c(M,s[i[1]],s[i[0]]);break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":B=u(M,s[i[0]],s[i[1]]);break;case"ci-g":case"ci-re":B=f(M,s[i[0]],s[i[1]]);break;case"savi":B=d(M,s[i[0]],s[i[1]],i[2]+1);break;case"tsavi":B=w(M,s[i[0]],s[i[1]],i[2]+1,i[3]+1,i[4]+1);break;case"msavi":B=h(M,s[i[0]],s[i[1]]);break;case"gemi":B=g(M,s[i[0]],s[i[1]]);break;case"pvi":B=y(M,s[i[0]],s[i[1]],i[2]+1,i[3]+1);break;case"gvitm":B=b(M,[s[i[0]],s[i[1]],s[i[2]],s[i[3]],s[i[4]],s[i[5]]]);break;case"sultan":B=m(M,[s[i[0]],s[i[1]],s[i[2]],s[i[3]],s[i[4]],s[i[5]]]);break;case"vari":B=v(M,[s[i[0]],s[i[1]],s[i[2]]]);break;case"mtvi2":B=k(M,[s[i[0]],s[i[1]],s[i[2]]]);break;case"rtvi-core":B=A(M,[s[i[0]],s[i[1]],s[i[2]]]);break;case"evi":B=F(M,[s[i[0]],s[i[1]],s[i[2]]]);break;case"wndwi":B=p(M,[s[i[0]],s[i[1]],s[i[2]]],i[3]?i[3]+1:.5);break;case"bai":B=x(M,s[i[0]],s[i[1]]);break;case"custom":B=r.calculateCustomBandIndex(M,s,l);break;default:return n}const I=null!=M?new Uint8Array(M.length):null;null!=M&&null!=I&&I.set(M);const q=new t({width:n.width,height:n.height,pixelType:"f32",pixels:B,mask:I});return q.updateStatistics(),q}function i(n,e,r,a){const{mask:l,pixels:o,width:i,height:s}=n,c=o[r],u=o[e],f=u.length,d=a?new Uint8Array(f):new Float32Array(f),w=a?100:1,h=a?100.5:0;for(let t=0;t<f;t++)if(null==l||l[t]){const n=c[t],e=u[t],r=n+e;r&&(d[t]=(n-e)/r*w+h)}const g=new t({width:i,height:s,mask:l,pixelType:a?"u8":"f32",pixels:[d]});return g.updateStatistics(),g}function s(n){const e=new Float32Array(9);return e[3*n[0]]=1,e[3*n[1]+1]=1,e[3*n[2]+2]=1,e}function c(n,e,t){const r=t.length,a=new Float32Array(r);for(let l=0;l<r;l++)if(null==n||n[l]){const n=e[l],r=t[l],o=n+r;o&&(a[l]=(n-r)/o)}return[a]}function u(n,e,t){const r=t.length,a=new Float32Array(r);for(let l=0;l<r;l++)if(null==n||n[l]){const n=e[l],r=t[l];r&&(a[l]=n/r)}return[a]}function f(n,e,t){const r=e.length,a=new Float32Array(r);for(let l=0;l<r;l++)if(null==n||n[l]){const n=e[l],r=t[l];r&&(a[l]=n/r-1)}return[a]}function d(n,e,t,r){const a=t.length,l=new Float32Array(a);for(let o=0;o<a;o++)if(null==n||n[o]){const n=t[o],a=e[o],i=a+n+r;i&&(l[o]=(a-n)/i*(1+r))}return[l]}function w(n,e,t,r,a,l){const o=t.length,i=new Float32Array(o),s=-a*r+l*(1+r*r);for(let c=0;c<o;c++)if(null==n||n[c]){const n=t[c],l=e[c],o=a*l+n+s;o&&(i[c]=r*(l-r*n-a)/o)}return[i]}function h(n,e,t){const r=t.length,a=new Float32Array(r);for(let l=0;l<r;l++)if(null==n||n[l]){const n=t[l],r=e[l];a[l]=.5*(2*(r+1)-Math.sqrt((2*r+1)**2-8*(r-n)))}return[a]}function g(n,e,t){const r=t.length,a=new Float32Array(r);for(let l=0;l<r;l++)if(null==n||n[l]){const n=t[l],r=e[l];if(1!==n){const e=(2*(r*r-n*n)+1.5*r+.5*n)/(r+n+.5);a[l]=e*(1-.25*e)-(n-.125)/(1-n)}}return[a]}function y(n,e,t,r,a){const l=t.length,o=new Float32Array(l),i=Math.sqrt(1+r*r);for(let s=0;s<l;s++)if(null==n||n[s]){const n=t[s],l=e[s];o[s]=(l-r*n-a)/i}return[o]}function b(n,e){const[t,r,a,l,o,i]=e,s=t.length,c=new Float32Array(s);for(let u=0;u<s;u++)(null==n||n[u])&&(c[u]=-.2848*t[u]-.2435*r[u]-.5436*a[u]+.7243*l[u]+.084*o[u]-1.18*i[u]);return[c]}function m(n,e){const[t,,r,a,l,o]=e,i=t.length,s=new Float32Array(i),c=new Float32Array(i),u=new Float32Array(i);for(let f=0;f<i;f++)(null==n||n[f])&&(s[f]=o[f]?l[f]/o[f]*100:0,c[f]=t[f]?l[f]/t[f]*100:0,u[f]=a[f]?r[f]/a[f]*(l[f]/a[f])*100:0);return[s,c,u]}function v(n,e){const[t,r,a]=e,l=t.length,o=new Float32Array(l);for(let i=0;i<l;i++)if(null==n||n[i])for(i=0;i<l;i++){const n=t[i],e=r[i],l=e+n-a[i];l&&(o[i]=(e-n)/l)}return[o]}function k(n,e){const[t,r,a]=e,l=t.length,o=new Float32Array(l);for(let i=0;i<l;i++)if(null==n||n[i])for(i=0;i<l;i++){const n=t[i],e=r[i],l=a[i],s=Math.sqrt((2*n+1)**2-6*n-5*Math.sqrt(e)-.5);o[i]=1.5*(1.2*(n-l)-2.5*(e-l))*s}return[o]}function A(n,e){const[t,r,a]=e,l=t.length,o=new Float32Array(l);for(let i=0;i<l;i++)if(null==n||n[i])for(i=0;i<l;i++){const n=t[i],e=r[i],l=a[i];o[i]=100*(n-e)-10*(n-l)}return[o]}function F(n,e){const[t,r,a]=e,l=t.length,o=new Float32Array(l);for(let i=0;i<l;i++)if(null==n||n[i])for(i=0;i<l;i++){const n=t[i],e=r[i],l=n+6*e-7.5*a[i]+1;l&&(o[i]=2.5*(n-e)/l)}return[o]}function p(n,e,t=.5){const[r,a,l]=e,o=a.length,i=new Float32Array(o);for(let s=0;s<o;s++)if(null==n||n[s])for(s=0;s<o;s++){const n=r[s],e=a[s],o=l[s],c=n+t*e+(1-t)*o;c&&(i[s]=(n-t*e-(1-t)*o)/c)}return[i]}function x(n,e,t){const r=t.length,a=new Float32Array(r);for(let l=0;l<r;l++)if(null==n||n[l])for(l=0;l<r;l++){const n=(.1-e[l])**2+(.06-t[l])**2;n&&(a[l]=1/n)}return[a]}n.bandIndexMethodMap=l,n.calculateBandIndex=o,n.calculateNDVI=i,n.getBandMatrix3=s,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})}));
