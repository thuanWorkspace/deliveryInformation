/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/has"],(function(e,t){"use strict";const n=new Set(["+","-","*","/","(",")"]);function r(e,t){(e=e.replaceAll(" ","")).startsWith("-")&&(e="0"+e),e.startsWith("+")&&(e=e.slice(1,e.length));const r=e.split(""),l=[],o=[];let s="";for(let a=0;a<r.length;a++){const e=r[a];if(n.has(e))""!==s&&o.push(parseFloat(s)),l.push(e),s="";else{if("b"===e.toLowerCase()){a++,s=e.concat(r[a]),o.push(t[parseInt(s[1],10)-1]),s="";continue}s=s.concat(e),a===r.length-1&&o.push(parseFloat(s))}}return{ops:l,nums:o}}function l(e,t,n,r){if("number"==typeof n&&"number"==typeof r)return n+r;let l,o,s;"number"==typeof n?(s=r,l=s.length,o=new Float32Array(l),o.fill(n)):(l=n.length,o=n,r.constructor===Number?(s=new Float32Array(l),s.fill(r)):s=r);const a=new Float32Array(l);switch(t){case"+":for(let t=0;t<l;t++)(null==e||e[t])&&(a[t]=o[t]+s[t]);break;case"-":for(let t=0;t<l;t++)(null==e||e[t])&&(a[t]=o[t]-s[t]);break;case"*":for(let t=0;t<l;t++)(null==e||e[t])&&(a[t]=o[t]*s[t]);break;case"/":for(let t=0;t<l;t++)(null==e||e[t])&&s[t]&&(a[t]=o[t]/s[t]);break;case"(":case")":throw new Error("encountered error with custom band index equation")}return a}function o(e,t){e.splice(t,1);let n=0,r=0;do{n=0,r=0;for(let t=0;t<e.length;t++)if("("===e[t])n=t;else if(")"===e[t]){r=t;break}r===n+1&&e.splice(n,2)}while(r===n+1);return e}function s(e){if(1===e.length)return{opIndex:0,numIndex:0};let t=0,n=0;for(let s=0;s<e.length;s++)if("("===e[s])t=s;else if(")"===e[s]){n=s;break}const r=0===n?e:e.slice(t+1,n);let l=-1;for(let s=0;s<r.length;s++)if("*"===r[s]||"/"===r[s]){l=s;break}if(l>-1)n>0&&(l+=t+1);else{for(let e=0;e<r.length;e++)if("+"===r[e]||"-"===r[e]){l=e;break}n>0&&(l+=t+1)}let o=0;for(let s=0;s<l;s++)"("===e[s]&&o++;return{opIndex:l,numIndex:l-o}}function a(e,t,n){let a,{ops:u,nums:c}=r(n,t);if(0===u.length){const e=1===c.length?c[0]:t[0];if(e instanceof Float32Array)return[e];const n=new Float32Array(t[0].length);return"number"==typeof e?n.fill(e):n.set(e),[n]}for(;u.length>0;){const{numIndex:t,opIndex:n}=s(u);if(a=l(e,u[n],c[t],c[t+1]),1===u.length)break;u=o(u,n),c.splice(t,2,a)}return[a]}e.calculateCustomBandIndex=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
