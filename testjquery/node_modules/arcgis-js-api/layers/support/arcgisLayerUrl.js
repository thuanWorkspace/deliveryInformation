/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../core/urlUtils","../../chunks/persistableUrlUtils"],(function(e,r,t){"use strict";const s={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},l=Object.values(s),n=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${l.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),i=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${l.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),u=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function a(e){return!!n.test(e)}function o(e){if(null==e)return null;const t=r.urlToObject(e),l=t?.path.match(n)||t?.path.match(i);if(!l)return null;const[,u,a,o,c]=l,d=a.indexOf("/");return{title:v(-1!==d?a.slice(d+1):a),serverType:s[o.toLowerCase()],sublayer:null!=c&&""!==c?parseInt(c,10):null,url:{path:u}}}function c(e){const t=r.urlToObject(e).path.match(u);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function v(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function d(e,r){const t=[];if(e){const r=o(e);null!=r&&r.title&&t.push(r.title)}if(r){const e=v(r);t.push(e)}if(2===t.length){if(t[0].toLowerCase().includes(t[1].toLowerCase()))return t[0];if(t[1].toLowerCase().includes(t[0].toLowerCase()))return t[1]}return t.join(" - ")}function f(e){if(!e)return!1;const r=".arcgis.com/",t="//services",s="//tiles",l="//features",n=(e=e.toLowerCase()).includes(r),i=e.includes(t)||e.includes(s)||e.includes(l);return n&&i}function m(e,t){return e?r.removeTrailingSlash(r.removeQueryParameters(e,t)):e}function p(e){let{url:t}=e;if(!t)return{url:t};t=r.removeQueryParameters(t,e.logger);const s=r.urlToObject(t),l=o(s.path);let n;if(null!=l)null!=l.sublayer&&null==e.layer.layerId&&(n=l.sublayer),t=l.url.path;else if(e.nonStandardUrlAllowed){const e=c(s.path);null!=e&&(t=e.serviceUrl,n=e.sublayerId)}return{url:r.removeTrailingSlash(t),layerId:n}}function y(e,s,l,n,i){t.write(s,n,"url",i),n.url&&null!=e.layerId&&(n.url=r.join(n.url,l,e.layerId.toString()))}function S(e){if(!e)return!1;const r=e.toLowerCase(),t=r.includes("/services/"),s=r.includes("/mapserver/wmsserver"),l=r.includes("/imageserver/wmsserver"),n=r.includes("/wmsserver");return t&&(s||l||n)}function h(e){if(!e)return!1;const t=new r.Url(r.makeAbsolute(e)),s=t.authority?.toLowerCase();return"server.arcgisonline.com"===s||"services.arcgisonline.com"===s}e.cleanTitle=v,e.isArcGISUrl=a,e.isHostedAgolService=f,e.isServerOrServicesAGOLUrl=h,e.isWmsServer=S,e.parse=o,e.parseNonStandardSublayerUrl=c,e.sanitizeUrl=m,e.sanitizeUrlWithLayerId=p,e.serverTypes=l,e.titleFromUrlAndName=d,e.writeUrlWithLayerId=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
