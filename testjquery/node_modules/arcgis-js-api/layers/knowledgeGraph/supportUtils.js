/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../core/Error","../../rest/knowledgeGraphService","../../rest/knowledgeGraph/GraphQueryStreaming"],(function(n,e,m,i){"use strict";function a(n){if(!n.spatialReference.isWGS84)throw new e("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let m;return m=n.xmax>180&&n.xmin<180?[[[n.xmin,n.ymin],[n.xmin,n.ymax],[180,n.ymax],[180,n.ymin],[n.xmin,n.ymin]],[[-180,n.ymin],[-180,n.ymax],[n.xmax-360,n.ymax],[n.xmax-360,n.ymin],[-180,n.ymin]]]:n.xmax>180&&n.xmin>180?[[[n.xmin-360,n.ymin],[n.xmin-360,n.ymax],[n.xmax-360,n.ymax],[n.xmax-360,n.ymin],[n.xmin-360,n.ymin]]]:n.xmax>-180&&n.xmin<-180?[[[n.xmin+360,n.ymin],[n.xmin+360,n.ymax],[180,n.ymax],[180,n.ymin],[n.xmin+360,n.ymin]],[[-180,n.ymin],[-180,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[-180,n.ymin]]]:n.xmax<-180&&n.xmin<-180?[[[n.xmin+360,n.ymin],[n.xmin+360,n.ymax],[n.xmax+360,n.ymax],[n.xmax+360,n.ymin],[n.xmin+360,n.ymin]]]:[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]],m}async function x(n,e){const a=[],x=new Map,t=[];if(e.dataModel?.relationshipTypes)for(const m of e.dataModel.relationshipTypes)m.name&&x.set(m.name,[]);for(const m of n)x.has(m.typeName)&&x.get(m.typeName)?.push(m.id);for(const[y,o]of x){if(o.length<1)continue;const n=new i({openCypherQuery:`MATCH (n)-[r:${y}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:o}});t.push(m.executeQueryStreaming(e,n).then((async n=>{const e=n.resultRowsStream.getReader();for(;;){const{done:n,value:m}=await e.read();if(n)break;for(const e of m)a.push({id:e[0],typeName:e[1]}),a.push({id:e[2],typeName:e[3]})}})))}return await Promise.all(t),a}n.extentToInBoundsRings=a,n.getRelationshipEndNodeIds=x,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})}));
