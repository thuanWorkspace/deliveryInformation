/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../geometry","../graphics/featureConversionUtils","../graphics/OptimizedFeature","../../geometry/support/jsonUtils"],(function(e,t,r,i){"use strict";const s="ESRI__DESTINATION_ID",o="ESRI__ORIGIN_ID";class n{constructor(){this._featureLookup=new Map}static getInstance(){return n.instance||(n.instance=new n),n.instance}static resetInstance(){n.instance&&(n.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const r=this.readFromStoreById(e);r&&t.push(r)})),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,n,p){const a=[];return e.forEach((e=>{if(!e?.id)return;e.properties||(e.properties=[]);let u,c=null;if(p&&e.properties[p]&&(c=t.convertFromGeometry(e.properties[p])),"originId"in e&&"destinationId"in e&&(e.properties[o]=e.originId,e.properties[s]=e.destinationId),e.properties[n]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const t=this._featureLookup.get(e.id),s=JSON.parse(JSON.stringify(Object.assign(t.attributes,e.properties)));p&&e.properties[p]&&(s[p]=i.fromJSON(e.properties[p])),u=new r.OptimizedFeature(c?JSON.parse(JSON.stringify(c)):t?.geometry?JSON.parse(JSON.stringify(t.geometry)):null,s,null,e.properties[n])}else u=new r.OptimizedFeature(c?JSON.parse(JSON.stringify(c)):null,e.properties,null,e.properties[n]);this._featureLookup.set(e.id,u),a.push(u)})),a}}return n}));
