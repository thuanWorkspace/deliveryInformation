/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../core/Collection","../../core/asyncUtils","../../core/Error","../../core/Logger","../../core/accessorSupport/watch","../../core/accessorSupport/trackingUtils"],(function(e,r,t,n,o,s,f){"use strict";const c=new r,i=new WeakMap;function a(e){u(e)&&c.push(new WeakRef(e))}function l(e){const r=c.find((r=>r.deref()===e));r&&c.remove(r)}function u(e){return null!=e&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e}function h(e,r){return Number.isFinite(e)&&Number.isFinite(r)?r<=0?e:h(r,e%r):0}let d=0,v=0;function g(){const e=Date.now();let r=!1;for(const t of c){const n=t.deref();if(n){if(n.refreshInterval){e-(i.get(n)??0)+5>=6e4*n.refreshInterval&&(i.set(n,e),n.refresh(e))}}else r=!0}if(r)for(let t=c.length-1;t>=0;t--){c.at(t).deref()||c.removeAt(t)}}f.autorun((()=>{const e=Date.now();let r=0;for(const t of c){const n=t.deref();n&&(r=h(Math.round(6e4*n.refreshInterval),r),n.refreshInterval?i.get(n)||i.set(n,e):i.delete(n))}if(r!==v){if(v=r,clearInterval(d),0===v)return void(d=0);d=setInterval(g,v)}}));const p={get hasRefreshTimer(){return d>0},get tickInterval(){return v},forceRefresh(){g()},hasLayer:e=>u(e)&&c.some((r=>r.deref()===e)),clear(){for(const e of c){const r=e.deref();r&&i.delete(r)}c.removeAll()}};e.registerLayer=a,e.test=p,e.unregisterLayer=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
