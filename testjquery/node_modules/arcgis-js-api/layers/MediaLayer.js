/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../chunks/tslib.es6","../core/Collection","../core/Error","../core/Logger","../core/MultiOriginJSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./Layer","./mixins/BlendLayer","./mixins/OperationalLayer","./mixins/ScaleRangeLayer","./support/ImageElement","./support/LocalMediaElementSource","./support/VideoElement"],(function(e,r,t,o,s,a,i,c,n,l,p,u,d,y,h,f,m,_,S){"use strict";function g(e){return"object"==typeof e&&null!=e&&"type"in e}let w=class extends(y.BlendLayer(f.ScaleRangeLayer(h.OperationalLayer(s.MultiOriginJSONMixin(d))))){constructor(e){super(e),this.effectiveSource=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this.source=new _}load(e){const o=this.source;if(!o)return this.addResolvingPromise(Promise.reject(new t("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer."))),Promise.resolve(this);const s=g(o)?new _({elements:new r([o])}):o;this._set("effectiveSource",s),this.spatialReference&&(s.spatialReference=this.spatialReference);const a=s.load(e).then((()=>{this.spatialReference=s.spatialReference}));return this.addResolvingPromise(a),Promise.resolve(this)}destroy(){this.effectiveSource?.destroy(),this.source?.destroy()}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}set source(e){"not-loaded"===this.loadStatus?this._set("source",e):o.getLogger(this).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)?new _({elements:new r(e)}):e instanceof r?new _({elements:e}):e:null}readSource(e,r,t){const o="image"===r.mediaType?new m:"video"===r.mediaType?new S:null;return o?.read(r,t),o}writeSource(e,r,o,s){e&&g(e)&&"image"===e.type?e.write(r,s):s?.messages&&s?.messages?.push(new t("media-layer:unsupported-source","source must be an 'ImageElement'"))}};e.__decorate([a.property({readOnly:!0})],w.prototype,"effectiveSource",void 0),e.__decorate([a.property({type:String})],w.prototype,"copyright",void 0),e.__decorate([a.property({readOnly:!0})],w.prototype,"fullExtent",null),e.__decorate([a.property({type:["MediaLayer"]})],w.prototype,"operationalLayerType",void 0),e.__decorate([a.property({type:["show","hide"]})],w.prototype,"listMode",void 0),e.__decorate([a.property({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1}}})],w.prototype,"source",null),e.__decorate([i.cast("source")],w.prototype,"castSource",null),e.__decorate([l.reader("source",["url"])],w.prototype,"readSource",null),e.__decorate([u.writer("source")],w.prototype,"writeSource",null),e.__decorate([a.property()],w.prototype,"spatialReference",void 0),e.__decorate([a.property({readOnly:!0})],w.prototype,"type",void 0),w=e.__decorate([p.subclass("esri.layers.MediaLayer")],w);return w}));
