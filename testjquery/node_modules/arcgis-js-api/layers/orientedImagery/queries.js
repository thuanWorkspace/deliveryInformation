/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../geometry","../../geometry/support/webMercatorUtils","../OrientedImageryLayer","./core/ExposurePoint","../../rest/support/Query","../../geometry/Extent"],(function(e,r,t,a,n,o,c){"use strict";const s={},i=1e3;async function u(e,r){const{point:n,queryParams:c,queryFeatures:u}=e,m={};let f=e.layerInstanceOrURL;const p=n.spatialReference.isGeographic?t.geographicToWebMercator(n.clone()):n.clone();if(m.outSpatialReference=p.spatialReference,c&&(m.maxRecordCountFactor=c.maxRecordCountFactor??5,m.outFields=c.outFields??["*"],m.where=c.where??"1=1",m.returnGeometry=c.returnGeometry??!0,m.outSpatialReference=c.outSpatialReference),"string"==typeof f&&(s.layer&&s.layer.url===f?f=s.layer:(s.layer?.destroy(),f=s.layer=new a({url:f}),await f.load())),f){if(u&&"esri.layers.OrientedImageryLayer"===f?.declaredClass)return l(f)(u);const e=f,t=y(p,c?.maximumDistance??e.maximumDistance??i),a=new o({geometry:t,...m});return e.queryFeatures(a,r).then(l(e))}return null}function l(e){return r=>{const{features:t,spatialReference:a}=r;return t.forEach((r=>{r.geometry&&(r.geometry.spatialReference=a);const t=n.fromJSON({...r.toJSON(),layer:e});t&&(r.attributes=t),r.layer=e,r.spatialReference=a})),r}}function y(e,r){const t=e.x-r,a=e.x+r,n=e.y-r,o=e.y+r;return new c({xmin:t,xmax:a,ymin:n,ymax:o,spatialReference:e.spatialReference})}e.createExtentFromPointAtDistance=y,e.searchImages=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
