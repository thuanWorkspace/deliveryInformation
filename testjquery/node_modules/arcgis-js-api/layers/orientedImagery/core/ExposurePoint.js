/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../chunks/tslib.es6","../../../geometry","../../../core/Clonable","../../../core/Error","../../../core/JSONSupport","../../../core/Logger","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/cast","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/reader","../../../core/accessorSupport/decorators/subclass","../../../core/accessorSupport/decorators/writer","./CameraOrientation","./cameraOrientationFactory","./utils","../enums/CameraOrientationType","../../../geometry/Point"],(function(e,r,t,a,o,i,n,c,p,d,l,s,y,m,u,g,_){"use strict";function f(e){throw new a("exposure-point:missing-default-value",`a value for ${e} is missing in default properties`)}function h(e,r){throw new a("exposure-point:missing-attribute-value",`a value for ${e} is missing in attribute table`,{exposurePoint:r})}let v=class extends(t.ClonableMixin(o.JSONSupport)){constructor(e){super(e),this.cameraOrientation=null,this.elevation=null,this.elevationSource=null,this.name=null}read(e,r){const t={},{attributes:a,layer:o,geometry:i}=e;for(const n in a)t[n.toLowerCase()]=a[n];super.read({geometry:i,layer:o??{},...t},r)}readCameraHeading(e,r){const{cameraheading:t,camheading:a,layer:o}=r;return t??a??o.cameraHeading}readCameraHeight(e,r){const{cameraheight:t,avghtag:a,layer:o}=r;return t??a??o.cameraHeight}readCamOffset(e,r){const{cameraoffset:t,camoffset:a}=r;return t?.split(";").map(Number)??a?.split(";").map(Number)??null}writeCameraOffset(e,r){e&&(r.cameraOffset=e.join(";"))}readCameraOrientation(e,r){const{cameraorientation:t,camori:a}=r;return t??a}readCameraPitch(e,r){const{camerapitch:t,campitch:a,layer:o}=r;return t??a??o.cameraPitch}readCameraRoll(e,r){const{cameraroll:t,camroll:a,layer:o}=r;return t??a??o.cameraRoll}readDepthImage(e,r){const{depthimage:t,depthimg:a,layer:o}=r,i=t??a??null,{depthImagePathPrefix:n,depthImagePathSuffix:c}=o??{};return u.appendPrefixAndSuffix(i,n,c)}readElevationSource(e,r){const{elevationsource:t,layer:a}=r,{demPathSuffix:o,demPathPrefix:i}=a;if(t){const e=this._parseIfJSON(t);return u.getEffectiveElevationSource(e,i,o)}return a.effectiveElevationSource}readFarDistance(e,r){const{fardistance:t,fardist:a,layer:o}=r;return t??a??o.farDistance}readHFOV(e,r){const{horizontalfieldofview:t,hfov:a,layer:o}=r;return t??a??o.horizontalFieldOfView}readImageURL(e,r){const{imagepath:t,layer:a}=r;t||h("imagePath",this);const{imagePathPrefix:o,imagePathSuffix:i}=a;return u.appendPrefixAndSuffix(t,o,i)}readImageRotation(e,r){const{imagerotation:t,imgrot:a,layer:o}=r;return t??a??o.imageRotation}get isHorizontal(){return"horizontal"===this.orientedImageryType}get isInspection(){return"inspection"===this.orientedImageryType}get isNadir(){return"nadir"===this.orientedImageryType}get isOblique(){return"oblique"===this.orientedImageryType}get isSpherical(){return"360"===this.orientedImageryType}get location(){const{cameraOrientation:e,geometry:r,cameraHeight:t,elevation:a}=this;if(e){const{type:r,x:t,y:a,z:o,horizontalWKID:i}=e;return new _({x:t,y:a,z:o,spatialReference:{wkid:r===g.CameraOrientationType.LTP?4326:i}})}if("number"!=typeof t)throw f("cameraHeight");return r.z=(a??0)+t,r}readNearDistance(e,r){const{neardistance:t,neardist:a,layer:o}=r;return t??a??o.nearDistance}readOrientationAccuracy(e,r){const{accuracy:t,orientationaccuracy:a}=r;return a?.split(";").map(Number)??t?.split(";").map(Number)??null}writeOrientationAccuracy(e,r){e&&(r.orientationAccuracy=e.join(";"))}readOIType(e,r){const{orientedimagerytype:t,oitype:a,camerapitch:o,campitch:i,layer:n}=r,c=u.orientedImageryTypeMap.read(t??a??n.orientedImageryType),p=o??i??n.cameraPitch;return"oblique"===c?p<10?"nadir":"oblique":c}readVFOV(e,r){const{verticalfieldofview:t,vfov:a,layer:o}=r;return t??a??o.verticalFieldOfView}_parseIfJSON(e){let r=null;try{r=JSON.parse(e)}catch(t){i.getLogger(this).error("couldn't parse the given elevation source JSON",e,t)}return r}};e.__decorate([n.property({type:Date,json:{write:{enabled:!0,target:"aquisitionDate"},name:"acquisitiondate"}})],v.prototype,"acquisitionDate",void 0),e.__decorate([n.property({type:Number,json:{write:!0,read:{source:["cameraheading","camheading","layer.cameraHeading"]}}})],v.prototype,"cameraHeading",void 0),e.__decorate([d.reader("cameraHeading")],v.prototype,"readCameraHeading",null),e.__decorate([n.property({type:Number,json:{write:!0}})],v.prototype,"cameraHeight",void 0),e.__decorate([d.reader("cameraHeight",["cameraheight","avghtag","layer.cameraHeight"])],v.prototype,"readCameraHeight",null),e.__decorate([n.property()],v.prototype,"cameraOffset",void 0),e.__decorate([d.reader("cameraOffset",["cameraoffset","camoffset"])],v.prototype,"readCamOffset",null),e.__decorate([s.writer("cameraOffset")],v.prototype,"writeCameraOffset",null),e.__decorate([n.property({json:{write:!0},type:y}),c.cast((e=>e?m.getCameraOrientation(e):null))],v.prototype,"cameraOrientation",void 0),e.__decorate([d.reader("cameraOrientation",["cameraorientation","camori"])],v.prototype,"readCameraOrientation",null),e.__decorate([n.property({type:Number,json:{write:!0}})],v.prototype,"cameraPitch",void 0),e.__decorate([d.reader("cameraPitch",["camerapitch","campitch","layer.cameraPitch"])],v.prototype,"readCameraPitch",null),e.__decorate([n.property({type:Number,json:{write:!0}})],v.prototype,"cameraRoll",void 0),e.__decorate([d.reader("cameraRoll",["cameraroll","camroll","layer.cameraRoll"])],v.prototype,"readCameraRoll",null),e.__decorate([n.property({json:{write:!0},type:String})],v.prototype,"depthImage",void 0),e.__decorate([d.reader("depthImage",["depthimage","depthimg"])],v.prototype,"readDepthImage",null),e.__decorate([n.property({type:Number,json:{write:!0}})],v.prototype,"elevation",void 0),e.__decorate([n.property({json:{write:!0}})],v.prototype,"elevationSource",void 0),e.__decorate([d.reader("elevationSource",["elevationsource","layer.effectiveElevationSource"])],v.prototype,"readElevationSource",null),e.__decorate([n.property({json:{name:"exposurestationid",write:{target:"exposureStationId"}},type:String})],v.prototype,"exposureStationId",void 0),e.__decorate([n.property({type:Number,json:{write:!0}})],v.prototype,"farDistance",void 0),e.__decorate([d.reader("farDistance",["fardistance","fardist","layer.farDistance"])],v.prototype,"readFarDistance",null),e.__decorate([n.property({type:_,json:{name:"geometry"}})],v.prototype,"geometry",void 0),e.__decorate([n.property({type:Number,json:{write:!0}})],v.prototype,"horizontalFieldOfView",void 0),e.__decorate([d.reader("horizontalFieldOfView",["horizontalfieldofview","hfov","layer.horizontalFieldOfView"])],v.prototype,"readHFOV",null),e.__decorate([n.property({json:{write:!0},type:String})],v.prototype,"imagePath",void 0),e.__decorate([d.reader("imagePath",["imagepath"])],v.prototype,"readImageURL",null),e.__decorate([n.property({type:Number,json:{write:!0}})],v.prototype,"imageRotation",void 0),e.__decorate([d.reader("imageRotation",["imagerotation","imgrot","layer.imageRotation"])],v.prototype,"readImageRotation",null),e.__decorate([n.property()],v.prototype,"isHorizontal",null),e.__decorate([n.property()],v.prototype,"isInspection",null),e.__decorate([n.property()],v.prototype,"isNadir",null),e.__decorate([n.property()],v.prototype,"isOblique",null),e.__decorate([n.property()],v.prototype,"isSpherical",null),e.__decorate([n.property()],v.prototype,"location",null),e.__decorate([n.property({json:{write:!0},type:String})],v.prototype,"name",void 0),e.__decorate([n.property({type:Number,json:{write:!0}})],v.prototype,"nearDistance",void 0),e.__decorate([d.reader("nearDistance",["neardistance","neardist","layer.nearDistance"])],v.prototype,"readNearDistance",null),e.__decorate([n.property({json:{write:!0,name:"objectid"},type:Number})],v.prototype,"objectId",void 0),e.__decorate([n.property()],v.prototype,"orientationAccuracy",void 0),e.__decorate([d.reader("orientationAccuracy",["accuracy","orientationaccuracy"])],v.prototype,"readOrientationAccuracy",null),e.__decorate([s.writer("orientationAccuracy")],v.prototype,"writeOrientationAccuracy",null),e.__decorate([p.enumeration(u.orientedImageryTypeMap)],v.prototype,"orientedImageryType",void 0),e.__decorate([d.reader("orientedImageryType",["orientedimagerytype","oitype","layer.orientedImageryType"])],v.prototype,"readOIType",null),e.__decorate([n.property({type:Number,json:{name:"sortorder",write:{target:"sortOrder"}}})],v.prototype,"sortOrder",void 0),e.__decorate([n.property({type:Number,json:{write:!0}})],v.prototype,"verticalFieldOfView",void 0),e.__decorate([d.reader("verticalFieldOfView",["verticalfieldofview","vfov","layer.verticalFieldOfView"])],v.prototype,"readVFOV",null),v=e.__decorate([l.subclass("esri.layers.orientedImagery.core.ExposurePoint")],v);return v}));
