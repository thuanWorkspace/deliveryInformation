/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../geometry/support/Ellipsoid","../../../geometry/support/pointUtils","./ExposurePoint"],(function(t,e,a,i){"use strict";function n(t){const{camera:e,features:a,selectedPoint:i}=t;if(!a.length)return[];t.currentImage??(t.currentImage={attributes:{cameraHeading:0,cameraPitch:0}});const n=s(e,i,t.currentImage);return a.map(n)}function s(t,i,n){return i.z??(i.z=0),i.elevation??(i.elevation=0),s=>{const{hfovWeight:h,vfovWeight:o,distanceWeight:c}=r(s.attributes,t?"3d":"2d"),l=s.attributes,{cameraHeight:u,cameraHeading:g,cameraPitch:M,farDistance:d,horizontalFieldOfView:b,verticalFieldOfView:f,isOblique:v}=l,m=l.geometry,W=180*Math.atan2(m.y-i.y,m.x-i.x)/Math.PI,y=a.distance(i,m);let p,P,x=b,I=f,q=!1;t?(p=t.heading,P=t.tilt,x=180,I=180,q=!0):!v||M<10?(p=g,P=M,q=!1):(p=n.attributes.cameraHeading,P=M,q=!0,x=180),p>180&&(p-=360);let O=1;m.spatialReference.isWebMercator&&(O=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*m.y/e.earth.radius))));const z=Math.sqrt((Math.sqrt((i.x-m.x)**2+(i.y-m.y)**2)/O)**2+((i.z??0)-(i.elevation??0)-u)**2),H=90-180*Math.atan2(i.y-m.y,i.x-m.x)/Math.PI;let S=(Math.abs(H-p)>180?Math.abs(360-Math.abs(H-p)):Math.abs(H-p))/x;S=4*S+1;const w=180*Math.acos((l.cameraHeight-(i.z??0)+(i.elevation??0))/z)/Math.PI;let E=Math.abs(w-P)/I;E=4*E+1;let F=z/Math.sqrt(d**2+u**2);F=4*F+1;const V=h*S+o*E+c*F;let j;if(q){const t=g>180?g-360:g;j=h*((Math.abs(H-t)>180?Math.abs(360-Math.abs(H-t)):Math.abs(H-t))/b*4+1)+o*(Math.abs(w-M)/f*4+1)+c*F}else j=V;return{suitability:V,trueSuitability:j,feature:s,angle:W,distance:y,verticalAngle:Math.abs(180*Math.atan(y/u)/Math.PI)}}}function r(t,e){const a="isOblique"in t?t:new i(t),{isOblique:n,isSpherical:s,isNadir:r}=a;return s?{hfovWeight:"2d"===e?0:1,vfovWeight:"2d"===e?0:.6,distanceWeight:"2d"===e?1:.5}:r?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:n?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}t.calculateSuitabilities=n,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
