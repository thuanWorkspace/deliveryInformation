/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../core/urlUtils"],(function(e,r){"use strict";function t(e,t){const o=t?.url?.path;if(e&&o&&(e=r.makeAbsolute(e,o,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const o=r.makeRelative(e,t.portalItem.itemUrl);null!=o&&a.test(o)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(o).path)}return m(e,t?.portal)}function o(t,o,n=e.MarkKeep.YES){if(null==t)return t;!r.isAbsolute(t)&&o?.blockedRelativeUrls&&o.blockedRelativeUrls.push(t);let l=r.makeAbsolute(t);if(o){const e=o.verifyItemRelativeUrls?.rootPath||o.url?.path;if(e){const n=m(e,o.portal),s=m(l,o.portal);l=r.makeRelative(s,n,n);null!=l&&l!==s&&l!==t&&o.verifyItemRelativeUrls&&o.verifyItemRelativeUrls.writtenUrls.push(l)}}return l=c(l,o?.portal),r.isAbsolute(l)&&(l=r.normalize(l)),o?.resources&&o?.portalItem&&!r.isAbsolute(l)&&!r.isDataProtocol(l)&&n===e.MarkKeep.YES&&o.resources.toKeep.push({resource:o.portalItem.resourceFromPath(l),compress:!1}),l}function n(e,r,o){return t(e,o)}function l(e,r,t,n){const l=o(e,n);void 0!==l&&(r[t]=l)}const s=/\/items\/([^\/]+)\/resources\/(.*)/,a=/^\.\/resources\//;function i(e){const r=e?.match(s)??null;return r?.[1]??null}function u(e){const t=e?.match(s)??null;if(null==t)return null;const o=t[2],n=o.lastIndexOf("/");if(-1===n){const{path:e,extension:t}=r.splitPathExtension(o);return{prefix:null,filename:e,extension:t}}const{path:l,extension:a}=r.splitPathExtension(o.slice(n+1));return{prefix:o.slice(0,n),filename:l,extension:a}}function c(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?r.changeDomain(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function m(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const o=`${t.urlKey}.${t.customBaseUrl}`,n=r.getAppUrl();return r.hasSameOrigin(n,`${n.scheme}://${o}`)?r.changeDomain(e,t.portalHostname,o):r.changeDomain(e,o,t.portalHostname)}var p;e.MarkKeep=void 0,(p=e.MarkKeep||(e.MarkKeep={}))[p.YES=0]="YES",p[p.NO=1]="NO";const f=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return e.MarkKeep},ensureMainOnlineDomain:c,fromJSON:t,itemIdFromResourceUrl:i,prefixAndFilenameFromResourceUrl:u,read:n,toJSON:o,write:l},Symbol.toStringTag,{value:"Module"}));e.ensureMainOnlineDomain=c,e.fromJSON=t,e.itemIdFromResourceUrl=i,e.persistableUrlUtils=f,e.prefixAndFilenameFromResourceUrl=u,e.read=n,e.toJSON=o,e.write=l}));
