/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../core/Error","./vec3","./vec3f64","../geometry/projection","../geometry/support/aaBoundingRect","../views/3d/terrain/TerrainConst","../views/3d/terrain/TilingScheme"],(function(e,t,n,o,r,i,l,c){"use strict";const s=o.create(),a=o.create(),u=o.create(),f=o.create();function h(e,t,n=0){const o=e.extent;if(null==o)return!1;if(0===n)return i.containsPoint(o,t);const r=Math.min(o[2]-o[0],o[3]-o[1]);return i.containsPointWithMargin(o,t,n*r)}function g(e,t,o,r){n.copy(s,o),s[r]=t[r];const i=n.subtract(s,s,t),l=n.subtract(a,e,t),c=n.dot(l,i),u=n.dot(i,i);let f;f=c<=0?t:u<=c?o:n.add(s,t,n.scale(i,i,c/u));const h=n.subtract(s,e,f);return Math.PI/2-Math.atan(h[2]/Math.sqrt(h[0]*h[0]+h[1]*h[1]))}function p(e,t,n){const o=e.extent;if(null==o)return 0;u[0]=o[0],u[1]=o[1],u[2]=n,f[0]=o[2],f[1]=o[3],f[2]=n;let r=1/0,i=1/0;return t[0]<u[0]?r=g(t,u,f,0):t[0]>f[0]&&(r=g(t,f,u,0)),t[1]<u[1]?i=g(t,u,f,1):t[1]>f[1]&&(i=g(t,f,u,1)),Math.min(r,i)}function d(e,n,o){if(null==e)return c.getMissingTileInfoError();if(e.spatialReference.isGeographic&&!r.canProjectToWGS84ComparableLonLat(e.spatialReference))return new t("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=c.TilingScheme.checkUnsupported(e);if(null!=i)return i;if(null==o)return new t("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const l=m(e,o);if(l)return l;const s=e.spatialReference;return null==n||s.equals(n)||n.isWGS84&&s.isWebMercator?null:new t("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function m(e,n){const o=e.lods,r=o[0].resolution*2**o[0].level,s=[r*e.size[0],r*e.size[1]],a=[e.origin.x,e.origin.y],u=i.fromExtent(n),f=i.create();c.TilingScheme.computeRowColExtent(u,s,a,f);const h=(f[2]-f[0])*(f[3]-f[1]);if(h>l.maxRootTiles){const n=o[0].scale*2**o[0].level;let i=Math.max((u[3]-u[1])/e.size[1],(u[2]-u[0])/e.size[0])*n/r;const c=Math.floor(Math.log(i)/Math.log(10));return i=Math.ceil(i/10**c)*10**c,new t("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(n).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+i.toLocaleString()+".",{level0Scale:n,suggestedLevel0Scale:i,requiredNumRootTiles:h,allowedNumRootTiles:l.maxRootTiles})}return null}const T=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:d,isInsideExtent:h,tiltToExtentEdge:p},Symbol.toStringTag,{value:"Module"}));e.checkIfTileInfoSupportedForViewSR=d,e.isInsideExtent=h,e.terrainUtilsPlanar=T,e.tiltToExtentEdge=p}));
