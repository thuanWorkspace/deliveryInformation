/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../chunks/vec2f64","../../chunks/vec3","../../chunks/vec3f64","../3d/state/utils/navigationUtils","./FilteredFiniteDifference","./FilteredValue","./Momentum"],(function(e,t,i,s,n,a,l,r){"use strict";const h=1e-5;class u extends r.Momentum{constructor(e,t,i,s,n,a=0,l){super(e,t,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=a,this.axis2=l}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}}class _{constructor(e=300,i=12,n=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=n,this.enabled=!0,this._tmpAxis1=s.create(),this._tmpAxis2=s.create(),this._tmpAngles=t.create(),this._time=new a.FilteredFiniteDifference(.3),this._screen=[new a.FilteredFiniteDifference(.4),new a.FilteredFiniteDifference(.4)],this._angle1=new l.FilteredValue(.6),this._angle2=new l.FilteredValue(.6),this._axis1=s.create(),this._axis2=s.create(),this._lastScene=s.create()}addMomentumDirectRotation(e,t,s,a,l,r){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(s)<.01)return;let e=n.rotationAngleAndAxisDirectRotation(this._lastScene,t,this._tmpAxis2,a,l,r);this._angle2.update(0),i.squaredLength(this._tmpAxis2)<h?e=0:i.normalize(this._axis1,this._tmpAxis2),this._angle1.update(e),i.copy(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(s)}}addMomentumPreserveHeading(e,t,s,a,l,r,u){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(s)<.01)return;n.rotationAnglesAndAxesHeadingPreserving(this._lastScene,t,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,a,l,r,u,!1),i.squaredLength(this._tmpAxis2)<h?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),i.normalize(this._axis1,this._tmpAxis1),i.normalize(this._axis2,this._tmpAxis2)),i.copy(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(s)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,i=null==e||null==t?null:Math.sqrt(e*e+t*t),s=this._time.filteredDelta,n=null==i||null==s?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,t,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,a=this._angle2.filteredValue,l=null==s||null==a?0:a/s;return new u(e,t,i,null==s||null==n?0:n/s,this._axis1,l,this._axis2)}}e.PanSphericalMomentum=u,e.PanSphericalMomentumEstimator=_,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
