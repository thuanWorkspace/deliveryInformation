/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/vec2","../../../chunks/vec2f64","../../../chunks/vec3f64","../../../support/elevationInfoUtils","../sketch/normalizedPoint","./SnappingAlgorithm","./snappingUtils","./candidates/RightAngleTriangleSnappingCandidate","../support/viewUtils","../../support/geometry2dUtils"],(function(e,t,n,i,o,r,s,a,p,c,l){"use strict";class d extends s.SnappingAlgorithm{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=[],o=n.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||o<2)return i;const{view:s}=this,a=n.vertices[0],p=n.vertices[o-1],c=r.fromAnyMapPoint(a.pos,s,t),l=r.fromAnyMapPoint(p.pos,s,t);return this._processCandidateProposal(c,l,e,t,i),i}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,o=i.component;if(o.edges.length<2)return n;if("polyline"===t.editGeometryOperations.data.type&&(0===i.index||i.index===o.vertices.length-1))return n;const{view:s}=this,a=r.fromAnyMapPoint(i.leftEdge.leftVertex.pos,s,t),p=r.fromAnyMapPoint(i.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(a,p,e,t,n),n}_processCandidateProposal(e,n,s,d,h){if(!this.exceedsShortLineThreshold(e,n,d))return;const f=t.lerp(g,e,n,.5),u=.5*t.distance(e,n),v=i.create();l.projectPointToCircle(v,s,f,u),v[2]=s[2];const m=r.fromVec3(v),{spatialReference:y,pointer:P}=d,x=c.vectorToScreenPoint(s,y,o.absoluteHeightElevationInfo,this.view);if(a.squaredScreenDistance(x,c.vectorToScreenPoint(m,y,o.absoluteHeightElevationInfo,this.view))<this.squaredProximityThreshold(P)){if(this.isVertical(e,m)||this.isVertical(m,n))return;h.push(new p.RightAngleTriangleSnappingCandidate({targetPoint:m,point1:e,point2:n,isDraped:"on-the-ground"===d.elevationInfo?.mode}))}}}const g=n.create();e.RightAngleTriangleSnapper=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
