/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/maybe","../../../core/promiseUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../support/Scheduler"],(function(t,e,s,o,n,r,i,a,p,l,c){"use strict";t.SnappingOperation=class extends s{constructor(t){super(t),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=n.debounce((async(t,e,s,o)=>{const n=this._frameTask;if(null==n)return;const r=await n.schedule((()=>e.snap({...t,context:s,signal:o})),o);r.valid&&await n.schedule((()=>{this.stagedPoint=r.apply(),t!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=e.update({...this._snapPoints,context:s}))}),o)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=t?t.registerTask(c.TaskPriority.SNAPPING):c.ImmediateTask}destroy(){this._abortController=o.abortMaybe(this._abortController),this._frameTask=o.removeMaybe(this._frameTask)}update(t,e,s){this._snapPoints=t;const{point:o,scenePoint:n}=t,r=e.update({point:o,scenePoint:n,context:s});return this.stagedPoint=r,r}async snap(t,e,s){const{point:o,scenePoint:n}=t;return this.stagedPoint=e.update({point:o,scenePoint:n,context:s}),this._snapPoints=t,null==this._abortController&&(this._abortController=new AbortController),this._snap(t,e,s,this._abortController.signal)}async resnap(t,e){null!=this._snapPoints&&await this.snap(this._snapPoints,t,e)}abort(){this._abortController=o.abortMaybe(this._abortController),this._snapPoints=null}},e.__decorate([r.property({constructOnly:!0})],t.SnappingOperation.prototype,"view",void 0),e.__decorate([r.property()],t.SnappingOperation.prototype,"stagedPoint",null),e.__decorate([r.property()],t.SnappingOperation.prototype,"constrainResult",void 0),e.__decorate([r.property()],t.SnappingOperation.prototype,"_stagedPoint",void 0),t.SnappingOperation=e.__decorate([l.subclass("esri.views.interactive.snapping.SnappingOperation")],t.SnappingOperation),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
