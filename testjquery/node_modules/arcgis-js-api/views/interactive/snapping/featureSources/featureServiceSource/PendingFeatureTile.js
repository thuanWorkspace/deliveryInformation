/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/asyncUtils","../../../../../geometry/support/aaBoundingRect"],(function(t,e,s){"use strict";class a{constructor(e,s){this.data=e,this.resolution=s,this.state={type:t.StateType.CREATED},this.alive=!0}process(e){switch(this.state.type){case t.StateType.CREATED:return this.state=this._gotoFetchCount(this.state,e),this.state.task.promise.then(e.resume,e.resume);case t.StateType.FETCH_COUNT:break;case t.StateType.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,e),this.state.task.promise.then(e.resume,e.resume);case t.StateType.FETCH_FEATURES:break;case t.StateType.FETCHED_FEATURES:this.state=this._goToDone(this.state,e);case t.StateType.DONE:}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case t.StateType.CREATED:case t.StateType.FETCH_COUNT:return 0;case t.StateType.FETCHED_COUNT:return this.state.featureCount;case t.StateType.FETCH_FEATURES:return this.state.previous.featureCount;case t.StateType.FETCHED_FEATURES:return this.state.features.length;case t.StateType.DONE:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case t.StateType.CREATED:return"created";case t.StateType.FETCH_COUNT:return"fetch-count";case t.StateType.FETCHED_COUNT:return"fetched-count";case t.StateType.FETCH_FEATURES:return"fetch-features";case t.StateType.FETCHED_FEATURES:return"fetched-features";case t.StateType.DONE:return"done"}}_gotoFetchCount(s,a){return{type:t.StateType.FETCH_COUNT,previous:s,task:e.createTask((async s=>{const T=await e.resultOrAbort(a.fetchCount(this,s));this.state.type===t.StateType.FETCH_COUNT&&(this.state=this._gotoFetchedCount(this.state,T.ok?T.value:1/0))}))}}_gotoFetchedCount(e,s){return{type:t.StateType.FETCHED_COUNT,featureCount:s,previous:e}}_gotoFetchFeatures(s,a){return{type:t.StateType.FETCH_FEATURES,previous:s,task:e.createTask((async T=>{const r=await e.resultOrAbort(a.fetchFeatures(this,s.featureCount,T));this.state.type===t.StateType.FETCH_FEATURES&&(this.state=this._gotoFetchedFeatures(this.state,r.ok?r.value:[]))}))}}_gotoFetchedFeatures(e,s){return{type:t.StateType.FETCHED_FEATURES,previous:e,features:s}}_goToDone(e,s){return s.finish(this,e.features),{type:t.StateType.DONE,previous:e}}reset(){const e=this.state;switch(this.state={type:t.StateType.CREATED},e.type){case t.StateType.CREATED:case t.StateType.FETCHED_COUNT:case t.StateType.FETCHED_FEATURES:case t.StateType.DONE:break;case t.StateType.FETCH_COUNT:case t.StateType.FETCH_FEATURES:e.task.abort()}}intersects(t){return null==t||!this.data.extent||(s.fromExtent(t,r),s.intersects(this.data.extent,r))}}var T;t.StateType=void 0,(T=t.StateType||(t.StateType={}))[T.CREATED=0]="CREATED",T[T.FETCH_COUNT=1]="FETCH_COUNT",T[T.FETCHED_COUNT=2]="FETCHED_COUNT",T[T.FETCH_FEATURES=3]="FETCH_FEATURES",T[T.FETCHED_FEATURES=4]="FETCHED_FEATURES",T[T.DONE=5]="DONE";const r=s.create();t.PendingFeatureTile=a,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
