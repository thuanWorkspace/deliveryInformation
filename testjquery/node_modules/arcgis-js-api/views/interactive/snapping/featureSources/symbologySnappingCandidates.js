/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/has","../../../../core/lang","../../../../core/LRUCache","../../../../core/promiseUtils","../../../../core/string"],(function(e,t,n,c,o,s){"use strict";function r(e=!1,t){return e?new h(t):new a}class a{async fetch(){return[]}notifySymbologyChange(){}}const i=1024;class h{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new c.LRUCache(i),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const c=[],s=[],r=this._candidatesCache;for(const o of e){const e=d(o),t=r.get(e);if(t)for(const c of t)s.push(n.clone(c));else c.push(o),r.put(e,[],1)}if(0===c.length)return s;const a=this._cacheVersion,{candidates:i,sourceCandidateIndices:h}=await this._getSymbologyCandidates(c,t);o.throwIfAborted(t);if(a!==this._cacheVersion)return this.fetch(e,t);const g=[],{length:u}=i;for(let o=0;o<u;++o){const e=i[o],t=d(c[h[o]]),s=r.get(t);s.push(e),r.put(t,s,s.length),g.push(n.clone(e))}return s.concat(g)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function d(e){switch(e.type){case"vertex":{const{objectId:t,target:n}=e,c=`${t}-vertex-${n.x}-${n.y}-${n.z??0}`;return s.numericHash(c).toString()}case"edge":{const{objectId:t,start:n,end:c}=e,o=`${t}-edge-${n.x}-${n.y}-${n.z??0}-to-${c.x}-${c.y}-${c.z??0}`;return s.numericHash(o).toString()}default:return""}}e.getSymbologySnappingCandidatesFetcher=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
