/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/reactiveUtils","../../../core/SetUtils","../../../core/sql","../../../core/timeUtils","../../../chunks/vec3","../../../layers/graphics/dehydratedPoint","../../../rest/support/Query","../../input/InputManager","../keybindings","../sketch/normalizedPoint"],(function(e,t,n,i,r,o,s,a,l,c,d){"use strict";function p(e,t){const n=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return n;case 3:return n&&e[2]===t[2];case 4:return n&&e[2]===t[2]&&e[3]===t[3]}return!1}function g(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function u(e,t){return Math.sqrt(g(e,t))}function y(e,t){t.sort(((t,n)=>o.squaredDistance(t.targetPoint,e)-o.squaredDistance(n.targetPoint,e)))}var E;function f({point:e,distance:t,returnEdge:n,vertexMode:o,coordinateHelper:{spatialReference:l},filter:c},d,p){return p=null!=p?p.clone():new a({where:"1=1"}),c&&(p.geometry=c.geometry,p.distance=c.distance,p.spatialRelationship=c.spatialRelationship,p.where=i.sqlAnd(p.where,c.where),p.timeExtent=r.mergeTimeExtents(p.timeExtent,c.timeExtent),p.objectIds=m(p.objectIds,c.objectIds)),{point:s.makeDehydratedPoint(e[0],e[1],e[2],l.toJSON()),mode:d,distance:t,returnEdge:n,vertexMode:o,query:p.toJSON()}}function m(e,t){return e||t?t?e?Array.from(n.intersection(new Set(e),new Set(t))):t:e:null}function h(e,t,n){return{left:d.fromAnyMapPoint(e.leftVertex.pos,t,n),right:d.fromAnyMapPoint(e.rightVertex.pos,t,n)}}function T(e){return e.createQuery()}function w(e,n=(()=>{})){const i=t.watch((()=>({view:e.view,snappingOptions:e.snappingOptions})),(({view:t,snappingOptions:i})=>{const r="snapping-toggle",o=l.ViewEventPriorities.TOOL;if(e.removeHandles(r),t&&null!=i){const s=[t.on("key-down",(e=>{e.key!==c.snappingKeys.toggle||e.repeat||(i.enabledToggled=!0,n())}),o),t.on("key-up",(e=>{e.key===c.snappingKeys.toggle&&(i.enabledToggled=!1,n())}),o),t.on("pointer-move",(e=>{const t=e.native.ctrlKey;i.enabledToggled!==t&&(i.enabledToggled=t,n())}),o)];e.addHandles(s,r)}}),t.syncAndInitial);e.addHandles(i)}function S(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass&&"utilityNetworks"in e&&!!e?.utilityNetworks?.length}e.LineSegmentHintType=void 0,(E=e.LineSegmentHintType||(e.LineSegmentHintType={}))[E.TARGET=0]="TARGET",E[E.REFERENCE=1]="REFERENCE",E[E.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION",e.editEdgeToSnappingEdge=h,e.isUtilityNetworkWebMap=S,e.makeFilter=T,e.makeSnappingQuery=f,e.objectEqual=p,e.screenDistance=u,e.setupSnappingToggleHandles=w,e.sortCandidatesInPlace=y,e.squaredScreenDistance=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
