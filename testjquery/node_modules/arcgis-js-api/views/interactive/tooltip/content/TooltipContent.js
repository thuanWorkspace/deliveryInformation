/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/tslib.es6","../../../../intl","../../../../core/memoize","../../../../core/quantityFormatUtils","../../../../core/reactiveUtils","../../../../core/unitFormatUtils","../../../../core/unitUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/decorators/subclass","../../../../support/getDefaultUnitForView","../../keybindings","../../../../widgets/Widget","../../../../widgets/support/componentsUtils","../../../../widgets/support/widgetUtils","../../../../widgets/support/decorators/messageBundle","../../../../intl/number"],(function(t,e,o,i,r,n,s,a,l,c,p,u,h,m,g,d,f,_,v,y,b){"use strict";e.TooltipContent=class extends f{constructor(){super(...arguments),this._getFormatters=r.memoize(((t,e)=>({angle:t=>n.formatAngle(t,t.rotationType),area:(o,i)=>n.formatArea(t,o,i??e.area),length:(o,i,r)=>n.formatLength(t,o,i??e.length,r),relativeLength:(o,i)=>n.formatRelativeLength(t,o,i??e.length),totalLength:(o,i)=>n.formatLength(t,o,i??e.length),verticalLength:(o,i)=>n.formatVerticalLength(t,o,i??e.length),relativeVerticalLength:(o,i)=>n.formatRelativeVerticalLength(t,o,i??e.verticalLength),relativeOrientation:t=>b.formatNumber(t,{maximumFractionDigits:2,minimumFractionDigits:2,signDisplay:"exceptZero"}),percentage:t=>b.formatNumber(t.value,{style:"percent"}),scale:t=>b.formatNumber(t,{style:"percent",maximumFractionDigits:0})}))),this._formatScale=t=>this._formatters.scale(t),this._formatRelativeOrientation=t=>this._formatters.relativeOrientation(t),this._formatLength=(t,e,o)=>this._formatters.length(t,e,o),this._formatRelativeLength=(t,e)=>this._formatters.relativeLength(t,e),this._formatVerticalLength=(t,e)=>this._formatters.verticalLength(t,e),this._formatRelativeVerticalLength=(t,e)=>this._formatters.relativeVerticalLength(t,e),this._formatArea=(t,e)=>this._formatters.area(t,e),this._formatPercentage=t=>this._formatters.percentage(t),this._onDiscard=()=>{this._exitInputMode()},this._onCommit=(t,e)=>{if("commit-and-exit"===e)return this._exitInputMode();const o=this._getFocusableInputs(),i=o.length,r=o.indexOf(t);if(-1===r)return this._exitInputMode();const n=((r+("commit-and-next"===e?1:-1))%i+i)%i;o.at(n)?.focus()},this._handleTab=t=>{if(t.code!==d.tooltipKeys.next)return;const e=this._getFocusableInputs();if(0===e.length)return;const o=e.at(0),i=e.at(-1);o&&i&&(t.shiftKey?document.activeElement===o&&(t.preventDefault(),i.focus()):document.activeElement===i&&(t.preventDefault(),o.focus()))}}get _displayUnits(){const t=g.getDefaultUnitForView(this.tooltip.view);return{length:t,verticalLength:t,area:t,angle:"degrees"}}get _inputUnitInfos(){const t=this._messagesUnits,e=e=>({unit:e,abbreviation:a.unitName(t,e,"abbr")}),o=g.getDefaultUnitForView(this.tooltip.view),i=l.defaultLengthUnit(o),r=l.defaultVerticalLengthUnit(o),n=l.defaultAreaUnit(o),s="degrees";return{length:e(i),relativeLength:e(i),verticalLength:e(r),relativeVerticalLength:e(r),area:e(n),orientation:e(s),rotation:e(s)}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,onCommit:this._onCommit,onDiscard:this._onDiscard}}initialize(){let t=new AbortController;this.addHandles([s.watch((()=>this.info.mode),(t=>{this.tooltip.positionMode="input"===t?"fixed":"follow-cursor"})),s.on((()=>this.info),"focus",(()=>{t?.abort();const{signal:e}=t=new AbortController;requestAnimationFrame((()=>{e.aborted||this._getFocusableInputs().at(0)?.focus()}))}))])}loadDependencies(){return _.loadCalciteComponents({button:()=>new Promise(((e,o)=>t(["../../../../chunks/calcite-button"],e,o))),icon:()=>new Promise(((e,o)=>t(["../../../../chunks/calcite-icon"],e,o))),input:()=>new Promise(((e,o)=>t(["../../../../chunks/calcite-input"],e,o)))})}_getHelpMessage(t){const{info:e}=this,{tooltipOptions:o,helpMessage:i,viewType:r}=e,n=o?.visibleElements?.helpMessage,s=t??i,a="3d"===r?"helpMessages3d":"helpMessages2d";return n&&s?this._messagesTooltip?.sketch?.[a]?.[s]:void 0}_exitInputMode(){this.info.exitInputMode(),document.querySelector(".esri-view-surface").focus()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("input:not([disabled])")??[])}},o.__decorate([y.messageBundle("esri/core/t9n/Units"),c.property()],e.TooltipContent.prototype,"_messagesUnits",void 0),o.__decorate([y.messageBundle("esri/views/interactive/tooltip/t9n/Tooltip"),c.property()],e.TooltipContent.prototype,"_messagesTooltip",void 0),o.__decorate([c.property()],e.TooltipContent.prototype,"info",void 0),o.__decorate([c.property()],e.TooltipContent.prototype,"tooltip",void 0),o.__decorate([c.property()],e.TooltipContent.prototype,"_displayUnits",null),o.__decorate([c.property()],e.TooltipContent.prototype,"_inputUnitInfos",null),o.__decorate([c.property()],e.TooltipContent.prototype,"_formatters",null),o.__decorate([c.property()],e.TooltipContent.prototype,"fieldContext",null),e.TooltipContent=o.__decorate([m.subclass("esri.views.interactive.tooltip.content.TooltipContent")],e.TooltipContent),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
