/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../keybindings","./css","../../../widgets/Widget","../../../widgets/support/componentsUtils","../../../widgets/support/widgetUtils","../../../widgets/support/jsxFactory"],(function(t,e,i,o,l,n,s,a,u,r,c,p,d,_){"use strict";const y=`${r.base}-editable-field`,h={base:y,inputMode:`${y}--input`,locked:`${y}--locked`,title:`${y}__title`,titleContent:`${y}__title__content`,value:`${y}__value`,valueContent:`${y}__value__content`,input:`${y}__input`,inputDisabled:`${y}__input--disabled`,inputReadOnly:`${y}__input--read-only`,inputSuffix:`${y}__input-suffix`,button:`${y}__button`};e.TooltipEditableField=class extends c{constructor(){super(...arguments),this._input=null,this._afterInputCreate=t=>{this._input=t},this._selectText=()=>{requestAnimationFrame((()=>{this._input?.select()}))},this._onKeyDown=t=>{t.key===u.tooltipKeys.discard&&this._discard()},this._onInputKeyDown=t=>{switch(t.key){case u.tooltipKeys.commit:return this._commit({type:"commit-and-exit",allowLockingCurrentValue:!0});case u.tooltipKeys.next:return t.stopPropagation(),this._commit({type:t.shiftKey?"commit-and-previous":"commit-and-next",allowLockingCurrentValue:!1})}},this._onInput=t=>{this.field.inputValue=t.target.value},this._onLockClick=()=>{const{field:t}=this;t.locked?t.unlock():this._lock()}}loadDependencies(){return p.loadCalciteComponents({button:()=>new Promise(((e,i)=>t(["../../../chunks/calcite-button"],e,i))),icon:()=>new Promise(((e,i)=>t(["../../../chunks/calcite-icon"],e,i)))})}render(){const{mode:t,field:e}=this,i="input"===t,{locked:o}=e;return _.tsx("div",{class:this.classes({[h.base]:!0,[h.inputMode]:"input"===t,[h.locked]:o})},_.tsx("div",{class:h.title,key:"title"},_.tsx("div",{class:h.titleContent,key:"title-content"},this._title,o&&!i?_.tsx("calcite-icon",{icon:"lock",key:"icon",scale:"s"}):null)),_.tsx("div",{class:h.value,key:"value"},i?this._renderInput():_.tsx("span",{key:"formatted-value"},this._feedbackValue)))}get _initialValue(){const{field:t}=this;return null!=t.actual?t.toInputUnits(t.actual,this.context).value:null}get _feedbackValue(){const{context:t,field:e}=this,{actual:i,committed:o,format:l}=e;return null!=o?l(o,t):null!=i?l(i,t):""}get _displayValue(){const{field:t}=this,{inputValue:e,committed:i}=t;return null!=e?e:null!=i?this._toString(t.toInputUnits(i,this.context).value):this._toString(this._initialValue)}get _suffix(){const{suffix:t}=this.field;return"string"==typeof t?t:t(this.context)}get _title(){const{title:t}=this.field;return"string"==typeof t?t:t(this.context)}_renderInput(){const{disabled:t,locked:e,readOnly:i}=this.field;return _.tsx("div",{class:h.valueContent,key:"input-container",onkeydown:this._onKeyDown},_.tsx("input",{afterCreate:this._afterInputCreate,class:this.classes({[h.input]:!0,[h.inputDisabled]:t,[h.inputReadOnly]:i}),disabled:t||i,onfocus:this._selectText,oninput:this._onInput,onkeydown:this._onInputKeyDown,readOnly:i,type:"text",value:this._displayValue}),_.tsx("div",{class:h.inputSuffix,key:"suffix"},this._suffix),i?void 0:_.tsx("calcite-button",{appearance:"transparent",class:h.button,disabled:t,iconStart:e?"lock":"unlock",kind:"neutral",onclick:this._onLockClick,scale:"s",tabIndex:-1}))}_commit({type:t,allowLockingCurrentValue:e}){const{_input:i,field:o}=this;i&&(o.locked&&""===o.inputValue?o.unlock():(e||null!=o.inputValue)&&this._lock(),this.context.onCommit(i,t))}_discard(){this._input&&(this.field.inputValue=null,this.context.onDiscard(this._input))}_lock(){const{field:t}=this,e=this._parseNumber(t.inputValue),i=null!=e?t.createQuantity(e,this.context):null;t.lock(i)}_parseNumber(t){if(null==t)return null;const e=parseFloat(t);return isNaN(e)||!isFinite(e)?null:e}_toString(t){return null!=t?t.toFixed(3):"0"}},i.__decorate([o.property()],e.TooltipEditableField.prototype,"field",void 0),i.__decorate([o.property()],e.TooltipEditableField.prototype,"context",void 0),i.__decorate([o.property()],e.TooltipEditableField.prototype,"mode",void 0),i.__decorate([o.property()],e.TooltipEditableField.prototype,"_initialValue",null),i.__decorate([o.property()],e.TooltipEditableField.prototype,"_feedbackValue",null),i.__decorate([o.property()],e.TooltipEditableField.prototype,"_input",void 0),i.__decorate([o.property()],e.TooltipEditableField.prototype,"_displayValue",null),i.__decorate([o.property()],e.TooltipEditableField.prototype,"_suffix",null),i.__decorate([o.property()],e.TooltipEditableField.prototype,"_title",null),e.TooltipEditableField=i.__decorate([a.subclass("esri.views.interactive.tooltip.TooltipEditableField")],e.TooltipEditableField),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
