/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/Evented","../../../core/handleUtils","./EditGeometry","./interfaces","./operations/AppendVertex","./operations/UpdateVertices","./operations/RemoveVertices","./operations/SplitEdge","./operations/SetVertexPosition","./operations/CloseComponent","./operations/MoveVertex","./operations/OffsetEdgeVertex","./operations/RotateVertex","./operations/ScaleVertex","./operations/UndoGroup"],(function(e,t,r,o,i,n,a,s,u,c,p,d,h,l,m,V){"use strict";class S extends t{constructor(e){super(),this.data=e,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",(e=>{e.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation})}))}destroy(){this._listener.remove()}splitEdge(e,t){return this._apply(new u.SplitEdge(this.data,e,t))}updateVertices(e,t,r=i.AccumulationBehaviour.ACCUMULATE_STEPS){return this._apply(new a.UpdateVertices(this.data,e,t),r)}moveVertices(e,t,r,o,n=i.AccumulationBehaviour.ACCUMULATE_STEPS){return this.updateVertices(e,new d.MoveVertex(this.data.coordinateHelper,t,r,o),n)}scaleVertices(e,t,r,o,n,s=i.AccumulationBehaviour.ACCUMULATE_STEPS,u=a.AccumulationType.CUMULATIVE){return this.updateVertices(e,new m.ScaleVertex(t,r,o,n,u),s)}rotateVertices(e,t,r,o=i.AccumulationBehaviour.ACCUMULATE_STEPS,n=a.AccumulationType.CUMULATIVE){return this.updateVertices(e,new l.RotateVertex(t,r,n),o)}removeVertices(e){return this._apply(new s.RemoveVertices(this.data,e,this._minNumVerticesPerType))}appendVertex(e){return 0===this.data.components.length?null:this._apply(new n.AppendVertex(this.data,this.data.components[0],e))}setVertexPosition(e,t){return this._apply(new c.SetVertexPosition(this.data,e,t))}offsetEdge(e,t,r,o=i.AccumulationBehaviour.ACCUMULATE_STEPS){return this.updateVertices([t.leftVertex,t.rightVertex],new h.OffsetEdgeVertex(this.data.coordinateHelper,e,t,r),o)}closeComponent(e){return this.data.components.includes(e)?this._apply(new p.CloseComponent(this.data,e)):null}canRemoveVertex(e){return e.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const e=new V.UndoGroup;return this._apply(e),r.makeHandle((()=>e.close()))}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop();return e.undo(),this._redoStack.push(e),e}return null}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop();return e.apply(),this._undoStack.push(e),e}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(e,t=i.AccumulationBehaviour.ACCUMULATE_STEPS){return t!==i.AccumulationBehaviour.NEW_STEP&&null!=this.lastOperation&&this.lastOperation.accumulate(e)||(e.apply(),this._undoStack.push(e),this._redoStack=[]),e}static fromGeometry(e,t){return new S(o.EditGeometry.fromGeometry(e,t))}}e.EditGeometryOperations=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
