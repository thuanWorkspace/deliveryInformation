/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/arrayUtils","../../../core/Evented","../../../geometry/Polygon","../../../geometry/Polyline","../coordinateHelper","./unnormalizationHelper"],(function(e,t,s,i,n,r,o){"use strict";class h{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class c{constructor(e,t,s){this.component=e,this.leftVertex=t,this.rightVertex=s,this.type="edge",t.rightEdge=this,s.leftEdge=this}}class l{constructor(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||o.unnormalize(this.vertices,o.getUnnormalizationInfo(this._spatialReference,this._viewingMode))}updateVertexIndex(e,t){if(0===this.vertices.length)return;const s=this.vertices[0];let i=null,n=e,r=t;do{i=n,i.index=r++,n=i.rightEdge?i.rightEdge.rightVertex:null}while(null!=n&&n!==s);i.leftEdge&&i!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(i),this.vertices.length-1)}getFirstVertex(){return 0===this.vertices.length?null:this.vertices[0]}getLastVertex(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}swapVertices(e,t){const s=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=s}iterateVertices(e){if(0===this.vertices.length)return;const t=this.vertices[0];let s=t;do{e(s,s.index),s=null!=s.rightEdge?s.rightEdge.rightVertex:null}while(s!==t&&null!=s)}}class g extends s{constructor(e,t){super(),this.type=e,this.coordinateHelper=t,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon()}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}notifyChanges(e){this._dirty=!0,this.emit("change",e)}_toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const e=[],t=this.coordinateHelper.vectorToArray;for(const s of this.components){if(s.vertices.length<1)continue;const i=[];let n=s.vertices.find((e=>null==e.leftEdge));const r=n;do{i.push(t(n.pos)),n=n.rightEdge?n.rightEdge.rightVertex:null}while(n&&n!==r);e.push(i)}return new n({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const e=[],t=this.coordinateHelper.vectorToArray;for(const s of this.components){if(s.vertices.length<1)continue;const i=[],n=s.vertices[0];let r=n;const o=r;do{i.push(t(r.pos)),r=null!=r.rightEdge?r.rightEdge.rightVertex:null}while(r&&r!==o);s.isClosed()&&i.push(t(n.pos)),e.push(i)}return new i({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,s){const i=e.spatialReference,n=r.createCoordinateHelper(e.hasZ,e.hasM,i),o=new g(e.type,n);switch(e.type){case"polygon":{const r=e.rings;for(let e=0;e<r.length;++e){const g=r[e],a=new l(i,s);a.index=e;const p=g.length>2&&t.equals(g[0],g[g.length-1]),d=p?g.length-1:g.length;for(let e=0;e<d;++e){const t=n.arrayToVector(g[e]),s=new h(a);a.vertices.push(s),s.pos=t,s.index=e}const u=a.vertices.length-1;for(let e=0;e<u;++e){const t=a.vertices[e],s=a.vertices[e+1],i=new c(a,t,s);a.edges.push(i)}if(p){const e=new c(a,a.vertices[a.vertices.length-1],a.vertices[0]);a.edges.push(e)}o.components.push(a)}break}case"polyline":{const t=e.paths;for(let e=0;e<t.length;++e){const r=t[e],g=new l(i,s);g.index=e;const a=r.length;for(let e=0;e<a;++e){const t=n.arrayToVector(r[e]),s=new h(g);g.vertices.push(s),s.pos=t,s.index=e}const p=g.vertices.length-1;for(let e=0;e<p;++e){const t=g.vertices[e],s=g.vertices[e+1],i=new c(g,t,s);g.edges.push(i)}o.components.push(g)}break}case"point":{const t=new l(i,s);t.index=0;const r=new h(t);r.index=0,r.pos=n.pointToVector(e),t.vertices.push(r),o.components.push(t);break}}return o}}e.Component=l,e.Edge=c,e.EditGeometry=g,e.Vertex=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
