/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../3d/webgl-engine/lib/OrderIndependentTransparency","./BufferObject","./contextUtils","./enums","./FramebufferObject","./renderState","./TextureDescriptor","./VertexArrayObject","./VertexElementDescriptor","./WebGLDriverTestModule"],(function(e,t,r,i,o,a,n,s,l,p,c){"use strict";class u extends c.WebGLDriverTestModule{constructor(e){if(super(),this._rctx=e,!e.gl)return;if(e.type===i.ContextType.WEBGL1)return void(this._result=!(!e.capabilities.textureFloat?.textureFloat||!e.capabilities.colorBufferFloat?.textureFloat));if(!(e.capabilities.textureFloat?.textureFloat&&e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const t="\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",r="\n     precision highp float;\n\n     void main() {\n      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ";this._program=e.programCache.acquire(t,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,c=new s.TextureDescriptor(1);c.wrapMode=o.TextureWrapMode.CLAMP_TO_EDGE,c.dataType=o.PixelType.FLOAT,c.internalFormat=o.SizedPixelFormat.RGBA32F,c.samplingMode=o.TextureSamplingMode.NEAREST;const u=new a.FramebufferObject(i,c),d=r.BufferObject.createVertex(i,o.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),f=new l.VertexArrayObject(i,new Map([["a_pos",0]]),{geometry:[new p.VertexElementDescriptor("a_pos",2,o.DataType.UNSIGNED_SHORT,0,4)]},{geometry:d});i.useProgram(e);const b=i.getBoundFramebufferObject(),{x:g,y:x,width:T,height:m}=i.getViewport();i.bindFramebuffer(u),i.setViewport(0,0,1,1),i.bindVAO(f),i.drawArrays(o.PrimitiveType.TRIANGLE_STRIP,0,4);const F=n.makePipelineState({blending:t.blendingAlpha});i.setPipelineState(F),i.drawArrays(o.PrimitiveType.TRIANGLE_STRIP,0,4);const _=i.gl.getError();return i.setViewport(g,x,T,m),i.bindFramebuffer(b),f.dispose(),u.dispose(),1282!==_||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}}e.FloatBufferBlend=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
