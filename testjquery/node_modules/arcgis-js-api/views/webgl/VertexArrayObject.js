/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../core/Logger","../../core/maybe","../../core/typedArrayUtil","./enums","./Util"],(function(e,t,i,r,s,n){"use strict";const o=t.getLogger("esri.views.webgl.VertexArrayObject");let u=class{constructor(e,t,i,r,s=null){this._context=e,this._locations=t,this._layout=i,this._buffers=r,this._indexBuffer=s,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].byteLength),null!=this._indexBuffer?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*r.typedArrayStaticSize}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=i.disposeMaybe(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&o.warn("Leaked WebGL VAO")}disposeVAOOnly(){if(this._glName){const e=this._context?.capabilities?.vao;e.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(s.ResourceType.VertexArrayObject,this)}this._context=null}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(s.ResourceType.VertexArrayObject,this)}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:i}=this;e||o.error("Vertex buffer dictionary is empty!");const r=this._context.gl;for(const s in e){const i=e[s];i||o.error("Vertex buffer is uninitialized!");const r=t[s];r||o.error("Vertex element descriptor is empty!"),n.bindVertexBufferLayout(this._context,this._locations,i,r)}if(null!=i){!!this._context.capabilities.vao?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i)}}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:t}=this;e||o.error("Vertex buffer dictionary is empty!");for(const i in e){const r=e[i];r||o.error("Vertex buffer is uninitialized!");const s=t[i];n.unbindVertexBufferLayout(this._context,this._locations,r,s)}null!=this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)}};e.VertexArrayObject=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
