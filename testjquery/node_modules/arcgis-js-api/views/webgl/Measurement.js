/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../core/maybe","./capabilities/DisjointTimerQuery"],(function(e,t,i){"use strict";function s(e){const t=e.capabilities.disjointTimerQuery;return null==t?null:t.timestampBits()>0?new u(t):i.hasRunningElapsedTimer?null:new r(t)}class r{constructor(e){this._timer=e,this._timer.disjoint(),this._query=this._timer.createQuery(),this._timer.beginTimeElapsed(this._query)}stop(e,t=50){this._timer.endTimeElapsed(),this._checkQueryResult(e,t)}abort(){this._deleteQuery()}_deleteQuery(){this._query&&(this._timer.deleteQuery(this._query),this._query=null)}_checkQueryResult(e,t){if(this._timer.disjoint())return this._deleteQuery(),void e(null);const i=this._query;if(!this._timer.resultAvailable(i))return void setTimeout((()=>this._checkQueryResult(e,t)),t);const s=this._timer.getResult(i);this._deleteQuery(),e(s/1e6)}}class u{constructor(e){this._timer=e,this._timer.disjoint(),this._start=this._timer.createQuery(),this._end=this._timer.createQuery(),this._timer.createTimestamp(this._start)}abort(){this._deleteQueries()}stop(e,i=50){t.assertIsSome(this._end),this._timer.createTimestamp(this._end),this._checkQueryResult(e,i)}_deleteQueries(){this._start&&(this._timer.deleteQuery(this._start),this._start=null),this._end&&(this._timer.deleteQuery(this._end),this._end=null)}_checkQueryResult(e,i){if(this._timer.disjoint())return this._deleteQueries(),void e(null);if(!(this._end&&this._timer.resultAvailable(this._end)))return void setTimeout((()=>this._checkQueryResult(e,i)),i);t.assertIsSome(this._start),t.assertIsSome(this._end);const s=this._timer.getResult(this._start),r=this._timer.getResult(this._end);this._deleteQueries(),e((r-s)/1e6)}}e.startMeasurement=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
