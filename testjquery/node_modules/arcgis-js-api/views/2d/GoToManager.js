/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/Error","../../core/Logger","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../ViewAnimation","./viewpointUtils"],(function(e,t,o,i,n,r,a,s,c,l,h,w,g,p){"use strict";e.GoToManager=class extends o{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(e,t){if(!e)return void n.getLogger(this).error("#goTo()","target cannot be null or undefined");this.view.animation&&(this.view.animation=null);const o=this._createAnimation();await a.whenOnce((()=>this.view.ready),t);const i={animate:!0,...t},{extent:r,spatialReference:s,size:c,viewpoint:l,constraints:h,padding:w,allLayerViews:g}=this.view,u=p.create(e,{extent:r,spatialReference:s,size:c,viewpoint:l,constraints:h,padding:w,allLayerViews:g,pickClosestTarget:t?.pickClosestTarget??!0});return o?.update(u),this._gotoTask={},i.animate?this._gotoAnimated(u,i):this._gotoImmediate(u,i)}_gotoImmediate(e,t){const o=this._gotoTask,n=this.view.animation,a=e.then((e=>{if(r.throwIfAborted(t),o!==this._gotoTask)throw new i("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=n.target=e,n.finish()}));return this._cancellableGoTo(o,n,a)}_gotoAnimated(e,t){const o=this._gotoTask,n=this.view.animation;if(!n)return Promise.resolve();const a=e.then((e=>{if(r.throwIfAborted(t),o!==this._gotoTask)throw new i("view:goto-interrupted","Goto was interrupted");return n.update(e),this.view.animationManager.animate(n,this.view.viewpoint,t),n.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(o,n,a)}_createAnimation(){return this.view.animation&&!this.view.animation.done||(this.view.animation=new g),this.view.animation}_cancellableGoTo(e,t,o){const i=()=>e===this._gotoTask;return o.finally((()=>{i()&&(t.done||t.stop(),this.view.animation=null)}))}},t.__decorate([s.property({constructOnly:!0})],e.GoToManager.prototype,"view",void 0),e.GoToManager=t.__decorate([w.subclass("esri.views.2d.GoToManager")],e.GoToManager),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
