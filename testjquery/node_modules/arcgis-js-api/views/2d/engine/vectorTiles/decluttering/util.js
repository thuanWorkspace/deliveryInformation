/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../enums","./core"],(function(t,e,s){"use strict";function o(t,e,s,o,l,i){const n=s-l;if(n>=0)return(e>>n)+(o-(i<<n))*(t>>n);const r=-n;return e-(i-(o<<r))*(t>>r)<<r}class l{constructor(t,e,s){this._rows=Math.ceil(e/s),this._columns=Math.ceil(t/s),this._cellSize=s,this.cells=new Array(this._rows);for(let o=0;o<this._rows;o++){this.cells[o]=new Array(this._columns);for(let t=0;t<this._columns;t++)this.cells[o][t]=[]}}getCell(t,e){const s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._rows-1),o=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[s]&&this.cells[s][o]||null}getCellSpan(t,e,s,o){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(o/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function i(t,e,o,l,i,n){const r=e[l++];for(let a=0;a<r;a++){const r=new s.VTLSymbol(n);r.xTile=e[l++],r.yTile=e[l++],r.hash=e[l++],r.priority=e[l++];const a=e[l++];for(let t=0;t<a;t++){const t=e[l++],s=e[l++],i=e[l++],n=e[l++],a=!!e[l++],c=e[l++],h=o[l++],u=o[l++],f=e[l++],m=e[l++];r.colliders.push({xTile:t,yTile:s,dxPixels:i,dyPixels:n,hard:a,partIndex:c,width:f,height:m,minLod:h,maxLod:u})}const c=t[l++];for(let e=0;e<c;e++)r.textVertexRanges.push([t[l++],t[l++]]);const h=t[l++];for(let e=0;e<h;e++)r.iconVertexRanges.push([t[l++],t[l++]]);i.push(r)}return l}function n(t,e,s){for(const[o,l]of t.symbols)r(t,e,s,l,o)}function r(t,s,o,l,i){const n=t.layerData.get(i);if(n.type===e.BucketType.SYMBOL){for(const e of l){const s=e.unique;let l;if(e.selectedForRendering){const e=s.parts[0],i=e.startOpacity,n=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===n;const r=o?Math.floor(127*i)|n<<7:n?255:0;l=r<<24|r<<16|r<<8|r}else l=0;for(const[t,o]of e.iconVertexRanges)for(let e=t;e<t+o;e+=4)n.iconOpacity[e/4]=l;if(e.selectedForRendering){const e=s.parts[1],i=e.startOpacity,n=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===n;const r=o?Math.floor(127*i)|n<<7:n?255:0;l=r<<24|r<<16|r<<8|r}else l=0;for(const[t,o]of e.textVertexRanges)for(let e=t;e<t+o;e+=4)n.textOpacity[e/4]=l}n.lastOpacityUpdate=s,n.opacityChanged=!0}}t.GridIndex=l,t.deserializeSymbols=i,t.tileCoordChange=o,t.writeOpacityToBuffers=n,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
