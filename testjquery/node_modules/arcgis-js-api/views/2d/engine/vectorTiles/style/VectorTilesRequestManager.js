/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../request","../../../../../core/lang","../../../../../core/MapUtils","../../../../../core/promiseUtils","../../../../../core/urlUtils"],(function(t,e,r,o,s,n){"use strict";class i{constructor(t){this._tileUrl=t,this._promise=null,this._abortController=null,this._abortOptions=[]}getData(t){null===this._promise&&(this._abortController=new AbortController,this._promise=this._makeRequest(this._tileUrl,this._abortController.signal));const e=this._abortOptions;return e.push(t),s.onAbort(t,(()=>{e.every((t=>s.isAborted(t)))&&this._abortController.abort()})),this._promise.then((t=>r.clone(t)))}async _makeRequest(t,r){const{data:o}=await e(t,{responseType:"array-buffer",signal:r});return o}}const l=new Map;function a(t,e,r,o,s){const i=n.urlToObject(t),l=i.query;if(l)for(const[n,c]of Object.entries(l))switch(c){case"{x}":l[n]=o.toString();break;case"{y}":l[n]=r.toString();break;case"{z}":l[n]=e.toString()}const a=i.path;return c(n.addQueryParameters(a.replaceAll(/\{z\}/gi,e.toString()).replaceAll(/\{y\}/gi,r.toString()).replaceAll(/\{x\}/gi,o.toString()),{...i.query}),s)}function c(t,e){return o.getOrCreateMapValue(l,t,(()=>new i(t))).getData(e).then((e=>(l.delete(t),e))).catch((e=>{throw l.delete(t),e}))}t.request=a,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
