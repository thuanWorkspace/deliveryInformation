/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../geometry/support/aaBoundingRect","../../viewpointUtils","./BrushRasterBitmap","./RasterTile","../webgl/enums","../webgl/TileContainer"],(function(e,t,s,r,i,n,o){"use strict";class a extends o{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(e){const t=this._getTileBounds(e),[s,r]=this._tileInfoView.tileInfo.size,n=this._tileInfoView.getTileResolution(e.level);return new i.RasterTile(e,n,t[0],t[3],s,r)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (tile)",brushes:[r],target:()=>this.children.map((e=>e.bitmap)),drawPhase:n.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){if(!this.visible||e.drawPhase!==n.WGLDrawPhase.MAP)return;const{rasterFunctionChain:t}=this;if(!t)return e.renderPass="raster-bitmap",void super.doRender(e);if(!t.hasFocalFunction){const[t,s]=this._tileInfoView.tileInfo.size;e.renderPass="raster",e.rasterFunction={name:"Reproject",parameters:{targetImageSize:[t,s],requireBilinear:!1},pixelType:"f32",id:0,isNoopProcess:!1},super.doRender(e)}if(t?.functions.length){const{functions:s,hasBranches:r}=t;for(let t=0;t<s.length;t++){const i=s[t];"Constant"!==i.name&&"Identity"!==i.name&&(e.renderPass="raster",e.rasterFunction=i,e.hasBranches=r,super.doRender(e))}}e.rasterFunction=null,e.renderPass="bitmap",super.doRender(e)}_getTileBounds(e){const r=this._tileInfoView.getTileBounds(t.create(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:t}=this._tileInfoView,i=s.getWorldWidth(t.spatialReference);if(i){const s=t.lodAt(e.level);if(!s)return r;const{resolution:n}=s,o=i/n%t.size[0],a=o?(t.size[0]-o)*n:0;r[0]-=a*e.world,r[2]-=a*e.world}}return r}}e.RasterTileContainer=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
