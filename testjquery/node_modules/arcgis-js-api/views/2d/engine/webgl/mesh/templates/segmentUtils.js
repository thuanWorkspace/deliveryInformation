/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","./util"],(function(t,e){"use strict";function n(t,e){return t[e+1]}function s(t){return t.length-1}function i(t){let e=0;for(let n=0;n<s(t);n++)e+=r(t,n);return e}function r(t,e,s=1){const[i,r]=n(t,e);return Math.sqrt(i*i+r*r)*s}class h{constructor(t,e,n,s,i){this._segments=t,this._index=e,this._distance=n,this._xStart=s,this._yStart=i,this._done=!1}static create(t){return new h(t,0,0,t[0][0],t[0][1])}clone(){return new h(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(0===this._distance||1===t._distance)||t._index===this._index+1&&(1===this._distance||0===t._distance)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){const t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length);let n=Math.acos(e);return t>0&&(n=2*Math.PI-n),n}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<s(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){const n=this.backwardLength;if(t<=n)return this._distance=(n-t)/this.length,this;let s=this.backwardLength;for(;this.prev();){if(s+this.length>t)return this._seekBackwards(t-s);s+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let n=this.remainingLength;for(;this.next();){if(n+this.length>t)return this.seek(t-n,e);n+=this.length}return this._distance=1,e?this:null}}function a(t,e,n,s=!0){const r=i(t),a=h.create(t),d=r/2;if(!s)return a.seek(d),void n(a.clone(),0,d+0*e,r);const u=Math.max((r-e)/2,0),c=Math.floor(u/e),o=d-c*e;a.seek(o);for(let i=-c;i<=c;i++)a.x<512&&a.x>=0&&a.y<512&&a.y>=0&&n(a.clone(),i,d+i*e,r),a.seek(e)}function d(t,e,n){u(n,e,i(t),h.create(t),0)}function u(t,e,n,s,i){if(n<e)return;const r=s.clone().seek(n/2);if(null==r)return;t(r.clone(),n,i),n=(n-e)/2;const h=r.seek(e/2);u(t,e,n,s,i+1),u(t,e,n,h,i+1)}function c(t,e){const n=e;for(let s=0;s<t.length;s++){let e=t[s];o(e,n);const i=[];i.push(e[0]);for(let t=1;t<e.length;t++){const[n,s]=e[t-1],[r,h]=e[t],a=Math.round(r-n),d=Math.round(h-s);i.push([a,d])}t[s]=i,e=i}return t}function o(t,n){const s=1e-6;if(n<=0)return;const i=t.length;if(i<3)return;const r=[];let h=0;r.push(0);for(let _=1;_<i;_++)h+=e.dist(t[_],t[_-1]),r.push(h);n=Math.min(n,.2*h);const a=[];a.push(t[0][0]),a.push(t[0][1]);const d=t[i-1][0],u=t[i-1][1],c=e.sub([0,0],t[0],t[1]);e.normalize(c),t[0][0]+=n*c[0],t[0][1]+=n*c[1],e.sub(c,t[i-1],t[i-2]),e.normalize(c),t[i-1][0]+=n*c[0],t[i-1][1]+=n*c[1];for(let e=1;e<i;e++)r[e]+=n;r[i-1]+=n;const o=.5*n;for(let e=1;e<i-1;e++){let h=0,d=0,u=0;for(let i=e-1;i>=0&&!(r[i+1]<r[e]-o);i--){const a=o+r[i+1]-r[e],c=r[i+1]-r[i],_=r[e]-r[i]<o?1:a/c;if(Math.abs(_)<s)break;const g=_*_,l=_*a-.5*g*c,x=_*c/n,f=t[i+1],y=t[i][0]-f[0],S=t[i][1]-f[1];h+=x/l*(f[0]*_*a+.5*g*(a*y-c*f[0])-g*_*c*y/3),d+=x/l*(f[1]*_*a+.5*g*(a*S-c*f[1])-g*_*c*S/3),u+=x}for(let a=e+1;a<i&&!(r[a-1]>r[e]+o);a++){const i=o-r[a-1]+r[e],c=r[a]-r[a-1],_=r[a]-r[e]<o?1:i/c;if(Math.abs(_)<s)break;const g=_*_,l=_*i-.5*g*c,x=_*c/n,f=t[a-1],y=t[a][0]-f[0],S=t[a][1]-f[1];h+=x/l*(f[0]*_*i+.5*g*(i*y-c*f[0])-g*_*c*y/3),d+=x/l*(f[1]*_*i+.5*g*(i*S-c*f[1])-g*_*c*S/3),u+=x}a.push(h/u),a.push(d/u)}a.push(d),a.push(u);for(let e=0,_=0;e<i;e++)t[e][0]=a[_++],t[e][1]=a[_++]}t.SegmentCursor=h,t.pathDivide=a,t.pathLength=i,t.pathSubdivide=d,t.segmentAt=n,t.segmentCount=s,t.segmentLength=r,t.smoothPaths=c,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
