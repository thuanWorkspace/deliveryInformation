/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../../chunks/earcut","../../../../../../geometry/libtess","../../../../../../geometry/support/TileClipper","../../../../../../layers/graphics/OptimizedGeometry","../../definitions","../bufcut"],(function(t,e,n,r,o,l,s){"use strict";const i=1e-5,u=new r.TileClipper(0,0,0,1,0),c=new r.TileClipper(0,0,0,1,0);function f(t,e,n){let r=0;for(let o=1;o<n;o++){const n=t[2*(e+o-1)],l=t[2*(e+o-1)+1];r+=(t[2*(e+o)]-n)*(t[2*(e+o)+1]+l)}return r}function a(t,e,n,r,o){let l=0;const s=2;for(let i=n;i<r;i+=3){const n=(t[i]-o)*s,r=(t[i+1]-o)*s,u=(t[i+2]-o)*s;l+=Math.abs((e[n]-e[u])*(e[r+1]-e[n+1])-(e[n]-e[r])*(e[u+1]-e[n+1]))}return l}function h(t,e){const{coords:n,lengths:r,hasIndeterminateRingOrder:o}=e,l=0,u=t;if(o)return!1;let c=0;for(let h=0;h<r.length;){let t=h,e=r[h],o=f(n,c,e);const g=[];for(;++t<r.length;){const l=r[t],s=f(n,c+e,l);if(!(s>0))break;o+=s,g.push(c+e),e+=l}const p=u.length;s.bufcut(u,n,c,c+e,g,2,l);const d=a(u,n,p,u.length,l),y=Math.abs(o);if(Math.abs((d-y)/Math.max(1e-7,y))>i)return u.length=0,!1;h=t,c+=e}return!0}function g(t,n,r){const{coords:o,lengths:l,hasIndeterminateRingOrder:s}=n;if(s)return!1;let i=0;for(let u=0;u<l.length;){let s=u,c=l[u];const a=[];for(;++s<l.length;){const t=l[s];if(!(f(o,i+c,t)>0))break;a.push(i+c-i),c+=t}const h=i+c,g=n.coords.slice(2*i,2*h),p=e.earcut(g,a,2);for(const e of p)t.push(e+r+i);u=s,i+=c}return!0}function p(t){const{coords:e,lengths:r}=t,{buffer:o}=n.triangulate(e,r);return o}function d(t,e,n){let r=0;for(let o=0;o<t.lengths.length;o++){const l=t.lengths[o];for(let o=0;o<l;o++){const l=t.coords[2*(o+r)],s=t.coords[2*(o+r)+1];if(l<e||l>n||s<e||s>n)return!0}r+=l}return!1}function y(t,e){if(null==t)return null;if(!d(t,-128,l.tileSize+128))return t;u.setPixelMargin(e),u.reset(r.GeometryType.Polygon);let n=0;for(let r=0;r<t.lengths.length;r++){const e=t.lengths[r];let o=t.coords[2*(0+n)],l=t.coords[2*(0+n)+1];u.moveTo(o,l);for(let r=1;r<e;r++)o=t.coords[2*(r+n)],l=t.coords[2*(r+n)+1],u.lineTo(o,l);u.close(),n+=e}const s=u.result(!1);if(!s)return null;const i=[],c=[];for(const r of s){let t=0;for(const e of r)c.push(e.x),c.push(e.y),t++;i.push(t)}return new o(i,c)}function x(t,e){c.setPixelMargin(e);const n=c,o=-e,s=l.tileSize+e;let i=[],u=!1;if(!t.nextPath())return null;let f=!0;for(;f;){t.seekPathStart();const e=[];if(!t.pathSize)return null;n.reset(r.GeometryType.LineString),t.nextPoint();let l=t.x,c=t.y;if(u)n.moveTo(l,c);else{if(l<o||l>s||c<o||c>s){u=!0;continue}e.push({x:l,y:c})}let a=!1;for(;t.nextPoint();)if(l=t.x,c=t.y,u)n.lineTo(l,c);else{if(l<o||l>s||c<o||c>s){a=!0;break}e.push({x:l,y:c})}if(a)u=!0;else{if(u){const t=n.resultWithStarts();if(t)for(const e of t)i.push(e)}else i.push({line:e,start:0});f=t.nextPath(),u=!1}}return i=i.filter((t=>t.line.length>1)),0===i.length?null:i}u.setExtent(l.tileSize),c.setExtent(l.tileSize),t.area=f,t.clipLinesMarshall=x,t.clipMarshall=y,t.triangleAreaArray=a,t.triangulate=h,t.triangulateEarcut=g,t.triangulateLibtess=p,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
