/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../../core/Error","../../../../core/Logger","../../../../core/reactiveUtils","../../../../chunks/mat3f32","../DisplayObject","./Mesh2D","../../../webgl/VertexArrayObject"],(function(e,t,r,s,i,h,c){"use strict";const a=e=>parseFloat(e)/100;class o extends i.DisplayObject{constructor(e,t){super(),this._clip=t,this._cache={},this.stage=e,this._handle=r.watch((()=>t.version),(()=>this._invalidate())),this.ready()}static fromClipArea(e,t){return new o(e,t)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null),null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(e,t,r,s){const[i,h]=t.size;if("geometry"!==this._clip.type&&this._lastWidth===i&&this._lastHeight===h||(this._lastWidth=i,this._lastHeight=h,this._destroyGL()),null==this._cache.vao){const i=this._createMesh(t,this._clip),h=i.getIndexBuffer(e),a=i.getVertexBuffers(e);this._cache.mesh=i,this._cache.vao=new c.VertexArrayObject(e,r,s,a,h)}return this._cache.vao}_createTransforms(){return{dvs:s.create()}}_invalidate(){this._destroyGL(),this.requestRender()}_createScreenRect(e,t){const[r,s]=e.size,i="string"==typeof t.left?a(t.left)*r:t.left,h="string"==typeof t.right?a(t.right)*r:t.right,c="string"==typeof t.top?a(t.top)*s:t.top,o="string"==typeof t.bottom?a(t.bottom)*s:t.bottom,n=i,l=c;return{x:n,y:l,width:Math.max(r-h-n,0),height:Math.max(s-o-l,0)}}_createMesh(r,s){switch(s.type){case"rect":return h.fromRect(this._createScreenRect(r,s));case"path":return h.fromPath(s);case"geometry":return h.fromGeometry(r,s);default:return t.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new e("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),h.fromRect({x:0,y:0,width:1,height:1})}}}return o}));
