/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["./Utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],(function(e,t,r,s){"use strict";class a{constructor(s){this.geometryMap=e.createGeometryData((()=>({indexBuffer:t.BufferObject.createIndex(s,r.Usage.STATIC_DRAW),vao:null})),((r,a)=>({vertexBuffer:t.BufferObject.createVertex(s,e.cVboInfo[a])})))}dispose(){for(let e=0;e<5;e++){const t=this.geometryMap[e];if(t){t.data.vao?.disposeVAOOnly(),t.data.indexBuffer?.dispose();for(const e in t.buffers)t.buffers[e]?.data.vertexBuffer.dispose()}}}get(e){const t=this.geometryMap[e];return{getVAO(e,r,a){if(!t.data.vao){const f={};for(const e in t.buffers)f[e]=t.buffers[e].data.vertexBuffer;t.data.vao=new s.VertexArrayObject(e,a,r,f,t.data.indexBuffer)}return t.data.vao}}}has(e){return null!=this.geometryMap[e]}upload(e,t){t.forEach(((t,r)=>{this._upload(t,r,e)}))}_upload(e,t,r){if(e.indices&&(e.indices.allDirty?this._uploadIndices(r,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(r,t,e.indices.from,e.indices.count)),e.vertices){const s=e.vertices;for(const e in s){const a=s[e];a.allDirty?this._uploadVertices(r,t,e):null!=a.from&&null!=a.count&&this._uploadVertices(r,t,e,a.from,a.count)}}}_uploadVertices(e,t,r,s,a){const f=this.geometryMap[t];if(!f)return;const n=e.geometries[t].vertexBuffer[r];if(!n)return;const{data:i,stride:o}=n;if(f.buffers[r]&&i.length>0){const e=o/i.BYTES_PER_ELEMENT;null!=s&&null!=a?f.buffers[r].data.vertexBuffer.setSubData(i,s*e,s*e,(s+a)*e):f.buffers[r].data.vertexBuffer.setData(i)}}_uploadIndices(e,t,r,s){const a=this.geometryMap[t];if(!a)return;const f=e.geometries[t].indexBuffer;a.data.indexBuffer&&f.length>0&&(null!=r&&null!=s?a.data.indexBuffer.setSubData(f,r,r,r+s):a.data.indexBuffer.setData(f))}}return a}));
