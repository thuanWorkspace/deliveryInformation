/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["./enums","./shaders/MaterialPrograms"],(function(r,e){"use strict";const a=e=>e===r.WGLDrawPhase.HITTEST||e===r.WGLDrawPhase.LABEL_ALPHA,t=e=>(a(e)?1:0)|(e===r.WGLDrawPhase.HIGHLIGHT?2:0),s=({rendererInfo:r,drawPhase:e},a,s)=>`${a.getVariationHash()}-${t(e)}-${r.getVariationHash()}-${null!=s&&s.join(".")}`,o=(e,t,s,o={})=>{if(o={...o,...t.getVariation(),...e.rendererInfo.getVariation(),highlight:e.drawPhase===r.WGLDrawPhase.HIGHLIGHT,id:a(e.drawPhase)},null!=s)for(const r of s)o[r]=!0;return o};class i{constructor(r){this._rctx=r,this._programByKey=new Map}dispose(){this._programByKey.forEach((r=>r.dispose())),this._programByKey.clear()}getProgram(r,a=[]){const t=r.vsPath+"."+r.fsPath+JSON.stringify(a);if(this._programByKey.has(t))return this._programByKey.get(t);const s={...a.map((r=>"string"==typeof r?{name:r,value:!0}:r)).reduce(((r,e)=>({...r,[e.name]:e.value})),{})},{vsPath:o,fsPath:i,attributes:h}=r,n=e.createProgramTemplate(o,i,h,s),g=this._rctx.programCache.acquire(n.shaders.vertexShader,n.shaders.fragmentShader,n.attributes);if(!g)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(t,g),g}getMaterialProgram(r,a,t,i,h){const n=s(r,a,h);if(this._programByKey.has(n))return this._programByKey.get(n);const g=o(r,a,h,{ignoresSamplerPrecision:r.context.driverTest.ignoresSamplerPrecision.result}),m=e.createProgramTemplate(t,t,i,g),c=this._rctx.programCache.acquire(m.shaders.vertexShader,m.shaders.fragmentShader,m.attributes);if(!c)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(n,c),c}}return i}));
