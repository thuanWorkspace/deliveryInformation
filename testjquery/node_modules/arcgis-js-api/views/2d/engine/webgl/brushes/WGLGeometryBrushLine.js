/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../enums","../Utils","./WGLGeometryBrush","../materialKey/MaterialKey","../../../../webgl/enums"],(function(e,t,a,n,o){"use strict";const i=e=>t.createProgramDescriptor(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:o.DataType.SHORT},{location:1,name:"a_id",count:4,type:o.DataType.UNSIGNED_BYTE},{location:2,name:"a_color",count:4,type:o.DataType.UNSIGNED_BYTE,normalized:!0},{location:3,name:"a_offsetAndNormal",count:4,type:o.DataType.BYTE},{location:4,name:"a_accumulatedDistanceAndHalfWidth",count:2,type:o.DataType.UNSIGNED_SHORT},{location:5,name:"a_tlbr",count:4,type:o.DataType.UNSIGNED_SHORT},{location:6,name:"a_segmentDirection",count:4,type:o.DataType.BYTE},{location:7,name:"a_aux",count:2,type:o.DataType.UNSIGNED_SHORT},{location:8,name:"a_zoomRange",count:2,type:o.DataType.UNSIGNED_SHORT}]});class r extends a{dispose(){}getGeometryType(){return e.WGLGeometryType.LINE}supportsSymbology(e){return!0}drawGeometry(e,t,a,r){const{context:l,painter:s,rendererInfo:m,displayLevel:y,passOptions:c,requestRender:u,allowDelayedRender:p}=e,T=n.LineMaterialKey.load(a.materialKey),d=null!=c&&"hittest"===c.type;let _=i(T),D=o.PrimitiveType.TRIANGLES;d&&(_=this._getTriangleDesc(a.materialKey,_),D=o.PrimitiveType.POINTS);const{attributes:E,bufferLayouts:N}=_,g=s.materialManager.getMaterialProgram(e,T,"materials/line",E,r);if(p&&null!=u&&!g.compiled)return void u();const f=1/e.pixelRatio,S=0;l.useProgram(g),this._setSharedUniforms(g,e,t),T.textureBinding&&s.textureManager.bindTextures(l,g,T);const U=2**(y-t.key.level);g.setUniform1f("u_zoomFactor",U),g.setUniform1f("u_blur",S+f),g.setUniform1f("u_antialiasing",f),this._setSizeVVUniforms(T,g,m,t),this._setColorAndOpacityVVUniforms(T,g,m),l.setFaceCullingEnabled(!1);const G=a.target.getVAO(l,N,E,d);let I=a.indexCount,R=a.indexFrom*Uint32Array.BYTES_PER_ELEMENT;d&&(I/=3,R/=3),l.bindVAO(G),l.drawElements(D,I,o.DataType.UNSIGNED_INT,R)}}return r}));
