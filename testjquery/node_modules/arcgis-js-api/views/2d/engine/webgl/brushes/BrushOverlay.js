/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../definitions","../Utils","./WGLBrush","../../../../webgl/enums"],(function(e,t,n,r){"use strict";const a=()=>t.createProgramDescriptor("overlay",{geometry:[{location:0,name:"a_pos",count:2,type:r.DataType.FLOAT}],tex:[{location:1,name:"a_uv",count:2,type:r.DataType.UNSIGNED_SHORT}]});class i extends n{constructor(){super(...arguments),this._desc={vsPath:"overlay/overlay",fsPath:"overlay/overlay",attributes:new Map([["a_pos",0],["a_uv",1]])}}dispose(){}prepareState({context:e}){e.setBlendingEnabled(!0),e.setColorMask(!0,!0,!0,!0),e.setBlendFunctionSeparate(r.BlendFactor.ONE,r.BlendFactor.ONE_MINUS_SRC_ALPHA,r.BlendFactor.ONE,r.BlendFactor.ONE_MINUS_SRC_ALPHA),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilFunction(r.CompareFunction.GREATER,255,255)}draw(t,n){const{context:i,painter:s,requestRender:o,allowDelayedRender:c}=t;if(!n.isReady)return;const{computedOpacity:u,dvsMat3:d,isWrapAround:l,perspectiveTransform:p,texture:m}=n;t.timeline.begin(this.name);const _=s.materialManager.getProgram(this._desc);if(c&&null!=o&&!_.compiled)return void o();const f=a(),y=n.getVAO(i,f.bufferLayouts,f.attributes);if(!y)return;i.bindVAO(y),i.useProgram(_),i.bindTexture(m,e.textureBindingBitmap),_.setUniformMatrix3fv("u_dvsMat3",d),_.setUniform1i("u_texture",e.textureBindingBitmap),_.setUniform1f("u_opacity",u),_.setUniform2fv("u_perspective",p);const v=l?10:4;i.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,v),i.bindVAO(),t.timeline.end(this.name)}}return i}));
