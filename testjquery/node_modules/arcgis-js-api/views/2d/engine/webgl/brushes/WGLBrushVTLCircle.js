/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../vectorTiles/style/StyleDefinition","../enums","../number","./WGLBrush","../../../../webgl/enums"],(function(e,t,r,n,i,a){"use strict";class s extends i{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,i){const{context:s,displayLevel:l,requiredLevel:o,state:c,drawPhase:u,painter:d,spriteMosaic:f,styleLayerUID:y,requestRender:m,allowDelayedRender:p}=e;if(!i.some((e=>e.layerData.get(y)?.circleIndexCount??!1)))return;const v=e.styleLayer,T=v.circleMaterial,g=d.vectorTilesMaterialManager,M=1.2,E=v.getPaintValue("circle-translate",l),h=v.getPaintValue("circle-translate-anchor",l),I=u===r.WGLDrawPhase.HITTEST,L=this._programOptions;L.id=I;const U=g.getMaterialProgram(s,T,L);if(p&&null!=m&&!U.compiled)return void m();s.useProgram(U),U.setUniformMatrix3fv("u_displayMat3",h===t.TranslateAnchor.VIEWPORT?c.displayMat3:c.displayViewMat3),U.setUniform2fv("u_circleTranslation",E),U.setUniform1f("u_depth",v.z),U.setUniform1f("u_antialiasingWidth",M);let _=-1;if(I){const e=n.u32to4Xu8(y+1);U.setUniform4fv("u_id",e)}for(const t of i){if(!t.layerData.has(y))continue;t.key.level!==_&&(_=t.key.level,T.setDataUniforms(U,l,v,_,f));const e=t.layerData.get(y);if(!e.circleIndexCount)continue;e.prepareForRendering(s);const r=e.vao;null!=r&&(s.bindVAO(r),U.setUniformMatrix3fv("u_dvsMat3",t.transforms.dvs),o!==t.key.level?s.setStencilFunction(a.CompareFunction.EQUAL,t.stencilRef,255):s.setStencilFunction(a.CompareFunction.GREATER,255,255),s.drawElements(a.PrimitiveType.TRIANGLES,e.circleIndexCount,a.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),t.triangleCount+=e.circleIndexCount/3)}}}e.WGLBrushVTLCircle=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
