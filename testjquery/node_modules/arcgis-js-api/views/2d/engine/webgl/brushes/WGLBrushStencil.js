/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../../../chunks/vec4f32","../DefaultVertexAttributeLayouts","./WGLBrush","../shaders/BackgroundPrograms","../../../../webgl/BufferObject","../../../../webgl/enums","../../../../webgl/ProgramTemplate","../../../../webgl/VertexArrayObject"],(function(e,t,r,i,s,o,a,n){"use strict";class l extends r{constructor(){super(...arguments),this._color=e.fromValues(1,0,0,1),this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null),this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:e}){e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(o.StencilOperation.KEEP,o.StencilOperation.KEEP,o.StencilOperation.REPLACE),e.setStencilWriteMask(255)}draw(e,t){const{context:r,requestRender:i,allowDelayedRender:s}=e;this._initialized||this._initialize(r),!s||null==i||this._solidProgram.compiled?(r.setStencilFunctionSeparate(o.Face.FRONT_AND_BACK,o.CompareFunction.GREATER,t.stencilRef,255),r.bindVAO(this._solidVertexArrayObject),r.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",t.transforms.dvs),this._solidProgram.setUniform2fv("u_coord_range",[t.rangeX,t.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),r.drawArrays(o.PrimitiveType.TRIANGLE_STRIP,0,4),r.bindVAO()):i()}_initialize(e){if(this._initialized)return!0;const r=a.createProgram(e,i.background);if(!r)return!1;const l=new Int8Array([0,0,1,0,0,1,1,1]),d=s.BufferObject.createVertex(e,o.Usage.STATIC_DRAW,l),c=new n.VertexArrayObject(e,i.background.attributes,t.Pos2b,{geometry:d});return this._solidProgram=r,this._solidVertexArrayObject=c,this._initialized=!0,!0}}return l}));
