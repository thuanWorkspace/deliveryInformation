/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../definitions","../enums","../Utils","./WGLGeometryBrush","../materialKey/MaterialKey","../techniques/utils","../../../../webgl/enums"],(function(e,t,a,o,r,n,i){"use strict";function s(e){const a={geometry:[{location:0,name:"a_pos",count:2,type:i.DataType.SHORT},{location:1,name:"a_id",count:3,type:i.DataType.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:i.DataType.UNSIGNED_BYTE},{location:3,name:"a_color",count:4,type:i.DataType.UNSIGNED_BYTE,normalized:!0},{location:4,name:"a_aux1",count:4,type:i.DataType.UNSIGNED_SHORT},{location:5,name:"a_aux2",count:4,type:i.DataType.SHORT},{location:6,name:"a_aux3",count:4,type:i.DataType.UNSIGNED_BYTE},{location:7,name:"a_zoomRange",count:2,type:i.DataType.UNSIGNED_SHORT}]};switch(e.symbologyType){case t.WGLSymbologyType.SIMPLE:case t.WGLSymbologyType.OUTLINE_FILL_SIMPLE:a.geometry.splice(7,1),a.geometry.splice(4,1)}return{shader:"materials/fill",vertexLayout:a}}class l extends o{dispose(){}getGeometryType(){return t.WGLGeometryType.FILL}supportsSymbology(e){return e!==t.WGLSymbologyType.DOT_DENSITY}drawGeometry(t,o,l,y){const{context:m,painter:u,rendererInfo:c,requiredLevel:p,passOptions:T,requestRender:_,allowDelayedRender:d}=t,f=r.FillMaterialKey.load(l.materialKey),g=n.getTechniqueFromMaterialKey(f.data),S=null!=T&&"hittest"===T.type,E=u.materialManager,{shader:I,vertexLayout:D,hittestAttributes:N}=g.programSpec??s(f);let x=i.PrimitiveType.TRIANGLES,L=a.createProgramDescriptor(f.data,D);S&&(L=this._getTriangleDesc(l.materialKey,L,N),x=i.PrimitiveType.POINTS);const{attributes:U,bufferLayouts:b}=L,G=E.getMaterialProgram(t,f,I,U,y);if(d&&null!=_&&!G.compiled)return void _();m.useProgram(G),this._setSharedUniforms(G,t,o);const{row:h,col:R}=o.key,O=R*e.tileSize,M=h*e.tileSize;if(G.setUniform2f("u_tileOffset",O%e.maxRepresentableInt,M%e.maxRepresentableInt),G.setUniform2f("u_maxIntNumOfCrossing",Math.floor(O/e.maxRepresentableInt),Math.floor(M/e.maxRepresentableInt)),f.textureBinding){u.textureManager.bindTextures(m,G,f);const e=1/2**(p-o.key.level);G.setUniform1f("u_zoomFactor",e)}const P=1/t.pixelRatio;G.setUniform1f("u_blur",P),G.setUniform1f("u_antialiasing",P),this._setSizeVVUniforms(f,G,c,o),this._setColorAndOpacityVVUniforms(f,G,c);const w=l.target.getVAO(m,b,U,S);let F=l.indexCount,v=l.indexFrom*Uint32Array.BYTES_PER_ELEMENT;S&&(F/=3,v/=3),m.bindVAO(w),this._drawFills(t,o,G,x,F,v)}_drawFills(e,t,a,o,r,n){e.context.drawElements(o,r,i.DataType.UNSIGNED_INT,n)}}return l}));
