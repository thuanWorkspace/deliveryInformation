/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/Error","../alignmentUtils","../enums"],(function(e,t,i,s){"use strict";function a(e,t,i){const a=s.WGLVVFlag.SIZE_FIELD_STOPS|s.WGLVVFlag.SIZE_MINMAX_VALUE|s.WGLVVFlag.SIZE_SCALE_STOPS|s.WGLVVFlag.SIZE_UNIT_VALUE,r=(t&(s.WGLVVTarget.FIELD_TARGETS_OUTLINE|s.WGLVVTarget.MINMAX_TARGETS_OUTLINE|s.WGLVVTarget.SCALE_TARGETS_OUTLINE|s.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return e===s.WGLGeometryType.LINE&&i.isOutline||e===s.WGLGeometryType.FILL&&b(i.symbologyType)?a&r:a&~r}const r=0,o=8,n=7,l=8,v=11,y=11,S=12,p=13,h=14,u=15,V=16,T=17,g=18,c=19,L=20,m=21,d=26,G=Object.keys(s.WGLSymbologyType).filter((e=>"number"==typeof s.WGLSymbologyType[e])).reduce(((e,t)=>({...e,[t]:s.WGLSymbologyType[t]})),{});function z(e){return e===s.WGLSymbologyType.SIMPLE||e===s.WGLSymbologyType.OUTLINE_FILL_SIMPLE}function b(e){return e===s.WGLSymbologyType.OUTLINE_FILL||e===s.WGLSymbologyType.OUTLINE_FILL_SIMPLE}function M(e){return z(e.symbologyType)}function E(e){return b(e.symbologyType)}function W(e,t){switch(e){case s.WGLGeometryType.FILL:return U.from(t);case s.WGLGeometryType.LINE:return B.from(t);case s.WGLGeometryType.MARKER:return x.from(t);case s.WGLGeometryType.TEXT:return R.from(t);case s.WGLGeometryType.LABEL:return w.from(t);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${e}`)}}function F(e){switch(I.load(e).geometryType){case s.WGLGeometryType.MARKER:return new x(e);case s.WGLGeometryType.FILL:return new U(e);case s.WGLGeometryType.LINE:return new B(e);case s.WGLGeometryType.TEXT:return new R(e);case s.WGLGeometryType.LABEL:return new w(e)}}class I{static load(e){const t=this.shared;return t.data=e,t}constructor(e){this._data=0,this._data=e}set data(e){this._data=e??0}get data(){return this._data}get geometryType(){return this.bits(l,v)}set geometryType(e){this.setBits(e,l,v)}get mapAligned(){return!!this.bit(L)}set mapAligned(e){this.setBit(L,e)}get sdf(){return!!this.bit(y)}set sdf(e){this.setBit(y,e??!1)}get pattern(){return!!this.bit(S)}set pattern(e){this.setBit(S,e)}get textureBinding(){return this.bits(r,o)}set textureBinding(e){this.setBits(e,r,o)}get symbologyType(){return this.bits(m,d)}set symbologyType(e){this.setBits(e,m,d)}get geometryTypeString(){switch(this.geometryType){case s.WGLGeometryType.FILL:return"fill";case s.WGLGeometryType.MARKER:return"marker";case s.WGLGeometryType.LINE:return"line";case s.WGLGeometryType.TEXT:return"text";case s.WGLGeometryType.LABEL:return"label";default:throw new t(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(e,t){const i=1<<e;t?this._data|=i:this._data&=~i}bit(e){return(this._data&1<<e)>>e}setBits(e,t,i){for(let s=t,a=0;s<i;s++,a++)this.setBit(s,0!=(e&1<<a))}bits(e,t){let i=0;for(let s=e,a=0;s<t;s++,a++)i|=this.bit(s)<<a;return i}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:s.WGLSymbologyType[this.symbologyType],options:G,namespace:"SYMBOLOGY_TYPE"}}}getVariationHash(){return this._data&~(n&this.textureBinding)}}I.shared=new I(0);const O=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(V)}set vvSizeMinMaxValue(e){this.setBit(V,e)}get vvSizeScaleStops(){return 0!==this.bit(T)}set vvSizeScaleStops(e){this.setBit(T,e)}get vvSizeFieldStops(){return 0!==this.bit(g)}set vvSizeFieldStops(e){this.setBit(g,e)}get vvSizeUnitValue(){return 0!==this.bit(c)}set vvSizeUnitValue(e){this.setBit(c,e)}hasSizeVV(){return this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}hasVV(){return super.hasVV()||this.hasSizeVV()}setVV(e,t){super.setVV(e,t);const i=a(this.geometryType,e,t)&e;this.vvSizeMinMaxValue=!!(i&s.WGLVVFlag.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(i&s.WGLVVFlag.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(i&s.WGLVVFlag.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(i&s.WGLVVFlag.SIZE_SCALE_STOPS)}},_=e=>class extends e{get vvRotation(){return 0!==this.bit(u)}set vvRotation(e){this.setBit(u,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t.isOutline&&!!(e&s.WGLVVFlag.ROTATION)}},f=e=>class extends e{get vvColor(){return 0!==this.bit(p)}set vvColor(e){this.setBit(p,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t.isOutline&&!!(e&s.WGLVVFlag.COLOR)}},A=e=>class extends e{get vvOpacity(){return 0!==this.bit(h)}set vvOpacity(e){this.setBit(h,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t.isOutline&&!!(e&s.WGLVVFlag.OPACITY)}};class U extends(f(A(O(I)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const{symbologyType:t,vvFlags:i}=e,a=this.load(0);return a.geometryType=s.WGLGeometryType.FILL,a.symbologyType=t,t!==s.WGLSymbologyType.DOT_DENSITY&&a.setVV(i,e),a.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}U.shared=new U(0);class x extends(f(A(_(O(I))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const{symbologyType:t,vvFlags:i}=e,a=this.load(0);return a.geometryType=s.WGLGeometryType.MARKER,a.symbologyType=t,t!==s.WGLSymbologyType.HEATMAP&&a.setVV(i,e),a.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}x.shared=new x(0);class B extends(f(A(O(I)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=s.WGLGeometryType.LINE,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}B.shared=new B(0);class R extends(f(A(_(O(I))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=s.WGLGeometryType.TEXT,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}R.shared=new R(0);class w extends(O(I)){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=s.WGLGeometryType.LABEL,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.mapAligned=i.isMapAligned(e.placement),t.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}w.shared=new w(0),e.FillMaterialKey=U,e.LabelMaterialKey=w,e.LineMaterialKey=B,e.MarkerMaterialKey=x,e.MaterialKeyBase=I,e.TextMaterialKey=R,e.createMaterialKey=W,e.hasOutlineFillSymbology=E,e.hasSimpleSymbology=M,e.hydrateMaterialKey=F,e.isOutlineFillSymbology=b,e.isSimpleSymbology=z,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
