/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports"],(function(e){"use strict";class t{get largestRange(){return this._largestRange}constructor(e){this._largestRange=null,this._parent=e,this._updateLargestRange()}rangeCreated(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}rangeResized(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}findBestRange(e){let t=this._parent._freeHead,n=null;for(;null!==t;)t.count>=e&&(!n||t.count-e<n.count-e)&&(n=t),t=t.next;return n}findAdjacentRanges(e,t){let n=!0,r=!1,o=null,s=this._parent._freeHead;for(;n&&!r;){const a=null!==o?o.from+o.count:0,l=null!==s?s.from:this._parent._size;e>=a&&e+t<=l?(n=!1,r=!0):null!==s?(o=s,s=s.next):n=!1}return[o,s]}_updateLargestRange(){let e=null,t=this._parent._freeHead;for(;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e}}class n{constructor(e,n){this._allocated=0,this._size=e,this._freeHead=e>0?{from:0,count:e,prev:null,next:null}:null,this._bookKeeper=n||new t(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}allocate(e){const t=this._bookKeeper.findBestRange(e);if(null==t)return-1;const r=t.from,o=t.count;if(t.from+=e,t.count-=e,this._bookKeeper.rangeResized(t,r,o),this._allocated+=e,0===t.count){const e=null!==t.prev?this._freeHead:t.next;n._removeRange(t),this._freeHead=e}return r}free(e,t){const[r,o]=this._bookKeeper.findAdjacentRanges(e,t),s={from:e,count:t,prev:r??null,next:o??null};if(null!=r&&(r.next=s),null!=o&&(o.prev=s),this._bookKeeper.rangeCreated(s),this._allocated-=t,null!=o&&s.from+s.count===o.from){const e=s.from,t=s.count;n._fuse(s,o),n._removeRange(o),this._bookKeeper.rangeResized(s,e,t),this._bookKeeper.rangeResized(o,void 0,0)}if(null!=r&&r.from+r.count===s.from){const e=r.from,t=r.count;n._fuse(r,s),n._removeRange(s),this._bookKeeper.rangeResized(r,e,t),this._bookKeeper.rangeResized(s,void 0,0)}this._freeHead=null!==s.prev?this._freeHead:s}get fragmentation(){const e=this._size-this._allocated;if(0===e)return 0;return 1-this._bookKeeper.largestRange.count/e}static _removeRange(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)}static _fuse(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)}}e.FreeList=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
