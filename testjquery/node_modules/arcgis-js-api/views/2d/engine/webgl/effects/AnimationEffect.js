/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/has","../definitions","../VertexStream","./Effect"],(function(e,t,i,r,a){"use strict";class n extends a.Effect{constructor(){super(...arguments),this.defines=[],this._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])}}dispose(){this._quad&&this._quad.dispose()}bind(){}unbind(){}draw(e,t){if(!t?.size)return;const{context:a,renderingOptions:n}=e;this._quad||(this._quad=new r(a,[0,0,1,0,0,1,1,1]));const s=a.getBoundFramebufferObject(),{x:o,y:u,width:d,height:f}=a.getViewport();t.bindTextures(a);const m=t.getBlock(i.attributeDataAnimation);if(null==m)return;const c=m.getFBO(a),l=m.getFBO(a,1);a.setViewport(0,0,t.size,t.size),this._computeDelta(e,l,n.labelsAnimationTime),this._updateAnimationState(e,l,c),a.bindFramebuffer(s),a.setViewport(o,u,d,f)}_computeDelta(e,r,a){const{context:n,painter:s,displayLevel:o}=e,u=s.materialManager.getProgram(this._desc,["delta"]);n.bindFramebuffer(r),n.setClearColor(0,0,0,0),n.clear(n.gl.COLOR_BUFFER_BIT),n.useProgram(u);const d=t("featurelayer-animation-enabled")?a:1;u.setUniform1i("u_maskTexture",i.textureBindingAttributeData0),u.setUniform1i("u_sourceTexture",i.textureBindingAttributeData1),u.setUniform1f("u_timeDelta",e.deltaTime),u.setUniform1f("u_animationTime",d),u.setUniform1f("u_zoomLevel",Math.round(10*o)),this._quad.draw()}_updateAnimationState(e,t,i){const{context:r,painter:a}=e,n=a.materialManager.getProgram(this._desc,["update"]);r.bindTexture(t.colorTexture,1),r.useProgram(n),n.setUniform1i("u_sourceTexture",1),r.bindFramebuffer(i),r.setClearColor(0,0,0,0),r.clear(r.gl.COLOR_BUFFER_BIT),this._quad.draw()}}e.AnimationEffect=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
