/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../../../../core/Logger","../../definitions","./parameters","../../../../../webgl/enums","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor"],(function(i,o,t,e,l,h){"use strict";const n=i.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function r(i,o){o.fillColor[0]=i.color.r/255,o.fillColor[1]=i.color.g/255,o.fillColor[2]=i.color.b/255,o.fillColor[3]=i.color.a,i.haloColor?(o.outlineColor[0]=i.haloColor.r/255,o.outlineColor[1]=i.haloColor.g/255,o.outlineColor[2]=i.haloColor.b/255,o.outlineColor[3]=i.haloColor.a):(o.outlineColor[0]=o.fillColor[0],o.outlineColor[1]=o.fillColor[1],o.outlineColor[2]=o.fillColor[2],o.outlineColor[3]=o.fillColor[3]),o.fillColor[3]*=i.fillOpacity,o.outlineColor[3]*=i.haloOpacity,o.fillColor[0]*=o.fillColor[3],o.fillColor[1]*=o.fillColor[3],o.fillColor[2]*=o.fillColor[3],o.outlineColor[0]*=o.outlineColor[3],o.outlineColor[1]*=o.outlineColor[3],o.outlineColor[2]*=o.outlineColor[3],o.outlineWidth=t.highlightSizing.outlineWidth,o.outerHaloWidth=t.highlightSizing.outerHaloWidth,o.innerHaloWidth=t.highlightSizing.innerHaloWidth,o.outlinePosition=t.highlightSizing.outlinePosition}const s=[0,0,0,0];class a{constructor(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:t.highlightSizing.outlinePosition,outlineWidth:t.highlightSizing.outlineWidth,innerHaloWidth:t.highlightSizing.innerHaloWidth,outerHaloWidth:t.highlightSizing.outerHaloWidth},this._shadeTexChanged=!0,this._texelData=new Uint8Array(4*t.shadeTextureSize),this._minMaxDistance=[0,0]}setHighlightOptions(i){const o=this._convertedHighlightOptions;r(i,o);const e=o.outlinePosition-o.outlineWidth/2-o.outerHaloWidth,l=o.outlinePosition-o.outlineWidth/2,h=o.outlinePosition+o.outlineWidth/2,a=o.outlinePosition+o.outlineWidth/2+o.innerHaloWidth,u=Math.sqrt(Math.PI/2)*t.sigma,d=Math.abs(e)>u?Math.round(10*(Math.abs(e)-u))/10:0,g=Math.abs(a)>u?Math.round(10*(Math.abs(a)-u))/10:0;let C;d&&!g?n.error("The outer rim of the highlight is "+d+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!d&&g?n.error("The inner rim of the highlight is "+g+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):d&&g&&n.error("The highlight is "+Math.max(d,g)+"px away from the edge of the feature; consider reducing some width values.");const f=[void 0,void 0,void 0,void 0];function c(i,o,t){f[0]=(1-t)*i[0]+t*o[0],f[1]=(1-t)*i[1]+t*o[1],f[2]=(1-t)*i[2]+t*o[2],f[3]=(1-t)*i[3]+t*o[3]}const{_texelData:x}=this;for(let n=0;n<t.shadeTextureSize;++n)C=e+n/(t.shadeTextureSize-1)*(a-e),C<e?(f[0]=0,f[1]=0,f[2]=0,f[3]=0):C<l?c(s,o.outlineColor,(C-e)/(l-e)):C<h?[f[0],f[1],f[2],f[3]]=o.outlineColor:C<a?c(o.outlineColor,o.fillColor,(C-h)/(a-h)):[f[0],f[1],f[2],f[3]]=o.fillColor,x[4*n]=255*f[0],x[4*n+1]=255*f[1],x[4*n+2]=255*f[2],x[4*n+3]=255*f[3];this._minMaxDistance[0]=e,this._minMaxDistance[1]=a,this._shadeTexChanged=!0}applyHighlightOptions(i,n){if(!this._shadeTex){const o=new h.TextureDescriptor;o.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE,o.width=t.shadeTextureSize,o.height=1,this._shadeTex=new l.Texture(i,o)}this._shadeTexChanged&&(this._shadeTex.updateData(0,0,0,t.shadeTextureSize,1,this._texelData),this._shadeTexChanged=!1),i.bindTexture(this._shadeTex,o.textureBindingHighlight1),n.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose(),this._shadeTex=null}}return a}));
