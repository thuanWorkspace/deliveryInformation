/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../../chunks/tslib.es6","../../../../geometry","../../../../core/Accessor","../../../../core/Logger","../../../../core/mathUtils","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Point","./FlowDisplayData","./FlowDisplayObject","../../../../geometry/Extent"],(function(t,e,o,a,i,l,r,s,n,c,d,p,h,y,u){"use strict";const _=1.15;let g=class extends o{constructor(t){super(t),this._flowDisplayObject=new y.FlowDisplayObject,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(t){const{flowStyle:e}=this.flowContainer;if(null==e)return void this._clear();const{extent:o,rotation:i,resolution:r,pixelRatio:s}=t.state,n=f(o,i);n.expand(_);const c=[Math.round((n.xmax-n.xmin)/r),Math.round((n.ymax-n.ymin)/r)],d=new h(e,n,c,s);if(null!=this._loading){if(this._loading.update(d))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(d)||(d.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(t=>{l.isAbortError(t)||(a.getLogger(this).error("A resource failed to load.",t),this._loading=null)})),this._loading=d)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}};t.__decorate([r.property()],g.prototype,"_loading",void 0),t.__decorate([r.property()],g.prototype,"flowContainer",void 0),t.__decorate([r.property()],g.prototype,"updating",null),g=t.__decorate([d.subclass("esri.views.2d.engine.flow.FlowStrategy")],g);function f(t,e){const o=new p({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference}),a=t.xmax-t.xmin,l=t.ymax-t.ymin,r=Math.abs(Math.cos(i.deg2rad(e))),s=Math.abs(Math.sin(i.deg2rad(e))),n=r*a+s*l,c=s*a+r*l,d=new u({xmin:o.x-n/2,ymin:o.y-c/2,xmax:o.x+n/2,ymax:o.y+c/2,spatialReference:t.spatialReference});return d.centerAt(o),d}return g}));
