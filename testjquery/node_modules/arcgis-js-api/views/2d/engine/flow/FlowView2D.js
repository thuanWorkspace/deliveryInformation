/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../../chunks/tslib.es6","../../../../Graphic","../../../../core/Accessor","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/decorators/subclass","./createFlowStyle","./dataUtils","./FlowContainer","./FlowStrategy"],(function(t,e,r,a,o,i,s,n,l,c,d,p,h){"use strict";let y=class extends r{constructor(){super(...arguments),this._loadImagery=(t,e,r,a,o)=>d.loadImagery(this.layer,t,e,r,a,o),this._createFlowMesh=(t,e,r,a)=>this.layer.createFlowMesh({meshType:t,flowData:r,simulationSettings:e},{signal:a}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const{layer:t}=this,e=()=>{this._loadImagery=(e,r,a,o,i)=>d.loadImagery(t,e,r,a,o,i),this._updateVisualization()};"multidimensionalDefinition"in t?this.addHandles(a.watch((()=>t.multidimensionalDefinition),e)):this.addHandles([a.watch((()=>t.mosaicRule),e),a.watch((()=>t.rasterFunction),e),a.watch((()=>t.definitionExpression),e)]),this.container=new p,this._strategy=new h({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container?.removeAllChildren(),this.container=null,this.removeHandles()}update(t){t.stationary?this._strategy.update(t):this.layerView.requestUpdate()}hitTest(t){return new e({attributes:{},geometry:t.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){const t=this.layer.renderer;if(null==t||"flow"!==t.type)return;const e=c(t,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=e,this.layerView.requestUpdate()}};t.__decorate([o.property()],y.prototype,"_strategy",void 0),t.__decorate([o.property()],y.prototype,"attached",void 0),t.__decorate([o.property()],y.prototype,"container",void 0),t.__decorate([o.property()],y.prototype,"layer",void 0),t.__decorate([o.property()],y.prototype,"layerView",void 0),t.__decorate([o.property()],y.prototype,"type",void 0),t.__decorate([o.property()],y.prototype,"updating",null),t.__decorate([o.property()],y.prototype,"timeExtent",void 0),y=t.__decorate([l.subclass("esri.views.2d.engine.flow.FlowView2D")],y);return y}));
