/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/Evented","../../../core/events","../../../core/handleUtils","../../../core/has","../../../core/mathUtils","../../../chunks/mat2d","../../../chunks/mat2df64","../../webgl/contextUtils"],(function(e,t,a,s,r,n,i,o,h){"use strict";class c{constructor(e){this.events=new t,this._hasMajorPerformanceCaveat=!1,this._lastRenderFrameCounter=0,this._canvas=document.createElement("canvas"),this._canvas.setAttribute("style","width: 100%; height:100%; display:block; willChange:transform");const r={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!1,depth:!0,stencil:!0};e.appendChild(this._canvas);let n=h.createContextForView("2d",this._canvas,r);n||(n=h.createContextForView("2d",this._canvas,{...r,failIfMajorPerformanceCaveat:!1}),this._hasMajorPerformanceCaveat=!0),this._gl=n,this._handles=s.handlesGroup([a.on(this._canvas,"webglcontextlost",(e=>this.events.emit("webgl-context-lost",e)))])}destroy(){this._canvas.parentNode?.removeChild(this._canvas),this._canvas=null,this._handles.remove(),this._gl=null}get gl(){return this._gl}render(e,t){if(this._hasMajorPerformanceCaveat||r("esri-force-performance-mode")){if(++this._lastRenderFrameCounter>=r("esri-performance-mode-frames-between-render")&&(t(),this._lastRenderViewState=e.state.clone(),this._lastRenderFrameCounter=0),this._lastRenderViewState){const[t,a,s,r,n,i]=this._computeViewTransform(this._lastRenderViewState,e.state);this._canvas.style.transform=`matrix(${t}, ${a}, ${s}, ${r}, ${n}, ${i})`}}else t()}resize(e){const t=this._canvas,a=t.style,{state:{size:s},pixelRatio:r}=e,n=s[0],i=s[1],o=Math.round(n*r),h=Math.round(i*r);t.width===o&&t.height===h||(t.width=o,t.height=h),a.width=n+"px",a.height=i+"px"}_computeViewTransform(e,t){const[a,s]=e.center,[r,h]=t.center,[c,l]=e.toScreen([0,0],r,h),[d,m]=e.toScreen([0,0],a,s),_=d-c,v=m-l,f=e.scale/t.scale,u=t.rotation-e.rotation,g=o.create();return i.identity(g),i.scale(g,g,[f,f]),i.rotate(g,g,n.deg2rad(u)),i.translate(g,g,[_,v]),g}}e.ManagedCanvas=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
