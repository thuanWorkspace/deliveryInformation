/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/promiseUtils","../../../core/Queue","./webgl/AttributeStoreView","./webgl/TileContainer","./webgl/WGLRendererInfo"],(function(e,t,r,s,i,n){"use strict";class o extends i{constructor(e){super(e),this._rendererInfo=new n.WGLRendererInfo,this._materialItemsRequestQueue=new r,this.attributeView=new s.AttributeStoreView((()=>this.onAttributeStoreUpdate()))}destroy(){this.children.forEach((e=>e.destroy())),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}async getMaterialItems(e,r){if(!e||0===e.length)return[];const s=t.createResolver();return this._materialItemsRequestQueue.push({items:e,abortOptions:r,resolver:s}),this.requestRender(),s.promise}doRender(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let t=this._materialItemsRequestQueue.pop();for(;t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop()}super.doRender(e)}renderChildren(e){for(const t of this.children)t.commit(e);this._rendererInfo.update(e.state),super.renderChildren(e)}createRenderParams(e){const t=super.createRenderParams(e);return t.rendererInfo=this._rendererInfo,t.attributeView=this.attributeView,t}onAttributeStoreUpdate(){}_processMaterialItemRequest(e,{items:t,abortOptions:r,resolver:s}){const{painter:i,pixelRatio:n}=e,o=t.map((e=>i.textureManager.rasterizeItem(e.symbol,n,e.glyphIds,r)));Promise.all(o).then((e=>{if(!this.stage)return void s.reject();const r=e.map(((e,r)=>({id:t[r].id,mosaicItem:e})));s.resolve(r)}),s.reject)}}e.FeatureContainer=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
