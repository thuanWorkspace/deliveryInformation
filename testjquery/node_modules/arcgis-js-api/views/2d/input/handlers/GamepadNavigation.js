/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Handles","../../../../core/reactiveUtils","../../../../core/scheduling","../../viewpointUtils","../../../input/InputHandler","../../../navigation/gamepadAndKeyboardUtils"],(function(t,a,e,i,n,s,r){"use strict";class o extends s.InputHandler{constructor(t){super(!0),this._view=t,this._frameTask=null,this._watchHandles=new a,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",(t=>this._handleGamePadEvent(t))),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([e.watch((()=>this._view.navigation.gamepad?.enabled),(t=>{t?(this._handle.resume(),this._frameTask||(this._frameTask=i.addFrameTask({update:t=>this._frameUpdate(t.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))}),e.initial)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(t){const a=this._view.navigation.gamepad.device;a&&t.data.device!==a||this._currentDevice&&this._currentDevice!==t.data.device||("end"===t.data.action?(this._currentDevice=null,r.resetTransformation(this._transformation)):(this._currentDevice=t.data.device,r.extractTransformation(t.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(t){const a=this._transformation;if(r.isZeroTransformation(a))return;const e=this._view.viewpoint.clone(),i=this._view.navigation.gamepad.velocityFactor,s=h*i*t;n.translateBy(e,e,[a.translation[0]*s,-a.translation[1]*s]);const o=1+a.translation[2]*d*t,c=this._view.constraints.rotationEnabled?-a.heading*l*t:0,_=this._view.size,v=[_[0]/2,_[1]];n.scaleAndRotateBy(e,e,o,c,v,_);const m=this._view.constraints.constrain(e,this._view.viewpoint);this._view.viewpoint=m}}const l=.06,h=.7,d=6e-4;t.GamepadNavigation=o,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
