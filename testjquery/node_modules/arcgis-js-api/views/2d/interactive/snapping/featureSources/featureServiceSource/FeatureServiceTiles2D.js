/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../../chunks/tslib.es6","../../../../../../core/Accessor","../../../../../../core/reactiveUtils","../../../../../../core/accessorSupport/decorators/property","../../../../../../core/accessorSupport/ensureType","../../../../../../core/arrayUtils","../../../../../../core/has","../../../../../../core/accessorSupport/decorators/subclass","../../../../../../layers/support/TileKey","../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils","../../../../../support/layerViewUtils"],(function(e,t,r,i,s,o,l,n,a,c,u,p){"use strict";e.FeatureServiceTiles2D=class extends r{get tiles(){const e=this.tilesCoveringView,t=null!=this.pointOfInterest?this.pointOfInterest:this.view.center;return e.sort(((e,r)=>u.distanceToTile(t,e)-u.distanceToTile(t,r))),e}_scaleEnabled(){return p.scaleBoundsPredicate(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||null==this.tileInfo)return[];if(!this._scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:r}=t,i=[];for(const{row:s,colFrom:o,colTo:l}of e)for(let e=o;e<=l;e++){const o=t.normalizeCol(e),l=new c.TileKey(null,r,s,o);this.tileInfo.updateTileInfo(l),i.push(l)}return i}get tileInfo(){return this.view.featuresTilingScheme?.tileInfo??null}get tileSize(){return null!=this.tileInfo?this.tileInfo.size[0]:256}constructor(e){super(e),this.pointOfInterest=null}initialize(){this.addHandles(i.watch((()=>this.view?.state?.viewpoint),(()=>this.notifyChange("tilesCoveringView")),i.sync))}},t.__decorate([s.property({readOnly:!0})],e.FeatureServiceTiles2D.prototype,"tiles",null),t.__decorate([s.property({readOnly:!0})],e.FeatureServiceTiles2D.prototype,"_scaleEnabled",null),t.__decorate([s.property({readOnly:!0})],e.FeatureServiceTiles2D.prototype,"tilesCoveringView",null),t.__decorate([s.property({readOnly:!0})],e.FeatureServiceTiles2D.prototype,"tileInfo",null),t.__decorate([s.property({readOnly:!0})],e.FeatureServiceTiles2D.prototype,"tileSize",null),t.__decorate([s.property({constructOnly:!0})],e.FeatureServiceTiles2D.prototype,"view",void 0),t.__decorate([s.property({constructOnly:!0})],e.FeatureServiceTiles2D.prototype,"layer",void 0),t.__decorate([s.property()],e.FeatureServiceTiles2D.prototype,"pointOfInterest",void 0),e.FeatureServiceTiles2D=t.__decorate([a.subclass("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],e.FeatureServiceTiles2D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
