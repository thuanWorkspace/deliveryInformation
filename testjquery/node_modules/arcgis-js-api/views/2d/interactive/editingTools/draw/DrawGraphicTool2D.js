/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/tslib.es6","../../../../../geometry","../../../../../Graphic","../../../../../core/handleUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/ensureType","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/accessorSupport/decorators/subclass","../../SnappingVisualizer2D","./symbols","../../../../draw/DrawGraphicTool","../../../../draw/DrawOperation","../../../../draw/drawSurfaces","../../../../../geometry/Point","../../../../../geometry/Multipoint"],(function(e,t,i,r,a,s,l,n,o,c,h,p,u,m,y,v,d,g,G){"use strict";function _(e,t){return(e.attributes?.displayOrder??-1/0)-(t.attributes?.displayOrder??-1/0)}e.DrawGraphicTool2D=class extends y.DrawGraphicTool{constructor(e){super(e),this._visualElementGraphics={outline:null,regularVertices:null,activeVertex:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:e.activeLineSymbol??m.outline,regularVertices:e.regularVerticesSymbol??m.regularVertices,activeVertex:e.activeVertexSymbol??m.activeVertex,fill:e.activeFillSymbol},e.activeVertexSymbol||this.addHandles(l.watch((()=>this.view?.effectiveTheme?.accentColor),(e=>{if(!e)return;const t=this._visualElementSymbols.activeVertex.clone().set({color:e});this._visualElementGraphics.activeVertex?.set("symbol",t),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:t}}),l.initial))}normalizeCtorArgs(e){const t={...e};return delete t.activeFillSymbol,delete t.activeVertexSymbol,delete t.regularVerticesSymbol,delete t.activeLineSymbol,t}initializeGraphic(e){return null!=this._visualElementSymbols.fill&&(e.symbol=this._visualElementSymbols.fill),a.makeHandle()}makeDrawOperation(){const{defaultZ:e,hasZ:t,view:i}=this;return this._createOrUpdateGraphic(null),new v.DrawOperation({view:i,manipulators:this.manipulators,geometryType:y.geometryTypeToDrawOperationGeometryType(this.geometryType),drawingMode:this.mode,hasZ:t,defaultZ:e,snapToSceneEnabled:this.snapToScene,drawSurface:new d.MapDrawSurface(i,t,e),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new u.SnappingVisualizer2D(this.internalGraphicsLayer),tooltipOptions:this.tooltipOptions,graphic:this.graphic,cursor:this.cursor})}onActiveVertexChanged(e){if("point"===this.geometryType)return a.makeHandle();const[t,i]=e,l=new g({x:t,y:i,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.activeVertex?(this._visualElementGraphics.activeVertex.geometry=l,a.makeHandle()):(this._visualElementGraphics.activeVertex=new r({geometry:l,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(_),a.makeHandle((()=>{null!=this._visualElementGraphics.activeVertex&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=s.destroyMaybe(this._visualElementGraphics.activeVertex))})))}onOutlineChanged(e){const t=e.clone();if("polyline"===t.type){const e=t.paths[t.paths.length-1];e.splice(0,e.length-2)}return null!=this._visualElementGraphics.outline?(this._visualElementGraphics.outline.geometry=t,a.makeHandle()):(this._visualElementGraphics.outline=new r({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.outline),this.internalGraphicsLayer.graphics.sort(_),a.makeHandle((()=>{null!=this._visualElementGraphics.outline&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.outline),this._visualElementGraphics.outline=s.destroyMaybe(this._visualElementGraphics.outline))})))}onRegularVerticesChanged(e){const t=new G({points:e,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.regularVertices?(this._visualElementGraphics.regularVertices.geometry=t,a.makeHandle()):(this._visualElementGraphics.regularVertices=new r({geometry:t,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(_),a.makeHandle((()=>{null!=this._visualElementGraphics.regularVertices&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=s.destroyMaybe(this._visualElementGraphics.regularVertices))})))}},t.__decorate([n.property()],e.DrawGraphicTool2D.prototype,"activeFillSymbol",void 0),t.__decorate([n.property({readOnly:!0})],e.DrawGraphicTool2D.prototype,"type",void 0),t.__decorate([n.property({constructOnly:!0,nonNullable:!0})],e.DrawGraphicTool2D.prototype,"view",void 0),e.DrawGraphicTool2D=t.__decorate([p.subclass("esri.views.2d.interactive.draw.DrawGraphicTool2D")],e.DrawGraphicTool2D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
