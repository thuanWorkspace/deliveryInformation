/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/Handles","../../../../../chunks/vec3","../../../../../chunks/vec3f64","./Manipulation","./utils","../../../../draw/support/drawUtils","../../../../interactive/dragEventPipeline","../../../../interactive/GraphicManipulator","../../../../interactive/editGeometry/interfaces","../../../../interactive/editGeometry/operations/UpdateVertices","../../../../interactive/editGeometry/support/editPlaneUtils"],(function(t,e,i,a,n,r,o,s,l,c,p,u){"use strict";class h extends n.Manipulation{constructor(t){super(),this._handles=new e,this._originCache=a.create(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._snapRotation=t.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>r.onGrabChangedHandle(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(t){t(this._manipulator,n.ManipulatorType.ROTATE)}createDragPipeline(t,e){let a=null,n=null;return s.createManipulatorDragEventPipeline(this._manipulator,((r,l)=>{l.next((e=>{if("start"===e.action){r.cursor="grabbing";const e=t();a=e.plane,n=e.editGeometryOperations}return e})).next(s.screenToMap(this._view)).next((t=>({...t,rotateAngle:o.getRotationAngle(t.mapStart,t.mapEnd,{x:a.origin[0],y:a.origin[1]},!0)}))).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next((t=>{const r=i.copy(this._originCache,a.origin),o=[];for(const e of n.data.components)o.push(...e.vertices);const s="start"===t.action?c.AccumulationBehaviour.NEW_STEP:c.AccumulationBehaviour.ACCUMULATE_STEPS,l=n.rotateVertices(o,r,t.rotateAngle,s,p.AccumulationType.REPLACE);return u.apply(l,a),e(t,l),t})).next((t=>("end"===t.action&&(r.cursor="grab"),t)))}))}_createManipulator(){const t=this._view,e=this._graphic;return new l.GraphicManipulator({view:t,graphic:e,selectable:!0,cursor:"grab"})}}t.RotateManipulation=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
