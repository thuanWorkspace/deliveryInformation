/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","./Manipulation","../../../../interactive/dragEventPipeline","../../../../interactive/GraphicManipulator","../../../../interactive/editGeometry/interfaces","../../../../interactive/support/utils"],(function(t,i,a,e,r,n){"use strict";class o extends i.Manipulation{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(t){t(this._manipulator,i.ManipulatorType.TRANSLATE_XY)}createDragPipeline(t,i){let e=null,o=null,s=0,l=0,c=0;const{offsetX:u,offsetY:p,size:h}=n.getSymbolInfo(this._graphic.symbol);return a.createManipulatorDragEventPipeline(this._manipulator,((n,m)=>{m.next((i=>{if("start"===i.action){const i=t();e=i.editGeometryOperations,o=i.constraints}return i})).next(a.screenToMap(this._view)).next((t=>{const{x:a,y:n,z:m}=t.mapEnd;if(o&&(a+u<o.xmin||n+p-h<o.ymin||a+u>o.xmax||n+p-h>o.ymax))return t;("start"===t.action||0===s&&0===l&&0===c)&&(s=t.mapStart.x,l=t.mapStart.y,c=t.mapStart.z);const _=a-s,v=n-l,f=m-c;s=a,l=n,c=m;const M=[];for(const i of e.data.components)M.push(...i.vertices);const d="start"===t.action?r.AccumulationBehaviour.NEW_STEP:r.AccumulationBehaviour.ACCUMULATE_STEPS,g=e.moveVertices(M,_,v,f,d);return i(t,g),t}))}))}_createManipulator(){const t=this._view,i=this._graphic;return new e.GraphicManipulator({view:t,graphic:i,selectable:!0,cursor:"move"})}}t.DragManipulation=o,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
