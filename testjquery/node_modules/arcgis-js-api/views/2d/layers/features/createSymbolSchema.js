/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../symbols/cim/CIMSymbolHelper","../../engine/webgl/enums","../../engine/webgl/materialKey/MaterialKey"],(function(e,t,r,a){"use strict";function l(e){if("line-marker"===e.type){return{type:"line-marker",color:e.color?.toJSON(),placement:e.placement,style:e.style}}return e.constructor.fromJSON(e.toJSON()).toJSON()}function n(e){return a.hydrateMaterialKey(e)}function o(e,t,r=!1){if(!e)return null;switch(e.type){case"simple-fill":case"picture-fill":return i(e,t,r);case"simple-marker":case"picture-marker":return m(e,t,r);case"simple-line":return s(e,t,r);case"text":return c(e,t,r);case"label":return y(e,t,r);case"cim":return{type:"cim",rendererKey:t.vvFlags,data:e.data,maxVVSize:t.maxVVSize};case"CIMSymbolReference":return{type:"cim",rendererKey:t.vvFlags,data:e,maxVVSize:t.maxVVSize};case"web-style":return{...l(e),type:"web-style",hash:e.hash(),rendererKey:t.vvFlags,maxVVSize:t.maxVVSize};default:throw new Error(`symbol not supported ${e.type}`)}}function y(e,t,l){const o=e.toJSON(),y=a.createMaterialKey(r.WGLGeometryType.LABEL,{...t,placement:o.labelPlacement});return{materialKey:l?n(y):y,hash:e.hash(),...o,labelPlacement:o.labelPlacement}}function i(e,t,o){const y=a.createMaterialKey(r.WGLGeometryType.FILL,t),i=o?n(y):y,s=e.clone(),m=s.outline,c=a.isOutlineFillSymbology(t.symbologyType);c||(s.outline=null);const u={materialKey:i,hash:s.hash(),...l(s)};if(c)return u;const h=[];if(h.push(u),m){const e=a.createMaterialKey(r.WGLGeometryType.LINE,{...t,isOutline:!0}),y={materialKey:o?n(e):e,hash:m.hash(),...l(m)};h.push(y)}return{type:"composite-symbol",layers:h,hash:h.reduce(((e,t)=>t.hash+e),"")}}function s(e,t,o){const y=a.isOutlineFillSymbology(t.symbologyType)?r.WGLSymbologyType.DEFAULT:t.symbologyType,i=a.createMaterialKey(r.WGLGeometryType.LINE,{...t,symbologyType:y}),s=o?n(i):i,m=e.clone(),c=m.marker;m.marker=null;const u=[];if(u.push({materialKey:s,hash:m.hash(),...l(m)}),c){const e=a.createMaterialKey(r.WGLGeometryType.MARKER,t),y=o?n(e):e;c.color=c.color??m.color,u.push({materialKey:y,hash:c.hash(),lineWidth:m.width,...l(c)})}return{type:"composite-symbol",layers:u,hash:u.reduce(((e,t)=>t.hash+e),"")}}function m(e,y,i){if("simple-marker"===e.type&&("path"===e.style||e.outline&&"solid"!==e.outline.style&&"none"!==e.outline.style)){return o({type:"CIMSymbolReference",symbol:t.CIMSymbolHelper.fromSimpleMarker(e)},y,i)}const s=a.createMaterialKey(r.WGLGeometryType.MARKER,y),m=i?n(s):s,c=l(e);return{materialKey:m,hash:e.hash(),...c,angle:e.angle,maxVVSize:y.maxVVSize}}function c(e,t,o){const y=a.createMaterialKey(r.WGLGeometryType.TEXT,t),i=o?n(y):y,s=l(e);return{materialKey:i,hash:e.hash(),...s,angle:e.angle,maxVVSize:t.maxVVSize}}e.createSymbolSchema=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
