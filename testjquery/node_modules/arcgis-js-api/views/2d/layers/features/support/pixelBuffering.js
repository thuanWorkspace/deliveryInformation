/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/screenUtils","../../../../../symbols/cim/CIMSymbolHelper","../../../../../symbols/cim/Rect","../../../engine/webgl/definitions","../../graphics/graphicsUtils","../../support/cimSymbolUtils"],(function(e,t,i,r,n,s,a){"use strict";const o={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1},u=.707;function c(e,t){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;const i=e.getVisualVariablesForType("size");if(!i[0])return 0;const r=i[0];if(t&&"cluster_count"===r.field&&"cluster"===t.type)return t.clusterMaxSize;if("outline"===r.target)return 0;if("stops"===r.transformationType)return r.stops.map((e=>e.size)).reduce(b,0);if("clamped-linear"===r.transformationType){let e=-1/0,t=-1/0;return e="number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((e=>e.size)).reduce(b,0),t="number"==typeof r.minSize?r.minSize:r.minSize.stops.map((e=>e.size)).reduce(b,0),Math.max(e,t)}return"real-world-size"===r.transformationType?30:void 0}function l(e){return e.type in o}async function m(e,i,r,n,s,a){if(!e||a&&"cluster"===a.type)return 0;if("heatmap"===e.type)return Math.round(t.pt2px(e.radius));if("dot-density"===e.type)return 0;if("dictionary"===e.type)return"esriGeometryPoint"===i||"esriGeometryMultipoint"===i?100:200;const o=e.getSymbols(),u=c(e),l=[];for(const t of o)l.push(M(t,u,r,i,n,s));const m=await Promise.all(l);return t.pt2px(m.reduce(b,0))}const p=[0,0,0,0];function f(e,t){return e??t}function y(e,t){return null==e.outline?t:f(e.outline.width,t)}const h={sdf:!0,code:99,metrics:n.averageGlyphMosaicItem.metrics,rect:new r(0,0,24,24),page:0,textureBinding:2};function d(e){const t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[h]};const i=[];for(let r=0;r<t;r++)i.push({...h,code:e.text.charCodeAt(r)});return{glyphMosaicItems:i}}async function x(e,t,r,n,o,c){if("simple-marker"===e.type){const i=Math.max(f(e.size,12),t);return g(e)+i*u}if("picture-marker"===e.type){const i=Math.max(f(e.height,12),t),r=f(e.width,12)*(i/f(e.height,12))/2,n=i/2;return g(e)+Math.sqrt(r*r+n*n)}if("text"===e.type){const t=d(e);s.getTextSymbolSize(p,e.toJSON(),t);const i=Math.abs(p[0]),r=Math.abs(p[1]),n=p[2],a=p[3];return Math.max(i,r)+Math.max(n,a)}if("simple-line"===e.type){const i=e,r=Math.max(f(i.width,.75),t)/2;return i.marker?Math.max(6*i.width,2*t):r}if("simple-fill"===e.type||"picture-fill"===e.type)return Math.max(y(e,0),t)/2;if("cim"===e.type){const s={geometryType:n,fields:o,spatialReference:c},u={type:"cim",rendererKey:0,data:e.data,maxVVSize:t};await a.expandSymbol(u,s,r);const l=i.CIMSymbolHelper.getEnvelope(e.data,null,r);return l?Math.sqrt(l.width*l.width+l.height*l.height):0}return"web-style"===e.type?x(await e.fetchCIMSymbol(),t,r,n,o,c):0}async function M(e,t,i,r,n,s){return l(e)?Math.min(await x(e,t,i,r,n,s),75):0}function g(e){const t=f(e.xoffset,0),i=f(e.yoffset,0);return Math.sqrt(t*t+i*i)}function b(e,t){return Math.max(e,t)}e.computePxBuffer=m,e.getPtMaxVVSize=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
