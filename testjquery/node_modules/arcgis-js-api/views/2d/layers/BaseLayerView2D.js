/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../../geometry/support/aaBoundingRect","../../../geometry/support/spatialReferenceUtils","../tiling/TileInfoView","../tiling/TileKey","../tiling/TileQueue","../tiling/TileStrategy","./LayerView2D","./support/Display","../../layers/LayerView","../../layers/RefreshableLayerView"],(function(e,t,s,i,r,o,l,a,n,c,h,p,d,u,y,g){"use strict";const f=new Set,w=[],_=[];class v{constructor(e,t,s,i,r,o,a,n=[0,0],c=l.create()){this.id=e,this.level=t,this.row=s,this.col=i,this.world=r,this.resolution=o,this.scale=a,this.coords=n,this.bounds=c}}let R=class extends(g(d.LayerView2DMixin(y))){constructor(e){super(e),this._tileMap=new Map,this.layer=null,this.tiles=[]}initialize(){this.display=new u.Display(this),this.container.addChild(this.display)}get _tileInfoView(){const e=this.layer?.tileInfo;return e?new n(e):null}attach(){}detach(){}requestRender(){this.display.requestRender()}tilesChanged(e,t){}supportsSpatialReference(e){const t=this.layer?.tileInfo;return!t||a.equals(t.spatialReference,e)}async doRefresh(){}isUpdating(){return!1}update(e){const t=this._tileInfoView,s=this.tiles;if(t){const i=t.getTileCoverage(e.state,0),{spans:r,lodInfo:o}=i??{};if(r?.length&&o)for(const{row:e,colFrom:t,colTo:l}of r)for(let i=t;i<=l;i++){const t=o.normalizeCol(i),r=o.getWorldForColumn(i),l=`${o.level}/${e}/${t}/${r}`;if(!this._tileMap.has(l)){const i=new v(l,o.level,e,t,r,o.resolution,o.scale);o.getTileCoords(i.coords,i,!1),o.getTileBounds(i.bounds,i,!0),this._tileMap.set(l,i),s.push(i),w.push(i)}f.add(l)}}for(let i=s.length-1;i>=0;i--){const e=s[i];f.has(e.id)||(s.splice(i,1),_.push(e),this._tileMap.delete(e.id))}(w.length||_.length)&&(this.tilesChanged(w,_),w.length=_.length=0),f.clear(),this.requestRender()}moveStart(){}viewChange(){this.requestUpdate()}moveEnd(){}};e.__decorate([t.property()],R.prototype,"_tileInfoView",null),e.__decorate([t.property()],R.prototype,"layer",void 0),R=e.__decorate([o.subclass("esri.views.2d.layers.BaseLayerView2D")],R);return R}));
