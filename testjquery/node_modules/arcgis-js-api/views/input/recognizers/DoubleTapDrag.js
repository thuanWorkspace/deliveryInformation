/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/clock","../../../core/MapUtils","../../../core/maybe","../../../core/screenUtils","../DragEventSeparator","../InputHandler","./support"],(function(t,e,a,i,r,o,n,s){"use strict";class u extends n.InputHandler{constructor(t=s.DefaultParameters.maximumDoubleClickDelay,a=s.DefaultParameters.maximumDoubleClickDistance,i=s.DefaultParameters.maximumDoubleTouchDelay,n=s.DefaultParameters.maximumDoubleTouchDistance,u=e.clock){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=a,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=u,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=r.createScreenPoint(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new o.DragEventSeparator({start:(t,e)=>this._dragStart(t,e),update:(t,e)=>this._dragUpdate(e),end:(t,e)=>this._dragEnd(e)}),this.registerIncoming("drag",(t=>this._dragEventSeparator.handle(t))),this.registerIncoming("pointer-down",(t=>this._handlePointerDown(t))),this.registerIncoming("pointer-up",(()=>this._handlePointerUp()))}onUninstall(){this._pointerState.forEach((t=>{t.doubleTapTimeout=i.removeMaybe(t.doubleTapTimeout)}))}get hasPendingInputs(){return a.someMap(this._pointerState,(t=>null!=t.doubleTapTimeout))}_clearPointerDown(t){const e=this._pointerState.get(t);e&&(e.doubleTapTimeout=i.removeMaybe(e.doubleTapTimeout),this._pointerState.delete(t),this.refreshHasPendingInputs())}_createDoubleTapDragData(t,e,a){const{button:i,buttons:r,pointer:o,pointers:n,pointerType:s,timestamp:u}=a;return{action:t,delta:e,button:i,buttons:r,pointer:o,pointers:n,pointerType:s,timestamp:u}}_dragStart(t,e){if(!this._doubleTapDragReady||1!==t)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:a,modifiers:i}=e,{center:o}=a;this._dragStartCenter=o;const n=this._createDoubleTapDragData("begin",r.createScreenPoint(0,0),a);this._doubleTapDrag.emit(n,void 0,i),e.stopPropagation()}_dragUpdate(t){if(!this._doubleTapDragActive)return;const{data:e,modifiers:a}=t,{center:i}=e,o=r.createScreenPoint(i.x-this._dragStartCenter.x,i.y-this._dragStartCenter.y),n=this._createDoubleTapDragData("update",o,e);this._doubleTapDrag.emit(n,void 0,a),t.stopPropagation()}_dragEnd(t){if(!this._doubleTapDragActive)return;const{data:e,modifiers:a}=t,{center:i}=e,o=r.createScreenPoint(i.x-this._dragStartCenter.x,i.y-this._dragStartCenter.y),n=this._createDoubleTapDragData("end",o,e);this._doubleTapDrag.emit(n,void 0,a),this._doubleTapDragActive=!1,t.stopPropagation()}_handlePointerDown(t){const{data:e}=t,a=s.getPointerId(e),i=this._pointerState.get(a),{pointerType:r}=e.native;if(i){const o="touch"===r?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(a),s.manhattanDistance(i.event.data,e)>o?this._storePointerDown(t):this._doubleTapDragReady=!0}else this._storePointerDown(t)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(t){const{data:e}=t,{pointerType:a}=e.native,i=s.getPointerId(e),r="touch"===a?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout((()=>this._clearPointerDown(i)),r);this._pointerState.set(i,{event:t,doubleTapTimeout:o}),this.refreshHasPendingInputs()}}t.DoubleTapDrag=u,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
