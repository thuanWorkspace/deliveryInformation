/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/clock","../../../core/MapUtils","../../../core/maybe","../InputHandler","./support"],(function(e,t,i,o,n,s){"use strict";class a extends n.InputHandler{constructor(e=s.DefaultParameters.maximumDoubleClickDelay,i=s.DefaultParameters.maximumDoubleClickDistance,o=s.DefaultParameters.maximumDoubleTouchDelay,n=s.DefaultParameters.maximumDoubleTouchDistance,a=t.clock){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=o,this._maximumDoubleTouchDistance=n,this._clock=a,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach((e=>e.doubleClickTimer=o.removeMaybe(e.doubleClickTimer)))}get hasPendingInputs(){return i.someMap(this._pointerState,(e=>null!=e.doubleClickTimer))}_clearDoubleClickTimer(e,t){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=o.removeMaybe(i.doubleClickTimer),t&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);1===t.pointerDownCount&&this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:t,pointerType:i,button:o}=e.native;return"mouse"===i?`${t}:${o}`:`${i}`}_handleImmediateClick(e){const t=e.data,{pointerType:i}=t.native,o=this._getPointerId(t);if(!this._pointerState.has(o))return void this._startClick(e);const n=this._pointerState.get(o),{data:a,modifiers:l}=n.event,r="touch"===i?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s.manhattanDistance(a,t)>r?(this._clearDoubleClickTimer(o,!0),this._startClick(e)):(this._clearDoubleClickTimer(o,!1),2===n.pointerDownCount&&this._doubleClick.emit(a,void 0,l))}_handlePointerDown(e){const t=s.getPointerId(e.data),i=this._pointerState.get(t);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:t}=e,{native:{pointerType:i}}=t,o=s.getPointerId(t),n="touch"===i?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(o)),n),l=1;this._pointerState.set(o,{event:e,doubleClickTimer:a,pointerDownCount:l}),this.refreshHasPendingInputs()}}e.SingleAndDoubleClick=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
