/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/clock","../InputHandler","./support"],(function(t,e,i,a){"use strict";class o extends i.InputHandler{constructor(t=a.DefaultParameters.maximumDoubleClickDelay,i=a.DefaultParameters.maximumDoubleClickDistance,o=a.DefaultParameters.maximumDoubleTouchDelay,n=a.DefaultParameters.maximumDoubleTouchDistance,m=e.clock){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=o,this._maximumDoubleTouchDistance=n,this._clock=m,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach((t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(t){const e=t.data,i=a.getPointerId(e);if(!this._pointerState.has(i)){const t={downButton:e.native.button,x:e.x,y:e.y,immediateDoubleClick:null};this._pointerState.set(i,t),this.startCapturingPointer(e.native)}}_handlePointerUp(t){const e=t.data,i=a.getPointerId(e),o=this._pointerState.get(i);if(o&&o.downButton===e.native.button){const i=o.immediateDoubleClick,n="touch"===t.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;i?(i.timeoutHandle.remove(),a.manhattanDistance(i,t.data)>n?this._startImmediateDoubleClick(t,o):(this._immediateDoubleClick.emit(t.data,void 0,i.modifiers),this._removeState(e))):a.manhattanDistance(o,t.data)>n?this._removeState(e):this._startImmediateDoubleClick(t,o)}}_startImmediateDoubleClick(t,e){const i="touch"===t.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;e.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(t.data)),i)}}_removeState(t){const e=a.getPointerId(t);this._pointerState.delete(e),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}t.ImmediateDoubleClick=o,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
