/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/Error","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../layers/support/commonProperties","../../layers/support/ExportWMSImageParameters"],(function(e,r,t,o,s,a,p,i,c,n){"use strict";return s=>{let a=class extends s{initialize(){this.exportImageParameters=new n.ExportWMSImageParameters({layer:this.layer})}destroy(){this.exportImageParameters=t.destroyMaybe(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}fetchPopupFeatures(e){const{layer:t}=this;if(!e)return Promise.reject(new r("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t}));const{popupEnabled:o}=t;if(!o)return Promise.reject(new r("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:o}));const s=this.createFetchPopupFeaturesQuery(e);if(!s)return Promise.resolve([]);const{extent:a,width:p,height:i,x:c,y:n}=s;if(!(a&&p&&i))throw new r("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:a,width:p,height:i});return t.fetchFeatureInfo(a,p,i,c,n)}};return e.__decorate([o.property()],a.prototype,"exportImageParameters",void 0),e.__decorate([o.property({readOnly:!0})],a.prototype,"exportImageVersion",null),e.__decorate([o.property()],a.prototype,"layer",void 0),e.__decorate([o.property(c.combinedViewLayerTimeExtentProperty)],a.prototype,"timeExtent",void 0),a=e.__decorate([i.subclass("esri.layers.mixins.WMSLayerView")],a),a}}));
