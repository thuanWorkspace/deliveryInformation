/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/Error","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../geometry/Point","../../layers/support/commonProperties","../../rest/support/Query","./support/popupUtils"],(function(e,t,r,o,s,p,a,i,n,u,c){"use strict";const l=o=>{let s=class extends o{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,r){const{layer:o}=this;if(!e)throw new t("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:o});const{popupEnabled:s}=o,p=c.getFetchPopupTemplate(o,r);if(!s||null==p)throw new t("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:s,popupTemplate:p});const a=await p.getRequiredFields(),n=new u;n.timeExtent=this.timeExtent,n.geometry=e,n.outFields=a,n.outSpatialReference=e.spatialReference;const{resolution:l,spatialReference:y}=this.view,d="2d"===this.view.type?new i(l,l,y):new i(.5*l,.5*l,y),{returnTopmostRaster:m,showNoDataRecords:h}=p.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},w={returnDomainValues:!0,returnTopmostRaster:m,pixelSize:d,showNoDataRecords:h,signal:null!=r?r.signal:null};return o.queryVisibleRasters(n,w).then((e=>e))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e.__decorate([r.property()],s.prototype,"layer",void 0),e.__decorate([r.property()],s.prototype,"suspended",void 0),e.__decorate([r.property(n.combinedViewLayerTimeExtentProperty)],s.prototype,"timeExtent",void 0),e.__decorate([r.property()],s.prototype,"view",void 0),s=e.__decorate([a.subclass("esri.views.layers.ImageryLayerView")],s),s};return l}));
