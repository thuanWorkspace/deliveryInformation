/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../intl","../../core/arrayUtils","../../core/domUtils","../../core/Evented","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/accessorSupport/decorators/subclass","../../support/themeUtils","./Component","../../widgets/support/widgetUtils","../../intl/locale"],(function(t,e,n,o,i,r,s,a,p,d,c,l,h,u){"use strict";const m={left:0,top:0,bottom:0,right:0},_={bottom:30,top:15,right:15,left:15},f="esri-ui",g={ui:f,corner:`${f}-corner`,innerContainer:`${f}-inner-container`,manualContainer:`${f}-manual-container`,cornerContainer:`${f}-corner-container`,topLeft:`${f}-top-left`,topRight:`${f}-top-right`,bottomLeft:`${f}-bottom-left`,bottomRight:`${f}-bottom-right`};function y(t){return t&&!t._started&&"function"==typeof t.postMixInProperties&&"function"==typeof t.buildRendering&&"function"==typeof t.postCreate&&"function"==typeof t.startup}function C(t){return 0===t?"0":`${t}px`}function v(t){const e="object"==typeof t&&null!==t&&Object.getPrototypeOf(t);return(null===e||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function b(t,{top:e,bottom:n,left:o,right:i}){t.style.top=e,t.style.bottom=n,t.style.left=o,t.style.right=i}let w=class extends i.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=u.getLocale(),this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&b(t,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&b(t,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([r.watch((()=>[this.view?.padding,this.container]),this._applyViewPadding,r.initial),r.watch((()=>this.padding),this._applyUIPadding,r.initial),r.watch((()=>[this.container,this._locale]),(([t,e])=>{t&&t.setAttribute("lang",e)}),r.initial),u.onLocaleChange((t=>{this._locale=t}))])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add(g.ui),c.setCalciteThemeClass(t),this._attachContainers(t)),e&&(e.classList.remove(g.ui),b(e,{top:"",bottom:"",left:"",right:""}),o.empty(e)),this._set("container",t))}get height(){const t=this.view?.height??0;if(0===t)return t;const e=this._getViewPadding(),{top:n,bottom:o}=e;return Math.max(t-n-o,0)}get padding(){return this._get("padding")}set padding(t){this._overrideIfSome("padding",t)}castPadding(t){return"number"==typeof t?{bottom:t,top:t,right:t,left:t}:{..._,...t}}get width(){const t=this.view?.width??0;if(0===t)return t;const e=this._getViewPadding(),{left:n,right:o}=e;return Math.max(t-n-o,0)}add(t,e){let n,o,i;if(Array.isArray(t))return void t.forEach((t=>this.add(t,e)));const r=v(t);r&&({index:n,position:e,component:t,key:o}=r),e&&"object"==typeof e&&({index:n,key:o,position:e,internal:i}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,n,o,i)}remove(t,e){if(!t)return;if(Array.isArray(t))return t.map((t=>this.remove(t,e)));const n=this._find(t);if(n){if(this._componentMap.has(n)&&this._componentMap.get(n)?.key!==e)return;const t=this._components.indexOf(n),o=n.node.parentNode;return o?.removeChild(n.node),this._componentMap.delete(n),this._components.splice(t,1)[0]}}empty(t,e={removeInternal:!1}){if(Array.isArray(t)){for(const n of t)this.empty(n,e);return}const n=this._positionNameToContainerLookup[t??"manual"],o=Array.prototype.slice.call(n.children).map((t=>this._findByNode(t))).filter((t=>{if(null==t)return!1;return!(this._componentMap.get(t)?.internal??!1)||e.removeInternal}));for(const i of o)this.remove(i)}move(t,e){if(Array.isArray(t)&&t.forEach((t=>this.move(t,e))),!t)return;let n;const o=v(t)||v(e);if(o&&(n=o.index,e=o.position,t=o.component||t),e&&!this._isValidPosition(e))return;const i=this.remove(t);i&&this.add(i,{position:e,index:n})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getComponents(t,e={includeInternal:!1}){return t?Array.isArray(t)?t.flatMap((t=>this._getComponentsAtPosition(t,e))):this._getComponentsAtPosition(t,e):this._components.filter((t=>e.includeInternal||!this._componentMap.get(t)?.internal)).map((({widget:t,node:e})=>t??e))}getPosition(t){for(const e in this._positionNameToContainerLookup){if(this._positionNameToContainerLookup[e].contains(t))return e}return null}_add(t,e,n,o,i){t instanceof l||(t=new l({node:t})),this._place({component:t,position:e,index:n}),this._components.push(t),this._componentMap.set(t,{key:o,internal:i})}_find(t){return t?t instanceof l?this._findByComponent(t):"string"==typeof t?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){return this.view?.padding??m}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add(g.innerContainer,g.cornerContainer);const e=document.createElement("div");e.classList.add(g.innerContainer,g.manualContainer);const n=document.createElement("div");n.classList.add(g.topLeft,g.corner),t.appendChild(n);const o=document.createElement("div");o.classList.add(g.topRight,g.corner),t.appendChild(o);const i=document.createElement("div");i.classList.add(g.bottomLeft,g.corner),t.appendChild(i);const r=document.createElement("div");r.classList.add(g.bottomRight,g.corner),t.appendChild(r),this._innerContainer=t,this._manualContainer=e;const s=h.isRTL();this._cornerNameToContainerLookup={"top-left":n,"top-right":o,"bottom-left":i,"bottom-right":r,"top-leading":s?o:n,"top-trailing":s?n:o,"bottom-leading":s?r:i,"bottom-trailing":s?i:r},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const e=t.position??"manual",{component:n,index:i}=t,r=this._positionNameToContainerLookup[e],s=null!=i&&i>-1;if(y(n.widget)&&n.widget.startup(),!s)return void r.appendChild(n.node);const a=Array.from(r.children);if(0===i)return void(r.firstChild?o.insertBefore(n.node,r.firstChild):r.appendChild(n.node));i>=a.length?r.appendChild(n.node):o.insertBefore(n.node,a[i])}_toPixelPosition(t){return{top:C(t.top),left:C(t.left),right:C(t.right),bottom:C(t.bottom)}}_findByComponent(t){return this._components.find((e=>e===t))??null}_findById(t){return this._components.find((({id:e})=>e===t))??null}_findByNode(t){return this._components.find((({node:e})=>e===t))??null}_getComponentsAtPosition(t,e){const o=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(o.children).map((t=>this._findByNode(t))).filter(n.isSome).filter((t=>e.includeInternal||!this._componentMap.get(t)?.internal)).map((({widget:t,node:e})=>t??e))}};t.__decorate([s.property()],w.prototype,"_locale",void 0),t.__decorate([s.property()],w.prototype,"container",null),t.__decorate([s.property()],w.prototype,"height",null),t.__decorate([s.property({value:_})],w.prototype,"padding",null),t.__decorate([a.cast("padding")],w.prototype,"castPadding",null),t.__decorate([s.property()],w.prototype,"view",void 0),t.__decorate([s.property()],w.prototype,"width",null),w=t.__decorate([d.subclass("esri.views.ui.UI")],w);return w}));
