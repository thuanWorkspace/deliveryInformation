/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4","../../../../chunks/vec4f64","./Object3DVisualElement","../../layers/graphics/ElevationContext","../../support/renderInfoUtils/point","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Material","../../webgl-engine/materials/ShadedColorMaterial"],(function(e,t,r,i,s,a,l,n,o,c,u,h){"use strict";class d extends a.Object3DVisualElement{constructor(e){super(e),this.view=null,this._renderOccluded=u.RenderOccludedFlag.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=s.fromArray([1,127/255,0,1]),this._size=11,this._outlineColor=s.fromArray([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){i.exactEquals(e,this._color)||(i.copy(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){i.exactEquals(e,this._outlineColor)||(i.copy(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const r=.5,i=.5,s=n.geometryToRenderInfo(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,l.ElevationContext.fromElevationInfo(this.elevationInfo)),a=[],o=s.numVertices,c=s.position;for(let l=0;l<o;++l){const e=t.set(_,c[3*l],c[3*l+1],c[3*l+2]),s=v(this._vertexMaterial,r,e),n=v(this._vertexOutlineMaterial,i,e);a.push({vertexGeometry:s,vertexOutlineGeometry:n})}return a}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:r,vertexOutlineGeometry:i}of t)e.addGeometry(r),e.addGeometry(i)}createExternalResources(){this._vertexMaterial=new h.ShadedColorMaterial({...this._vertexMaterialParameters,writeDepth:!0,cullFace:o.CullFaceOptions.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new h.ShadedColorMaterial({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:o.CullFaceOptions.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const _=r.create();function v(e,t,r){return c.createSphereGeometry(e,t,16,16,{offset:r})}e.VerticesVisualElement=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
