/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/mathUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/ensureType","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/vec3","../../../../../geometry/support/axisAngleDegrees","../../../../../geometry/support/MeshTransform","../../../../ViewingMode","./undoRecords"],(function(e,t,r,o,a,n,s,i,c,l,p,g,h,d,u){"use strict";e.ScaleRotateMeshAdapter=class extends r{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([a.when((()=>{const e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null}),(({interactionState:e})=>{this._updateMeshRotation(e)}),a.sync),a.when((()=>{const e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null}),(({interactionState:e})=>{this._updateMeshSize(e)}),a.sync)])}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const e=this.geometry.transform;if(null==e)return this._interactionState?.angle??0;const t=g.axis(e.rotation)[2];return Math.abs(t)>.999999?o.deg2rad(g.angle(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const e=new y({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return u.createGraphicGeometryUndoRecord(this.graphic)}_updateMeshRotation(e){const{angle:t,previousAngle:r}=e;e.previousAngle=t;const{geometry:a}=this,{vertexSpace:n}=a,s=o.rad2deg(t-r);if(n.isGeoreferenced){const e=!n.isRelative&&this.viewingMode===d.ViewingMode.Global,t=this.geometry.anchor;this.geometry.rotate(0,0,s,{origin:t,geographic:e}),this.graphic.notifyGeometryChanged()}else{a.transform??(a.transform=new h);const{transform:e}=a,t=g.composeAxes(0,0,s,_);e.rotation=g.compose(e.rotation,t,e.rotation),this.graphic.notifyMeshTransformChanged()}}_updateMeshSize(e){const{scale:t,previousScale:r}=e;e.previousScale=t;const{geometry:o}=this,{vertexSpace:a}=o,n=t/r;if(a.isGeoreferenced){const e=!a.isRelative&&this.viewingMode===d.ViewingMode.Global,t=this.geometry.anchor;this.geometry.scale(n,{origin:t,geographic:e}),this.graphic.notifyGeometryChanged()}else{o.transform??(o.transform=new h);const{transform:e}=o;e.scale=p.scale(e.scale,e.scale,n),this.graphic.notifyMeshTransformChanged()}}},t.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"graphic",void 0),t.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"geometry",void 0),t.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"viewingMode",void 0),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"initialAngle",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"angle",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"angleClockwise",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngle",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngleClockwise",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"scale",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"_interactionState",void 0),e.ScaleRotateMeshAdapter=t.__decorate([l.subclass("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],e.ScaleRotateMeshAdapter);let y=class extends r{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};t.__decorate([n.property()],y.prototype,"angle",void 0),t.__decorate([n.property()],y.prototype,"initialAngle",void 0),t.__decorate([n.property()],y.prototype,"previousAngle",void 0),t.__decorate([n.property()],y.prototype,"previousScale",void 0),t.__decorate([n.property()],y.prototype,"scale",void 0),t.__decorate([n.property()],y.prototype,"state",null),y=t.__decorate([l.subclass("InteractionState")],y);const _=g.create();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
