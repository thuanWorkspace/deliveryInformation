/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/Handles","../../../../../core/handleUtils","../../../../../core/has","../../../../../core/reactiveUtils","../ManipulatorType","./config","./Manipulation","./MoveXYAxisManipulation","./MoveXYDiscManipulation","./MoveZManipulation"],(function(i,a,t,n,e,s,o,l,p,r,u){"use strict";class h extends l.Manipulation{constructor(i){super(),this._handles=new a,this._interactive=!0;const{tool:t,view:n,snapToScene:e,radius:s}=i;this._view=n,this.xyManipulation=new r.MoveXYDiscManipulation({tool:t,view:n,snapToScene:e,radius:s}),this.xyAxisManipulation=new p.MoveXYAxisManipulation({tool:t,view:n,radius:s}),this.zManipulation=new u.MoveZManipulation({tool:t,view:n,radius:s}),this.xyManipulation.available=i.xyAvailable,this.xyAxisManipulation.available=i.xyAxisAvailable,this.zManipulation.available=i.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((i=>this._handles.add(i.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(a,n,e){return t.handlesGroup([this.xyManipulation.createGraphicDragPipeline(((t,n,e,s,o)=>a(i.ManipulationType.XY,t,n,e,s,o)),n,e),this.xyAxisManipulation.createGraphicDragPipeline(((t,n,e,s,o)=>a(i.ManipulationType.XY_AXIS,t,n,e,s,o)),n,e),this.zManipulation.createGraphicDragPipeline(((t,n,e,s,o)=>a(i.ManipulationType.Z,t,n,e,s,o)),n,e)])}createDragPipeline(a,n,e,s){return t.handlesGroup([this.xyManipulation.createDragPipeline(((t,n,e,s,o)=>a(i.ManipulationType.XY,t,n,e,s,o)),n,e,s),this.xyAxisManipulation.createDragPipeline(((t,n,e,s,o)=>a(i.ManipulationType.XY_AXIS,t,n,e,s,o)),n,e,s),this.zManipulation.createDragPipeline(((t,n,e,s,o)=>a(i.ManipulationType.Z,t,n,e,s,o)),e)])}set snapToScene(i){this.xyManipulation.snapToScene=i}set angle(i){this.xyAxisManipulation.angle=i}set interactive(i){this._interactive!==i&&(this._interactive=i,this._updateManipulatorInteractivity())}set radius(i){this.xyAxisManipulation.radius=i,this.xyManipulation.radius=i,this.zManipulation.radius=i}set displayScale(i){this.xyManipulation.displayScale=i,this.xyAxisManipulation.displayScale=i}forEachManipulator(i){this.xyManipulation.forEachManipulator((a=>i(a,s.ManipulatorType.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((a=>i(a,s.ManipulatorType.TRANSLATE_XY))),this.zManipulation.forEachManipulator((a=>i(a,s.ManipulatorType.TRANSLATE_Z)))}get _xyAxisVisible(){const i=this.xyManipulation.someManipulator((i=>i.focused))||this.xyAxisManipulation.someManipulator((i=>i.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||i}_autoHideXYAxis(){const i=this.xyAxisManipulation,a=this.xyManipulation;if(n("esri-mobile"))return;const t=[];a.forEachManipulator((i=>t.push(i))),i.forEachManipulator((i=>t.push(i)));const s=()=>{const a=[];this._xyAxisVisible||i.forEachManipulator((i=>a.push(i.disableDisplay()))),this._handles.remove(M),this._handles.add(a,M)};for(const n of t)this._handles.add(n.events.on("focus-changed",s));this._view.inputManager&&this._handles.add(e.when((()=>this._view.inputManager?.latestPointerType),s)),s()}_updateManipulatorInteractivity(){const i=this.grabbing;this.forEachManipulator((a=>{a.interactive=!i&&this._interactive||a.grabbing}))}static radiusForSymbol(i){const a=null!=i&&"point-3d"===i.type&&i.symbolLayers;return!!a&&a.some((i=>"icon"===i.type))?o.discRadiusSmall:o.discRadius}}const M="disable-xy-axis-display";var c;i.ManipulationType=void 0,(c=i.ManipulationType||(i.ManipulationType={}))[c.XY=0]="XY",c[c.XY_AXIS=1]="XY_AXIS",c[c.Z=2]="Z",i.MoveManipulation=h,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})}));
