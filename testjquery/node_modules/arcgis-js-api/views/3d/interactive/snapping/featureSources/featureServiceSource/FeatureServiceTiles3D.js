/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../../chunks/tslib.es6","../../../../../../core/Accessor","../../../../../../core/reactiveUtils","../../../../../../core/accessorSupport/decorators/property","../../../../../../core/accessorSupport/ensureType","../../../../../../core/arrayUtils","../../../../../../core/has","../../../../../../core/accessorSupport/decorators/subclass","../../../../../../layers/support/TileKey","../../../../layers/support/FeatureTileDescriptor3D","../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils"],(function(e,t,r,i,s,o,l,n,c,a,u,p){"use strict";function f({lij:[e,t,r],extent:i}){return new a.TileKey(`${e}/${t}/${r}`,e,t,r,i)}e.FeatureServiceTiles3D=class extends r{get tiles(){const e=this.tilesCoveringView,t=this._effectivePointOfInterest;if(null!=t){const r=e.map((e=>p.distanceToTile(t,e)));for(let i=1;i<r.length;i++)if(r[i-1]>r[i])return e.sort(((e,r)=>p.distanceToTile(t,e)-p.distanceToTile(t,r))),e.slice()}return e}get tilesCoveringView(){return this._filterTiles(this.view.featureTiles?.tiles?.toArray()).map(f)}get tileInfo(){return this.view.featureTiles?.tilingScheme.toTileInfo()??null}get tileSize(){return this.view.featureTiles?.tileSize??256}get _effectivePointOfInterest(){const e=this.pointOfInterest;return null!=e?e:this.view.pointsOfInterest?.focus.location}constructor(e){super(e),this.pointOfInterest=null}initialize(){this.addHandles(i.watch((()=>this.view.featureTiles),(e=>{this.removeHandles(d),e&&this.addHandles(e.addClient(),d)}),i.initial))}_filterTiles(e){if(null==e)return[];return e.filter((e=>Math.abs(e.measures.screenRect[3]-e.measures.screenRect[1])>v&&e.measures.visibility===u.Visibility.VISIBLE_ON_SURFACE))}},t.__decorate([s.property({readOnly:!0})],e.FeatureServiceTiles3D.prototype,"tiles",null),t.__decorate([s.property({readOnly:!0})],e.FeatureServiceTiles3D.prototype,"tilesCoveringView",null),t.__decorate([s.property({readOnly:!0})],e.FeatureServiceTiles3D.prototype,"tileInfo",null),t.__decorate([s.property({readOnly:!0})],e.FeatureServiceTiles3D.prototype,"tileSize",null),t.__decorate([s.property({constructOnly:!0})],e.FeatureServiceTiles3D.prototype,"view",void 0),t.__decorate([s.property()],e.FeatureServiceTiles3D.prototype,"pointOfInterest",void 0),t.__decorate([s.property()],e.FeatureServiceTiles3D.prototype,"_effectivePointOfInterest",null),e.FeatureServiceTiles3D=t.__decorate([c.subclass("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],e.FeatureServiceTiles3D);const v=50,d="feature-tiles";Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
