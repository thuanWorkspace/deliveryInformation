/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../Color","../../../core/colorUtils","../../../core/has","../../../core/handleUtils","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/projection/projectVectorToVector","../../../support/elevationInfoUtils","./visualElements/ExtendedLineVisualElement","./visualElements/ParallelLineVisualElement","./visualElements/PointVisualElement","./visualElements/RightAngleQuadVisualElement","../layers/interfaces","../webgl-engine/lib/Material","../../interactive/sketch/normalizedPoint","../../interactive/snapping/Settings","../../interactive/snapping/SnappingDomain","../../interactive/snapping/snappingUtils","../../interactive/snapping/SnappingVisualizer","../../interactive/snapping/hints/LineSnappingHint","../../interactive/support/viewUtils"],(function(e,n,i,t,l,r,a,o,d,s,c,u,p,g,f,v,h,E,m,S,R,O){"use strict";class H extends S.SnappingVisualizer{sortUniqueHints(e){return e.sort(((e,n)=>(n instanceof R.LineSnappingHint?n.length:0)-(e instanceof R.LineSnappingHint?e.length:0)))}visualizeIntersectionPoint(e,n){const{spatialReference:i,view:t}=n,r=C(n);return l.destroyHandle(new u.PointVisualElement({view:t,primitive:"circle",geometry:v.toDehydratedPoint(e.intersectionPoint,i),elevationInfo:e.isDraped?d.onTheGroundElevationInfo:d.absoluteHeightElevationInfo,size:20,outlineSize:2,color:r.intersectionPointColor,outlineColor:r.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,n){const{view:i,spatialReference:t}=n,r=C(n),a=D(e.point,e.domain,n);return l.destroyHandle(new u.PointVisualElement({view:i,primitive:"circle",geometry:v.toDehydratedPoint(a,t),elevationInfo:w(e,n),size:20,outlineSize:2,color:r.pointColor,outlineColor:r.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,n){const{view:i,spatialReference:t}=n,r=C(n),a=D(e.lineStart,e.domain,n),o=D(e.lineEnd,e.domain,n);return l.destroyHandle(this._createLineSegmentHint(e.type,a,o,t,w(e,n),i,r,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,n){const{view:i,spatialReference:t}=n,a=C(n),{isDraped:o}=e,d=w(e,n),s=D(e.lineStart,e.domain,n),u=D(e.lineEnd,e.domain,n),p=T(s,t,d,i,o),v=T(u,t,d,i,o),E=r.lerp(v,p,v,.5),m=new c.ParallelLineVisualElement({view:i,attached:!1,offset:h.defaults.parallelLineHintOffset,length:h.defaults.parallelLineHintLength,width:h.defaults.parallelLineHintWidth,color:a.parallelSignColor,location:E,renderOccluded:o?f.RenderOccludedFlag.OccludeAndTransparent:f.RenderOccludedFlag.Opaque,isDraped:o,renderGroup:g.DrapedRenderGroup.SnappingHint,isDecoration:!0});return m.setDirectionFromPoints(p,E),m.attached=!0,l.destroyHandle(m)}visualizeRightAngleQuad(e,n){const{view:i,spatialReference:t}=n,r=C(n),a=w(e,n),{isDraped:o}=e,d=D(e.previousVertex,e.domain,n),s=D(e.centerVertex,e.domain,n),c=D(e.nextVertex,e.domain,n),u=T(d,t,a,i,o),v=T(s,t,a,i,o),E=T(c,t,a,i,o);return l.destroyHandle(new p.RightAngleQuadVisualElement({view:i,attached:!0,color:o?r.rightAngleColorDraped:r.rightAngleColor,renderOccluded:o?f.RenderOccludedFlag.OccludeAndTransparent:f.RenderOccludedFlag.Transparent,outlineRenderOccluded:o?f.RenderOccludedFlag.OccludeAndTransparent:f.RenderOccludedFlag.Opaque,outlineColor:r.rightAngleOutlineColor,outlineSize:h.defaults.rightAngleHintOutlineSize,size:h.defaults.rightAngleHintSize,isDraped:o,geometry:{previous:u,center:v,next:E},renderGroup:g.DrapedRenderGroup.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,n,i,t,l,r,a,o=!1,d=!0,c=!0){const u=T(n,t,l,r,o),p=T(i,t,l,r,o),v=new s.ExtendedLineVisualElement({view:r,extensionType:s.ExtensionType.FADED,start:u,end:p,isDraped:o,color:a.lineColor,renderOccluded:o?f.RenderOccludedFlag.OccludeAndTransparent:f.RenderOccludedFlag.Opaque,renderGroup:g.DrapedRenderGroup.SnappingHint,isDecoration:!0});switch(e){case m.LineSegmentHintType.TARGET:v.width=h.defaults.lineHintWidthTarget,v.fadedExtensions={start:0,end:h.defaults.lineHintFadedExtensions};break;case m.LineSegmentHintType.REFERENCE_EXTENSION:v.width=h.defaults.lineHintWidthReference,v.fadedExtensions={start:0,end:0};break;case m.LineSegmentHintType.REFERENCE:v.width=h.defaults.lineHintWidthReference,v.fadedExtensions={start:d?h.defaults.lineHintFadedExtensions:0,end:c?h.defaults.lineHintFadedExtensions:0}}return v.attached=!0,v}}function C(e){const{effectiveTheme:t}=e.view,l=n.toUnitRGBA(t.accentColor),r=[0,0,0,0];return{intersectionPointColor:r,intersectionPointOutlineColor:l,pointColor:r,pointOutlineColor:l,lineColor:l,lineOutlineColor:void 0,parallelSignColor:l,rightAngleColor:l,rightAngleColorDraped:n.toUnitRGBA(i.multiplyOpacity(t.accentColor,.5)),rightAngleOutlineColor:l}}function D(e,n,i){const t=y(n,i);return null==t?e:v.create(e[0],e[1],t)}function w(e,n){return null!=y(e.domain,n)?n.selfSnappingZ.elevationInfo:e.isDraped?d.onTheGroundElevationInfo:d.absoluteHeightElevationInfo}function y(e,{selfSnappingZ:n}){return e===E.SnappingDomain.SELF&&null!=n?n.value:null}function T(e,n,i,t,l,r=a.create()){if(l){const i=t.basemapTerrain.overlayManager.renderer.spatialReference;o.projectVectorToVector(e,n,r,i)}else O.vectorToRender(e,n,i,t,r);return r}e.SnappingVisualizer3D=H,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
