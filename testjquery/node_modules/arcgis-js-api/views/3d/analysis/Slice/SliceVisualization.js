/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/maybe","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/decorators/subclass","../../../../chunks/mat4","../../../../chunks/vec3","../../../../chunks/vec4f64","../../../../geometry/support/vectorStacks","./settings","./sliceToolConfig","./sliceToolUtils","../../webgl-engine/materials/lineStippleUtils"],(function(e,i,t,l,s,a,o,r,n,u,c,d,p,h,_,m,V,v){"use strict";e.SliceVisualization=class extends t{constructor(e){super(e),this._gridVisualElement=null,this._outlineVisualElement=null,this.showGrid=!1,this.preview=!0}initialize(){const e=this.analysisViewData;if(null==e)throw new Error("expected internal object to be valid");this._gridVisualElement=V.createGridVisualElement(this.view),this._outlineVisualElement=V.createOutlineVisualElement(this.view),this.addHandles([s.watch((()=>{const i=null!=e.plane&&this.analysisViewData.visible,{active:t}=this.analysisViewData,{preview:l,showGrid:s,view:a}=this,{effectiveTheme:o}=a;return{visible:i,active:t,preview:l,showGrid:s,gridColor:_.getGridColor(o),outlineColor:_.getOutlineColor(o)}}),(e=>this._updateMaterials(e)),s.syncAndInitial),s.watch((()=>e.plane),(e=>this._updatePlane(e)),s.syncAndInitial)],"internal")}destroy(){this._gridVisualElement=l.destroyMaybe(this._gridVisualElement),this._outlineVisualElement=l.destroyMaybe(this._outlineVisualElement),this.set("view",null)}_updatePlane(e){if(null==e)return;this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;const i=d.set(h.sv3d.get(),d.length(e.basis1),d.length(e.basis2),1),t=c.fromScaling(h.sm4d.get(),i),l=V.calculateBoundedPlaneTranslateRotate(e,h.sm4d.get()),s=c.multiply(t,l,t);this._outlineVisualElement.transform=s,this._gridVisualElement.transform=s}_updateMaterials({visible:e,active:i,preview:t,showGrid:l,gridColor:s,outlineColor:a}){this._outlineVisualElement.color=a,this._outlineVisualElement.width=t?m.planePreviewOutlineWidth:m.planeOutlineWidth,this._outlineVisualElement.stipplePattern=i?null:v.createStipplePatternSimple(5),this._gridVisualElement.backgroundColor=_.planeColor,this._gridVisualElement.gridColor=l?s:p.ZEROS,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}},i.__decorate([a.property()],e.SliceVisualization.prototype,"view",void 0),i.__decorate([a.property()],e.SliceVisualization.prototype,"analysis",void 0),i.__decorate([a.property()],e.SliceVisualization.prototype,"analysisViewData",void 0),i.__decorate([a.property()],e.SliceVisualization.prototype,"showGrid",void 0),i.__decorate([a.property()],e.SliceVisualization.prototype,"preview",void 0),e.SliceVisualization=i.__decorate([u.subclass("esri.views.3d.analysis.Slice.SliceVisualization")],e.SliceVisualization),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
