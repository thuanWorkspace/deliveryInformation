/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/ray","./common","./ConstraintTypes","./InteractionType","../../support/intersectionUtils"],(function(t,e,n,r,i,o,a,s,c){"use strict";function u(t,e,r=o.defaultConstraintOptions){const a=l(t,e,r);if(0===a)return!1;const s=t.renderCoordsHelper,u=s.getAltitude(e.eye)+a,p=o.interactionDirectionTowardsConstraintMinimization(e,r.interactionDirection,y(t,e,Math.sign(a),C),T),d=n.copy(g,e.viewForward),m=s.intersectInfiniteManifold(i.wrap(e.eye,p),u,I);return e.eye=null!=m?m:s.setAltitude(I,u,e.eye),e.center=c.closestPointOnRay(I,e.eye,d,e.center),!0}function l(t,n,r=o.defaultConstraintOptions){if(!p(t,r)||!t.state.constraints.altitude)return 0;const i=m(t.state.constraints.altitude,f);d(t,r,i);const a=t.renderCoordsHelper.getAltitude(n.eye),s=e.clamp(a,i.min,i.max)-a;return Math.abs(s)<=1e-6?0:s}function p(t,e){const n=t.state.constraints.altitude;return!(!t.state.isGlobal||!n)&&(e.interactionType!==s.InteractionType.TUMBLE||!o.hasConstraintType(e.selection,a.ConstraintTypes.TILT))}function d(t,e,n){const r=e.interactionType;if(r===s.InteractionType.NONE)return;const{min:i,max:a}=n,{interactionStartCamera:c,interactionFactor:u}=e;if(!c)return;const p=r===s.InteractionType.TUMBLE||r===s.InteractionType.ZOOM,d=l(t,c),y=0===d?0:t.renderCoordsHelper.getAltitude(c.eye);n.min=i,n.max=a;const m=.05*y;o.adjustRangeForInteraction(d,y,p,u,m,n)}function y(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),n.scale(i,i,r),i}function m(t,e){return e.min=t.min,e.max=t.max,e}const f={min:0,max:0},T=r.create(),C=r.create(),g=r.create(),I=r.create();t.applyAltitudeConstraint=u,t.getAltitudeConstraintError=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
