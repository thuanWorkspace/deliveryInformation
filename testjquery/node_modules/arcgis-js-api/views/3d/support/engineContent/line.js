/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/vec2","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/projectors","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices","../../../ViewingMode","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/ContentObjectType","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/VertexAttribute"],(function(t,e,r,n,i,o,a,u,l,c,s,b,p,A,f){"use strict";function g(t,e,r=null){const n=[],i=e.mapPositions;y(e,n);const o=n[0][1].data,a=n[0][1].indices.length,u=c.getZeroIndexArray(a);return h(e,n,u),D(e,n,u),T(e,n,u),w(e,n,u),d(e,n,u),E(e,n,u),m(e,n,o),new A.Geometry(t,n,i,p.ContentObjectType.Line,r)}function y(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:n}=t,i=I(r)&&n,o=r.length/3-(i?1:0),a=new Array(2*(o-1)),u=i?r.slice(0,-3):r;let l=0;for(let c=0;c<o-1;c++)a[l++]=c,a[l++]=c+1;e.push([f.VertexAttribute.POSITION,new b.Attribute(u,a,3,i)])}function h(t,e,r){if(null!=t.attributeData.colorFeature)return;const n=t.attributeData.color;e.push([f.VertexAttribute.COLOR,new b.Attribute(n??i.ONES,r,4)])}function T(t,e,r){t.attributeData.normal&&e.push([f.VertexAttribute.NORMAL,new b.Attribute(t.attributeData.normal,r,3)])}function w(t,e,r){null!=t.attributeData.colorFeature&&e.push([f.VertexAttribute.COLORFEATUREATTRIBUTE,new b.Attribute([t.attributeData.colorFeature],r,1,!0)])}function D(t,e,r){null==t.attributeData.sizeFeature&&e.push([f.VertexAttribute.SIZE,new b.Attribute([t.attributeData.size??1],r,1,!0)])}function d(t,e,r){null!=t.attributeData.sizeFeature&&e.push([f.VertexAttribute.SIZEFEATUREATTRIBUTE,new b.Attribute([t.attributeData.sizeFeature],r,1,!0)])}function E(t,e,r){null!=t.attributeData.opacityFeature&&e.push([f.VertexAttribute.OPACITYFEATUREATTRIBUTE,new b.Attribute([t.attributeData.opacityFeature],r,1,!0)])}function m(t,n,i){if(null==t.overlayInfo||t.overlayInfo.renderCoordsHelper.viewingMode!==s.ViewingMode.Global||!t.overlayInfo.spatialReference.isGeographic)return;const c=u.newDoubleArray(i.length),p=o.getReferenceEllipsoid(t.overlayInfo.spatialReference);for(let e=0;e<c.length;e+=3)a.lonLatToWebMercatorComparable(i,e,c,e,p);const A=i.length/3,g=l.newFloatArray(A+1);let y=F,h=O,T=0,w=0;r.set(y,c[w++],c[w++],c[w++]),g[0]=0;for(let o=1;o<A+1;++o)o===A&&(w=0),r.set(h,c[w++],c[w++],c[w++]),T+=e.dist(y,h),g[o]=T,[y,h]=[h,y];n.push([f.VertexAttribute.DISTANCETOSTART,new b.Attribute(g,n[0][1].indices,1,!0)])}function I(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const F=n.create(),O=n.create();function R(t,e){if(null==t||0===t.length)return[];const r=[];return t.forEach((t=>{const n=t.length,i=u.newDoubleArray(3*n);t.forEach(((t,e)=>{i[3*e]=t[0],i[3*e+1]=t[1],i[3*e+2]=t[2]}));const o={attributeData:{position:i,normal:e},removeDuplicateStartEnd:!1};r.push(o)})),r}t.createGeometry=g,t.lineStripsToParameters=R,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
