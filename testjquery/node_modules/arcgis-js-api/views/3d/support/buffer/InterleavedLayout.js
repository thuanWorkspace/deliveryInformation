/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types","../../webgl-engine/lib/Util"],(function(e,t,i,r){"use strict";class f{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const i of e.fields.keys()){const t=e.fields.get(i);this[i]=new t.constructor(this.buffer,t.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const i=this[e];return i&&i.elementCount===t.ElementCount&&i.elementType===t.ElementType?i:null}slice(e,t){return new f(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t=0,i=0,r=e.count){const f=this.stride;if(f%4==0){const s=new Uint32Array(e.buffer,t*f,r*f/4);new Uint32Array(this.buffer,i*f,r*f/4).set(s)}else{const s=new Uint8Array(e.buffer,t*f,r*f);new Uint8Array(this.buffer,i*f,r*f).set(s)}return this}get usedMemory(){return this.byteLength}dispose(){}}class s{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach((e=>this._fields.set(e[0],{...e[1],constructor:h(e[1].constructor)}))))}vec2f(e,i){return this._appendField(e,t.BufferViewVec2f,i),this}vec2f64(e,i){return this._appendField(e,t.BufferViewVec2f64,i),this}vec3f(e,i){return this._appendField(e,t.BufferViewVec3f,i),this}vec3f64(e,i){return this._appendField(e,t.BufferViewVec3f64,i),this}vec4f(e,i){return this._appendField(e,t.BufferViewVec4f,i),this}vec4f64(e,i){return this._appendField(e,t.BufferViewVec4f64,i),this}mat3f(e,i){return this._appendField(e,t.BufferViewMat3f,i),this}mat3f64(e,i){return this._appendField(e,t.BufferViewMat3f64,i),this}mat4f(e,i){return this._appendField(e,t.BufferViewMat4f,i),this}mat4f64(e,i){return this._appendField(e,t.BufferViewMat4f64,i),this}vec4u8(e,i){return this._appendField(e,t.BufferViewVec4u8,i),this}f32(e,i){return this._appendField(e,t.BufferViewFloat,i),this}f64(e,i){return this._appendField(e,t.BufferViewFloat64,i),this}u8(e,i){return this._appendField(e,t.BufferViewUint8,i),this}u16(e,i){return this._appendField(e,t.BufferViewUint16,i),this}i8(e,i){return this._appendField(e,t.BufferViewInt8,i),this}vec2i8(e,i){return this._appendField(e,t.BufferViewVec2i8,i),this}vec2i16(e,i){return this._appendField(e,t.BufferViewVec2i16,i),this}vec2u8(e,i){return this._appendField(e,t.BufferViewVec2u8,i),this}vec4u16(e,i){return this._appendField(e,t.BufferViewVec4u16,i),this}u32(e,i){return this._appendField(e,t.BufferViewUint32,i),this}_appendField(e,t,f){if(this._fields.has(e))return void r.assert(!1,`${e} already added to vertex buffer layout`);const s=t.ElementCount*i.elementTypeSize(t.ElementType),u=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:t,offset:u,optional:f})}createBuffer(e){return new f(this,e)}createView(e){return new f(this,e)}clone(){const e=new s;return e._stride=this._stride,e._fields=new Map,this._fields.forEach(((t,i)=>e._fields.set(i,t))),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach((t=>e=Math.max(e,i.elementTypeSize(t.constructor.ElementType)))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}function u(){return new s}class n{constructor(e){this.fields=new Array,e.fields.forEach(((e,t)=>{const i={...e,constructor:d(e.constructor)};this.fields.push([t,i])})),this.stride=e.stride}}const c=[t.BufferViewFloat,t.BufferViewVec2f,t.BufferViewVec3f,t.BufferViewVec4f,t.BufferViewMat3f,t.BufferViewMat4f,t.BufferViewFloat64,t.BufferViewVec2f64,t.BufferViewVec3f64,t.BufferViewVec4f64,t.BufferViewMat3f64,t.BufferViewMat4f64,t.BufferViewUint8,t.BufferViewVec2u8,t.BufferViewVec3u8,t.BufferViewVec4u8,t.BufferViewUint16,t.BufferViewVec2u16,t.BufferViewVec3u16,t.BufferViewVec4u16,t.BufferViewUint32,t.BufferViewVec2u32,t.BufferViewVec3u32,t.BufferViewVec4u32,t.BufferViewInt8,t.BufferViewVec2i8,t.BufferViewVec3i8,t.BufferViewVec4i8,t.BufferViewInt16,t.BufferViewVec2i16,t.BufferViewVec3i16,t.BufferViewVec4i16,t.BufferViewInt32,t.BufferViewVec2i32,t.BufferViewVec3i32,t.BufferViewVec4i32];function d(e){return`${e.ElementType}_${e.ElementCount}`}function h(e){return V.get(e)}const V=new Map;c.forEach((e=>V.set(d(e),e))),e.InterleavedBuffer=f,e.InterleavedLayout=s,e.PackedLayout=n,e.newLayout=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
