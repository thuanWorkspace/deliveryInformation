/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/promiseUtils","../../../core/urlUtils","./TextureCollection","../webgl-engine/lib/Texture","../../webgl/enums"],(function(e,t,r,i,s,n){"use strict";class l extends i.TextureCollection{constructor(e,t,r){super(t,r),this._streamDataRequester=e}async fromUrl(e,r,s){t.throwIfAborted(s);const n=null!=s?s.signal:null,l=this.makeUid(e,r);let o=this._textureRequests.get(l);if(!o){const t=new AbortController,s=this._streamDataRequester.request(e,"image",{uid:l,signal:t.signal});o=new i.TextureRequest,o.abortController=t;const n=o;this._textureRequests.set(l,o),o.textureAsync=s.then((async t=>{const i=this._createTexture(e,t,r);return n.texture=i,n.abortController=null,await i.load(this._stage.renderView.renderingContext),this._stage.add(i),{uid:l,texture:i,release:()=>this._release(l)}}),(e=>{throw n.abortController=null,e}))}o.referenceCount++;try{return await t.whenOrAbort(o.textureAsync,n)}catch(u){throw this._release(l),u}}_createTexture(e,t,i){const l={width:t.width,height:t.height,wrap:{s:n.TextureWrapMode.CLAMP_TO_EDGE,t:n.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(r.isSVG(e)){if(i||0===t.width&&0===t.height){const e=t.width?t.height/t.width:1;i=i||64,e>1?(t.width=Math.round(i/e),t.height=i):(t.width=i,t.height=Math.round(i*e))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(l.preMultiplyAlpha=!1)}return new s.Texture(t,l)}}e.StreamTextureCollection=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
