/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../core/unitUtils","../../../chunks/mat4","../../../chunks/vec3","../../../core/libs/gl-matrix-2/types/vec3","../../../geometry/projection/projectPointToVector","../../../geometry/projection/projectVectorToDehydratedPoint","../../../geometry/projection/projectVectorToPoint","../../../geometry/projection/projectVectorToVector","../../../geometry/support/Axis","../../../geometry/support/coordinateSystem","../../../geometry/support/plane","../../../geometry/support/vector","../../../geometry/support/vectorStacks","../../../layers/graphics/dehydratedFeatureUtils","../../ViewingMode"],(function(t,e,o,i,r,s,n,a,c,d,l,p,h,u,m,y,g){"use strict";class S{constructor(t,e,o,i){this.viewingMode=t,this.spatialReference=e,this.unitInMeters=o,this._coordinateSystem=i,this._tmpCoordinateSystem=p.create(i)}set extent(t){t&&p.setExtent(this._coordinateSystem,t,this._coordinateSystem)}getAltitude(t){return p.altitudeAt(this._coordinateSystem,t)}setAltitude(t,e,o=t){return p.setAltitudeAt(this._coordinateSystem,o,e,t)}setAltitudeOfTransformation(t,e){p.setAltitudeOfTransformation(this._coordinateSystem,e,t,e)}worldUpAtPosition(t,e){return p.normalAt(this._coordinateSystem,t,e)}worldBasisAtPosition(t,e,o){return p.axisAt(this._coordinateSystem,t,e,o)}basisMatrixAtPosition(t,e){const o=this.worldBasisAtPosition(t,l.Axis.X,m.sv3d.get()),r=this.worldBasisAtPosition(t,l.Axis.Y,m.sv3d.get()),s=this.worldBasisAtPosition(t,l.Axis.Z,m.sv3d.get());return i.set(e,o[0],o[1],o[2],0,r[0],r[1],r[2],0,s[0],s[1],s[2],0,0,0,0,1),e}headingAtPosition(t,o){const i=this.worldUpAtPosition(t,m.sv3d.get()),r=this.worldBasisAtPosition(t,l.Axis.Y,m.sv3d.get()),s=u.angleAroundAxis(o,r,i);return e.rad2deg(s)}intersectManifoldClosestSilhouette(t,e,o){return p.elevate(this._coordinateSystem,e,this._tmpCoordinateSystem),p.intersectRayClosestSilhouette(this._tmpCoordinateSystem,t,o),o}intersectManifold(t,e,o){p.elevate(this._coordinateSystem,e,this._tmpCoordinateSystem);const i=m.sv3d.get();return p.intersectRay(this._tmpCoordinateSystem,t,i)?r.copy(o,i):null}intersectInfiniteManifold(t,e,o){if(this.viewingMode===g.ViewingMode.Global)return this.intersectManifold(t,e,o);p.elevate(this._coordinateSystem,e,this._tmpCoordinateSystem);const i=this._tmpCoordinateSystem.value,s=m.sv3d.get();return h.intersectRay(i.plane,t,s)?r.copy(o,s):null}toRenderCoords(t,e,o){return y.isDehydratedPoint(t)?n.projectPointToVector(t,e,this.spatialReference):d.projectVectorToVector(t,e,o,this.spatialReference)}fromRenderCoords(t,e,o=null){return y.isDehydratedPoint(e)?(null!=o&&(e.spatialReference=o),a.projectVectorToDehydratedPoint(t,this.spatialReference,e)):s.isVec3(e)?d.projectVectorToVector(t,this.spatialReference,e,o)?e:null:c.projectVectorToPoint(t,this.spatialReference,e)}static create(t,e){switch(t){case g.ViewingMode.Local:return new S(g.ViewingMode.Local,e,o.getMetersPerUnitForSR(e),p.createLocal());case g.ViewingMode.Global:return new S(g.ViewingMode.Global,e,1,p.createGlobal(e))}}static renderUnitScaleFactor(t,e){return o.getMetersPerCartesianUnitForSR(t)/o.getMetersPerCartesianUnitForSR(e)}}t.RenderCoordsHelper=S,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
