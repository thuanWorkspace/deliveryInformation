/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/mat3","../../../chunks/mat3f64","../../../chunks/quat","../../../chunks/quatf64","../../../chunks/vec3","../../../chunks/vec3f64","../../../chunks/vec4","../../../chunks/vec4f64","../../../geometry/support/aaBoundingBox","../../../geometry/support/plane","../../ViewingMode","./dito"],(function(e,t,n,a,r,c,i,o,s,u,f,l,h){"use strict";const S=r.create(),z=i.create(),m=i.create(),d=s.create(),b=n.create();function M(e=[0,0,0],t=[-1,-1,-1],n=r.create()){return{center:i.clone(e),halfSize:i.clone(t),quaternion:r.clone(n)}}function g(e){return M(e.center,e.halfSize,e.quaternion)}function p(e,t){c.copy(t.center,e.center),c.copy(t.halfSize,e.halfSize),a.copy(t.quaternion,e.quaternion)}function q(e,t){return t=t||M(),h.computeOBB(e,t),t}function y(e,t){const n=f.signedDistance(t,e.center),a=P(e,f.normal(t));return n>a?1:n<-a?-1:0}function A(e,t){return z[0]=e.center[0]-t[0],z[1]=e.center[1]-t[1],z[2]=e.center[2]-t[2],a.conjugate(S,e.quaternion),c.transformQuat(z,z,S),c.abs(z,z),c.min(m,z,e.halfSize),c.sqrDist(m,z)<t[3]*t[3]}function Q(e,n){n||(n=u.create());const a=t.fromQuat(b,e.quaternion),r=e.halfSize[0]*Math.abs(a[0])+e.halfSize[1]*Math.abs(a[3])+e.halfSize[2]*Math.abs(a[6]),c=e.halfSize[0]*Math.abs(a[1])+e.halfSize[1]*Math.abs(a[4])+e.halfSize[2]*Math.abs(a[7]),i=e.halfSize[0]*Math.abs(a[2])+e.halfSize[1]*Math.abs(a[5])+e.halfSize[2]*Math.abs(a[8]);return n[0]=e.center[0]-r,n[1]=e.center[1]-c,n[2]=e.center[2]-i,n[3]=e.center[0]+r,n[4]=e.center[1]+c,n[5]=e.center[2]+i,n}function j(e,t){return f.signedDistance(t,e.center)-P(e,f.normal(t))}function k(e,t){return f.signedDistance(t,e.center)+P(e,f.normal(t))}function x(e,t){return y(e,t[0])<=0&&y(e,t[1])<=0&&y(e,t[2])<=0&&y(e,t[3])<=0&&y(e,t[4])<=0&&y(e,t[5])<=0}function B(e,t,n,r=0){a.conjugate(S,e.quaternion),c.subtract(z,t,e.center);const i=c.transformQuat(z,z,S),o=c.transformQuat(m,n,S);let s=-1/0,u=1/0;for(let a=0;a<3;a++)if(Math.abs(o[a])>1e-6){const t=(r+e.halfSize[a]-i[a])/o[a],n=(-r-e.halfSize[a]-i[a])/o[a];s=Math.max(s,Math.min(t,n)),u=Math.min(u,Math.max(t,n))}else if(i[a]>e.halfSize[a]+r||i[a]<-e.halfSize[a]-r)return!1;return s<=u}function D(e,n,r,i,s){a.conjugate(S,e.quaternion),c.sub(z,n,e.center),c.transformQuat(z,z,S);const u=z[0]<-e.halfSize[0]?-1:z[0]>e.halfSize[0]?1:0,f=z[1]<-e.halfSize[1]?-1:z[1]>e.halfSize[1]?1:0,l=z[2]<-e.halfSize[2]?-1:z[2]>e.halfSize[2]?1:0,h=Math.abs(u)+Math.abs(f)+Math.abs(l);if(0===h)return 1/0;const m=1===h?4:6,M=6*(u+3*f+9*l+13);t.fromQuat(b,e.quaternion),t.scale(b,b,e.halfSize);for(let t=0;t<m;t++){const n=O[M+t];c.set(z,((1&n)<<1)-1,(2&n)-1,((4&n)>>1)-1),c.transformMat3(z,z,b),c.add(d,e.center,z),d[3]=1,o.transformMat4(d,d,r);const a=1/Math.max(1e-6,d[3]);v[2*t]=d[0]*a,v[2*t+1]=d[1]*a}const g=2*m-2;let p=v[0]*(v[3]-v[g+1])+v[g]*(v[1]-v[g-1]);for(let t=2;t<g;t+=2)p+=v[t]*(v[t+3]-v[t-1]);return Math.abs(p)*i*s*.125}const v=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],O=(()=>{const e=new Int8Array(162);let t=0;const n=n=>{for(let a=0;a<n.length;a++)e[t+a]=n[a];t+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),e})();function P(e,t){a.conjugate(S,e.quaternion),c.transformQuat(z,t,S);const n=e.halfSize;return Math.abs(z[0]*n[0])+Math.abs(z[1]*n[1])+Math.abs(z[2]*n[2])}function w(e,t){for(let n=0;n<8;++n){const a=t[n];a[0]=1&n?-e.halfSize[0]:e.halfSize[0],a[1]=2&n?-e.halfSize[1]:e.halfSize[1],a[2]=4&n?-e.halfSize[2]:e.halfSize[2],c.transformQuat(a,a,e.quaternion),c.add(a,a,e.center)}}function V(e){return c.len(e.halfSize)}function G(e,t,n,r,i){if(a.copy(i.quaternion,e.quaternion),r===l.ViewingMode.Global){a.conjugate(T,e.quaternion),c.transformQuat(I,e.center,T),c.abs(L,I),c.min(R,L,e.halfSize),c.sub(R,L,R);const r=c.length(R);c.add(R,L,e.halfSize);const o=c.length(R);if(r<n)c.copy(i.center,e.center),c.set(I,n,n,n),c.add(i.halfSize,e.halfSize,I);else{const a=o>0?1+t/o:1,s=r>0?1+n/r:1,u=(s+a)/2,f=(s-a)/2;c.scale(i.halfSize,L,f),c.scaleAndAdd(i.halfSize,i.halfSize,e.halfSize,u),c.scale(i.center,L,u),c.scaleAndAdd(i.center,i.center,e.halfSize,f),c.sign(I,I),c.multiply(i.center,i.center,I),c.transformQuat(i.center,i.center,i.quaternion)}}else{const r=c.set(I,0,0,1);c.scaleAndAdd(i.center,e.center,r,(n+t)/2),a.conjugate(T,e.quaternion),c.transformQuat(r,r,T),c.abs(r,r),c.scaleAndAdd(i.halfSize,e.halfSize,r,(n-t)/2)}return i}const I=i.create(),L=i.create(),R=i.create(),T=r.create();e.clone=g,e.compute=q,e.computeOffsetObb=G,e.corners=w,e.create=M,e.intersectLine=B,e.intersectPlane=y,e.intersectSphere=A,e.isVisible=x,e.maximumDistancePlane=k,e.minimumDistancePlane=j,e.projectedArea=D,e.projectedRadius=P,e.radius=V,e.set=p,e.toAaBoundingBox=Q,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
