/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../geometry/projection/projectBuffer","../../../../geometry/support/DoubleArray","../../../../geometry/support/triangulationUtils","../../layers/graphics/elevationAlignmentUtils","../../terrain/OverlayRenderer"],(function(o,e,n,t,s,i){"use strict";function r(o,e,i,r){const l=t.pathsToTriangulationInfo(o.rings,!!o.hasZ,t.CounterClockwiseMode.CCW_IS_HOLE,o.spatialReference),a=n.newDoubleArray(l.position.length),c=s.applyPerVertexElevationAlignment(l.position,o.spatialReference,0,a,0,l.position,0,l.position.length/3,e,i,r),h=null!=c;return new g(l.position,a,p(l.polygons,l.position,a),u(l.outlines,l.position,a),h,c)}function l(o,n){const s=t.pathsToTriangulationInfo(o.rings,!1,t.CounterClockwiseMode.CCW_IS_HOLE),r=e.projectBuffer(s.position,o.spatialReference,0,s.position,n,0,s.position.length/3);for(let e=2;e<s.position.length;e+=3)s.position[e]=i.drapedZ;return{position:s.position,polygons:p(s.polygons,s.position),outlines:u(s.outlines,s.position),projectionSuccess:r}}function u(o,e,t=null){return o.filter((({count:o})=>o>1)).map((({index:o,count:s})=>{const i=3*o,r=3*s;return null!=t?new c(o,s,n.doubleSubArray(e,i,r),n.doubleSubArray(t,i,r)):new a(o,s,n.doubleSubArray(e,i,r))}))}function p(o,e,t=null){const s=new Array;for(const{index:i,count:r,holeIndices:l,pathLengths:u}of o){if(r<=1)continue;const o=3*i,p=3*r,a=l.map((o=>o-i)),c=null!=t?new h(i,r,n.doubleSubArray(e,3*i,3*r),n.doubleSubArray(t,o,p),a,u):new d(i,r,n.doubleSubArray(e,3*i,3*r),a,u);s.push(c)}return s}class a{constructor(o,e,n){this.index=o,this.count=e,this.position=n}}class c extends a{constructor(o,e,n,t){super(o,e,n),this.mapPositions=t}}class h extends c{constructor(o,e,n,t,s,i){super(o,e,n,t),this.holeIndices=s,this.pathLengths=i}}class d extends a{constructor(o,e,n,t,s){super(o,e,n),this.holeIndices=t,this.pathLengths=s}}class g{constructor(o,e,n,t,s,i){this.position=o,this.mapPositions=e,this.polygons=n,this.outlines=t,this.projectionSuccess=s,this.sampledElevation=i}}o.PolygonRenderInfo=g,o.PolygonVertexData=h,o.PolygonVertexDataDraped=d,o.geometryToRenderInfo=r,o.geometryToRenderInfoDraped=l,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})}));
