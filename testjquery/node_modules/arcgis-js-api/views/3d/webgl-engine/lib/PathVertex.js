/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/mathUtils","../../../../chunks/mat2","../../../../chunks/mat2f64","../../../../chunks/vec2","../../../../chunks/vec2f64","../../../../chunks/vec3","../../../../chunks/vec3f64","./PathExtruder","./PathGeometry"],(function(t,e,r,a,i,s,h,n,o,c){"use strict";class g{constructor(){this.vLeft=n.create(),this.vRight=n.create(),this.vMinSiblingLength=0,this.frame=new o.Frame2D}setFrameFromUpVector(t){h.copy(this.frame.up,t),h.add(P,this.vLeft,this.vRight),h.normalize(P,P),h.scale(L,this.frame.up,h.dot(P,this.frame.up)),h.subtract(S,P,L),h.normalize(S,S),h.cross(this.frame.right,S,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class l extends g{get rotationFrameUp(){return this.frame.up}get rotationRight(){return s.UNIT_X}get rotationAngle(){h.scale(R,this.frame.up,h.dot(this.frame.up,this.vLeft)),h.subtract(R,this.vLeft,R),h.negate(R,R),h.normalize(R,R),h.scale(A,this.frame.up,h.dot(this.frame.up,this.vRight)),h.subtract(A,this.vRight,A),h.normalize(A,A),h.cross(b,this.rotationFrameUp,this.vLeft);return Math.sign(h.dot(b,this.vRight))*(Math.PI-e.acosClamped(h.dot(R,A)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(t,r){const a=this.rotationAngle;if(Math.abs(a)<=0)return r;const s=e.reciprocalClamped(Math.cos(.5*a));return i.set(t,(s-1+1)*r[0],r[1])}}class m extends g{get rotationFrameUp(){const t=Math.sign(h.dot(this.frame.right,this.vRight));return h.cross(p,this.vRight,this.vLeft),h.scale(p,p,t),h.normalize(p,p)}get rotationRight(){const t=this.rotationFrameUp,e=h.dot(t,this.frame.up),r=h.dot(t,this.frame.right);return h.scale(v,this.frame.up,-r),h.scale(M,this.frame.right,e),h.add(v,v,M),h.normalize(v,v),u(d,this.frame,v),d}get rotationAngle(){const t=Math.sign(h.dot(this.frame.right,this.vRight));return h.negate(b,this.vLeft),-t*(Math.PI-e.acosClamped(h.dot(b,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*e.reciprocalClamped(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(t,a){const s=this.rotationAngle;if(0===Math.abs(s))return a;const h=e.reciprocalClamped(Math.cos(.5*s)),n=this.rotationRight,o=r.set(U,1+(h-1)*n[0]*n[0],(h-1)*n[0]*n[1],(h-1)*n[0]*n[1],1+(h-1)*n[1]*n[1]);return i.transformMat2(t,a,o)}}function u(t,e,r){i.set(t,h.dot(r,e.right),h.dot(r,e.up))}function f(t){switch(t){case c.UpVectorAlignment.World:return new l;case c.UpVectorAlignment.Path:return new m}}const p=n.create(),d=s.create(),v=n.create(),M=n.create(),b=n.create(),R=n.create(),A=n.create(),L=n.create(),P=n.create(),S=n.create(),U=a.create();t.PathVertex=g,t.newPathVertex=f,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
