/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../support/buffer/glUtil","../DefaultVertexAttributeLocations","../GLMaterials","../Intersector","../IntersectorInterfaces","../VertexArrayObject","./Intersector","../../../../webgl/BufferObject","../../../../webgl/enums"],(function(e,t,r,s,o,a,i,n,l,u){"use strict";class m{constructor(e,o){const a=e.renderContext.rctx,n=o.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const m=n.material.createBufferWriter(),f=m.vertexBufferLayout,c=m.elementCount(n),d=f.createBuffer(c);m.write(null,null,n,d,0),this.geometry=n,this.material=n.material,this.glMaterials=new s.GLMaterials(n.material,this._materialRepository),this.vertexBufferLayout=f,this.vbo=l.BufferObject.createVertex(a,u.Usage.STATIC_DRAW,d.buffer),this.vao=new i.VertexArrayObject(a,r.Default3D,{geometry:t.glLayout(f)},{geometry:this.vbo}),this.vertexCount=c}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,r,s,i,l,u,m){const f=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,s,((r,s,c,d,y)=>{if(r>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,r))return;const d=new n.LodTarget(l.layerUid,l.graphicUid(i),f,c,u,m);if((null==e.results.min.drapedLayerOrder||y>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&e.results.min.set(a.IntersectorType.LOD,d,r,s,e.transform.transform,y),e.options.store!==a.StoreResults.MIN&&(null==e.results.max.drapedLayerOrder||y>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&e.results.max.set(a.IntersectorType.LOD,d,r,s,e.transform.transform,y),e.options.store===a.StoreResults.ALL){const t=o.newIntersectorResult(e.results.min.ray);t.set(a.IntersectorType.LOD,d,r,s,e.transform.transform,y),e.results.all.push(t)}}}))}}e.LodComponentData=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
