/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/mat3","../../../../chunks/mat3f64","../../../../chunks/mat4","../../../../chunks/mat4f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/sphere","../../../ViewingMode","../../support/orientedBoundingBox"],(function(t,e,s,r,n,o,i,a,f,h){"use strict";class l{constructor(){this._transform=n.create(),this._transformInverse=new c({value:this._transform},r.invert,n.create),this._transformInverseTranspose=new c(this._transformInverse,r.transpose,n.create),this._transformTranspose=new c({value:this._transform},r.transpose,n.create),this._transformInverseRotation=new c({value:this._transform},e.normalFromMat4Legacy,s.create)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){r.copy(this._transform,t)}multiplyTransform(t){r.multiply(this._transform,this._transform,t)}set(t){r.copy(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,e){this.setTransformMatrix(t),this.multiplyTransform(e),this._invalidateLazyTransforms()}}class c{constructor(t,e,s){this._original=t,this._update=e,this._dirty=!0,this._transform=s()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}class m{constructor(t=0){this.offset=t,this.tmpVertex=i.create()}applyToVertex(t,e,s){const r=o.set(y,t,e,s),n=o.add(V,r,this.localOrigin),i=this.offset/o.length(n);return o.scaleAndAdd(this.tmpVertex,r,n,i),this.tmpVertex}applyToAabb(t){const e=x,s=A,r=M;for(let a=0;a<3;++a)e[a]=t[0+a]+this.localOrigin[a],s[a]=t[3+a]+this.localOrigin[a],r[a]=e[a];const n=this.applyToVertex(e[0],e[1],e[2]);for(let a=0;a<3;++a)t[a]=n[a],t[a+3]=n[a];const o=e=>{const s=this.applyToVertex(e[0],e[1],e[2]);for(let r=0;r<3;++r)t[r]=Math.min(t[r],s[r]),t[r+3]=Math.max(t[r+3],s[r])};for(let a=1;a<8;++a){for(let t=0;t<3;++t)r[t]=0==(a&1<<t)?e[t]:s[t];o(r)}let i=0;for(let a=0;a<3;++a){e[a]*s[a]<0&&(i|=1<<a)}if(0!==i&&7!==i)for(let a=0;a<8;++a)if(0==(i&a)){for(let t=0;t<3;++t)r[t]=0!=(i&1<<t)?0:0!=(a&1<<t)?e[t]:s[t];o(r)}for(let a=0;a<3;++a)t[a]-=this.localOrigin[a],t[a+3]-=this.localOrigin[a];return t}}class _{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=i.create(),this._mbs=a.create(),this._obb=h.create(),this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=o.length(t)}applyToVertex(t,e,s){const r=o.set(y,t,e,s),n=o.set(V,t,e,s+this.componentLocalOriginLength),i=this._totalOffset/o.length(n);return o.scaleAndAdd(this._tmpVertex,r,n,i),this._tmpVertex}applyToAabb(t){const e=o.set(y,t[0],t[1],t[2]+this.componentLocalOriginLength),s=o.set(V,t[3],t[4],t[5]+this.componentLocalOriginLength),r=o.sign(x,e),n=o.sign(A,s),i=o.abs(M,e),a=o.abs(I,s),f=o.min(L,i,a);f[0]=r[0]*n[0]<0?0:f[0],f[1]=r[1]*n[1]<0?0:f[1],f[2]=r[2]*n[2]<0?0:f[2];const h=o.length(f);if(h<this._totalOffset)return t[0]-=e[0]<0?this._totalOffset:0,t[1]-=e[1]<0?this._totalOffset:0,t[2]-=e[2]<0?this._totalOffset:0,t[3]+=s[0]>0?this._totalOffset:0,t[4]+=s[1]>0?this._totalOffset:0,t[5]+=s[2]>0?this._totalOffset:0,t;const l=o.max(L,i,a),c=o.length(l),m=this._totalOffset/c,_=this._totalOffset/h;return t[0]+=e[0]*(e[0]>0?m:_),t[1]+=e[1]*(e[1]>0?m:_),t[2]+=e[2]*(e[2]>0?m:_),t[3]+=s[0]*(s[0]<0?m:_),t[4]+=s[1]*(s[1]<0?m:_),t[5]+=s[2]*(s[2]<0?m:_),t}applyToMbs(t){const e=o.length(t),s=this._totalOffset/e;return o.scaleAndAdd(this._mbs,t,t,s),this._mbs[3]=t[3]+t[3]*this._totalOffset/e,this._mbs}applyToObb(t){return h.computeOffsetObb(t,this._totalOffset,this._totalOffset,f.ViewingMode.Global,this._obb),this._obb}}class p{constructor(t=0){this.offset=t,this.sphere=a.create(),this.tmpVertex=i.create()}applyToVertex(t,e,s){const r=this.objectTransform.transform,n=o.set(y,t,e,s),i=o.transformMat4(n,n,r),a=this.offset/o.length(i);o.scaleAndAdd(i,i,i,a);const f=this.objectTransform.inverse;return o.transformMat4(this.tmpVertex,i,f),this.tmpVertex}applyToMinMax(t,e){const s=this.offset/o.length(t);o.scaleAndAdd(t,t,t,s);const r=this.offset/o.length(e);o.scaleAndAdd(e,e,e,r)}applyToAabb(t){const e=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*e,t[1]+=t[1]*e,t[2]+=t[2]*e;const s=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*s,t[4]+=t[4]*s,t[5]+=t[5]*s,t}applyToBoundingSphere(t){const e=o.length(t),s=this.offset/e;return o.scaleAndAdd(this.sphere,t,t,s),this.sphere[3]=t[3]+t[3]*this.offset/e,this.sphere}}const u=new p;function d(t){return null!=t?(u.offset=t,u):null}const g=new _;function O(t){return null!=t?(g.offset=t,g):null}const v=new m;function b(t){return null!=t?(v.offset=t,v):null}const T="terrain",y=i.create(),V=i.create(),x=i.create(),A=i.create(),M=i.create(),I=i.create(),L=i.create();t.I3SVerticalOffsetGlobalViewingMode=_,t.IntersectorTransform=l,t.Object3DVerticalOffsetGlobalViewingMode=p,t.TerrainVerticalOffsetGlobalViewingMode=m,t.getVerticalOffsetI3S=O,t.getVerticalOffsetObject3D=d,t.getVerticalOffsetTerrain=b,t.terrainId=T,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
