/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Evented","../../../../core/Handles","../../../../core/maybe","../../../../core/PooledArray","./ContentObject","./ContentObjectType","./DirtyEvents","./Octree","./UpdatePolicy"],(function(e,t,s,i,r,o,d,c,h,n){"use strict";class a extends o.ContentObject{get objects(){return this._objects}constructor(e,i,o=""){super(),this.stage=e,this.apiLayerUid=o,this.type=d.ContentObjectType.Layer,this.events=new t,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new r,this._objectsAdded=new r,this._handles=new s,this.apiLayerUid=o,this.visible=i?.visible??!0,this.pickable=i?.pickable??!0,this.updatePolicy=i?.updatePolicy??n.UpdatePolicy.ASYNC,this._disableOctree=i?.disableOctree??!1,e.add(this);for(const t of c.DirtyEventNames)this._handles.add(this.events.on(t,(s=>e.handleEvent(t,s))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==n.UpdatePolicy.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new h((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=i.destroyMaybe(this._octree),this._objectsAdded.clear()}}function l(e){return null!=e&&e.type===d.ContentObjectType.Layer}e.WebGLLayer=a,e.isWebGLLayer=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
