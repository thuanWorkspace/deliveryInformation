/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],(function(i,t,e,s,n){"use strict";class r{constructor(i,t,r){this.primitiveIndices=i,this._numIndexPerPrimitive=t,this.position=r,this._children=void 0,n.assert(i.length>=1),n.assert(3===r.size||4===r.size);const{data:a,size:o,indices:c}=r;n.assert(c.length%this._numIndexPerPrimitive==0),n.assert(c.length>=i.length*this._numIndexPerPrimitive);const l=i.length;let d=o*c[this._numIndexPerPrimitive*i[0]];h.clear(),h.push(d);const u=s.fromValues(a[d],a[d+1],a[d+2]),m=s.clone(u);for(let e=0;e<l;++e){const t=this._numIndexPerPrimitive*i[e];for(let i=0;i<this._numIndexPerPrimitive;++i){d=o*c[t+i],h.push(d);let e=a[d];u[0]=Math.min(e,u[0]),m[0]=Math.max(e,m[0]),e=a[d+1],u[1]=Math.min(e,u[1]),m[1]=Math.max(e,m[1]),e=a[d+2],u[2]=Math.min(e,u[2]),m[2]=Math.max(e,m[2])}}this.bbMin=u,this.bbMax=m;const f=e.lerp(s.create(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(m[0]-u[0],m[1]-u[1]),m[2]-u[2]);let P=this.radius*this.radius;for(let e=0;e<h.length;++e){d=h.at(e);const i=a[d]-f[0],t=a[d+1]-f[1],s=a[d+2]-f[2],n=i*i+t*t+s*s;if(n<=P)continue;const r=Math.sqrt(n),o=.5*(r-this.radius);this.radius=this.radius+o,P=this.radius*this.radius;const c=o/r;f[0]+=i*c,f[1]+=t*c,f[2]+=s*c}this.center=f,h.clear()}getChildren(){if(this._children||e.squaredDistance(this.bbMin,this.bbMax)<=1)return this._children;const i=e.lerp(s.create(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,n=new Uint8Array(t),h=new Array(8);for(let e=0;e<8;++e)h[e]=0;const{data:a,size:o,indices:c}=this.position;for(let e=0;e<t;++e){let t=0;const s=this._numIndexPerPrimitive*this.primitiveIndices[e];let r=o*c[s],l=a[r],d=a[r+1],u=a[r+2];for(let i=1;i<this._numIndexPerPrimitive;++i){r=o*c[s+i];const t=a[r],e=a[r+1],n=a[r+2];t<l&&(l=t),e<d&&(d=e),n<u&&(u=n)}l<i[0]&&(t|=1),d<i[1]&&(t|=2),u<i[2]&&(t|=4),n[e]=t,++h[t]}let l=0;for(let e=0;e<8;++e)h[e]>0&&++l;if(l<2)return;const d=new Array(8);for(let e=0;e<8;++e)d[e]=h[e]>0?new Uint32Array(h[e]):void 0;for(let e=0;e<8;++e)h[e]=0;for(let e=0;e<t;++e){const i=n[e];d[i][h[i]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)void 0!==d[e]&&this._children.push(new r(d[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){h.prune()}}const h=new t({deallocator:null});i.BoundingInfo=r,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})}));
