/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],(function(e,t,r,n){"use strict";const o=t.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),a=542327876,u=131072,i=4;function l(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function s(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const c=l("DXT1"),d=l("DXT3"),m=l("DXT5"),h=31,g=0,p=1,D=2,T=3,C=4,S=7,x=20,f=21;function w(e,t,o){const a=M(o,t.hasMipmap??!1);if(null==a)throw new Error("DDS texture data is null");const{textureData:u,internalFormat:i,width:l,height:s}=a;return t.samplingMode=u.levels.length>1?r.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:r.TextureSamplingMode.LINEAR,t.hasMipmap=u.levels.length>1,t.internalFormat=i,t.width=l,t.height=s,new n.Texture(e,t,u)}function M(e,t){const n=new Int32Array(e,0,h);if(n[g]!==a)return o.error("Invalid magic number in DDS header"),null;if(!(n[x]&i))return o.error("Unsupported format, must contain a FourCC code"),null;const l=n[f];let w,M;switch(l){case c:w=8,M=r.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case d:w=16,M=r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case m:w=16,M=r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return o.error("Unsupported FourCC code:",s(l)),null}let _=1,E=n[C],A=n[T];0==(3&E)&&0==(3&A)||(o.warn("Rounding up compressed texture size to nearest multiple of 4."),E=E+3&-4,A=A+3&-4);const b=E,R=A;let X,F;n[D]&u&&!1!==t&&(_=Math.max(1,n[S]));let v=n[p]+4;const I=[];for(let r=0;r<_;++r)F=(E+3>>2)*(A+3>>2)*w,X=new Uint8Array(e,v,F),I.push(X),v+=F,E=Math.max(1,E>>1),A=Math.max(1,A>>1);return{textureData:{type:"compressed",levels:I},internalFormat:M,width:b,height:R}}e.createDDSTexture=w,e.createDDSTextureData=M,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
