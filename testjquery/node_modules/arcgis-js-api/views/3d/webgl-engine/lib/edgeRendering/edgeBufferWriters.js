/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/RandomLCG","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../../../support/buffer/glUtil","./bufferLayouts"],(function(t,e,n,o,i,r){"use strict";class s{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?m:l}write(t,e,n){const o=this._edgeHashFunction(n);L.seed=o;const i=L.getIntRange(0,255),r=L.getIntRange(0,this.settings.variants-1),s=.7,a=L.getFloat(),c=255*(.5*d(-(1-Math.min(a/s,1))+Math.max(0,a-s)/(1-s),1.2)+.5);t.position0.setVec(e,n.position0),t.position1.setVec(e,n.position1),t.componentIndex.set(e,n.componentIndex),t.variantOffset.set(e,i),t.variantStroke.set(e,r),t.variantExtension.set(e,c)}trim(t,e){return t.slice(0,e)}}const a=new Float32Array(6),c=new Uint32Array(a.buffer),u=new Uint32Array(1);function l(t){const e=a;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],u[0]=5381;for(let n=0;n<c.length;n++)u[0]=31*u[0]+c[n];return u[0]}function m(t){const e=a;e[0]=f(t.position0[0]),e[1]=f(t.position0[1]),e[2]=f(t.position0[2]),e[3]=f(t.position1[0]),e[4]=f(t.position1[1]),e[5]=f(t.position1[2]),u[0]=5381;for(let n=0;n<c.length;n++)u[0]=31*u[0]+c[n];return u[0]}const g=1e4;function f(t){return Math.round(t*g)/g}function d(t,e){const n=t<0?-1:1;return Math.abs(t)**e*n}class p{constructor(){this._commonWriter=new s}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return r.RegularEdgeInstancesLayout.createBuffer(t)}write(t,e,o){this._commonWriter.write(t,e,o),n.add(y,o.faceNormal0,o.faceNormal1),n.normalize(y,y),t.normal.setVec(e,y)}trim(t,e){return this._commonWriter.trim(t,e)}}p.Layout=r.RegularEdgeInstancesLayout,p.glLayout=i.glLayout(r.RegularEdgeInstancesLayout,1);class h{constructor(){this._commonWriter=new s}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return r.SilhouetteEdgeInstancesLayout.createBuffer(t)}write(t,e,n){this._commonWriter.write(t,e,n),t.normalA.setVec(e,n.faceNormal0),t.normalB.setVec(e,n.faceNormal1)}trim(t,e){return this._commonWriter.trim(t,e)}}h.Layout=r.SilhouetteEdgeInstancesLayout,h.glLayout=i.glLayout(r.SilhouetteEdgeInstancesLayout,1);const y=o.create(),L=new e;t.CommonBufferWriter=s,t.RegularEdgeBufferWriter=p,t.SilhouetteEdgeBufferWriter=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
