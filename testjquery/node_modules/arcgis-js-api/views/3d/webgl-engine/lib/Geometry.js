/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec3","../../../../geometry/support/Indices","./AttributeArray","./basicInterfaces","./BoundingInfo","./ContentObject","./ContentObjectType","./geometryDataUtils","./Object3DStateID","./Util","./VertexAttribute","../materials/renderers/utils"],(function(t,e,i,n,s,r,o,a,h,u,c,g,l,d){"use strict";class b extends a.ContentObject{constructor(t,e,i=null,s=h.ContentObjectType.Mesh,r=null,o=-1){super(),this.material=t,this.mapPositions=i,this.type=s,this.objectAndLayerIdColor=r,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,h]of e)this._attributes.set(a,{...h,indices:n.compactIndices(h.indices)}),a===l.VertexAttribute.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(t={}){const e=new b(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach(((t,i)=>{t.exclusive=!1,e._attributes.set(i,t)})),e._boundingInfo=this._boundingInfo,e.transformation=t.transformation||this.transformation,e}get attributes(){return this._attributes}getMutableAttribute(t){let e=this._attributes.get(t);return e&&!e.exclusive&&(e={...e,exclusive:!0,data:s.cloneAttributeData(e.data)},this._attributes.set(t,e)),e}setAttributeData(t,e){const i=this._attributes.get(t);i&&this._attributes.set(t,{...i,exclusive:!0,data:e})}get indexCount(){const t=this._attributes.values().next().value.indices;return t?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===h.ContentObjectType.Mesh?this._computeAttachmentOriginTriangles(t):this.type===h.ContentObjectType.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(null!=this._transformation&&i.transformMat4(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){const e=this.attributes.get(l.VertexAttribute.POSITION);return u.computeAttachmentOriginTriangles(e,t)}_computeAttachmentOriginLines(t){const e=this.attributes.get(l.VertexAttribute.POSITION);return u.computeAttachmentOriginLines(e,m(this.material.parameters,e),t)}_computeAttachmentOriginPoints(t){const e=this.attributes.get(l.VertexAttribute.POSITION);return u.computeAttachmentOriginPoints(e,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.attributes.get(l.VertexAttribute.POSITION);if(!t||0===t.indices.length)return null;const e=this.type===h.ContentObjectType.Mesh?3:1;g.assert(t.indices.length%e==0,"Indexing error: "+t.indices.length+" not divisible by "+e);const i=n.getContinuousIndexArray(t.indices.length/e);return new o.BoundingInfo(i,e,t)}get transformation(){return this._transformation??e.IDENTITY}set transformation(t){this._transformation=t&&t!==e.IDENTITY?e.clone(t):null}addHighlight(){const t=new c.Object3DStateID(r.Object3DState.Highlight);return this.highlights=d.addObject3DStateID(this.highlights,t),t}removeHighlight(t){this.highlights=d.removeObject3DStateID(this.highlights,t)}}function m(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}t.Geometry=b,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
