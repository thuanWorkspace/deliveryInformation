/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/tslib.es6","../../../../../assets","../../../../../core/Accessor","../../../../../core/asyncUtils","../../../../../core/Logger","../../../../../core/maybe","../../../../../core/promiseUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/ensureType","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/accessorSupport/decorators/subclass","../../../../../support/requestImageUtils","../../core/shaderModules/interfaces","../../lib/basicInterfaces","../../../../webgl/enums","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],(function(e,r,s,t,a,o,i,c,u,p,l,n,m,d,g,h,_,y,T){"use strict";e.WaterTextureRepository=class extends t{constructor(){super(...arguments),this._passParameters=new b,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=i.abortMaybe(this._resourcesTask),this._passParameters.waveNormal=i.disposeMaybe(this._passParameters.waveNormal),this._passParameters.wavePerturbation=i.disposeMaybe(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=a.createTask((async r=>{await Promise.allSettled([this._loadImageResource(e,s.getAssetUrl("esri/images/materials/water/normals.jpg"),(e=>this._passParameters.waveNormal=e),r),this._loadImageResource(e,s.getAssetUrl("esri/images/materials/water/perturbation.jpg"),(e=>this._passParameters.wavePerturbation=e),r)])}))),this._resourcesTask.finished?h.ResourceState.LOADED:h.ResourceState.LOADING}async _loadImageResource(e,r,s,t){try{const a=await d.requestImage(r,{signal:t});c.throwIfAborted(t);const o=new T.TextureDescriptor(a.width,a.height);o.pixelFormat=_.PixelFormat.RGB,o.samplingMode=_.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,s(new y.Texture(e,o,a))}catch(a){o.getLogger(this).error("Failed to load water material normal texture.",a)}}},r.__decorate([u.property()],e.WaterTextureRepository.prototype,"_resourcesTask",void 0),r.__decorate([u.property({type:Boolean,readOnly:!0})],e.WaterTextureRepository.prototype,"updating",null),e.WaterTextureRepository=r.__decorate([m.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],e.WaterTextureRepository);class b extends g.NoParameters{}e.WaterTexturePassParameters=b,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
