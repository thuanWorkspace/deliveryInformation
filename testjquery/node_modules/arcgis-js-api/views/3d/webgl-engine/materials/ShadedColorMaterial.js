/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4f64","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/buffer/BufferView","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../lib/basicInterfaces","../lib/GLMaterial","../lib/Material","../lib/RenderSlot","../lib/Util","../lib/VertexAttribute","./internal/bufferWriterUtils","./internal/MaterialUtil","../shaders/ShadedColorMaterialTechnique"],(function(e,t,r,i,a,s,n,o,u,c,l,h,d,p,S,b,f){"use strict";class A extends l.Material{constructor(e){super(e,new g),this.supportsEdges=!0,this._configuration=new f.ShadedColorMaterialTechniqueConfiguration,this._vertexAttributeLocations=f.vertexAttributeLocations}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,s,n,o){if(this.parameters.screenSizeEnabled){const r=e.attributes.get(p.VertexAttribute.OFFSET),u={applyToVertex:(e,a,s,n)=>{const o=t.set(m,r.data[3*n],r.data[3*n+1],r.data[3*n+2]),u=t.set(x,e,a,s);return t.scale(o,o,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(o)),t.add(u,u,o),[u[0],u[1],u[2]]},applyToAabb:e=>{const t=a.center(e,m);return a.scale(e,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(t))}};b.intersectTriangleGeometry(e,i,s,n,u,o)}else b.intersectTriangleGeometry(e,i,s,n,void 0,o)}produces(e,t){if(t===o.ShaderOutput.Highlight)return e===h.RenderSlot.OPAQUE_MATERIAL;if(t===o.ShaderOutput.Color||t===o.ShaderOutput.Alpha||t===o.ShaderOutput.ObjectAndLayerIdColor){let t=h.RenderSlot.OPAQUE_MATERIAL;return this._isTransparent&&(t=this.parameters.writeDepth?h.RenderSlot.TRANSPARENT_MATERIAL:h.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===t||e===h.RenderSlot.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new T(e)}createBufferWriter(){return new E(this.parameters.screenSizeEnabled)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class T extends c{beginSlot(e){return this.ensureTechnique(f.ShadedColorMaterialTechnique,e)}}class g extends l.MaterialParameters{constructor(){super(...arguments),this.color=i.fromValues(1,1,1,1),this.shadingTint=i.fromValues(0,0,0,.25),this.shadingDirection=t.normalize(r.create(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=u.CullFaceOptions.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class E{constructor(e){this.screenSizeEnabled=e;const t=n.newLayout().vec3f(p.VertexAttribute.POSITION).vec3f(p.VertexAttribute.NORMAL);this.screenSizeEnabled&&t.vec3f(p.VertexAttribute.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.attributes.get(p.VertexAttribute.POSITION).indices.length}write(e,t,r,i,a){if(S.writeDefaultAttributes(r,this.vertexBufferLayout,e,t,i,a),this.screenSizeEnabled){if(!r.attributes.has(p.VertexAttribute.OFFSET))throw new Error(`${p.VertexAttribute.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const e=r.attributes.get(p.VertexAttribute.OFFSET);d.assert(3===e.size);const n=i.getField(p.VertexAttribute.OFFSET,s.BufferViewVec3f);if(!n)throw new Error("unable to acquire view for "+p.VertexAttribute.OFFSET);S.writePosition(e,t,n,a)}}}}const m=r.create(),x=r.create();e.ShadedColorMaterial=A,e.ShadedColorMaterialParameters=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
