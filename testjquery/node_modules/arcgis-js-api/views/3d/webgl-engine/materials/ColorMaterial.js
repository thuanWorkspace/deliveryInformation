/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/has","../../../../chunks/vec4f64","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../lib/basicInterfaces","../lib/GLMaterial","../lib/OrderIndependentTransparency","../lib/RenderSlot","../lib/VertexAttribute","./DefaultBufferWriter","./TriangleMaterial","./VisualVariablePassParameters","../shaders/ColorMaterialTechnique","../shaders/ColorMaterialTechniqueConfiguration"],(function(e,t,r,a,i,s,n,o,u,l,h,c,p,d,f){"use strict";class O extends c.TriangleMaterial{constructor(e){super(e,new T),this.supportsEdges=!0,this._configuration=new f.ColorMaterialTechniqueConfiguration}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<o.OITPolygonOffsetLimit,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,t){if(t===i.ShaderOutput.Color||t===i.ShaderOutput.Alpha||t===i.ShaderOutput.Highlight||t===i.ShaderOutput.Depth&&this.parameters.writeLinearDepth||t===i.ShaderOutput.ObjectAndLayerIdColor){if(e===u.RenderSlot.DRAPED_MATERIAL)return!0;if(t===i.ShaderOutput.Highlight)return e===u.RenderSlot.OPAQUE_MATERIAL;return e===(this._isTransparent?this.parameters.writeDepth?u.RenderSlot.TRANSPARENT_MATERIAL:u.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:u.RenderSlot.OPAQUE_MATERIAL)}return!1}createGLMaterial(e){return new g(e)}createBufferWriter(){const e=a.newLayout().vec3f(l.VertexAttribute.POSITION);return t("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(l.VertexAttribute.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(l.VertexAttribute.COLORFEATUREATTRIBUTE):e.vec4u8(l.VertexAttribute.COLOR),new h.DefaultBufferWriter(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class g extends n{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==i.ShaderOutput.Color&&this._output!==i.ShaderOutput.Alpha||this._updateOccludeeState(e),this.ensureTechnique(d.ColorMaterialTechnique,e)}}class T extends p.VisualVariablePassParameters{constructor(){super(...arguments),this.color=r.ZEROS,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=s.CullFaceOptions.None,this.hasOccludees=!1}}e.ColorMaterial=O,e.Parameters=T,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
