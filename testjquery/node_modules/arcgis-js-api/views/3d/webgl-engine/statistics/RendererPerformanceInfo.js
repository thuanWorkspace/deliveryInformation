/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../core/PerformanceSampler","../../../../core/time","../../../webgl/TimerPool"],(function(e,t,r,i,o){"use strict";var a;e.PerformanceCategory=void 0,(a=e.PerformanceCategory||(e.PerformanceCategory={})).OVERLAY="overlay",a.PREPARE="prepare",a.SHADOW_MAP="shadow map",a.LINEAR_DEPTH="linear depth",a.ACCUMULATED_SHADOWS="accumulated shadows",a.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",a.SSAO="SSAO",a.OPAQUE="opaque",a.OPAQUE_EDGES="opaque edges",a.VOXEL="voxel",a.TRANSPARENT="transparent",a.TRANSPARENT_EDGES="transparent edges",a.HUD_VISIBILITY="HUD visibility",a.TRANSPARENT_TERRAIN="transparent terrain",a.ENVIRONMENT="environment",a.LASER_LINES="laser lines",a.OCCLUDED="occluded",a.ANTIALIASING="antialiasing",a.HIGHLIGHTS="highlights",a.HUD="HUD",a.HUD_OCCLUDED="HUD occluded",a.FINISH="finish";const s="Total";class l{constructor(t){this._rctx=t,this._startTimeStampCPU=i.Milliseconds(0),this._lastTimeStampCPU=i.Milliseconds(0),this._totalCPUTime=new r(s),this._cpuTimeSamplers=new Map(Object.values(e.PerformanceCategory).map((e=>[e,new r(e)]))),this._enableGPUTimer=0,this._totalGPUTime=new r("GPU"),this._gpuTimeSamplers=new Map(Object.values(e.PerformanceCategory).map((e=>[e,new r(e)]))),this._totalTime=i.Milliseconds(0),this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return null!=this._gpuTimerPool}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return i.Milliseconds(performance.now()-this._startTimeStampCPU)}enableGPUPerformanceInfo(){if(null==this._gpuTimerPool){const t=[...Object.values(e.PerformanceCategory),s];this._gpuTimerPool=o.createElapsedTimerPool(this._rctx,t)}if(null==this._gpuTimerPool)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let r=!1;return{hasGPUTimerSupport:!0,remove:()=>{r||(r=!0,--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=t.disposeMaybe(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=i.Milliseconds(performance.now()),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const t=i.Milliseconds(performance.now());if(this._cpuTimeSamplers.get(e).record(t-this._lastTimeStampCPU),this._lastTimeStampCPU=t,this._gpuTimerPool){const t=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(t),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const t=this._gpuTimerPool.stop(e.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(e.PerformanceCategory.FINISH).record(t),this._rctx.gl.flush()}const t=i.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=i.Milliseconds(this._totalTime+t),this._totalCPUTime.record(t),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce(((e,t)=>e+(t.last||0)),0)),++this._totalFrameCount}}e.RendererPerformanceInfo=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
