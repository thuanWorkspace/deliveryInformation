/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","exports","../../../ViewingMode","../../../../chunks/Terrain.glsl","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../lib/basicInterfaces","../lib/Program","../lib/StencilUtils","../lib/VertexAttribute","../../../webgl/enums","../../../webgl/renderState"],(function(e,i,t,r,n,l,a,c,s,u,d,o){"use strict";class h extends l.ShaderTechnique{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.spherical=e.viewingMode===t.ViewingMode.Global}initializeProgram(e){return new c.Program(e.rctx,h.shader.get().build(this.configuration),g)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,t=i.backfaceCullingEnabled&&!i.renderOccluded;return o.makePipelineState({blending:i.renderOccluded?o.simpleBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:t?o.backFaceCullingParams:null,depthTest:i.renderOccluded?null:{func:d.CompareFunction.LESS},depthWrite:i.renderOccluded?null:o.defaultDepthWriteParams,colorWrite:o.defaultColorWriteParams,stencilTest:e?s.renderWhenBitIsNotSet(a.StencilBits.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}}h.shader=new n.ReloadableShaderModule(r.Terrain,(()=>new Promise(((i,t)=>e(["../core/shaderLibrary/terrain/Terrain.glsl"],i,t)))));const g=new Map([[u.VertexAttribute.POSITION,0],[u.VertexAttribute.UV0,1],[u.VertexAttribute.NORMALCOMPRESSED,2]]);i.TerrainTechnique=h,i.terrainVertexAttributeLocations=g,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})}));
