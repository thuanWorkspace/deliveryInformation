/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../layers/support/ElevationSamplerData","../support/mathUtils","./TerrainConst"],(function(t,a,e,l,o){"use strict";class i{constructor(t,a,l){this.type="elevation",this.level=t[0],this.i=t[1],this.j=t[2],this.extent=a,this.samplerData=new e.ElevationSamplerData(l,a)}computeMinMaxValue(t,a,e,i){i.min=1/0,i.max=-1/0,i.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return i;const s=2**n;if(!(Math.floor(a/s)===this.i&&Math.floor(e/s)===this.j))return i;let r=1/0,h=-1/0;const u=this.samplerData.data.width,c=this.samplerData.data.values,f=.5*o.elevationNodataValue;let m=(u-1)/s,p=(e-this.j*s)*m,M=(a-this.i*s)*m;if(m<1){const t=Math.floor(p),a=Math.floor(M),e=t+a*u,o=c[e],n=c[e+1],s=c[e+u],r=c[e+u+1];if(o+n+s+r<f){const e=p-t,h=M-a,u=l.bilerp(o,n,s,r,e,h),c=l.bilerp(o,n,s,r,e+m,h),f=l.bilerp(o,n,s,r,e,h+m),d=l.bilerp(o,n,s,r,e+m,h+m);return i.min=Math.min(u,c,f,d),i.max=Math.max(u,c,f,d),i}p=t,M=a,m=1}else p=Math.floor(p),M=Math.floor(M),m=Math.ceil(m);for(let l=p;l<=p+m;l++)for(let t=M;t<=M+m;t++){const a=c[l+t*u];a<f?(r=Math.min(r,a),h=Math.max(h,a)):i.hasNoDataValues=!0}return i.min=r,i.max=h,i}}const n=.5*o.elevationNodataValue;function s(t,e,l){if(null==l)return null;for(const o of l){if(!o)continue;const l=o.safeWidth;let i=a.clamp(o.dy*(o.y1-e),0,l),s=a.clamp(o.dx*(t-o.x0),0,l);const r=Math.floor(i),h=Math.floor(s),u=o.data.width,c=r*u+h,f=o.data.values,m=f[c],p=f[c+1],M=c+u,d=f[M],v=f[M+1];if(m+d+p+v<n){i-=r,s-=h;const t=m+(p-m)*s;return t+(d+(v-d)*s-t)*i}}return null}t.ElevationData=i,t.sampleElevation=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
