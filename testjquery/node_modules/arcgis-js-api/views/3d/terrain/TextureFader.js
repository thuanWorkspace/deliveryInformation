/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","./interfaces"],(function(t,e,i){"use strict";class n{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=e.destroyMaybe(this._current),this._next=e.destroyMaybe(this._next),this._waiting=e.destroyMaybe(this._waiting),this._delayed=e.destroyMaybe(this._delayed)}get current(){if(null==this._current)return null;if(!this._isFadingEnabled){const t=this._delayed||this._waiting||this._next||this._current;t!==this._current&&(this._current=null,this.clear(),this._current=t)}let a=n.test.fadeMoment;if(null!=this._delayed&&(a=a||performance.now(),a>=this._delayedTime&&(this._push(this._delayed,t.ActivationTime.Immediate),this._delayed=null)),null!=this._next){a=a||performance.now();const t=this._fadeDuration,n=null!=this._current&&this._next.texture===this._current.texture,r=this._next.type!==i.TextureUpdate.FADING,s=a-this._fadeStart>=t;(n||r||s)&&(e.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(a))}return this._current}get next(){return this._next}get fadeFactor(){if(null==this._next)return 1;const t=n.test.fadeMoment||performance.now(),e=Math.max(0,t-this._fadeStart),i=this._fadeDuration;return e>i?0:1-e/i}get isFading(){return null!=this._next||null!=this._delayed}push(i,n=t.ActivationTime.Immediate){this._delayed=e.destroyMaybe(this._delayed),this._push(i,n)}_push(i,a){if(this._isFadingEnabled||this.clear(),null==this._current)return void(this._current=i);const r=n.test.fadeMoment||performance.now();return a!==t.ActivationTime.Immediate?(this._delayed=i,void(this._delayedTime=r+a)):null==this._next?(this._next=i,void(this._fadeStart=this._alignFadeStart(r))):void(null!=i&&(e.destroyMaybe(this._waiting),this._waiting=i))}get _fadeDuration(){return null==this._waiting?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const e=this._getFadeDuration();return t+e-t%e}get _isFadingEnabled(){return this._getFadeDuration()>0}}var a;n.test={fadeMoment:0},t.ActivationTime=void 0,(a=t.ActivationTime||(t.ActivationTime={}))[a.Immediate=0]="Immediate",a[a.Delayed=5e3]="Delayed",t.TextureFader=n,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
