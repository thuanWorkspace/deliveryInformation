/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/PooledArray","./RenderOrder"],(function(e,t,r){"use strict";class n{constructor(){this._queue=new t,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),null!=e&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}}class i{constructor(){this._q=new t}get done(){return 0===this._q.length}reset(e){if(this._q.clear(),null!=e){this._q.pushArray(e);for(let e=0;e<this._q.length;++e){const t=this._q.data[e];t.isLeaf||this._q.pushArray(t.children)}}}next(){return this._q.pop()}}function s(e,t){if(Array.isArray(e))for(let r=0;r<e.length;r++)o(e[r],t);else o(e,t)}function o(e,t){if(t(e),!e.isLeaf)for(const r of e.children)o(r,t)}function l(e,t,r){if(null==t?.fullExtent)return!1;const n=t.fullExtent,i=e.extent;if(r){if(i[0]<n.xmin||i[1]<n.ymin||i[2]>n.xmax||i[3]>n.ymax)return!1}else if(n.xmin>i[2]||n.ymin>i[3]||n.xmax<i[0]||n.ymax<i[1])return!1;const s=e.surface.tilingScheme.levels[e.level].scale,o=t.minScale;if(o>0&&s>1.00000001*o)return!1;const l=t.maxScale;return!(l>0&&s<.99999999*l)}function u(e,t){const r=e.lij,n=t.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function c(e,t,n=null){null==n||0===n.length?e===r.RenderOrder.BACK_TO_FRONT?t.sort(a):t.sort(f):t.sort(((t,r)=>p(t,r,e,n)))}function a(e,t){const r=t.screenDepth-e.screenDepth;if(0!==r)return r;const n=e.lij,i=t.lij;return n[0]-i[0]||n[1]-i[1]||n[2]-i[2]}function f(e,t){const r=e.screenDepth-t.screenDepth;if(0!==r)return r;const n=e.lij,i=t.lij;return n[0]-i[0]||n[1]-i[1]||n[2]-i[2]}function h(e,t,r){const n=e.screenDepth,i=t.screenDepth;return n<i?-r:n>i?r:u(e,t)}function p(e,t,r,n){return d(e,n)===d(t,n)?h(e,t,r):e?r:-r}function d(e,t){for(const r of t)if(e.intersectsExtent(r))return!0;return!1}function _(e,t){const r=e.distanceToPOI-t.distanceToPOI;if(0!==r)return r;const n=e.lij,i=t.lij;return n[0]-i[0]||n[1]-i[1]||n[2]-i[2]}function m(e,t){const r=e.length;for(let n=0;n<r;++n){e.at(n).updateDistanceToPOI(t)}e.sort(_)}function q(e,t,r){let n=1,i=0,s=0;for(;e!==t;)if(n*=.5,i*=.5,s*=.5,1&e.lij[2]&&(i+=.5),0==(1&e.lij[1])&&(s+=.5),null==(e=e.parent))throw new Error("tile was not a descendant of upsampleTile");r.init(t,i,s,n)}function x(e){for(let t=0;t<e.length;t++){const r=e[t],n=r.parent;if(n)for(let e=0;e<4;e++){const t=n.children[e];if(t&&t!==r)return!0}}return!1}function y(e,t){if(!e||!t||e[0]===t[0])return!1;const r=e[0]<t[0],n=r?e:t,i=r?t:e,s=1<<i[0]-n[0];return Math.floor(i[1]/s)===n[1]&&Math.floor(i[2]/s)===n[2]}e.IteratorPostorder=i,e.IteratorPreorder=n,e.compareTiles=h,e.compareTilesByLij=u,e.compareTilesWithStencil=p,e.computeUpsampleInfo=q,e.fallsWithinLayer=l,e.hasLoadableSiblings=x,e.sortTiles=c,e.sortTilesByPOI=m,e.tilesAreRelated=y,e.traverseTilesPreorder=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
