/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/Collection","../../../geometry/support/spatialReferenceUtils","../../../layers/support/layerUtils","../../ViewingMode","../support/StreamDataLoader","./ITile","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical"],(function(e,n,r,t,i,o,l,a,u){"use strict";const s={[i.ViewingMode.Global]:u.terrainUtilsSpherical,[i.ViewingMode.Local]:a.terrainUtilsPlanar};function c(e,n){e||console.warn("Terrain: "+n)}function f(n){e.enableWaterproofnessTests=n,e.enableTerrainInternalChecks=e.enableTerrainInternalChecks||n}function T(n){e.enableTerrainInternalChecks=n}function I(n,r){if(e.enableTerrainInternalChecks&&!n){const e=(new Error).stack?.slice(5);throw console.warn("Terrain internal: "+(r??"")+" at "+e),new Error("Assertion failed"+(r?": "+r:""))}}function d(e){return h(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function g(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function h(e){return"imagery-tile-3d"===e?.type}function S(e){return"tile-3d"===e?.type}function x(e){return"vector-tile-3d"===e?.type}function b(e){return"wmts-3d"===e?.type}function N(e){return"elevation-3d"===e?.type}function E(e){return"group"===e?.type}function p(e){return e&&(S(e)||b(e)||h(e)||x(e))}function y(e){return e&&(S(e)||h(e)||x(e)||b(e))}function O(e){return y(e)||N(e)}function H(e){const n=e?.sourceLayerInfo?.data;return null!=n&&"type"in n&&"raster-tile"===n.type}function L(e){return m(e?.sourceLayerInfo)||!!e?.isVTLBackground}function R(e){const n=e?.sourceLayerInfo?.data;return null!=n&&"type"in n&&"tile-texture"===n.type}function W(e){const n=e?.sourceLayerInfo?.data;return n instanceof HTMLImageElement||n instanceof o.ImageWithType||n instanceof HTMLCanvasElement||n instanceof ImageData}function m(e){return null!=e?.data&&"type"in e.data&&"vector-tile"===e.data.type}function w(e){return null!=e&&"release"in e&&e.release(),null}function _(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function A(e,n,r,t){return s[t].checkIfTileInfoSupportedForViewSR(e,r,n)}function C(e,n,r){let t=null,o=null;if("wmts"===e?.type){const i=V(e,n,r);t=i.tileInfo,o=i.fullExtent}else{o=g(e)?e.getCompatibleFullExtent(n):e.fullExtent;const l=r===i.ViewingMode.Local;if(g(e))t=e.getCompatibleTileInfo(n,o,l);else if("vector-tile"===e?.type){const r=l&&!U(n)||k.force512VTL,i=e.tileInfo.spatialReference.isGeographic;t=r?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,i?1:2)}else t=e.tileInfo}return null!=t&&null!=o&&null==A(t,o,n,r)?{tileInfo:t,fullExtent:o}:null}function V(e,r,i){const o=t.getTileMaxtrixSetFromActiveLayer(e);if(null!=o){if(!n.isCollection(o))return{tileInfo:o.tileInfo,fullExtent:o.fullExtent};{const e=o.find((e=>null==A(e.tileInfo,e.fullExtent,r,i)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}function U(e){return e.isWGS84||e.isWebMercator||r.isCGCS2000(e)||!r.isEarth(e)}e.enableTerrainInternalChecks=!1,e.enableWaterproofnessTests=!1;const k={force512VTL:!1};function M(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function v(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function F(e,n,r=X){return Math.abs(e-n)<r}function P(e){return e===l.NeighborIndex.NORTH_EAST?l.NeighborIndex.SOUTH_WEST:e===l.NeighborIndex.NORTH_WEST?l.NeighborIndex.SOUTH_EAST:e===l.NeighborIndex.SOUTH_WEST?l.NeighborIndex.NORTH_EAST:l.NeighborIndex.NORTH_WEST}function G(e){return e===l.NeighborIndex.NORTH?l.NeighborIndex.SOUTH:e===l.NeighborIndex.EAST?l.NeighborIndex.WEST:e===l.NeighborIndex.SOUTH?l.NeighborIndex.NORTH:l.NeighborIndex.EAST}function D(e){return e===l.NeighborIndex.NORTH_WEST||e===l.NeighborIndex.SOUTH_WEST}function j(e){return e===l.NeighborIndex.NORTH_WEST||e===l.NeighborIndex.NORTH_EAST}function B(e){return e===l.NeighborIndex.NORTH_WEST||e===l.NeighborIndex.WEST||e===l.NeighborIndex.SOUTH_WEST}function q(e){return e===l.NeighborIndex.NORTH_EAST||e===l.NeighborIndex.EAST||e===l.NeighborIndex.SOUTH_EAST}function z(e){return e===l.NeighborIndex.SOUTH_EAST||e===l.NeighborIndex.SOUTH||e===l.NeighborIndex.SOUTH_WEST}function J(e){return e===l.NeighborIndex.NORTH_EAST||e===l.NeighborIndex.NORTH||e===l.NeighborIndex.NORTH_WEST}const K=[l.NeighborIndex.NORTH,l.NeighborIndex.EAST,l.NeighborIndex.SOUTH,l.NeighborIndex.WEST],Q=[l.NeighborIndex.NORTH_EAST,l.NeighborIndex.SOUTH_EAST,l.NeighborIndex.SOUTH_WEST,l.NeighborIndex.NORTH_WEST],X=1e-5;e.almostEquals=F,e.checkIfTileInfoSupportedForView=A,e.enableInternalTerrainChecks=T,e.enableTerrainWaterproofnessChecks=f,e.eps=X,e.getLayerWithExtentRange=d,e.getTileInfoAndExtentFromWMTSLayer=V,e.getTiledLayerInfo=C,e.internalAssert=I,e.isBlendableLayerView=p,e.isEast=q,e.isElevationLayerView=N,e.isGroupLayerView=E,e.isImageryTileLayerView=h,e.isImageryTileRenderInfo=H,e.isMapTileLayerView=y,e.isNorth=J,e.isNorthCorner=j,e.isProjectableRasterLayer=g,e.isRasterTileRenderInfo=W,e.isSouth=z,e.isSurfaceLayerView=O,e.isTextureTileRenderInfo=R,e.isTileLayerView=S,e.isVectorTileLayerView=x,e.isVectorTilePerLayerInfo=m,e.isVectorTileRenderInfo=L,e.isWMTSLayerView=b,e.isWest=B,e.isWestCorner=D,e.lij2s=M,e.neighborCornerIndices=Q,e.neighborEdgeIndices=K,e.oppositeCorner=P,e.oppositeEdge=G,e.releaseTileData=w,e.test=k,e.useFetchTileForLayer=_,e.v32s=v,e.vtlAssumes256PixelSizeAsDefault=U,e.weakAssert=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
