/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../geometry","../../../../core/promiseUtils","../../../../geometry/projection/projectPointToVectorWithEngine","../../../../layers/graphics/dehydratedPoint","../../../../support/elevationInfoUtils","./elevationAlignmentUtils","./ElevationContext","./featureExpressionInfoUtils","../../../../geometry/SpatialReference"],(function(e,t,o,n,i,r,a,s,c,l){"use strict";async function f(e,t,i,s,f){const{elevationProvider:g,renderCoordsHelper:I}=e,{elevationInfo:y}=t,{pointsInFeatures:m,spatialReference:E}=s,x=l.fromJSON(E),h=!0,P=c.extractExpressionInfo(y,h),S=await c.createContext(P,x,f);o.throwIfAborted(f);const j=[],w=new Set,b=new Set;d.spatialReference=x;const C=e.elevationProvider.spatialReference??e.spatialReference;for(const{objectId:o,points:c}of m){const e=i(o);if(null==e){for(const e of c)j.push(e.z??0);w.add(o);continue}e.isDraped&&b.add(o);const s=e.graphic.geometry;p.setFromElevationInfo(r.getGeometryEffectiveElevationInfo(s,y)),p.updateFeatureExpressionInfoContext(S,e.graphic,t);for(const{x:t,y:o,z:i}of c)d.x=t,d.y=o,d.z=i??0,await n.projectPointToVectorWithEngine(d,u,C,0,{signal:f}),a.evaluateElevationInfoAtPoint(u,g,p,I,v),j.push(v.z)}return{elevations:j,drapedObjectIds:b,failedObjectIds:w}}const p=new s.ElevationContext,d=i.makeDehydratedPoint(0,0,0,l.WGS84),v=new a.SampleElevationInfo,u=[0,0,0];e.elevationAlignPointsInFeatures=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
