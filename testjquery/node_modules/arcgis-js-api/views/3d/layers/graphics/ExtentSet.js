/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],(function(t,e,n,r){"use strict";const s=.05;class o{constructor(){this._extents=new e({allocator:t=>t||n.create()}),this._tmpExtent=n.create(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(t){this._contains(t)||(this._removeContained(t),n.copy(this._extents.pushNew(),t),this._dirty=!0)}pop(){return this._dirty&&this._mergeTight(),this._extents.pop()}merge(t){return this._mergeTight(t),t.hasProgressed}_mergeTight(t=r.noBudget){const e=this._extents,o=new Set;let i=0;for(;i!==e.length;){e.sort(((t,e)=>t[0]-e[0])),i=e.length,o.clear();for(let r=0;r<e.length;++r){if(t.done)return;const i=e.at(r);if(i){for(let t=r+1;t<e.length;++t){const n=e.at(t);if(null==n||n[0]>=i[2])break;o.add(n)}o.forEach((r=>{if(i===r)return;if(r[2]<=i[0])return void o.delete(r);const a=n.area(i),h=n.area(r),c=this._tmpExtent;n.expand(i,r,c);const d=a+h;(n.area(c)-d)/d<s&&(n.copy(i,c),o.delete(r),e.remove(r),t.madeProgress())})),o.add(i)}}}this._dirty=!1}_contains(t){return this._extents.some((e=>n.contains(e,t)))}_removeContained(t){this._extents.filterInPlace((e=>!n.contains(t,e)))}get test(){const t=this;return{containsPoint:e=>t._extents.some((t=>n.containsPoint(t,e)))}}}t.ExtentSet=o,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
