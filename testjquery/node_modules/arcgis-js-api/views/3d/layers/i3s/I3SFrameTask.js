/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/arrayUtils","../../../../core/handleUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/has","../../../../core/accessorSupport/decorators/subclass","../../../support/Scheduler"],(function(e,r,t,s,n,o,a,i,c,l){"use strict";let u=class extends t{constructor(){super(),this.referenceCount=0,this.callbacks=new Array,this.runIndex=0}get running(){return this.callbacks.some((e=>e.running))}runTask(e){this._sort();const r=this.callbacks,t={numIndexLoading:0,numNodesLoading:0};for(let s=0;s<r.length&&!e.done;++s)r[s].priority=r[s].runTask(e,t),this.runIndex=s}_sort(){const e=this.callbacks;let r=e.length;for(let t=this.runIndex;t>0;t--){const s=e[t-1];let n=t;for(;n<e.length&&s.priority<=e[n].priority&&(n!==r||s.priority<e[n].priority);)e[n-1]=e[n],n++;e[n-1]=s,r=n-1}this.runIndex=0}add(e){this._sort(),e.priority=1/0,this.callbacks.unshift(e),this.notifyChange("running")}remove(e){s.removeUnordered(this.callbacks,e),this.runIndex=this.callbacks.length,this._sort(),this.notifyChange("running")}};r.__decorate([o.property({readOnly:!0})],u.prototype,"running",null),u=r.__decorate([c.subclass("esri.views.3d.layers.i3s.I3SFrameTask")],u);class d{constructor(e,r){this.task=e,this.handle=r}}const h=new Map;function p(e,r){let t=h.get(e);if(null==t){const r=new u,s=e.registerTask(l.TaskPriority.I3S_CONTROLLER,r);t=new d(r,s),h.set(e,t)}return t.task.add(r),n.makeHandle((()=>{if(null==t)return;t.task.remove(r);t.task.callbacks.length>0||(h.delete(e),t.handle.remove(),t.task.destroy()),t=null}))}e.addCallback=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
