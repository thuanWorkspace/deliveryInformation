/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../../../chunks/tslib.es6","../../../core/asyncUtils","../../../core/Error","../../../core/maybe","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","./LayerView3D","../../layers/LayerView"],(function(e,s,i,a,t,r,n,l,o,y,c){"use strict";const w=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),h="analysis-view-handles";let d=class extends(y.LayerView3D(c)){constructor(e){super(e),this.type="line-of-sight-3d",this._analysisModule=null}initialize(){this.addHandles(n.watch((()=>this.layer.analysis),(e=>{this._destroyAnalysisView(),null!=e&&this._createAnalysisView(e)}),n.syncAndInitial),h)}destroy(){this.removeHandles(h),this._destroyAnalysisView()}async whenAnalysisView(){if(null!=this.analysisView)return this.analysisView;if(null!=this._createAnalysisViewTask)return this._createAnalysisViewTask.promise;throw new a("layerview:no-analysisview-for-analysis","The analysis has not been set on the LineOfSightLayer of this layer view")}isUpdating(){return null!=this._createAnalysisViewTask||null!=this.analysisView&&this.analysisView.updating}_createAnalysisView(e){const s=i.createTask((async i=>(this.analysisView=await this._createAnalysisViewPromise(e,i),this._createAnalysisViewTask===s&&(this._createAnalysisViewTask=null),this.analysisView)));this._createAnalysisViewTask=s}_destroyAnalysisView(){this.analysisView=t.destroyMaybe(this.analysisView),this._createAnalysisViewTask=t.abortMaybe(this._createAnalysisViewTask)}async _createAnalysisViewPromise(e,s){let i=this._analysisModule;if(null==i){const e=await this._loadAnalysisModule();this._analysisModule=e,i=e}const t=new i.default({analysis:e,view:this.view,parent:this});if(await t.when(),r.isAborted(s))throw t.destroy(),new a("layerview:no-analysisview-for-analysis","The analysis has not been added to the LineOfSightLayer of this layer view",{analysis:e});return t}_loadAnalysisModule(){return new Promise(((s,i)=>e(["../analysis/LineOfSightAnalysisView3D"],(e=>s(w(e))),i)))}};s.__decorate([l.property()],d.prototype,"type",void 0),s.__decorate([l.property()],d.prototype,"layer",void 0),s.__decorate([l.property()],d.prototype,"analysisView",void 0),s.__decorate([l.property()],d.prototype,"_createAnalysisViewTask",void 0),d=s.__decorate([o.subclass("esri.views.3d.layers.LineOfSightLayerView3D")],d);return d}));
