/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec2","../../../../chunks/vec2f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/projectors","../../../../geometry/support/DoubleArray","../../../../geometry/support/plane","../../../ViewingMode"],(function(e,t,o,r,c,a,s,n,l,i,d){"use strict";function I(e,t,r,c,a=1){if(r.isGeographic&&c===d.ViewingMode.Global){const e=l.newDoubleArray(t.length),o=t.length,c=s.getReferenceEllipsoid(r);for(let r=0;r<o;r+=3)n.lonLatToWebMercatorComparable(t,r,e,r,c);t=e}o.set(g,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<t.length;o+=3)g[0]=Math.min(g[0],t[o]),g[1]=Math.min(g[1],t[o+1]);const i=g[0]%a,I=g[1]%a,u=g[0]-i,m=g[1]-I;for(let o=0;o<t.length;o+=3){const r=o/3*4;e[r]=(t[o]-u)/a,e[r+1]=(t[o+1]-m)/a,e[r+2]=u/a,e[r+3]=m/a}}function u(e,t,r,a,s=1){c.set(N,1,0,0),c.set(p,0,1,0),c.set(b,0,0,1),Y(m,r),i.fromArray(f,r)&&V(f,N,p,b,a,m),o.set(g,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o.set(M,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let o=0;o<r.length;o+=3){c.set(h,r[o],r[o+1],r[o+2]);const e=c.dot(N,h),t=c.dot(p,h);g[0]=Math.min(g[0],e),g[1]=Math.min(g[1],t),M[0]=Math.max(M[0],e),M[1]=Math.max(M[1],t)}const n=c.dot(b,m);k(T,g[0],g[1],n,N,p,b),k(y,M[0],g[1],n,N,p,b),k(A,g[0],M[1],n,N,p,b),c.subtract(y,y,T),c.scale(y,y,.5),c.subtract(A,A,T),c.scale(A,A,.5),c.add(T,T,y),c.add(T,T,A);const l=g[0]%s,d=g[1]%s,I=g[0]-l,u=g[1]-d;for(let o=0;o<r.length;o+=3){c.set(h,r[o],r[o+1],r[o+2]);const a=o/3,n=4*a;e[n]=(c.dot(N,h)-I)/s,e[n+1]=(c.dot(p,h)-u)/s,e[n+2]=I/s,e[n+3]=u/s;const l=9*a;for(let e=0;e<3;e++)t[l+e]=T[e],t[l+e+3]=y[e],t[l+e+6]=A[e]}}const m=a.create(),h=a.create(),f=i.create(),N=a.create(),p=a.create(),b=a.create(),g=r.create(),M=r.create(),T=a.create(),y=a.create(),A=a.create();function V(e,t,o,r,a,s){null!=a?(a.basisMatrixAtPosition(s,E),c.set(S,E[0],E[1],E[2]),c.set(F,E[4],E[5],E[6]),c.set(P,E[8],E[9],E[10])):(c.set(S,1,0,0),c.set(F,0,1,0),c.set(P,0,0,1));const n=i.normal(e);c.dot(n,P)<0&&c.scale(n,n,-1),c.copy(r,n);const l=c.dot(n,F),d=c.dot(n,S);Math.abs(l)>Math.abs(d)?(c.scaleAndAdd(t,S,n,-d),c.normalize(t,t),c.cross(o,t,n),c.normalize(o,o),c.scale(o,o,-1)):(c.scaleAndAdd(o,F,n,-l),c.normalize(o,o),c.cross(t,o,n),c.normalize(t,t))}const E=t.create(),S=a.create(),F=a.create(),P=a.create();function Y(e,t){c.set(_,0,0,0);for(let o=0;o<t.length-3;o+=3)_[0]+=t[o],_[1]+=t[o+1],_[2]+=t[o+2];c.scale(e,_,1/(t.length/3-1))}const _=a.create();function k(e,t,o,r,a,s,n){c.set(e,t*a[0]+o*s[0]+r*n[0],t*a[1]+o*s[1]+r*n[1],t*a[2]+o*s[2]+r*n[2])}e.createMapSpaceUVCoords=u,e.createMapSpaceUVCoordsDraped=I,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
