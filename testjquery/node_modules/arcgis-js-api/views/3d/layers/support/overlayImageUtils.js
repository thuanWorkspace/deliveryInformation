/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/VertexAttribute"],(function(t,e,r,n,i,o,u,h){"use strict";function a(t,r,n){const i=e.width(t)/e.height(t),o={width:n,height:n};return i>1.0001?o.height=n/i:i<.9999&&(o.width=n*i),o.width=Math.round(o.width/(e.width(t)/e.width(r))),o.height=Math.round(o.height/(e.height(t)/e.height(r))),o}function g(t,e){return u.createSquareGeometry(t,[[e[0],e[1],-1],[e[2],e[1],-1],[e[2],e[3],-1],[e[0],e[3],-1]])}function l(t,u,a){if(!e.intersects(u,a))return g(t,a);const l=[u[1]-a[1],Math.min(u[3],a[3])-Math.max(u[1],a[1]),a[3]-u[3],123456],c=[u[0]-a[0],Math.min(u[2],a[2])-Math.max(u[0],a[0]),a[2]-u[2],123456],w=a[2]-a[0],m=a[3]-a[1],y=c[0]>0&&c[2]>0?3:2,A=l[0]>0&&l[2]>0?3:2,s=(A+1)*(y+1),d=r.newDoubleArray(3*s),f=n.newFloatArray(2*s),p=new Array(6*(A*y-1));let x=0,M=0,G=0,O=0,S=0;for(let e=0;e<4;e++){const t=l[e];if(t<=0)continue;let r=0;for(let n=0;n<4;n++){const t=c[n];t<=0||(d[M++]=a[0]+r,d[M++]=a[1]+x,d[M++]=-1,f[G++]=r/w,f[G++]=x/m,n<3&&e<3&&(1!==n||1!==e)&&(p[S++]=O,p[S++]=O+1,p[S++]=O+y+1,p[S++]=O+1,p[S++]=O+y+2,p[S++]=O+y+1),O++,r+=t)}x+=t}const V=new Array(p.length);return new o.Geometry(t,[[h.VertexAttribute.POSITION,new i.Attribute(d,p,3,!0)],[h.VertexAttribute.NORMAL,new i.Attribute(b,V,3,!0)],[h.VertexAttribute.UV0,new i.Attribute(f,p,2,!0)]])}const b=[0,0,1];t.computeImageExportSize=a,t.createGeometryForExtent=g,t.createOuterImageGeometry=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
