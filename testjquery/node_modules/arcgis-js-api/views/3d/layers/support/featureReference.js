/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../core/has","../../../../geometry/SpatialReference","../../../../geometry/support/aaBoundingBox","../../../../core/mathUtils","../../../../geometry/Extent","../../../../geometry/Geometry","../../../../geometry/Multipoint","../../../../geometry/Point","../../../../geometry/Polygon","../../../../geometry/Polyline","../../../../geometry/support/typeUtils","../../../../layers/support/Field","../../../../layers/graphics/dehydratedFeatureComparison"],(function(e,t,s,i,r,o,n,u,h,l,f,a,g,c){"use strict";class V{get isReferenced(){return 0!==this.versions.length}get isSingle(){return 1===this.versions.length&&1===this.versions[0].refCount}constructor(e,t){this._highestResolutionVersion=null,this.versions=[],this.ref(e,t)}ref(e,t){const s=this.feature;d.oldVersion=s,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});for(const r of this.versions)if(r.resolution===t){r.refCount++;const t=this._highestResolutionVersion===r&&!c.equals(e,r.feature);return(t||this._highestResolutionVersion!==r)&&(r.feature=e),d.newVersion=t?e:s,d}const i={feature:e,resolution:t,refCount:1};return this.versions.push(i),!this._highestResolutionVersion||t<this._highestResolutionVersion.resolution?(d.newVersion=e,this._highestResolutionVersion=i):d.newVersion=s,d}unref(e){for(let t=0;t<this.versions.length;t++){const s=this.versions[t];if(s.resolution===e)return s.refCount--,d.oldVersion=this.feature,0===s.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this._highestResolutionVersion===s&&(this._recalculateHighestResolutionVersion(),d.oldVersion=s.feature)),d.newVersion=this.feature,d}return null}get feature(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}_recalculateHighestResolutionVersion(){if(0===this.versions.length)return void(this._highestResolutionVersion=null);let e=this.versions[0];for(let t=1;t<this.versions.length;t++){const s=this.versions[t];s.resolution<e.resolution&&(e=s)}this._highestResolutionVersion=e}}class _{get isReferenced(){return 0!==this._refCount}get isSingle(){return 1===this._refCount}constructor(e){this._feature=e,this._refCount=1}ref(e){return++this._refCount,d.oldVersion=this._feature,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0}),c.equals(this._feature,e)||(this._feature=e),d.newVersion=this._feature,d}unref(){return d.oldVersion=this._feature,this._refCount>0&&(this._refCount--,!this.isReferenced)?(d.newVersion=null,d):(d.newVersion=this._feature,d)}get feature(){return this._feature}}const d={oldVersion:null,newVersion:null};e.MultiFeatureReference=V,e.SingleFeatureReference=_,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
