/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../chunks/tslib.es6","./Analysis","./LineOfSightAnalysisObserver","./LineOfSightAnalysisTarget","../core/Collection","../core/collectionUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","../geometry/projection","../geometry/support/aaBoundingBox","../support/elevationInfoUtils"],(function(e,t,r,o,s,n,i,l,p,a,c,u,y,d,g){"use strict";const h=s.ofType(o);let f=class extends t{constructor(e){super(e),this.type="line-of-sight",this.observer=null,this.extent=null}initialize(){this.addHandles(i.watch((()=>this._computeExtent()),(e=>{null==e?.pending&&this._set("extent",null!=e?e.extent:null)}),i.syncAndInitial))}get targets(){return this._get("targets")||new h}set targets(e){this._set("targets",n.referenceSetter(e,this.targets,h))}get spatialReference(){return null!=this.observer?.position?this.observer.position.spatialReference:null}get requiredPropertiesForEditing(){return[this.observer?.position]}async waitComputeExtent(){const e=this._computeExtent();return null!=e?e.pending:Promise.resolve()}_computeExtent(){const e=this.spatialReference;if(null==this.observer?.position||null==e)return null;const t=e=>"absolute-height"===g.getGeometryEffectiveElevationMode(e.position,e.elevationInfo),r=this.observer.position,o=d.fromValues(r.x,r.y,r.z,r.x,r.y,r.z);for(const n of this.targets)if(null!=n.position){const t=y.projectOrLoad(n.position,e);if(null!=t.pending)return{pending:t.pending,extent:null};if(null!=t.geometry){const{x:e,y:r,z:s}=t.geometry;d.expandWithVec3(o,[e,r,s])}}const s=d.toExtent(o,e);return t(this.observer)&&this.targets.every(t)||(s.zmin=void 0,s.zmax=void 0),{pending:null,extent:s}}clear(){this.observer=null,this.targets.removeAll()}};e.__decorate([l.property({type:["line-of-sight"]})],f.prototype,"type",void 0),e.__decorate([l.property({type:r,json:{read:!0,write:!0}})],f.prototype,"observer",void 0),e.__decorate([l.property({cast:n.castForReferenceSetter,type:h,nonNullable:!0,json:{read:!0,write:!0}})],f.prototype,"targets",null),e.__decorate([l.property({value:null,readOnly:!0})],f.prototype,"extent",void 0),e.__decorate([l.property({readOnly:!0})],f.prototype,"spatialReference",null),e.__decorate([l.property({readOnly:!0})],f.prototype,"requiredPropertiesForEditing",null),f=e.__decorate([u.subclass("esri.analysis.LineOfSightAnalysis")],f);return f}));
