/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../core/Logger","../core/promiseUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../portal/Portal","../chunks/persistableUrlUtils","./Symbol","./support/Thumbnail"],(function(e,t,r,o,l,s,a,c,p,n,i,y,u,h){"use strict";var m;let d=m=class extends u{constructor(e){super(e),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const e=null!=this.portal?this.portal:i.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?.portal,super.read(e,t)}clone(){return new m({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(t,l){const s=null!=l?l.cache:null,a=s?this._fetchCacheKey:null;if(null!=s){const e=a&&s.get(a);if(e)return e.clone()}const{resolveWebStyleSymbol:c}=await new Promise(((t,r)=>e(["./support/webStyleSymbolUtils"],t,r)));o.throwIfAborted(l);const p=c(this,{portal:this.portal},t,l);p.catch((e=>{r.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",e)}));const n=await p;return"webRef"===t&&"point-3d"===n.type||"cimRef"===t&&"cim"===n.type?(null!=s&&s.set(a,n.clone()),n):null}};t.__decorate([l.property({json:{write:!1}})],d.prototype,"color",void 0),t.__decorate([l.property({type:String,json:{write:!0}})],d.prototype,"styleName",void 0),t.__decorate([l.property({type:i,json:{write:!1}})],d.prototype,"portal",void 0),t.__decorate([l.property({type:String,json:{read:y.read,write:y.write}})],d.prototype,"styleUrl",void 0),t.__decorate([l.property({type:h.Thumbnail,json:{read:!1}})],d.prototype,"thumbnail",void 0),t.__decorate([l.property({type:String,json:{write:!0}})],d.prototype,"name",void 0),t.__decorate([p.enumeration({styleSymbolReference:"web-style"},{readOnly:!0})],d.prototype,"type",void 0),t.__decorate([l.property()],d.prototype,"_fetchCacheKey",null),d=m=t.__decorate([n.subclass("esri.symbols.WebStyleSymbol")],d);return d}));
