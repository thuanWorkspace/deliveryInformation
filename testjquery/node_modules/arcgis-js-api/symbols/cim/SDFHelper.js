/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect","../../views/2d/engine/webgl/definitions"],(function(t,n,o,e,r){"use strict";function l(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":{const n=t.symbolLayers;return n&&1===n.length?l(n[0]):null}case"CIMVectorMarker":{const n=t.markerGraphics;if(!n||1!==n.length)return null;const o=n[0];if(!o)return null;const e=o.geometry;if(!e)return null;const r=o.symbol;return!r||"CIMPolygonSymbol"!==r.type&&"CIMLineSymbol"!==r.type||r.symbolLayers?.some((t=>!!t.effects))?null:{geom:e,asFill:"CIMPolygonSymbol"===r.type}}case"sdf":return{geom:t.geom,asFill:t.asFill}}return null}function i(t){return t?t.rings?t.rings:t.paths?t.paths:void 0!==t.xmin&&void 0!==t.ymin&&void 0!==t.xmax&&void 0!==t.ymax?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:null:null}function s(t){let n=1/0,o=-1/0,r=1/0,l=-1/0;for(const e of t)for(const t of e)t[0]<n&&(n=t[0]),t[0]>o&&(o=t[0]),t[1]<r&&(r=t[1]),t[1]>l&&(l=t[1]);return new e(n,r,o-n,l-r)}function a(t){let n=1/0,o=-1/0,e=1/0,r=-1/0;for(const l of t)for(const t of l)t[0]<n&&(n=t[0]),t[0]>o&&(o=t[0]),t[1]<e&&(e=t[1]),t[1]>r&&(r=t[1]);return[n,e,o,r]}function f(t){return t?t.rings?a(t.rings):t.paths?a(t.paths):o.isExtent(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function u(t,n,o,e,l){const[i,s,a,f]=t;if(a<i||f<s)return[0,0,0];const u=a-i,c=f-s,m=128,y=r.spritePadding,h=Math.floor(.5*(.5*m-y)),x=(m-2*(h+y))/Math.max(u,c),g=Math.round(u*x)+2*h,M=Math.round(c*x)+2*h;let d=1;if(n){d=M/x/(n.ymax-n.ymin)}let p=0,b=0,F=1;e&&(l?n&&o&&n.ymax-n.ymin>0&&(F=(n.xmax-n.xmin)/(n.ymax-n.ymin),p=e.x/(o*F),b=e.y/o):(p=e.x,b=e.y)),n&&(p=.5*(n.xmax+n.xmin)+p*(n.xmax-n.xmin),b=.5*(n.ymax+n.ymin)+b*(n.ymax-n.ymin)),p-=i,b-=s,p*=x,b*=x,p+=h,b+=h;let S=p/g-.5,w=b/M-.5;return l&&o&&(S*=o*F,w*=o),[d,S,w]}function c(t){const n=i(t.geom),o=s(n),e=128,l=r.spritePadding,a=Math.floor(.5*(.5*e-l)),f=(e-2*(a+l))/Math.max(o.width,o.height),u=Math.round(o.width*f)+2*a,c=Math.round(o.height*f)+2*a,x=[];for(const r of n)if(r&&r.length>1){const n=[];for(const e of r){let[r,l]=e;r-=o.x,l-=o.y,r*=f,l*=f,r+=a-.5,l+=a-.5,t.asFill?n.push([r,l]):n.push([Math.round(r),Math.round(l)])}if(t.asFill){const t=n.length-1;n[0][0]===n[t][0]&&n[0][1]===n[t][1]||n.push(n[0])}x.push(n)}const g=m(x,u,c,a);return t.asFill&&y(x,u,c,a,g),[h(g,a),u,c]}function m(t,n,o,e){const r=n*o,l=new Array(r),i=e*e+1;for(let s=0;s<r;++s)l[s]=i;for(const s of t){const t=s.length;for(let r=1;r<t;++r){const t=s[r-1],i=s[r];let a,f,u,c;t[0]<i[0]?(a=t[0],f=i[0]):(a=i[0],f=t[0]),t[1]<i[1]?(u=t[1],c=i[1]):(u=i[1],c=t[1]);let m=Math.floor(a)-e,y=Math.floor(f)+e,h=Math.floor(u)-e,x=Math.floor(c)+e;m<0&&(m=0),y>n&&(y=n),h<0&&(h=0),x>o&&(x=o);const g=i[0]-t[0],M=i[1]-t[1],d=g*g+M*M;for(let e=m;e<y;e++)for(let r=h;r<x;r++){let s,a,f=(e-t[0])*g+(r-t[1])*M;f<0?(s=t[0],a=t[1]):f>d?(s=i[0],a=i[1]):(f/=d,s=t[0]+f*g,a=t[1]+f*M);const u=(e-s)*(e-s)+(r-a)*(r-a),c=(o-r-1)*n+e;u<l[c]&&(l[c]=u)}}}for(let s=0;s<r;++s)l[s]=Math.sqrt(l[s]);return l}function y(t,n,o,e,r){for(const l of t){const t=l.length;for(let i=1;i<t;++i){const t=l[i-1],s=l[i];let a,f,u,c;t[0]<s[0]?(a=t[0],f=s[0]):(a=s[0],f=t[0]),t[1]<s[1]?(u=t[1],c=s[1]):(u=s[1],c=t[1]);let m=Math.floor(a),y=Math.floor(f)+1,h=Math.floor(u),x=Math.floor(c)+1;m<e&&(m=e),y>n-e&&(y=n-e),h<e&&(h=e),x>o-e&&(x=o-e);for(let l=h;l<x;++l){if(t[1]>l==s[1]>l)continue;const i=(o-l-1)*n;for(let n=m;n<y;++n)n<(s[0]-t[0])*(l-t[1])/(s[1]-t[1])+t[0]&&(r[i+n]=-r[i+n]);for(let t=e;t<m;++t)r[i+t]=-r[i+t]}}}}function h(t,o){const e=2*o,r=t.length,l=new Uint8Array(4*r);for(let i=0;i<r;++i){const o=.5-t[i]/e;n.packFloatRGBA(o,l,4*i)}return l}t.buildSDF=c,t.getExtent=f,t.getSDFInfo=l,t.getSDFMetrics=u,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
