/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../CIMCursor","../enums","../GeometryWalker"],(function(t,e,n,s){"use strict";class i{static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(t,e,n,s,i){return new a(t,e,n)}}i.instance=null;class a extends e.PathTransformationCursor{constructor(t,e,n){super(t),this._geometryWalker=new s.GeometryWalker,this._geometryWalker.updateTolerance(n),this._angleToLine=e.angleToLine??!0,this._offset=(e.offset?e.offset:0)*n,this._originalEndings=e.endings,this._offsetAtEnd=(e.customEndingOffset?e.customEndingOffset:0)*n,this._position=-(e.offsetAlongLine?e.offsetAlongLine:0)*n,this._pattern=new s.DashPattern,this._pattern.init(e.placementTemplate,!1),this._pattern.scale(n),this._endings=this._originalEndings}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath)e=this._pattern.nextValue();else{this._originalEndings===n.PlacementEndings.WithFullGap&&this.isClosed?this._endings=n.PlacementEndings.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let s,i=!0;switch(this._endings){case n.PlacementEndings.NoConstraint:s=-this._position,s=this._adjustPosition(s),i=!1;break;case n.PlacementEndings.WithHalfGap:default:s=-this._pattern.lastValue()/2;break;case n.PlacementEndings.WithFullGap:s=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case n.PlacementEndings.WithMarkers:s=0;break;case n.PlacementEndings.Custom:s=-this._position,s=this._adjustPosition(s),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(t,this._pattern,i))return null;this._pattern.reset();let a=0;for(;s>a;)s-=a,a=this._pattern.nextValue();a-=s,e=a,this.iteratePath=!0}const i=new s.Pos;return this._geometryWalker.nextPointAndAngle(e,i)?this._endings===n.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===n.PlacementEndings.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(t){let e=t/this._pattern.length();return e-=Math.floor(e),e*this._pattern.length()}}t.PlacementAlongLineSameSize=i,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
