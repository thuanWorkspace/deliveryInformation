/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../CIMCursor","../CurveHelper"],(function(t,e,s){"use strict";const i=1e-15;class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,s,i,n){return new o(t,e,s)}}n.instance=null;class o extends e.PathTransformationCursor{constructor(t,e,i){super(t),this._curveHelper=new s.CurveHelper,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._endPoints=void 0===e.placeOnEndPoints||e.placeOnEndPoints,this._controlPoints=void 0===e.placeOnControlPoints||e.placeOnControlPoints,this._regularVertices=void 0===e.placeOnRegularVertices||e.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(t){if(this.iteratePath||(this._preparePath(t),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const e=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(e[2]);let s=e[0],i=e[1];if(0!==this._offset){const t=Math.cos(e[2]),n=Math.sin(e[2]);s-=this._offset*n,i+=this._offset*t}return this.internalPlacement.setTranslate(s,i),this._tagIterator++,this.internalPlacement}_preparePath(t){this._tags.length=0,this._tagIterator=0,t.seekPathStart();const e=t.isClosed();let s=0,i=!1,n=0,o=0;if(t.seekPathStart(),t.nextPoint()){let a=t.x,h=t.y,l=t.getControlPoint(),c=!0,_=t.nextPoint();for(;_;){const g=t.x,u=t.y,P=t.getControlPoint();(this._angleToLine||0!==this._offset)&&(n=this._curveHelper.getAngle(a,h,g,u,0)),c?(c=!1,e?(s=n,i=l):(this._endPoints||this._controlPoints&&l)&&this._tags.push([a,h,n])):l?this._controlPoints&&this._tags.push([a,h,r(o,n)]):this._regularVertices&&this._tags.push([a,h,r(o,n)]),(this._angleToLine||0!==this._offset)&&(o=this._curveHelper.getAngle(a,h,g,u,1)),_=t.nextPoint(),_||(e?P||i?this._controlPoints&&this._tags.push([g,u,r(o,s)]):this._regularVertices&&this._tags.push([g,u,r(o,s)]):(this._endPoints||this._controlPoints&&P)&&this._tags.push([g,u,o])),a=g,h=u,l=P}}this._tagIterator=0}}function r(t,e){const s=Math.PI;for(;Math.abs(e-t)>s+2*i;)e-t>s?e-=2*s:e+=2*s;return(t+e)/2}t.PlacementOnVertices=n,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
