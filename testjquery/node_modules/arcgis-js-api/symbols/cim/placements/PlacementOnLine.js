/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../CIMCursor","../CurveHelper","../enums"],(function(e,t,n,i){"use strict";const s=.001;class a{static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(e,t,n,i,s){return new r(e,t,n)}}a.instance=null;class r extends t.PathTransformationCursor{constructor(e,t,i){super(e),this._curveHelper=new n.CurveHelper,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*i:0,this._epsilon=s*i}processPath(e){const t=this._position;if(this._relativeTo===i.PlacementOnLineRelativeTo.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[t,n]=[e.x,e.y],[i,s]=[0,0];for(;e.nextPoint();){i=e.x,s=e.y;const a=this._curveHelper.getLength(t,n,i,s);if(a<this._epsilon){t=i,n=s;continue}const r=.5+this._position/a,[o,l]=this._curveHelper.getAngleCS(t,n,i,s,r),h=this._curveHelper.getCoord2D(t,n,i,s,r);return this.internalPlacement.setTranslate(h[0]-this._offset*l,h[1]+this._offset*o),this._angleToLine&&this.internalPlacement.setRotateCS(o,l),this.internalPlacement}}return this.iteratePath=!1,null}const n=this._relativeTo===i.PlacementOnLineRelativeTo.LineEnd;return this.onLine(e,t,n)}onLine(e,t,n){let s,a=!1;switch(this._relativeTo){case i.PlacementOnLineRelativeTo.LineMiddle:default:e.seekPathStart(),s=e.pathLength()/2+t;break;case i.PlacementOnLineRelativeTo.LineBeginning:s=t;break;case i.PlacementOnLineRelativeTo.LineEnd:s=t,a=!0}n?e.seekPathEnd():e.seekPathStart();let r=0;if(n?e.prevPoint():e.nextPoint()){let[t,i]=[e.x,e.y],[o,l]=[0,0];for(;n?e.prevPoint():e.nextPoint();){o=e.x,l=e.y;const n=this._curveHelper.getLength(t,i,o,l);if(r+n>s){const e=(s-r)/n,[h,c]=this._curveHelper.getAngleCS(t,i,o,l,e),u=this._curveHelper.getCoord2D(t,i,o,l,e),f=a?-this._offset:this._offset;return this.internalPlacement.setTranslate(u[0]-f*c,u[1]+f*h),this._angleToLine&&(a?this.internalPlacement.setRotateCS(-h,-c):this.internalPlacement.setRotateCS(h,c)),this.internalPlacement}t=o,i=l,r+=n}}return null}}e.PlacementOnLine=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
