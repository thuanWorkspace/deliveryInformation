/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../enums","../GeometryWalker"],(function(t,e,s,i,a,n){"use strict";class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,s,i,a){return new h(t,e,s)}}r.instance=null;class h extends i.PathEffectCursor{constructor(t,e,s){super(t,!0,!0),this._firstCurve=null,this._walker=new n.GeometryWalker,this._walker.updateTolerance(s),this._endings=e.lineDashEnding,this._customDashPos=-(e.offsetAlongLine??0)*s,this._offsetAtEnd=(e.customEndingOffset??0)*s,this._pattern=new n.DashPattern,this._pattern.init(e.dashTemplate,!0),this._pattern.scale(s)}processPath(t){if(0===this._pattern.length()){this.iteratePath=!1;const i=s.collectPath(t);return e.GeometryCursor.fromJSONCIM({paths:[i]})}if(!this.iteratePath){let i=!0;switch(this._endings){case a.LineDashEnding.HalfPattern:case a.LineDashEnding.HalfGap:default:this._pattern.extPtGap=0;break;case a.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case a.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case a.LineDashEnding.NoConstraint:this.isClosed||(i=!1);break;case a.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const n=t.pathLength();if(this._pattern.isEmpty()||n<.1*this._pattern.length()){const i=s.collectPath(t);return e.GeometryCursor.fromJSONCIM({paths:[i]})}if(!this._walker.init(t,this._pattern,i)){const i=s.collectPath(t);return e.GeometryCursor.fromJSONCIM({paths:[i]})}}let i;if(this.iteratePath)i=this._pattern.nextValue();else{let t;switch(this._endings){case a.LineDashEnding.HalfPattern:default:t=.5*this._pattern.firstValue();break;case a.LineDashEnding.HalfGap:t=.5*-this._pattern.lastValue();break;case a.LineDashEnding.FullGap:t=-this._pattern.lastValue();break;case a.LineDashEnding.FullPattern:t=0;break;case a.LineDashEnding.NoConstraint:case a.LineDashEnding.Custom:t=-this._customDashPos}let e=t/this._pattern.length();e-=Math.floor(e),t=e*this._pattern.length(),this._pattern.reset(),i=this._pattern.nextValue();let s=!1;for(;t>=i;)t-=i,i=this._pattern.nextValue(),s=!s;i-=t,s?(this._walker.nextPosition(i),i=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(i),i=this._pattern.nextValue(),this._walker.nextPosition(i),i=this._pattern.nextValue())}let n=this._walker.nextCurve(i);if(n)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)n.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else i=this._pattern.nextValue(),!this._walker.nextPosition(i)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(n.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,n=this._firstCurve,this._firstCurve=null;return n?.reset(),n}}t.EffectDashes=r,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
