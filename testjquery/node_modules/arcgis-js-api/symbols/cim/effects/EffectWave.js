/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../geometry/GeometryCursor","../enums","../GeometryWalker"],(function(t,e,i,s){"use strict";class h{static local(){return null===h.instance&&(h.instance=new h),h.instance}execute(t,e,i,s,h){return new n(t,e,i)}}h.instance=null;class n{constructor(t,e,i){this._inputGeometries=t,this._height=(void 0!==e.amplitude?e.amplitude:2)*i,this._period=(void 0!==e.period?e.period:3)*i,this._style=e.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new s.DashPattern,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new s.GeometryWalker,this._walker.updateTolerance(i)}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._height||0===this._period)return t;const e=this._processGeom(t);if(e)return e;t=this._inputGeometries.next()}return null}_processGeom(t){const s=e.GeometryCursor.createEmptyOptimizedCIM(t.geometryType);for(;t.nextPath();){s.startPath();const e=t.pathLength();if(this._walker.init(t,this._pattern))switch(this._style){case i.GeometricEffectWaveform.Sinus:default:this._constructCurve(s,e,!1);break;case i.GeometricEffectWaveform.Square:this._constructSquare(s,e);break;case i.GeometricEffectWaveform.Triangle:this._constructTriangle(s,e);break;case i.GeometricEffectWaveform.Random:this._constructCurve(s,e,!0)}else for(;t.nextPoint();)s.pushXY(t.x,t.y)}return s}_constructCurve(t,e,i){let h=Math.round(e/this._period);0===h&&(h=1);const n=h*16+1,r=e/h,o=this._period/16,a=1/n,p=2*Math.PI*e/r,c=2*Math.PI*Math.random(),_=2*Math.PI*Math.random(),u=2*Math.PI*Math.random(),l=.75-Math.random()/2,d=.75-Math.random()/2,g=new s.Pos;this._walker.curPointAndAngle(g),t.pushPoint(g.pt);let P=0;for(;;){if(!this._walker.nextPointAndAngle(o,g)){t.pushPoint(this._walker.getPathEnd());break}{const e=P;let s;if(P+=a,i){const t=this._height/2*(1+.3*Math.sin(l*p*e+c));s=t*Math.sin(p*e+_),s+=t*Math.sin(d*p*e+u),s/=2}else s=.5*this._height*Math.sin(.5*p*e);t.pushXY(g.pt[0]-s*g.sa,g.pt[1]+s*g.ca)}}}_constructSquare(t,e){Math.round(e/this._period);let i=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const h=new s.Pos;this._walker.curPointAndAngle(h);const n=new s.Pos;if(this._walker.nextPointAndAngle(this._period,n)){const r=new s.Pos;this._walker.nextPointAndAngle(this._period,r)&&(i?(t.pushPoint(h.pt),i=!1):t.pushPoint(h.pt),t.pushXY(h.pt[0]-this._height/2*h.sa,h.pt[1]+this._height/2*h.ca),t.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),t.pushXY(n.pt[0]+this._height/2*n.sa,n.pt[1]-this._height/2*n.ca),t.pushXY(r.pt[0]+this._height/2*r.sa,r.pt[1]-this._height/2*r.ca),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(t,e){Math.round(e/this._period);let i=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const h=new s.Pos;this._walker.curPointAndAngle(h);const n=new s.Pos;if(this._walker.nextPointAndAngle(this._period/2,n)){const r=new s.Pos;this._walker.nextPointAndAngle(this._period,r)&&(this._walker.nextPosition(this._period/2)&&(i?(t.pushPoint(h.pt),i=!1):t.pushPoint(h.pt),t.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),t.pushXY(r.pt[0]+this._height/2*r.sa,r.pt[1]-this._height/2*r.ca)),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}}t.EffectWave=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
