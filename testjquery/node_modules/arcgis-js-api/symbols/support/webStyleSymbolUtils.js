/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../symbols","../../core/devEnvironmentUtils","../../core/Error","../../core/urlUtils","../../portal/Portal","../../chunks/persistableUrlUtils","./jsonUtils","./StyleOrigin","./styleUtils","./Thumbnail"],(function(e,t,l,r,n,o,a,s,i,m,u){"use strict";function y(e,t,l,n){const o=e.name;return null==o?Promise.reject(new r("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?f(o,t,n):m.fetchStyle(e,t,n).then((e=>b(e,o,t,l,m.symbolUrlFromStyleItem,n)))}function c(e,t){return t.items.find((t=>t.name===e))}function b(e,y,b,f,S,p){const g=null!=b?.portal?b.portal:o.getDefault(),d={portal:g,url:n.urlToObject(e.baseUrl),origin:"portal-item"},h=c(y,e.data);if(!h){const e=`The symbol name '${y}' could not be found`;return Promise.reject(new r("symbolstyleutils:symbol-name-not-found",e,{symbolName:y}))}let O=a.fromJSON(S(h,f),d),U=h.thumbnail?.href??null;const N=h.thumbnail?.imageData;l.isDevEnvironment()&&(O=l.adjustStaticAGOUrl(O)??"",U=l.adjustStaticAGOUrl(U));const j={portal:g,url:n.urlToObject(n.removeFile(O)),origin:"portal-item"};return m.requestJSON(O,p).then((l=>{const r="cimRef"===f?m.makeCIMSymbolRef(l.data):l.data,n=s.fromJSON(r,j);if(n&&t.isSymbol3D(n)){if(U){const e=a.fromJSON(U,d);n.thumbnail=new u.Thumbnail({url:e})}else N&&(n.thumbnail=new u.Thumbnail({url:`data:image/png;base64,${N}`}));e.styleUrl?n.styleOrigin=new i({portal:b.portal,styleUrl:e.styleUrl,name:y}):e.styleName&&(n.styleOrigin=new i({portal:b.portal,styleName:e.styleName,name:y}))}return n}))}function f(e,t,l){const r=m.Style2DUrlTemplate.replaceAll(/\{SymbolName\}/gi,e),a=null!=t.portal?t.portal:o.getDefault();return m.requestJSON(r,l).then((e=>{const t=m.makeCIMSymbolRef(e.data);return s.fromJSON(t,{portal:a,url:n.urlToObject(n.removeFile(r)),origin:"portal-item"})}))}e.fetchSymbolFromStyle=b,e.getStyleItemFromStyle=c,e.resolveWebStyleSymbol=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
