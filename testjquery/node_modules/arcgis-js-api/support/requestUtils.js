/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../config","../core/has","../core/promiseUtils","../core/urlUtils"],(function(e,r,o,t,n){"use strict";function s(e,r,n=!1,s){return new Promise(((c,u)=>{if(t.isAborted(s))return void u(i());let a=()=>{g(),u(new Error(`Unable to load ${r}`))},l=()=>{const r=e;g(),c(r)},d=()=>{if(!e)return;const r=e;g(),r.src="",u(i())};const g=()=>{o("esri-image-decode")||(e.removeEventListener("error",a),e.removeEventListener("load",l)),a=null,l=null,e=null,null!=s&&s.removeEventListener("abort",d),d=null,n&&URL.revokeObjectURL(r)};null!=s&&s.addEventListener("abort",d),o("esri-image-decode")?e.decode().then(l,a):(e.addEventListener("error",a),e.addEventListener("load",l))}))}function i(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}const c="Timeout exceeded";function u(){return new Error(c)}function a(e){return"object"==typeof e&&!!e&&"message"in e&&e.message===c}function l(e){r.request.crossOriginNoCorsDomains||(r.request.crossOriginNoCorsDomains={});const o=r.request.crossOriginNoCorsDomains;for(let r of e)r=r.toLowerCase(),/^https?:\/\//.test(r)?o[n.getOrigin(r)??""]=0:(o[n.getOrigin("http://"+r)??""]=0,o[n.getOrigin("https://"+r)??""]=0)}function d(e){const o=r.request.crossOriginNoCorsDomains;if(o){let r=n.getOrigin(e);if(r)return r=r.toLowerCase(),!n.hasSameOrigin(r,n.getAppUrl())&&o[r]<Date.now()-36e5}return!1}async function g(e){const o=r.request.crossOriginNoCorsDomains,t=n.getOrigin(e);o&&t&&(o[t.toLowerCase()]=Date.now());const s=n.urlToObject(e);e=s.path,"json"===s.query?.f&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}e.createTimeoutError=u,e.isNoCorsRequestRequired=d,e.isTimeoutError=a,e.loadImageAsync=s,e.registerNoCorsDomains=l,e.sendNoCorsRequest=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
