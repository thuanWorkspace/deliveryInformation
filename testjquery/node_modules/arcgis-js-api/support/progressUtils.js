/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../core/handleUtils","../core/has","../core/MapUtils","../core/time"],(function(e,s,t,r,o){"use strict";function i(e,s=(e=>{}),t){return new n(e,s,t)}class n{constructor(e,s=(e=>{}),t){if(this.onProgress=s,this.taskName=t,this._progressMap=new Map,this._startTime=void 0,this._timingsMap=new Map,"number"==typeof e){this._weights={};for(let s=0;s<e;s++){const t=s,r=1/e;this._weights[t]=r,this._progressMap.set(t,0)}}else this._weights=e;this.emitProgress()}emitProgress(){let e=0;for(const[s,t]of this._progressMap.entries()){e+=t*this._weights[s]}if(1===e&&t("enable-feature:esri-3dofl-upload-timings")){const e=Math.round(performance.now()-(this._startTime??0))/1e3;console.log(`${this.taskName} done in ${e} sec`);for(const[s,t]of this._timingsMap){const r=Math.round(t.end-t.start)/1e3,o=Math.round(r/e*100);console.log(this.taskName??"Task",{stepKey:s,stepTime:r,relativeTime:o})}}this.onProgress(e)}setProgress(e,s){if(this._progressMap.set(e,s),t("enable-feature:esri-3dofl-upload-timings")){const t=performance.now();this._startTime??(this._startTime=t);const o=r.getOrCreateMapValue(this._timingsMap,e,(()=>({start:t,end:0})));1===s&&(o.end=t)}this.emitProgress()}simulate(e,s){return a((s=>this.setProgress(e,s)),s)}makeOnProgress(e){return s=>this.setProgress(e,s)}}function a(e=(e=>{}),t=p){const r=performance.now();e(0);const o=setInterval((()=>{const s=performance.now()-r,o=1-Math.exp(-s/t);e(o)}),d);return s.makeHandle((()=>{clearInterval(o),e(1)}))}function c(e,s=l){const t=e*g;return o.millisecondsFromSeconds(o.Seconds(t/s))}function m(e,s=h){const t=e*g;return o.millisecondsFromSeconds(o.Seconds(t/s))}const l=10,h=10,g=8e-6,d=o.Milliseconds(50),p=o.Milliseconds(1e3);e.ProgressManager=n,e.estimatedConversionTime=m,e.estimatedTransferTime=c,e.makeProgressManager=i,e.simulateProgress=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
