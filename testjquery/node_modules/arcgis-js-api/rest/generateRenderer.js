/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../request","../renderers/support/jsonUtils","./query/executeQuery","./utils","../kernel","../core/urlUtils","./query/support/AttachmentInfo","./support/AttachmentQuery","../geometry/Extent","../geometry/Geometry","../geometry/Multipoint","../geometry/Point","../geometry/Polygon","../geometry/Polyline","../geometry/support/normalizeUtils","../geometry/support/spatialReferenceUtils","../core/Error","../core/pbf","../core/unitUtils","../geometry/ellipsoidUtils","./support/Query","../geometry","./support/FeatureSet","../layers/graphics/featureConversionUtils","./support/RelationshipQuery","./support/TopFeaturesQuery","./support/StatisticDefinition"],(function(e,t,n,r,i,o,l,s,a,u,c,p,f,y,m,g,d,h,S,V,b,k,x,U,v,O,R,q){"use strict";async function F(e,n,r,o){const l=i.parseUrl(e),{source:s,checkValueRange:a}=n,{classificationDefinition:u}=r,c={...r.toJSON(),f:"json"};let p=null;if(p="class-breaks-definition"===u?.type?u.classificationField:u?.attributeField,s){const e={source:s?.toJSON()};c.layer=JSON.stringify(e)}c.classificationDef&&(c.classificationDef=JSON.stringify(c.classificationDef));let f={query:c};o&&(f={...o,...f});const y={url:l.path,field:p,checkValueRange:a},m=l.path+"/generateRenderer";return t(m,f).then((e=>Q(y,e)))}function Q(e,t){const{field:n,checkValueRange:i,url:o}=e,l=t?.data;if(!l)return;if(!i){const e=T(l);return Promise.resolve(e)}const s=new q({statisticType:"min",onStatisticField:n}),a=new q({statisticType:"max",onStatisticField:n}),u=new k({outStatistics:[s,a]});return r.executeQuery(o,u).then((e=>{const t=e.features[0].attributes;let n=null,r=null;for(const i in t)0===i.toLowerCase().indexOf("min")?n=t[i]:r=t[i];return T(l,n,r)}))}function T(e,t,r){if("classBreaks"===e.type){const i=n.fromJSON(e);return{classBreaks:i.classBreakInfos.map(((e,n)=>(0===n&&null!=t&&(e.minValue=t),n===i.classBreakInfos.length-1&&null!=r&&(e.maxValue=r),{minValue:e.minValue,maxValue:e.maxValue,label:e.label}))),normalizationTotal:i.normalizationTotal}}const{uniqueValueInfos:i}=e;return{uniqueValues:i?.map(((e,n)=>(0===n&&null!=t&&(e.value=t),n===i.length-1&&null!=r&&(e.value=r),{count:e.count,value:e.value,label:e.label})))??[]}}e.generateRenderer=F,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
