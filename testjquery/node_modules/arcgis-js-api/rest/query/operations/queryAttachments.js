/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../kernel","../../../request","../../../core/urlUtils","../../operations/urlUtils","../support/AttachmentInfo"],(function(t,e,n,o,a,s){"use strict";function r(t){const e=t.toJSON();return e.attachmentTypes&&(e.attachmentTypes=e.attachmentTypes.join(",")),e.keywords&&(e.keywords=e.keywords.join(",")),e.globalIds&&(e.globalIds=e.globalIds.join(",")),e.objectIds&&(e.objectIds=e.objectIds.join(",")),e.size&&(e.size=e.size.join(",")),e}function c(t,n){const a={};for(const r of n){const{parentObjectId:n,parentGlobalId:c,attachmentInfos:u}=r;for(const r of u){const{id:u}=r,d=o.addProxy(e.addTokenParameter(`${t.path}/${n}/attachments/${u}`)),l=s.fromJSON(r);l.set({url:d,parentObjectId:n,parentGlobalId:c}),a[n]?a[n].push(l):a[n]=[l]}}return a}function u(t,e,o){let s={query:a.mapParameters({...t.query,f:"json",...r(e)})};return o&&(s={...o,...s,query:{...o.query,...s.query}}),n(t.path+"/queryAttachments",s).then((t=>t.data.attachmentGroups))}async function d(t,e,o){const{objectIds:a}=e,s=[];for(const r of a)s.push(n(t.path+"/"+r+"/attachments",o));return Promise.all(s).then((t=>a.map(((e,n)=>({parentObjectId:e,attachmentInfos:t[n].data.attachmentInfos})))))}t.executeAttachmentQuery=u,t.fetchAttachments=d,t.processAttachmentQueryResult=c,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
