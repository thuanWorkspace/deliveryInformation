/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/unitUtils","../../../geometry/support/spatialReferenceUtils","../../../layers/graphics/OptimizedFeature","../../../layers/graphics/OptimizedFeatureSet","../../../layers/graphics/OptimizedGeometry"],(function(e,t,r,i,o,s){"use strict";const a=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class n{constructor(e){this._options=e,this.geometryTypes=a,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new o}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||r.equals(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const o=t.getMetersPerVerticalUnitForSR(this._options.sourceSpatialReference)/t.getMetersPerVerticalUnitForSR(e.spatialReference);if(1!==o)for(const t of e.features){if(!i.hasGeometry(t))continue;const e=t.geometry.coords;for(let t=2;t<e.length;t+=3)e[t]*=o}}addFeature(e,t){e.features.push(t)}createFeature(){return new i.OptimizedFeature}createSpatialReference(){return{wkid:0}}createGeometry(){return new s}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new s}}e.OptimizedFeatureSetParserContext=n,e.optimizedGeometryTypes=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
