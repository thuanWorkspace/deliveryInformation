/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/Error","../../../core/pbf","../../../layers/graphics/OptimizedGeometry","./pbfOptimizedFeatureSet"],(function(e,t,s,r,a){"use strict";const n=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],i=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],o=["upperLeft","lowerLeft"];function c(e){return e>=n.length?null:n[e]}function l(e){return e>=i.length?null:i[e]}function g(e){return e>=o.length?null:o[e]}function p(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function u(e,t,s){const r=3,a=e.asUnsafe(),n=t.createPointGeometry(s);for(;a.next();)switch(a.tag()){case r:{const e=a.getUInt32(),s=a.pos()+e;let r=0;for(;a.pos()<s;)t.addCoordinatePoint(n,a.getSInt64(),r++);break}default:a.skip()}return n}function y(e,t,s){const r=2,a=3,n=e.asUnsafe(),i=t.createGeometry(s),o=2+(s.hasZ?1:0)+(s.hasM?1:0);for(;n.next();)switch(n.tag()){case r:{const e=n.getUInt32(),s=n.pos()+e;let r=0;for(;n.pos()<s;)t.addLength(i,n.getUInt32(),r++);break}case a:{const e=n.getUInt32(),s=n.pos()+e;let r=0;for(t.allocateCoordinates(i);n.pos()<s;)t.addCoordinate(i,n.getSInt64(),r),r++,r===o&&(r=0);break}default:n.skip()}return i}function f(e){const t=1,s=2,n=3,i=e.asUnsafe(),o=new r;let c="esriGeometryPoint";for(;i.next();)switch(i.tag()){case s:{const e=i.getUInt32(),t=i.pos()+e;for(;i.pos()<t;)o.lengths.push(i.getUInt32());break}case n:{const e=i.getUInt32(),t=i.pos()+e;for(;i.pos()<t;)o.coords.push(i.getSInt64());break}case t:c=a.optimizedGeometryTypes[i.getEnum()];break;default:i.skip()}return{queryGeometry:o,queryGeometryType:c}}function d(e){const t=1,s=2,r=3,a=4,n=5,i=6,o=7,c=8,l=9,g=e.asUnsafe();for(;g.next();)switch(g.tag()){case t:return g.getString();case s:return g.getFloat();case r:return g.getDouble();case a:return g.getSInt32();case n:return g.getUInt32();case i:return g.getInt64();case o:return g.getUInt64();case c:return g.getSInt64();case l:return g.getBool();default:return g.skip(),null}return null}function b(e){const t=1,s=2,r=3,a=4,n=5,i=6,o=e.asUnsafe(),g={type:c(0)};for(;o.next();)switch(o.tag()){case t:g.name=o.getString();break;case s:g.type=c(o.getEnum());break;case r:g.alias=o.getString();break;case a:g.sqlType=l(o.getEnum());break;case n:o.skip();break;case i:g.defaultValue=o.getString();break;default:o.skip()}return g}function k(e){const t=1,s=2,r={},a=e.asUnsafe();for(;a.next();)switch(a.tag()){case t:r.name=a.getString();break;case s:r.isSystemMaintained=a.getBool();break;default:a.skip()}return r}function T(e,t,s,r){const a=1,n=2,i=4,o=t.createFeature(s);let c=0;for(;e.next();)switch(e.tag()){case a:{const t=r[c++].name;o.attributes[t]=e.processMessage(d);break}case n:o.geometry=e.processMessageWithArgs(y,t,s);break;case i:o.centroid=e.processMessageWithArgs(u,t,s);break;default:e.skip()}return o}function h(e){const t=1,s=2,r=3,a=4,n=[1,1,1,1],i=e.asUnsafe();for(;i.next();)switch(i.tag()){case t:n[0]=i.getDouble();break;case s:n[1]=i.getDouble();break;case a:n[2]=i.getDouble();break;case r:n[3]=i.getDouble();break;default:i.skip()}return n}function m(e){const t=1,s=2,r=3,a=4,n=[0,0,0,0],i=e.asUnsafe();for(;i.next();)switch(i.tag()){case t:n[0]=i.getDouble();break;case s:n[1]=i.getDouble();break;case a:n[2]=i.getDouble();break;case r:n[3]=i.getDouble();break;default:i.skip()}return n}function F(e){const t=1,s=2,r=3,a={originPosition:g(0)},n=e.asUnsafe();for(;n.next();)switch(n.tag()){case t:a.originPosition=g(n.getEnum());break;case s:a.scale=n.processMessage(h);break;case r:a.translate=n.processMessage(m);break;default:n.skip()}return a}function q(e){const t=1,s=2,r=3,a={},n=e.asUnsafe();for(;n.next();)switch(n.tag()){case t:a.shapeAreaFieldName=n.getString();break;case s:a.shapeLengthFieldName=n.getString();break;case r:a.units=n.getString();break;default:n.skip()}return a}function I(e,t){const s=1,r=2,a=3,n=4,i=5,o=t.createSpatialReference();for(;e.next();)switch(e.tag()){case s:o.wkid=e.getUInt32();break;case i:o.wkt=e.getString();break;case r:o.latestWkid=e.getUInt32();break;case a:o.vcsWkid=e.getUInt32();break;case n:o.latestVcsWkid=e.getUInt32();break;default:e.skip()}return o}function S(e,t){const s=1,r=2,a=3,n=4,i=5,o=7,c=8,l=9,g=10,u=11,y=12,f=13,d=15,h=t.createFeatureResult(),m=e.asUnsafe();h.geometryType=p(t,0);let S=!1;for(;m.next();)switch(m.tag()){case s:h.objectIdFieldName=m.getString();break;case a:h.globalIdFieldName=m.getString();break;case n:h.geohashFieldName=m.getString();break;case i:h.geometryProperties=m.processMessage(q);break;case o:h.geometryType=p(t,m.getEnum());break;case c:h.spatialReference=m.processMessageWithArgs(I,t);break;case g:h.hasZ=m.getBool();break;case u:h.hasM=m.getBool();break;case y:h.transform=m.processMessage(F);break;case l:h.exceededTransferLimit=m.getBool();break;case f:t.addField(h,m.processMessage(b));break;case d:S||(t.prepareFeatures(h),S=!0),t.addFeature(h,m.processMessageWithArgs(T,t,h,h.fields));break;case r:h.uniqueIdField=m.processMessage(k);break;default:m.skip()}return t.finishFeatureResult(h),h}function U(e,t){const s=1,r=4,a={};let n=null;for(;e.next();)switch(e.tag()){case r:n=e.processMessageWithArgs(f);break;case s:a.featureResult=e.processMessageWithArgs(S,t);break;default:e.skip()}return null!=n&&a.featureResult&&t.addQueryGeometry(a,n),a}function w(e,r){try{const t=2,a=new s(new Uint8Array(e),new DataView(e)),n={};for(;a.next();)if(a.tag()===t)n.queryResult=a.processMessageWithArgs(U,r);else a.skip();return n}catch(a){throw new t("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:a})}}e.parseFeatureQuery=w,e.parseField=b,e.parseFieldType=c,e.parseTransform=F,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
