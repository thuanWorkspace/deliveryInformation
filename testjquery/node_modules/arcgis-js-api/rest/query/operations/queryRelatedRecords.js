/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../request","../../../geometry/support/spatialReferenceUtils","../../operations/urlUtils"],(function(e,t,o,r){"use strict";function s(e,t){const r=e.toJSON();return r.objectIds&&(r.objectIds=r.objectIds.join(",")),r.orderByFields&&(r.orderByFields=r.orderByFields.join(",")),r.outFields&&!t?.returnCountOnly?r.outFields.includes("*")?r.outFields="*":r.outFields=r.outFields.join(","):delete r.outFields,r.outSR&&(r.outSR=o.srToRESTValue(r.outSR)),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}async function a(e,t,o){const r=await u(e,t,o),s=r.data,a=s.geometryType,n=s.spatialReference,d={};for(const u of s.relatedRecordGroups){const e={fields:void 0,objectIdFieldName:void 0,geometryType:a,spatialReference:n,hasZ:!!s.hasZ,hasM:!!s.hasM,features:u.relatedRecords};if(null!=u.objectId)d[u.objectId]=e;else for(const t of Object.keys(u))"relatedRecords"!==t&&(d[u[t]]=e)}return{...r,data:d}}async function n(e,t,o){const r=await u(e,t,o,{returnCountOnly:!0}),s=r.data,a={};for(const n of s.relatedRecordGroups)null!=n.objectId&&(a[n.objectId]=n.count);return{...r,data:a}}async function u(e,o,a={},n){const u=r.mapParameters({...e.query,f:"json",...n,...s(o,n)});return t(e.path+"/queryRelatedRecords",{...a,query:{...a.query,...u}})}e.executeRelationshipQuery=a,e.executeRelationshipQueryForCount=n,e.toQueryStringParameters=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
