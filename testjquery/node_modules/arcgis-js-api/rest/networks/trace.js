/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../request","../utils","./support/TraceResult"],(function(e,t,r,a){"use strict";async function s(e,a,s){const n=r.parseUrl(e),c=a.toJSON();c.traceLocations=JSON.stringify(a.traceLocations),a.resultTypes&&(c.resultTypes=JSON.stringify(a.resultTypes));const i=r.asValidOptions(n.query,{query:r.encode({...c,f:"json"}),...s}),l=`${n.path}/trace`;return t(l,i).then((e=>o(e,a.outSpatialReference)))}async function n(e,a,s){const n=r.parseUrl(e),o=a.toJSON();o.traceLocations=JSON.stringify(a.traceLocations),a.resultTypes&&(o.resultTypes=JSON.stringify(a.resultTypes));const c=r.asValidOptions(n.query,{query:r.encode({...o,async:!0,f:"json"}),...s}),i=`${n.path}/trace`,{data:l}=await t(i,c);return l.statusUrl}function o(e,t){const{data:r}=e,s=a.fromJSON(r.traceResults);return s.aggregatedGeometry&&t&&(s.aggregatedGeometry.line&&(s.aggregatedGeometry.line.spatialReference=t.clone()),s.aggregatedGeometry.multipoint&&(s.aggregatedGeometry.multipoint.spatialReference=t.clone()),s.aggregatedGeometry.polygon&&(s.aggregatedGeometry.polygon.spatialReference=t.clone())),s}e.submitTraceJob=n,e.trace=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
