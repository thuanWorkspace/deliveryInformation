/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","./types"],(function(t,n){"use strict";function e(t,n){return!!n&&(n.loc.end.line===t.loc.start.line&&n.loc.end.column<=t.loc.start.column)}function s(t,n){return t.range[0]>=n.range[0]&&t.range[1]<=n.range[1]}class i{constructor(){this.comments=[],this._nodeStack=[],this._newComments=[]}insertInnerComments(t){if(!n.isBlockStatement(t)||0!==t.body.length)return;const e=[];for(let n=this._newComments.length-1;n>=0;--n){const s=this._newComments[n];t.range[1]>=s.range[0]&&(e.unshift(s),this._newComments.splice(n,1))}e.length&&(t.innerComments=e)}attachTrailingComments(t){if(!t)return;const i=this._nodeStack[this._nodeStack.length-1];if(n.isBlockStatement(t)&&s(i,t))for(let n=this._newComments.length-1;n>=0;--n){const e=this._newComments[n];s(e,t)&&(i.trailingComments=[...i.trailingComments??[],e],this._newComments.splice(n,1))}let m=[];if(this._newComments.length>0)for(let n=this._newComments.length-1;n>=0;--n){const s=this._newComments[n];e(s,i)?(i.trailingComments=[...i.trailingComments??[],s],this._newComments.splice(n,1)):e(s,t)&&(m.unshift(s),this._newComments.splice(n,1))}if(i?.trailingComments){e(i.trailingComments[0],t)&&(m=[...m,...i.trailingComments],delete i.trailingComments)}m.length>0&&(t.trailingComments=m)}attachLeadingComments(t){if(!t)return;let e;for(;this._nodeStack.length>0;){const n=this._nodeStack[this._nodeStack.length-1];if(!(t.range[0]<=n.range[0]))break;e=n,this._nodeStack.pop()}const s=[],i=[];if(e){for(let m=(e.leadingComments?.length??0)-1;m>=0;--m){const o=e.leadingComments[m];t.range[0]>=o.range[1]?(s.unshift(o),e.leadingComments.splice(m,1)):n.isVariableDeclarator(t)&&!n.isBlockComment(o)&&(i.unshift(o),e.leadingComments.splice(m,1))}return 0===e.leadingComments?.length&&delete e.leadingComments,s.length&&(t.leadingComments=s),void(i.length&&(t.trailingComments=[...i,...t.trailingComments??[]]))}for(let n=this._newComments.length-1;n>=0;--n){const e=this._newComments[n];t.range[0]>=e.range[0]&&(s.unshift(e),this._newComments.splice(n,1))}s.length&&(t.leadingComments=s)}attachComments(t){if(n.isProgram(t)&&t.body.length>0){const n=this._nodeStack[this._nodeStack.length-1];return n?(n.trailingComments=[...n.trailingComments??[],...this._newComments],this._newComments.length=0,void this._nodeStack.pop()):(t.trailingComments=[...this._newComments],void(this._newComments.length=0))}this.attachTrailingComments(t),this.attachLeadingComments(t),this.insertInnerComments(t),this._nodeStack.push(t)}collectComment(t){this.comments.push(t),this._newComments.push(t)}}t.CommentHandler=i,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
