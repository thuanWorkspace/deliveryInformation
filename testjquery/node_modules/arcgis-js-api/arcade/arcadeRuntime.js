/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","./ArcadeModule","./ArcadeModuleLoader","./Dictionary","./executionError","./Feature","./FunctionWrapper","../chunks/languageUtils","./treeAnalysis","../chunks/array","./functions/date","./functions/geometry","./functions/geomsync","./functions/maths","./functions/stats","./functions/string","../geometry/Geometry","../geometry/SpatialReference"],(function(e,r,t,o,n,i,c,a,u,s,l,d,E,f,p,x,h,w){"use strict";class m extends c.ArcadeFunction{constructor(e,r){super(),this.definition=null,this.context=null,this.definition=e,this.context=r}createFunction(e){return(...r)=>{const t={spatialReference:this.context.spatialReference,console:this.context.console,services:this.context.services,timeZone:this.context.timeZone??null,lrucache:this.context.lrucache,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter.depth+1},globalScope:this.context.globalScope};if(t.depthCounter.depth>64)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.MaximumCallDepth,null);return ee(this.definition,t,r,null)}}call(e,r){return b(e,r,((t,o,i)=>{const c={spatialReference:e.spatialReference,services:e.services,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,timeZone:e.timeZone??null,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{}};if(c.depthCounter.depth>64)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.MaximumCallDepth,r);return ee(this.definition,c,i,r)}))}marshalledCall(e,r,t,o){return o(e,r,((n,i,u)=>{const s={spatialReference:e.spatialReference,globalScope:t.globalScope,services:e.services,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,timeZone:e.timeZone??null,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{}};return u=u.map((r=>!a.isFunctionParameter(r)||r instanceof c.ScopeMarshalledFunction?r:c.wrapModuleScopedResponse(r,e,o))),c.wrapModuleScopedResponse(ee(this.definition,s,u,r),t,o)}))}}class g extends r.ArcadeModule{constructor(e){super(e)}global(e){const r=this.executingContext.globalScope[e.toLowerCase()];if(r.valueset||(r.value=y(this.executingContext,r.node),r.valueset=!0),a.isFunctionParameter(r.value)&&!(r.value instanceof c.ScopeMarshalledFunction)){const e=new c.ScopeMarshalledFunction;e.fn=r.value,e.parameterEvaluator=b,e.context=this.executingContext,r.value=e}return r.value}setGlobal(e,r){if(a.isFunctionParameter(r))throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.AssignModuleFunction,null);this.executingContext.globalScope[e.toLowerCase()]={value:r,valueset:!0,node:null}}hasGlobal(e){return void 0===this.executingContext.exports[e]&&(e=e.toLowerCase()),void 0!==this.executingContext.exports[e]}loadModule(e){let r=e.spatialReference;null==r&&(r=new w({wkid:102100})),this.moduleScope=te({},e.customfunctions,e.timeZone),this.executingContext={spatialReference:r,globalScope:this.moduleScope,localScope:null,libraryResolver:new t.ArcadeModuleLoader(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},services:e.services,console:e.console??ne,timeZone:e.timeZone??null,lrucache:e.lrucache,interceptor:e.interceptor,depthCounter:{depth:1}},y(this.executingContext,this.source.syntax)}}function v(e,r){const t=[];for(let o=0;o<r.arguments.length;o++)t.push(y(e,r.arguments[o]));return t}function b(e,r,t){try{return!0===r.preparsed?t(e,null,r.arguments):t(e,r,v(e,r))}catch(o){throw o}}function y(e,r){try{switch(r?.type){case"EmptyStatement":return a.voidOperation;case"VariableDeclarator":return U(e,r);case"VariableDeclaration":return T(e,r);case"ImportDeclaration":return D(e,r);case"ExportNamedDeclaration":return K(e,r);case"BlockStatement":case"Program":return L(e,r);case"FunctionDeclaration":return q(e,r);case"ReturnStatement":return P(e,r);case"IfStatement":return B(e,r);case"ExpressionStatement":return k(e,r);case"AssignmentExpression":return M(e,r);case"UpdateExpression":return I(e,r);case"BreakStatement":return a.breakResult;case"ContinueStatement":return a.continueResult;case"TemplateElement":return _(e,r);case"TemplateLiteral":return H(e,r);case"ForStatement":return R(e,r);case"ForInStatement":return S(e,r);case"WhileStatement":return F(e,r);case"Identifier":return Y(e,r);case"MemberExpression":return Z(e,r);case"Literal":return r.value;case"CallExpression":return J(e,r);case"UnaryExpression":return G(e,r);case"BinaryExpression":return j(e,r);case"LogicalExpression":return V(e,r);case"ArrayExpression":return W(e,r);case"ObjectExpression":return A(e,r);case"Property":return C(e,r);default:throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.Unrecognized,r)}}catch(t){throw n.ensureArcadeExecutionError(e,r,t)}}function A(e,r){const t={},i=new Map;for(let o=0;o<r.properties.length;o++){const c=y(e,r.properties[o]);if(a.isFunctionParameter(c.value))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.NoFunctionInDictionary,r);if(!1===a.isString(c.key))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.KeyMustBeString,r);let u=c.key.toString();const s=u.toLowerCase();i.has(s)?u=i.get(s):i.set(s,u),c.value===a.voidOperation?t[u]=null:t[u]=c.value}const c=new o(t);return c.immutable=!1,c}function C(e,r){return{key:"Identifier"===r.key.type?r.key.name:y(e,r.key),value:y(e,r.value)}}function S(e,r){const t=y(e,r.right);"VariableDeclaration"===r.left.type&&y(e,r.left);let i=null,c="";if("VariableDeclaration"===r.left.type){const e=r.left.declarations[0].id;"Identifier"===e.type&&(c=e.name)}else"Identifier"===r.left.type&&(c=r.left.name);if(!c)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidIdentifier,r);if(c=c.toLowerCase(),null!=e.localScope&&void 0!==e.localScope[c]&&(i=e.localScope[c]),null===i&&void 0!==e.globalScope[c]&&(i=e.globalScope[c]),null===i)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidIdentifier,r);if(a.isArray(t)||a.isString(t)){const o=t.length;for(let t=0;t<o;t++){i.value=t;const o=y(e,r.body);if(o===a.breakResult)break;if(o instanceof a.ReturnResult)return o}return a.voidOperation}if(a.isImmutableArray(t)){for(let o=0;o<t.length();o++){i.value=o;const t=y(e,r.body);if(t===a.breakResult)break;if(t instanceof a.ReturnResult)return t}return a.voidOperation}if(!(t instanceof o||a.isFeature(t)))return a.voidOperation;{const o=t.keys();for(let t=0;t<o.length;t++){i.value=o[t];const n=y(e,r.body);if(n===a.breakResult)break;if(n instanceof a.ReturnResult)return n}}}function R(e,r){null!==r.init&&y(e,r.init);const t={testResult:!0,lastAction:a.voidOperation};do{N(e,r,t)}while(!0===t.testResult);return t.lastAction instanceof a.ReturnResult?t.lastAction:a.voidOperation}function F(e,r){const t={testResult:!0,lastAction:a.voidOperation};if(t.testResult=y(e,r.test),!1===t.testResult)return a.voidOperation;if(!0!==t.testResult)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.BooleanConditionRequired,r);for(;!0===t.testResult&&(t.lastAction=y(e,r.body),t.lastAction!==a.breakResult)&&!(t.lastAction instanceof a.ReturnResult);)if(t.testResult=y(e,r.test),!0!==t.testResult&&!1!==t.testResult)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.BooleanConditionRequired,r);return t.lastAction instanceof a.ReturnResult?t.lastAction:a.voidOperation}function N(e,r,t){if(null!==r.test){if(t.testResult=y(e,r.test),!1===t.testResult)return;if(!0!==t.testResult)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.BooleanConditionRequired,r)}t.lastAction=y(e,r.body),t.lastAction!==a.breakResult?t.lastAction instanceof a.ReturnResult?t.testResult=!1:null!==r.update&&y(e,r.update):t.testResult=!1}function I(e,r){let t,i=null,c="";if("MemberExpression"===r.argument.type){if(i=y(e,r.argument.object),!0===r.argument.computed?c=y(e,r.argument.property):"Identifier"===r.argument.property.type&&(c=r.argument.property.name),a.isArray(i)){if(!a.isNumber(c))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.ArrayAccessorMustBeNumber,r);if(c<0&&(c=i.length+c),c<0||c>=i.length)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.OutOfBounds,r);t=a.toNumber(i[c]),i[c]="++"===r.operator?t+1:t-1}else if(i instanceof o){if(!1===a.isString(c))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0!==i.hasField(c))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.FieldNotFound,r);t=a.toNumber(i.field(c)),i.setField(c,"++"===r.operator?t+1:t-1)}else if(a.isFeature(i)){if(!1===a.isString(c))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0!==i.hasField(c))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.FieldNotFound,r);t=a.toNumber(i.field(c)),i.setField(c,"++"===r.operator?t+1:t-1)}else{if(a.isImmutableArray(i))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.Immutable,r);if(!(i instanceof g))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);if(!1===a.isString(c))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.ModuleAccessorMustBeString,r);if(!0!==i.hasGlobal(c))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.ModuleExportNotFound,r);t=a.toNumber(i.global(c)),i.setGlobal(c,"++"===r.operator?t+1:t-1)}return!1===r.prefix?t:"++"===r.operator?t+1:t-1}if(i="Identifier"===r.argument.type?r.argument.name.toLowerCase():"",!i)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidIdentifier,r);if(null!=e.localScope&&void 0!==e.localScope[i])return t=a.toNumber(e.localScope[i].value),e.localScope[i]={value:"++"===r.operator?t+1:t-1,valueset:!0,node:r},!1===r.prefix?t:"++"===r.operator?t+1:t-1;if(void 0!==e.globalScope[i])return t=a.toNumber(e.globalScope[i].value),e.globalScope[i]={value:"++"===r.operator?t+1:t-1,valueset:!0,node:r},!1===r.prefix?t:"++"===r.operator?t+1:t-1;throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidIdentifier,r)}function O(e,r,t,o,i){switch(r){case"=":return e===a.voidOperation?null:e;case"/=":return a.toNumber(t)/a.toNumber(e);case"*=":return a.toNumber(t)*a.toNumber(e);case"-=":return a.toNumber(t)-a.toNumber(e);case"+=":return a.isString(t)||a.isString(e)?a.toString(t)+a.toString(e):a.toNumber(t)+a.toNumber(e);case"%=":return a.toNumber(t)%a.toNumber(e);default:throw new n.ArcadeExecutionError(i,n.ExecutionErrorCodes.UnsupportedOperator,o)}}function M(e,r){let t=null,i="";if("MemberExpression"===r.left.type){if(t=y(e,r.left.object),!0===r.left.computed)i=y(e,r.left.property);else{if("Identifier"!==r.left.property.type)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidIdentifier,r);i=r.left.property.name}const c=y(e,r.right);if(a.isArray(t)){if(!a.isNumber(i))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.ArrayAccessorMustBeNumber,r);if(i<0&&(i=t.length+i),i<0||i>t.length)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.OutOfBounds,r);if(i===t.length){if("="!==r.operator)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.OutOfBounds,r);t[i]=O(c,r.operator,t[i],r,e)}else t[i]=O(c,r.operator,t[i],r,e)}else if(t instanceof o){if(!1===a.isString(i))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0===t.hasField(i))t.setField(i,O(c,r.operator,t.field(i),r,e));else{if("="!==r.operator)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.FieldNotFound,r,{key:i});t.setField(i,O(c,r.operator,null,r,e))}}else if(a.isFeature(t)){if(!1===a.isString(i))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0===t.hasField(i))t.setField(i,O(c,r.operator,t.field(i),r,e));else{if("="!==r.operator)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.FieldNotFound,r,{key:i});t.setField(i,O(c,r.operator,null,r,e))}}else{if(a.isImmutableArray(t))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.Immutable,r);if(!(t instanceof g))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidIdentifier,r);if(!1===a.isString(i))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.ModuleAccessorMustBeString,r);if(!0!==t.hasGlobal(i))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.ModuleExportNotFound,r);t.setGlobal(i,O(c,r.operator,t.global(i),r,e))}return a.voidOperation}t=r.left.name.toLowerCase();const c=y(e,r.right);if(null!=e.localScope&&void 0!==e.localScope[t])return e.localScope[t]={value:O(c,r.operator,e.localScope[t].value,r,e),valueset:!0,node:r.right},a.voidOperation;if(void 0!==e.globalScope[t])return e.globalScope[t]={value:O(c,r.operator,e.globalScope[t].value,r,e),valueset:!0,node:r.right},a.voidOperation;throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidIdentifier,r)}function k(e,r){if("AssignmentExpression"===r.expression.type||"UpdateExpression"===r.expression.type)return y(e,r.expression);if("CallExpression"===r.expression.type){const t=y(e,r.expression);return t===a.voidOperation?a.voidOperation:new a.ImplicitResult(t)}{const t=y(e,r.expression);return t===a.voidOperation?a.voidOperation:new a.ImplicitResult(t)}}function B(e,r){const t=y(e,r.test);if(!0===t)return y(e,r.consequent);if(!1===t)return null!==r.alternate?y(e,r.alternate):a.voidOperation;throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.BooleanConditionRequired,r)}function L(e,r){let t=a.voidOperation;for(let o=0;o<r.body.length;o++)if(t=y(e,r.body[o]),t instanceof a.ReturnResult||t===a.breakResult||t===a.continueResult)return t;return t}function P(e,r){if(null===r.argument)return new a.ReturnResult(a.voidOperation);const t=y(e,r.argument);return new a.ReturnResult(t)}function q(e,r){const t=r.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new m(r,e)},a.voidOperation}function D(e,r){const t=r.specifiers[0].local.name.toLowerCase(),o=e.libraryResolver.loadLibrary(t);let n=null;return e.libraryResolver._moduleSingletons?.has(o.uri)?n=e.libraryResolver._moduleSingletons.get(o.uri):(n=new g(o),n.loadModule(e),e.libraryResolver._moduleSingletons?.set(o.uri,n)),e.globalScope[t]={value:n,valueset:!0,node:r},a.voidOperation}function K(e,r){if(y(e,r.declaration),"FunctionDeclaration"===r.declaration.type)e.exports[r.declaration.id.name.toLowerCase()]="function";else if("VariableDeclaration"===r.declaration.type)for(const t of r.declaration.declarations)e.exports[t.id.name.toLowerCase()]="variable";return a.voidOperation}function T(e,r){for(let t=0;t<r.declarations.length;t++)y(e,r.declarations[t]);return a.voidOperation}function U(e,r){let t=null===r.init?null:y(e,r.init);if(t===a.voidOperation&&(t=null),"Identifier"!==r.id.type)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidIdentifier,r);const o=r.id.name.toLowerCase();return null!=e.localScope?e.localScope[o]={value:t,valueset:!0,node:r.init}:e.globalScope[o]={value:t,valueset:!0,node:r.init},a.voidOperation}function Z(e,r){try{const t=y(e,r.object);if(null===t)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.MemberOfNull,r);if(!1===r.computed){if("Identifier"===r.property.type){if(t instanceof o||a.isFeature(t))return t.field(r.property.name);if(t instanceof h)return d.geometryMember(t,r.property.name,r,e);if(t instanceof g){if(!t.hasGlobal(r.property.name))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidIdentifier,r);return t.global(r.property.name)}}throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidMemberAccessKey,r)}{let i=y(e,r.property);if(t instanceof o||a.isFeature(t)){if(a.isString(i))return t.field(i);throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(t instanceof g){if(a.isString(i))return t.global(i);throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(t instanceof h){if(a.isString(i))return d.geometryMember(t,i,r,e);throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(a.isArray(t)){if(a.isNumber(i)&&isFinite(i)&&Math.floor(i)===i){if(i<0&&(i=t.length+i),i>=t.length||i<0)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.OutOfBounds,r);return t[i]}throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(a.isString(t)){if(a.isNumber(i)&&isFinite(i)&&Math.floor(i)===i){if(i<0&&(i=t.length+i),i>=t.length||i<0)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.OutOfBounds,r);return t[i]}throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(a.isImmutableArray(t)){if(a.isNumber(i)&&isFinite(i)&&Math.floor(i)===i){if(i<0&&(i=t.length()+i),i>=t.length()||i<0)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.OutOfBounds,r);return t.get(i)}throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidMemberAccessKey,r)}throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidMemberAccessKey,r)}}catch(t){throw t}}function G(e,r){try{const t=y(e,r.argument);if(a.isBoolean(t)){if("!"===r.operator)return!t;if("-"===r.operator)return-1*a.toNumber(t);if("+"===r.operator)return 1*a.toNumber(t);if("~"===r.operator)return~a.toNumber(t);throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.UnsupportedUnaryOperator,r)}if("~"===r.operator)return~a.toNumber(t);if("-"===r.operator)return-1*a.toNumber(t);if("+"===r.operator)return 1*a.toNumber(t);throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.UnsupportedUnaryOperator,r)}catch(t){throw t}}function W(e,r){try{const t=[];for(let o=0;o<r.elements.length;o++){const i=y(e,r.elements[o]);if(a.isFunctionParameter(i))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.NoFunctionInArray,r);i===a.voidOperation?t.push(null):t.push(i)}return t}catch(t){throw t}}function j(e,r){try{const t=[y(e,r.left),y(e,r.right)],o=t[0],i=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return a.binaryOperator(a.toNumber(o),a.toNumber(i),r.operator);case"==":return a.equalityTest(o,i);case"!=":return!a.equalityTest(o,i);case"<":case">":case"<=":case">=":return a.greaterThanLessThan(o,i,r.operator);case"+":return a.isString(o)||a.isString(i)?a.toString(o)+a.toString(i):a.toNumber(o)+a.toNumber(i);case"-":return a.toNumber(o)-a.toNumber(i);case"*":return a.toNumber(o)*a.toNumber(i);case"/":return a.toNumber(o)/a.toNumber(i);case"%":return a.toNumber(o)%a.toNumber(i);default:throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.UnsupportedOperator,r)}}catch(t){throw t}}function V(e,r){try{const t=y(e,r.left);if(a.isBoolean(t))switch(r.operator){case"||":if(!0===t)return t;{const t=y(e,r.right);if(a.isBoolean(t))return t;throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.LogicExpressionOrAnd,r)}case"&&":if(!1===t)return t;{const t=y(e,r.right);if(a.isBoolean(t))return t;throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.LogicExpressionOrAnd,r)}default:throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.LogicExpressionOrAnd,r)}throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.LogicalExpressionOnlyBoolean,r)}catch(t){throw t}}function _(e,r){return r.value?r.value.cooked:""}function z(e,r,t){if(a.isFunctionParameter(e))throw new n.ArcadeExecutionError(r,n.ExecutionErrorCodes.NoFunctionInTemplateLiteral,t);return e}function H(e,r){let t="",o=0;for(const n of r.quasis)if(t+=n.value?n.value.cooked:"",!1===n.tail){t+=r.expressions[o]?a.toString(z(y(e,r.expressions[o]),e,r)):"",o++}return t}function Y(e,r){let t;try{const o=r.name.toLowerCase();if(null!=e.localScope&&void 0!==e.localScope[o])return t=e.localScope[o],!0===t.valueset||(t.value=y(e,t.node),t.valueset=!0),t.value;if(void 0!==e.globalScope[o])return t=e.globalScope[o],!0===t.valueset||(t.value=y(e,t.node),t.valueset=!0),t.value;throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidIdentifier,r)}catch(o){throw o}}function J(e,r){try{if("MemberExpression"===r.callee.type){const t=y(e,r.callee.object);if(!(t instanceof g))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.FunctionNotFound,r);const o=!1===r.callee.computed?r.callee.property.name:y(e,r.callee.property);if(!t.hasGlobal(o))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.FunctionNotFound,r);const i=t.global(o);if(!a.isFunctionParameter(i))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.CallNonFunction,r);return i.call(e,r)}if("Identifier"!==r.callee.type)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.FunctionNotFound,r);if(null!=e.localScope&&void 0!==e.localScope[r.callee.name.toLowerCase()]){const t=e.localScope[r.callee.name.toLowerCase()];if(a.isFunctionParameter(t.value))return t.value.call(e,r);throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.CallNonFunction,r)}if(void 0!==e.globalScope[r.callee.name.toLowerCase()]){const t=e.globalScope[r.callee.name.toLowerCase()];if(a.isFunctionParameter(t.value))return t.value.call(e,r);throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.CallNonFunction,r)}throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.FunctionNotFound,r)}catch(t){throw t}}const Q={};function X(e,r,t,o){try{const n=r.arguments,i=y(e,n[t]);if(a.equalityTest(i,o))return y(e,n[t+1]);{const i=n.length-t;return 1===i?y(e,n[t]):2===i?null:3===i?y(e,n[t+2]):X(e,r,t+2,o)}}catch(n){throw n}}function $(e,r,t,o){try{const i=r.arguments;if(!0===o)return y(e,i[t+1]);if(3===i.length-t)return y(e,i[t+2]);{const o=y(e,i[t+2]);if(!1===a.isBoolean(o))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.BooleanConditionRequired,i[t+2]);return $(e,r,t+2,o)}}catch(i){throw i}}function ee(e,r,t,o){try{const i=e.body;if(t.length!==e.params.length)throw new n.ArcadeExecutionError(r,n.ExecutionErrorCodes.WrongNumberOfParameters,o);if(null!=r.localScope)for(let o=0;o<t.length;o++)r.localScope[e.params[o].name.toLowerCase()]={value:t[o],valueset:!0,node:null};const c=y(r,i);if(c instanceof a.ReturnResult)return c.value;if(c===a.breakResult)throw new n.ArcadeExecutionError(r,n.ExecutionErrorCodes.UnexpectedToken,o);if(c===a.continueResult)throw new n.ArcadeExecutionError(r,n.ExecutionErrorCodes.UnexpectedToken,o);return c instanceof a.ImplicitResult?c.value:c}catch(i){throw i}}l.registerFunctions(Q,b),x.registerFunctions(Q,b),f.registerFunctions(Q,b),d.registerFunctions(Q,b),p.registerFunctions(Q,b),E.registerFunctions(Q,b),Q.iif=function(e,r){try{const t=r.arguments;a.pcCheck(null===t?[]:t,3,3,e,r);const o=y(e,t[0]);if(!1===a.isBoolean(o))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.BooleanConditionRequired,r);return y(e,!0===o?t[1]:t[2])}catch(t){throw t}},Q.decode=function(e,r){try{const t=r.arguments;if(t.length<2)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongNumberOfParameters,r);if(2===t.length)return y(e,t[1]);{if((t.length-1)%2==0)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongNumberOfParameters,r);const o=y(e,t[0]);return X(e,r,1,o)}}catch(t){throw t}},Q.when=function(e,r){try{const t=r.arguments;if(t.length<3)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongNumberOfParameters,r);if(t.length%2==0)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongNumberOfParameters,r);const o=y(e,t[0]);if(!1===a.isBoolean(o))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.BooleanConditionRequired,t[0]);return $(e,r,0,o)}catch(t){throw t}};for(const ae in Q)Q[ae]={value:new c.NativeFunction(Q[ae]),valueset:!0,node:null};const re=function(){};function te(e,r,t){const n=new re;e||(e={}),r||(r={});const a=new o({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});a.immutable=!1,n.textformatting={value:a,valueset:!0,node:null};for(const o in r)n[o]={value:new c.NativeFunction(r[o]),native:!0,valueset:!0,node:null};for(const o in e)e[o]&&"esri.Graphic"===e[o].declaredClass?n[o]={value:i.createFromGraphic(e[o],t),valueset:!0,node:null}:n[o]={value:e[o],valueset:!0,node:null};return n}re.prototype=Q,re.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},re.prototype.pi={value:Math.PI,valueset:!0,node:null};const oe={fixSpatialReference:a.fixSpatialReference,parseArguments:v,standardFunction:b};function ne(e){console.log(e)}function ie(e){const r={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:b,evaluateIdentifier:Y};for(let t=0;t<e.length;t++)e[t].registerFunctions(r);for(const t in r.functions)Q[t]={value:new c.NativeFunction(r.functions[t]),valueset:!0,node:null},re.prototype[t]=Q[t];for(let t=0;t<r.signatures.length;t++)u.addFunctionDeclaration(r.signatures[t],"sync")}function ce(e,r){let o=r.spatialReference;null==o&&(o=new w({wkid:102100}));let i=null;e.usesModules&&(i=new t.ArcadeModuleLoader(new Map,e.loadedModules));const c={spatialReference:o,globalScope:te(r.vars,r.customfunctions,r.timeZone),localScope:null,services:r.services??null,exports:{},libraryResolver:i,console:r.console??ne,timeZone:r.timeZone??null,lrucache:r.lrucache,interceptor:r.interceptor,depthCounter:{depth:1}};let u=y(c,e);if(u instanceof a.ReturnResult&&(u=u.value),u instanceof a.ImplicitResult&&(u=u.value),u===a.voidOperation&&(u=null),u===a.breakResult)throw new n.ArcadeExecutionError(c,n.ExecutionErrorCodes.IllegalResult,null);if(u===a.continueResult)throw new n.ArcadeExecutionError(c,n.ExecutionErrorCodes.IllegalResult,null);if(a.isFunctionParameter(u))throw new n.ArcadeExecutionError(c,n.ExecutionErrorCodes.IllegalResult,null);return u}ie([s.ArrayFunctions]),e.executeScript=ce,e.extend=ie,e.functionHelper=oe,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
