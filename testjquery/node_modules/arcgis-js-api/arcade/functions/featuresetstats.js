/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../ArcadeDate","../executionError","../../chunks/languageUtils","./fieldStats","../../core/sql/SqlTimestampOffset","../../core/sql/WhereClause"],(function(t,e,n,a,r,i,u){"use strict";async function c(t,e,n,i,c,d){if(1===i.length){if(a.isArray(i[0]))return r.calculateStat(t,i[0],a.defaultUndefined(i[1],-1));if(a.isImmutableArray(i[0]))return r.calculateStat(t,i[0].toArray(),a.defaultUndefined(i[1],-1))}else if(2===i.length){if(a.isArray(i[0]))return r.calculateStat(t,i[0],a.defaultUndefined(i[1],-1));if(a.isImmutableArray(i[0]))return r.calculateStat(t,i[0].toArray(),a.defaultUndefined(i[1],-1));if(a.isFeatureSet(i[0])){const n=await i[0].load(),r=await o(u.WhereClause.create(i[1],n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC),d,c);return s(c,await i[0].calculateStatistic(t,r,a.defaultUndefined(i[2],1e3),e.abortSignal))}}else if(3===i.length&&a.isFeatureSet(i[0])){const n=await i[0].load(),r=await o(u.WhereClause.create(i[1],n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC),d,c);return s(c,await i[0].calculateStatistic(t,r,a.defaultUndefined(i[2],1e3),e.abortSignal))}return r.calculateStat(t,i,-1)}function s(t,n){return n instanceof i.SqlTimeStampOffset?e.ArcadeDate.fromReaderAsTimeStampOffset(n.toStorageFormat()):n instanceof Date?e.ArcadeDate.dateJSAndZoneToArcadeDate(n,a.defaultTimeZone(t)):n}async function o(t,e,n){const a=t.getVariables();if(a.length>0){const r=[];for(let t=0;t<a.length;t++){const i={name:a[t]};r.push(await e.evaluateIdentifier(n,i))}const i={};for(let t=0;t<a.length;t++)i[a[t]]=r[t];return t.parameters=i,t}return t}function d(t){"async"===t.mode&&(t.functions.stdev=function(e,n){return t.standardFunctionAsync(e,n,((n,a,r)=>c("stdev",n,a,r,e,t)))},t.functions.variance=function(e,n){return t.standardFunctionAsync(e,n,((n,a,r)=>c("variance",n,a,r,e,t)))},t.functions.average=function(e,n){return t.standardFunctionAsync(e,n,((n,a,r)=>c("mean",n,a,r,e,t)))},t.functions.mean=function(e,n){return t.standardFunctionAsync(e,n,((n,a,r)=>c("mean",n,a,r,e,t)))},t.functions.sum=function(e,n){return t.standardFunctionAsync(e,n,((n,a,r)=>c("sum",n,a,r,e,t)))},t.functions.min=function(e,n){return t.standardFunctionAsync(e,n,((n,a,r)=>c("min",n,a,r,e,t)))},t.functions.max=function(e,n){return t.standardFunctionAsync(e,n,((n,a,r)=>c("max",n,a,r,e,t)))},t.functions.count=function(e,r){return t.standardFunctionAsync(e,r,((t,i,u)=>{if(a.pcCheck(u,1,1,e,r),a.isFeatureSet(u[0]))return u[0].count(t.abortSignal);if(a.isArray(u[0])||a.isString(u[0]))return u[0].length;if(a.isImmutableArray(u[0]))return u[0].length();throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r)}))})}t.registerFunctions=d,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
