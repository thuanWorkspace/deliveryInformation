/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../kernel","../ArcadePortal","../Dictionary","../executionError","../kernel","../../chunks/languageUtils","../portalUtils","./centroid","../../core/unitUtils","../../geometry/Extent","../../geometry/Geometry","../../geometry/geometryEngineAsync","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/jsonUtils","../../portal/Portal","../../portal/support/utils"],(function(e,n,r,t,o,a,i,c,u,s,l,d,f,E,m,y,C,h,x,A){"use strict";function w(e){return 0===n.version.indexOf("4.")?y.fromExtent(e):new y({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function p(e,n,r){if(i.pcCheck(e,2,2,n,r),e[0]instanceof d&&e[1]instanceof d);else if(e[0]instanceof d&&null===e[1]);else if(e[1]instanceof d&&null===e[0]);else if(null!==e[0]||null!==e[1])throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r)}async function g(e,n){if("polygon"!==e.type&&"polyline"!==e.type&&"extent"!==e.type)return 0;let r=1;if(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid){r=u.getMetersPerVerticalUnitForSR(e.spatialReference)/s.getMetersPerUnitForSR(e.spatialReference)}let t=0;if("polyline"===e.type)for(const a of e.paths)for(let e=1;e<a.length;e++)t+=u.segmentLength3d(a[e],a[e-1],r);else if("polygon"===e.type)for(const a of e.rings){for(let e=1;e<a.length;e++)t+=u.segmentLength3d(a[e],a[e-1],r);(a[0][0]!==a[a.length-1][0]||a[0][1]!==a[a.length-1][1]||void 0!==a[0][2]&&a[0][2]!==a[a.length-1][2])&&(t+=u.segmentLength3d(a[0],a[a.length-1],r))}else"extent"===e.type&&(t+=2*u.segmentLength3d([e.xmin,e.ymin,0],[e.xmax,e.ymin,0],r),t+=2*u.segmentLength3d([e.xmin,e.ymin,0],[e.xmin,e.ymax,0],r),t*=2,t+=4*Math.abs(i.defaultUndefined(e.zmax,0)*r-i.defaultUndefined(e.zmin,0)*r));const o=new C({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:[[0,0],[0,t]]});return f.planarLength(o,n)}function v(e){"async"===e.mode&&(e.functions.disjoint=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(p(o=i.autoCastFeatureToGeometry(o),n,r),null===o[0]||null===o[1]||f.disjoint(o[0],o[1]))))},e.functions.intersects=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(p(o=i.autoCastFeatureToGeometry(o),n,r),null!==o[0]&&null!==o[1]&&f.intersects(o[0],o[1]))))},e.functions.touches=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(p(o=i.autoCastFeatureToGeometry(o),n,r),null!==o[0]&&null!==o[1]&&f.touches(o[0],o[1]))))},e.functions.crosses=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(p(o=i.autoCastFeatureToGeometry(o),n,r),null!==o[0]&&null!==o[1]&&f.crosses(o[0],o[1]))))},e.functions.within=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(p(o=i.autoCastFeatureToGeometry(o),n,r),null!==o[0]&&null!==o[1]&&f.within(o[0],o[1]))))},e.functions.contains=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(p(o=i.autoCastFeatureToGeometry(o),n,r),null!==o[0]&&null!==o[1]&&f.contains(o[0],o[1]))))},e.functions.overlaps=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(p(o=i.autoCastFeatureToGeometry(o),n,r),null!==o[0]&&null!==o[1]&&f.overlaps(o[0],o[1]))))},e.functions.equals=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(i.pcCheck(o,2,2,n,r),o[0]===o[1]||(o[0]instanceof d&&o[1]instanceof d?f.equals(o[0],o[1]):(i.isDate(o[0])&&i.isDate(o[1])||!!(i.isTime(o[0])&&i.isTime(o[1])||i.isDateOnly(o[0])&&i.isDateOnly(o[1])))&&o[0].equals(o[1])))))},e.functions.relate=function(n,r){return e.standardFunctionAsync(n,r,((e,t,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,3,3,n,r),a[0]instanceof d&&a[1]instanceof d)return f.relate(a[0],a[1],i.toString(a[2]));if(a[0]instanceof d&&null===a[1])return!1;if(a[1]instanceof d&&null===a[0])return!1;if(null===a[0]&&null===a[1])return!1;throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r)}))},e.functions.intersection=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(p(o=i.autoCastFeatureToGeometry(o),n,r),null===o[0]||null===o[1]?null:f.intersect(o[0],o[1]))))},e.functions.union=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{const u=[];if(0===(c=i.autoCastFeatureToGeometry(c)).length)throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.WrongNumberOfParameters,r);if(1===c.length)if(i.isArray(c[0])){const e=i.autoCastFeatureToGeometry(c[0]);for(let t=0;t<e.length;t++)if(null!==e[t]){if(!(e[t]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);u.push(e[t])}}else{if(!i.isImmutableArray(c[0])){if(c[0]instanceof d)return i.fixSpatialReference(a.cloneGeometry(c[0]),n.spatialReference);if(null===c[0])return null;throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r)}{const e=i.autoCastFeatureToGeometry(c[0].toArray());for(let t=0;t<e.length;t++)if(null!==e[t]){if(!(e[t]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);u.push(e[t])}}}else for(let a=0;a<c.length;a++)if(null!==c[a]){if(!(c[a]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);u.push(c[a])}return 0===u.length?null:f.union(u)}))},e.functions.difference=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(p(o=i.autoCastFeatureToGeometry(o),n,r),null!==o[0]&&null===o[1]?a.cloneGeometry(o[0]):null===o[0]?null:f.difference(o[0],o[1]))))},e.functions.symmetricdifference=function(n,r){return e.standardFunctionAsync(n,r,((e,t,o)=>(p(o=i.autoCastFeatureToGeometry(o),n,r),null===o[0]&&null===o[1]?null:null===o[0]?a.cloneGeometry(o[1]):null===o[1]?a.cloneGeometry(o[0]):f.symmetricDifference(o[0],o[1]))))},e.functions.clip=function(n,r){return e.standardFunctionAsync(n,r,((e,t,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,2,2,n,r),!(a[1]instanceof l)&&null!==a[1])throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(null===a[0])return null;if(!(a[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return null===a[1]?null:f.clip(a[0],a[1])}))},e.functions.cut=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,2,n,r),!(c[1]instanceof C)&&null!==c[1])throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(null===c[0])return[];if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return null===c[1]?[a.cloneGeometry(c[0])]:f.cut(c[0],c[1])}))},e.functions.area=function(n,r){return e.standardFunctionAsync(n,r,(async(e,t,c)=>{if(i.pcCheck(c,1,2,n,r),null===(c=i.autoCastFeatureToGeometry(c))[0])return 0;if(i.isFeatureSet(c[0])){const e=await c[0].sumArea(a.convertSquareUnitsToCode(i.defaultUndefined(c[1],-1)),!1,n.abortSignal);if(n.abortSignal.aborted)throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.Cancelled,r);return e}if(i.isArray(c[0])||i.isImmutableArray(c[0])){const e=i.autoCastArrayOfPointsToPolygon(c[0],n.spatialReference);return null===e?0:f.planarArea(e,a.convertSquareUnitsToCode(i.defaultUndefined(c[1],-1)))}if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return f.planarArea(c[0],a.convertSquareUnitsToCode(i.defaultUndefined(c[1],-1)))}))},e.functions.areageodetic=function(n,r){return e.standardFunctionAsync(n,r,(async(e,t,c)=>{if(i.pcCheck(c,1,2,n,r),null===(c=i.autoCastFeatureToGeometry(c))[0])return 0;if(i.isFeatureSet(c[0])){const e=await c[0].sumArea(a.convertSquareUnitsToCode(i.defaultUndefined(c[1],-1)),!0,n.abortSignal);if(n.abortSignal.aborted)throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.Cancelled,r);return e}if(i.isArray(c[0])||i.isImmutableArray(c[0])){const e=i.autoCastArrayOfPointsToPolygon(c[0],n.spatialReference);return null===e?0:f.geodesicArea(e,a.convertSquareUnitsToCode(i.defaultUndefined(c[1],-1)))}if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return f.geodesicArea(c[0],a.convertSquareUnitsToCode(i.defaultUndefined(c[1],-1)))}))},e.functions.length=function(n,r){return e.standardFunctionAsync(n,r,(async(e,t,c)=>{if(i.pcCheck(c,1,2,n,r),null===(c=i.autoCastFeatureToGeometry(c))[0])return 0;if(i.isFeatureSet(c[0])){const e=await c[0].sumLength(a.convertLinearUnitsToCode(i.defaultUndefined(c[1],-1)),!1,n.abortSignal);if(n.abortSignal.aborted)throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.Cancelled,r);return e}if(i.isArray(c[0])||i.isImmutableArray(c[0])){const e=i.autoCastArrayOfPointsToPolyline(c[0],n.spatialReference);return null===e?0:f.planarLength(e,a.convertLinearUnitsToCode(i.defaultUndefined(c[1],-1)))}if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return f.planarLength(c[0],a.convertLinearUnitsToCode(i.defaultUndefined(c[1],-1)))}))},e.functions.length3d=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{if(i.pcCheck(c,1,2,n,r),null===(c=i.autoCastFeatureToGeometry(c))[0])return 0;if(i.isArray(c[0])||i.isImmutableArray(c[0])){const e=i.autoCastArrayOfPointsToPolyline(c[0],n.spatialReference);return null===e?0:!0===e.hasZ?g(e,a.convertLinearUnitsToCode(i.defaultUndefined(c[1],-1))):f.planarLength(e,a.convertLinearUnitsToCode(i.defaultUndefined(c[1],-1)))}if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return!0===c[0].hasZ?g(c[0],a.convertLinearUnitsToCode(i.defaultUndefined(c[1],-1))):f.planarLength(c[0],a.convertLinearUnitsToCode(i.defaultUndefined(c[1],-1)))}))},e.functions.lengthgeodetic=function(n,r){return e.standardFunctionAsync(n,r,(async(e,t,c)=>{if(i.pcCheck(c,1,2,n,r),null===(c=i.autoCastFeatureToGeometry(c))[0])return 0;if(i.isFeatureSet(c[0])){const e=await c[0].sumLength(a.convertLinearUnitsToCode(i.defaultUndefined(c[1],-1)),!0,n.abortSignal);if(n.abortSignal.aborted)throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.Cancelled,r);return e}if(i.isArray(c[0])||i.isImmutableArray(c[0])){const e=i.autoCastArrayOfPointsToPolyline(c[0],n.spatialReference);return null===e?0:f.geodesicLength(e,a.convertLinearUnitsToCode(i.defaultUndefined(c[1],-1)))}if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return f.geodesicLength(c[0],a.convertLinearUnitsToCode(i.defaultUndefined(c[1],-1)))}))},e.functions.distance=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,3,n,r);let u=c[0];(i.isArray(c[0])||i.isImmutableArray(c[0]))&&(u=i.autoCastArrayOfPointsToMultiPoint(c[0],n.spatialReference));let s=c[1];if((i.isArray(c[1])||i.isImmutableArray(c[1]))&&(s=i.autoCastArrayOfPointsToMultiPoint(c[1],n.spatialReference)),!(u instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(!(s instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return f.distance(u,s,a.convertLinearUnitsToCode(i.defaultUndefined(c[2],-1)))}))},e.functions.distancegeodetic=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,3,n,r);const u=c[0],s=c[1];if(!(u instanceof m))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(!(s instanceof m))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);const l=new C({paths:[],spatialReference:u.spatialReference});return l.addPath([u,s]),f.geodesicLength(l,a.convertLinearUnitsToCode(i.defaultUndefined(c[2],-1)))}))},e.functions.densify=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,3,n,r),null===c[0])return null;if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);const u=i.toNumber(c[1]);if(isNaN(u))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(u<=0)throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return c[0]instanceof y||c[0]instanceof C?f.densify(c[0],u,a.convertLinearUnitsToCode(i.defaultUndefined(c[2],-1))):c[0]instanceof l?f.densify(w(c[0]),u,a.convertLinearUnitsToCode(i.defaultUndefined(c[2],-1))):c[0]}))},e.functions.densifygeodetic=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,3,n,r),null===c[0])return null;if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);const u=i.toNumber(c[1]);if(isNaN(u))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(u<=0)throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return c[0]instanceof y||c[0]instanceof C?f.geodesicDensify(c[0],u,a.convertLinearUnitsToCode(i.defaultUndefined(c[2],-1))):c[0]instanceof l?f.geodesicDensify(w(c[0]),u,a.convertLinearUnitsToCode(i.defaultUndefined(c[2],-1))):c[0]}))},e.functions.generalize=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,4,n,r),null===c[0])return null;if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);const u=i.toNumber(c[1]);if(isNaN(u))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return f.generalize(c[0],u,i.toBoolean(i.defaultUndefined(c[2],!0)),a.convertLinearUnitsToCode(i.defaultUndefined(c[3],-1)))}))},e.functions.buffer=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,3,n,r),null===c[0])return null;if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);const u=i.toNumber(c[1]);if(isNaN(u))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return 0===u?a.cloneGeometry(c[0]):f.buffer(c[0],u,a.convertLinearUnitsToCode(i.defaultUndefined(c[2],-1)))}))},e.functions.buffergeodetic=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,3,n,r),null===c[0])return null;if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);const u=i.toNumber(c[1]);if(isNaN(u))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return 0===u?a.cloneGeometry(c[0]):f.geodesicBuffer(c[0],u,a.convertLinearUnitsToCode(i.defaultUndefined(c[2],-1)))}))},e.functions.offset=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,6,n,r),null===c[0])return null;if(!(c[0]instanceof y||c[0]instanceof C))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);const u=i.toNumber(c[1]);if(isNaN(u))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);const s=i.toNumber(i.defaultUndefined(c[4],10));if(isNaN(s))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);const l=i.toNumber(i.defaultUndefined(c[5],0));if(isNaN(l))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return f.offset(c[0],u,a.convertLinearUnitsToCode(i.defaultUndefined(c[2],-1)),i.toString(i.defaultUndefined(c[3],"round")).toLowerCase(),s,l)}))},e.functions.rotate=function(n,r){return e.standardFunctionAsync(n,r,((e,t,a)=>{a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,2,3,n,r);let c=a[0];if(null===c)return null;if(!(c instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);c instanceof l&&(c=y.fromExtent(c));const u=i.toNumber(a[1]);if(isNaN(u))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);const s=i.defaultUndefined(a[2],null);if(null===s)return f.rotate(c,u);if(s instanceof m)return f.rotate(c,u,s);throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r)}))},e.functions.centroid=function(n,r){return e.standardFunctionAsync(n,r,((e,t,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,1,1,n,r),null===c[0])return null;let s=c[0];if((i.isArray(c[0])||i.isImmutableArray(c[0]))&&(s=i.autoCastArrayOfPointsToMultiPoint(c[0],n.spatialReference)),null===s)return null;if(!(s instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return s instanceof m?i.fixSpatialReference(a.cloneGeometry(c[0]),n.spatialReference):s instanceof y?s.centroid:s instanceof C?u.centroidPolyline(s):s instanceof E?u.centroidMultiPoint(s):s instanceof l?s.center:null}))},e.functions.multiparttosinglepart=function(n,r){return e.standardFunctionAsync(n,r,(async(e,t,c)=>{c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,1,1,n,r);const u=[];if(null===c[0])return null;if(!(c[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(c[0]instanceof m)return[i.fixSpatialReference(a.cloneGeometry(c[0]),n.spatialReference)];if(c[0]instanceof l)return[i.fixSpatialReference(a.cloneGeometry(c[0]),n.spatialReference)];const s=await f.simplify(c[0]);if(s instanceof y){const e=[],n=[];for(let r=0;r<s.rings.length;r++)if(s.isClockwise(s.rings[r])){const n=h.fromJSON({rings:[s.rings[r]],hasZ:!0===s.hasZ,hazM:!0===s.hasM,spatialReference:s.spatialReference.toJSON()});e.push(n)}else n.push({ring:s.rings[r],pt:s.getPoint(r,0)});for(let r=0;r<n.length;r++)for(let t=0;t<e.length;t++)if(e[t].contains(n[r].pt)){e[t].addRing(n[r].ring);break}return e}if(s instanceof C){const e=[];for(let n=0;n<s.paths.length;n++){const r=h.fromJSON({paths:[s.paths[n]],hasZ:!0===s.hasZ,hazM:!0===s.hasM,spatialReference:s.spatialReference.toJSON()});e.push(r)}return e}if(c[0]instanceof E){const e=i.fixSpatialReference(a.cloneGeometry(c[0]),n.spatialReference);for(let n=0;n<e.points.length;n++)u.push(e.getPoint(n));return u}return null}))},e.functions.issimple=function(n,r){return e.standardFunctionAsync(n,r,((e,t,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,1,1,n,r),null===a[0])return!0;if(!(a[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return f.isSimple(a[0])}))},e.functions.simplify=function(n,r){return e.standardFunctionAsync(n,r,((e,t,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,1,1,n,r),null===a[0])return null;if(!(a[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return f.simplify(a[0])}))},e.functions.convexhull=function(n,r){return e.standardFunctionAsync(n,r,((e,t,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,1,1,n,r),null===a[0])return null;if(!(a[0]instanceof d))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);return f.convexHull(a[0])}))},e.functions.getuser=function(n,a){return e.standardFunctionAsync(n,a,(async(e,u,s)=>{i.pcCheck(s,0,2,n,a);let l=i.defaultUndefined(s[1],""),d=!0===l;if(l=!0===l||!1===l?"":i.toString(l),0===s.length||s[0]instanceof r){let e=null;e=n.services?.portal?n.services.portal:x.getDefault(),s.length>0&&(e=c.getPortal(s[0],e));const r=await A.lookupUser(e,l,d);if(r){const e=JSON.parse(JSON.stringify(r));for(const n of["lastLogin","created","modified"])void 0!==e[n]&&null!==e[n]&&(e[n]=new Date(e[n]));return t.convertObjectToArcadeDictionary(e,i.defaultTimeZone(n))}return null}let f=null;if(i.isFeatureSet(s[0])&&(f=s[0]),f){if(d=!1,l)return null;await f.load();const e=await f.getOwningSystemUrl();if(!e){if(!l){const e=await f.getIdentityUser();return e?t.convertObjectToArcadeDictionary({username:e},i.defaultTimeZone(n)):null}return null}let o=null;o=n.services?.portal?n.services.portal:x.getDefault(),o=c.getPortal(new r(e),o);const a=await A.lookupUser(o,l,d);if(a){const e=JSON.parse(JSON.stringify(a));for(const n of["lastLogin","created","modified"])void 0!==e[n]&&null!==e[n]&&(e[n]=new Date(e[n]));return t.convertObjectToArcadeDictionary(e,i.defaultTimeZone(n))}return null}throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,a)}))}),e.functions.nearestcoordinate=function(n,r){return e.standardFunctionAsync(n,r,(async(e,a,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,2,n,r),!(c[0]instanceof d||null===c[0]))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(!(c[1]instanceof m||null===c[1]))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(null===c[0]||null===c[1])return null;const u=await f.nearestCoordinate(c[0],c[1]);return null===u?null:t.convertObjectToArcadeDictionary({coordinate:u.coordinate,distance:u.distance},i.defaultTimeZone(n),!1,!0)}))},e.functions.nearestvertex=function(n,r){return e.standardFunctionAsync(n,r,(async(e,a,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,2,n,r),!(c[0]instanceof d||null===c[0]))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(!(c[1]instanceof m||null===c[1]))throw new o.ArcadeExecutionError(n,o.ExecutionErrorCodes.InvalidParameter,r);if(null===c[0]||null===c[1])return null;const u=await f.nearestVertex(c[0],c[1]);return null===u?null:t.convertObjectToArcadeDictionary({coordinate:u.coordinate,distance:u.distance},i.defaultTimeZone(n),!1,!0)}))}}e.registerFunctions=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
