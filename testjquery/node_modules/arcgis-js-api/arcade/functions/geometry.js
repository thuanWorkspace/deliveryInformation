/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../Dictionary","../executionError","../Feature","../ImmutablePathArray","../ImmutablePointArray","../../chunks/languageUtils","./centroid","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/coordsUtils","../../geometry/support/jsonUtils"],(function(e,r,t,n,a,o,i,c,s,l,u,f,d,m,E,h){"use strict";function p(e){return e&&"esri.arcade.Feature"===e.arcadeDeclaredClass}function x(e,a){e.ringisclockwise=function(e,r){return a(e,r,((n,a,c)=>{i.pcCheck(c,1,1,e,r);let s=[];if(null===c[0])return!1;if(i.isArray(c[0]))for(const o of c[0]){if(!(o instanceof f))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);s.push(o.hasZ?o.hasM?[o.x,o.y,o.z,o.m]:[o.x,o.y,o.z]:[o.x,o.y])}else if(c[0]instanceof o)s=c[0]._elements;else{if(!i.isImmutableArray(c[0]))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);for(const n of c[0].toArray()){if(!(n instanceof f))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);s.push(n.hasZ?n.hasM?[n.x,n.y,n.z,n.m]:[n.x,n.y,n.z]:[n.x,n.y])}}return!(s.length<3)&&E.isClockwise(s)}))},e.polygon=function(e,o){return a(e,o,((a,c,s)=>{i.pcCheck(s,1,1,e,o);let l=null;if(s[0]instanceof r){if(l=i.fixSpatialReference(n.parseGeometryFromDictionary(s[0]),e.spatialReference),l instanceof d==!1)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,o)}else l=s[0]instanceof d?h.fromJSON(s[0].toJSON()):i.fixSpatialReference(new d(JSON.parse(s[0])),e.spatialReference);if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,o);return i.fixNullGeometry(l)}))},e.polyline=function(e,o){return a(e,o,((a,c,s)=>{i.pcCheck(s,1,1,e,o);let l=null;if(s[0]instanceof r){if(l=i.fixSpatialReference(n.parseGeometryFromDictionary(s[0]),e.spatialReference),l instanceof m==!1)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,o)}else l=s[0]instanceof m?h.fromJSON(s[0].toJSON()):i.fixSpatialReference(new m(JSON.parse(s[0])),e.spatialReference);if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,o);return i.fixNullGeometry(l)}))},e.point=function(e,o){return a(e,o,((a,c,s)=>{i.pcCheck(s,1,1,e,o);let l=null;if(s[0]instanceof r){if(l=i.fixSpatialReference(n.parseGeometryFromDictionary(s[0]),e.spatialReference),l instanceof f==!1)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,o)}else l=s[0]instanceof f?h.fromJSON(s[0].toJSON()):i.fixSpatialReference(new f(JSON.parse(s[0])),e.spatialReference);if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,o);return i.fixNullGeometry(l)}))},e.multipoint=function(e,o){return a(e,o,((a,c,s)=>{i.pcCheck(s,1,1,e,o);let l=null;if(s[0]instanceof r){if(l=i.fixSpatialReference(n.parseGeometryFromDictionary(s[0]),e.spatialReference),l instanceof u==!1)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,o)}else l=s[0]instanceof u?h.fromJSON(s[0].toJSON()):i.fixSpatialReference(new u(JSON.parse(s[0])),e.spatialReference);if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,o);return i.fixNullGeometry(l)}))},e.extent=function(e,o){return a(e,o,((a,c,l)=>{l=i.autoCastFeatureToGeometry(l),i.pcCheck(l,1,1,e,o);let E=null;if(l[0]instanceof r)E=i.fixSpatialReference(n.parseGeometryFromDictionary(l[0]),e.spatialReference);else if(l[0]instanceof f){const e={xmin:l[0].x,ymin:l[0].y,xmax:l[0].x,ymax:l[0].y,spatialReference:l[0].spatialReference.toJSON()},r=l[0];r.hasZ?(e.zmin=r.z,e.zmax=r.z):r.hasM&&(e.mmin=r.m,e.mmax=r.m),E=h.fromJSON(e)}else E=l[0]instanceof d||l[0]instanceof m||l[0]instanceof u?h.fromJSON(l[0].extent?.toJSON()):l[0]instanceof s?h.fromJSON(l[0].toJSON()):i.fixSpatialReference(new s(JSON.parse(l[0])),e.spatialReference);if(null!==E&&!1===E.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,o);return i.fixNullGeometry(E)}))},e.geometry=function(e,o){return a(e,o,((a,c,s)=>{i.pcCheck(s,1,1,e,o);let l=null;if(null===s[0])return null;if(l=p(s[0])?i.fixSpatialReference(s[0].geometry(),e.spatialReference):s[0]instanceof r?i.fixSpatialReference(n.parseGeometryFromDictionary(s[0]),e.spatialReference):i.fixSpatialReference(h.fromJSON(JSON.parse(s[0])),e.spatialReference),null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,o);return i.fixNullGeometry(l)}))},e.setgeometry=function(e,r){return a(e,r,((n,a,o)=>{if(i.pcCheck(o,2,2,e,r),!p(o[0]))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);if(!0===o[0].immutable)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.Immutable,r);if(!(o[1]instanceof l||null===o[1]))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);return o[0]._geometry=o[1],i.voidOperation}))},e.feature=function(e,o){return a(e,o,((a,c,s)=>{if(0===s.length)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongNumberOfParameters,o);let u=null;if(1===s.length)if(i.isString(s[0]))u=n.fromJson(JSON.parse(s[0]),e.timeZone);else if(p(s[0]))u=n.createFromArcadeFeature(s[0]);else if(s[0]instanceof l)u=n.createFromGraphicLikeObject(s[0],null,null,e.timeZone);else{if(!(s[0]instanceof r))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,o);{let t=s[0].hasField("geometry")?s[0].field("geometry"):null,a=s[0].hasField("attributes")?s[0].field("attributes"):null;null!==t&&t instanceof r&&(t=n.parseGeometryFromDictionary(t)),null!==a&&(a=n.parseAttributesFromDictionary(a)),u=n.createFromGraphicLikeObject(t,a,null,e.timeZone)}}else if(2===s.length){let a=null,i=null;if(null!==s[0])if(s[0]instanceof l)a=s[0];else{if(!(a instanceof r))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,o);a=n.parseGeometryFromDictionary(s[0])}if(null!==s[1]){if(!(s[1]instanceof r))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,o);i=n.parseAttributesFromDictionary(s[1])}u=n.createFromGraphicLikeObject(a,i,null,e.timeZone)}else{let a=null;const c={};if(null!==s[0])if(s[0]instanceof l)a=s[0];else{if(!(a instanceof r))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,o);a=n.parseGeometryFromDictionary(s[0])}for(let r=1;r<s.length;r+=2){const n=i.toString(s[r]),a=s[r+1];if(!(null==a||i.isString(a)||isNaN(a)||i.isDate(a)||i.isNumber(a)||i.isTime(a)||i.isDateOnly(a)||i.isBoolean(a)))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,o);if(i.isFunctionParameter(a)||!1===i.isSimpleType(a))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,o);a===i.voidOperation?c[n]=null:c[n]=a}u=n.createFromGraphicLikeObject(a,c,null,e.timeZone)}return u._geometry=i.fixSpatialReference(u.geometry(),e.spatialReference),u.immutable=!1,u}))},e.dictionary=function(e,n){return a(e,n,((a,o,c)=>{if(0===c.length||1===c.length&&null===c[0]){const e=new r;return e.immutable=!1,e}if(1===c.length&&i.isString(c[0]))try{const t=JSON.parse(c[0]),n=r.convertObjectToArcadeDictionary(t,i.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(f){throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}if(1===c.length&&c[0]instanceof l)try{const t=c[0].toJSON();t.hasZ=!0===c[0].hasZ,t.hasM=!0===c[0].hasM;const n=r.convertObjectToArcadeDictionary(t,i.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(f){throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}if(1===c.length&&i.isFeature(c[0]))try{const e=new r;e.immutable=!1,e.setField("geometry",c[0].geometry());const t=new r;t.immutable=!1,e.setField("attributes",t);for(const r of c[0].keys())t.setField(r,c[0].field(r));return e}catch(f){throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}if(1===c.length&&c[0]instanceof r)try{const e=new r;e.immutable=!1;for(const r of c[0].keys())e.setField(r,c[0].field(r));return e}catch(f){throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}if(2===c.length&&c[0]instanceof r&&i.isBoolean(c[1]))try{if(!(!0===c[1])){const e=new r;e.immutable=!1;for(const r of c[0].keys())e.setField(r,c[0].field(r));return e}return c[0].deepClone()}catch(f){throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}if(c.length%2!=0)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongNumberOfParameters,n);const s={};for(let r=0;r<c.length;r+=2){const a=i.toString(c[r]),o=c[r+1];if(!(null==o||i.isString(o)||isNaN(o)||i.isDate(o)||i.isNumber(o)||i.isBoolean(o)||i.isDateOnly(o)||i.isTime(o)||i.isArray(o)||i.isImmutableArray(o)))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n);if(i.isFunctionParameter(o))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n);o===i.voidOperation?s[a]=null:s[a]=o}const u=new r(s);return u.immutable=!1,u}))},e.haskey=function(e,n){return a(e,n,((a,o,c)=>{i.pcCheck(c,2,2,e,n);const s=i.toString(c[1]);if(p(c[0]))return c[0].hasField(s);if(c[0]instanceof r)return c[0].hasField(s);if(c[0]instanceof l){const e=w(c[0],s,null,null,2);return!e||"notfound"!==e.keystate}throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}))},e.hasvalue=function(e,t){return a(e,t,((n,a,o)=>{if(i.pcCheck(o,2,2,e,t),null===o[0]||null===o[1])return!1;const c=i.toString(o[1]);if(i.isFeature(o[0]))return!!o[0].hasField(c)&&null!==o[0].field(c);if(o[0]instanceof r)return!!o[0].hasField(c)&&null!==o[0].field(c);if(o[0]instanceof l){return null!==w(o[0],c,null,null,0)}return!1}))},e.indexof=function(e,r){return a(e,r,((n,a,o)=>{i.pcCheck(o,2,2,e,r);const c=o[1];if(i.isArray(o[0])){for(let e=0;e<o[0].length;e++)if(i.equalityTest(c,o[0][e]))return e;return-1}if(i.isImmutableArray(o[0])){const e=o[0].length();for(let r=0;r<e;r++)if(i.equalityTest(c,o[0].get(r)))return r;return-1}throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r)}))},e.angle=function(e,r){return a(e,r,((n,a,o)=>{if(o=i.autoCastFeatureToGeometry(o),i.pcCheck(o,2,3,e,r),!(o[0]instanceof f))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);if(!(o[1]instanceof f))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);if(o.length>2&&!(o[2]instanceof f))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);return 2===o.length?c.angle2D(o[0],o[1]):c.angleBetween2D(o[0],o[1],o[2])}))},e.bearing=function(e,r){return a(e,r,((n,a,o)=>{if(o=i.autoCastFeatureToGeometry(o),i.pcCheck(o,2,3,e,r),!(o[0]instanceof f))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);if(!(o[1]instanceof f))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);if(o.length>2&&!(o[2]instanceof f))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);return 2===o.length?c.bearing2D(o[0],o[1]):c.bearingBetween2D(o[0],o[1],o[2])}))},e.isselfintersecting=function(e,r){return a(e,r,((t,n,a)=>{a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,1,1,e,r);let o=a[0];if(o instanceof d)return o.isSelfIntersecting;if(o instanceof m)return o=o.paths,c.pathsSelfIntersecting(o);if(o instanceof u){const e=o.points;for(let r=0;r<e.length;r++)for(let t=0;t<e.length;t++)if(t!==r){let n=!0;for(let a=0;a<e[r].length;a++)if(e[r][a]!==e[t][a]){n=!1;break}if(!0===n)return!0}}return!(!i.isArray(o)&&!i.isImmutableArray(o))&&(o=i.autoCastArrayOfPointsToPolyline(o,e.spatialReference),null!==o&&(o=o.paths),c.pathsSelfIntersecting(o))}))}}let y=0;function w(e,n,i,c,s=1){let l;switch(n=n.toLowerCase()){case"hasz":{const r=e.hasZ;return void 0!==r&&r}case"hasm":{const r=e.hasM;return void 0!==r&&r}case"spatialreference":{let t=e.spatialReference._arcadeCacheId;if(void 0===t){let r=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(r=!1),r&&(y++,e.spatialReference._arcadeCacheId=y,t=y)}const n=new r({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}}switch(e.type){case"extent":switch(n){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const r=e[n];return void 0!==r?r:null}case"type":return"Extent"}break;case"polygon":switch(n){case"rings":l=e.cache._arcadeCacheId,void 0===l&&(y++,l=y,e.cache._arcadeCacheId=l);return new a(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,l);case"type":return"Polygon"}break;case"point":switch(n){case"x":case"y":case"z":case"m":return void 0!==e[n]?e[n]:null;case"type":return"Point"}break;case"polyline":switch(n){case"paths":l=e.cache._arcadeCacheId,void 0===l&&(y++,l=y,e.cache._arcadeCacheId=l);return new a(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,l);case"type":return"Polyline"}break;case"multipoint":switch(n){case"points":l=e.cache._arcadeCacheId,void 0===l&&(y++,l=y,e.cache._arcadeCacheId=l);return new o(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,l,1);case"type":return"Multipoint"}}if(1===s)throw new t.ArcadeExecutionError(i,t.ExecutionErrorCodes.InvalidIdentifier,c);return 2===s?{keystate:"notfound"}:null}e.geometryMember=w,e.registerFunctions=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
