/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../Dictionary","../executionError","../../chunks/languageUtils","../featureset/support/shared"],(function(e,n,t,r,o){"use strict";function a(e,t){return e&&e.domain?"coded-value"===e.domain.type||"codedValue"===e.domain.type?n.convertObjectToArcadeDictionary({type:"codedValue",name:e.domain.name,dataType:o.layerFieldEsriConstants[e.field.type],codedValues:e.domain.codedValues.map((e=>({name:e.name,code:e.code})))},r.defaultTimeZone(t)):n.convertObjectToArcadeDictionary({type:"range",name:e.domain.name,dataType:o.layerFieldEsriConstants[e.field.type],min:e.domain.min,max:e.domain.max},r.defaultTimeZone(t)):null}function i(e){"async"===e.mode&&(e.functions.domain=function(n,o){return e.standardFunctionAsync(n,o,(async(e,i,c)=>{if(r.pcCheck(c,2,3,n,o),r.isFeature(c[0])){return a(r.featureFullDomain(c[0],r.toString(c[1]),void 0===c[2]?void 0:c[2]),n)}if(r.isFeatureSet(c[0])){await c[0]._ensureLoaded();return a(r.getDomain(r.toString(c[1]),c[0],null,void 0===c[2]?void 0:c[2]),n)}throw new t.ArcadeExecutionError(n,t.ExecutionErrorCodes.InvalidParameter,o)}))},e.functions.subtypes=function(o,a){return e.standardFunctionAsync(o,a,(async(e,i,c)=>{if(r.pcCheck(c,1,1,o,a),r.isFeature(c[0])){const e=r.featureSubtypes(c[0]);return e?n.convertObjectToArcadeDictionary(e,r.defaultTimeZone(o)):null}if(r.isFeatureSet(c[0])){await c[0]._ensureLoaded();const e=c[0].subtypes();return e?n.convertObjectToArcadeDictionary(e,r.defaultTimeZone(o)):null}throw new t.ArcadeExecutionError(o,t.ExecutionErrorCodes.InvalidParameter,a)}))},e.functions.domainname=function(n,o){return e.standardFunctionAsync(n,o,(async(e,a,i)=>{if(r.pcCheck(i,2,4,n,o),r.isFeature(i[0]))return r.featureDomainValueLookup(i[0],r.toString(i[1]),i[2],void 0===i[3]?void 0:i[3]);if(r.isFeatureSet(i[0])){await i[0]._ensureLoaded();const e=r.getDomain(r.toString(i[1]),i[0],null,void 0===i[3]?void 0:i[3]);return r.getDomainValue(e,i[2])}throw new t.ArcadeExecutionError(n,t.ExecutionErrorCodes.InvalidParameter,o)}))},e.signatures.push({name:"domainname",min:2,max:4}),e.functions.domaincode=function(n,o){return e.standardFunctionAsync(n,o,(async(e,a,i)=>{if(r.pcCheck(i,2,4,n,o),r.isFeature(i[0]))return r.featureDomainCodeLookup(i[0],r.toString(i[1]),i[2],void 0===i[3]?void 0:i[3]);if(r.isFeatureSet(i[0])){await i[0]._ensureLoaded();const e=r.getDomain(r.toString(i[1]),i[0],null,void 0===i[3]?void 0:i[3]);return r.getDomainCode(e,i[2])}throw new t.ArcadeExecutionError(n,t.ExecutionErrorCodes.InvalidParameter,o)}))},e.signatures.push({name:"domaincode",min:2,max:4})),e.functions.text=function(n,t){return e.standardFunctionAsync(n,t,((e,o,a)=>{if(r.pcCheck(a,1,2,n,t),!r.isFeatureSet(a[0]))return r.toStringExplicit(a[0],a[1]);{const n=r.defaultUndefined(a[1],"");if(""===n)return a[0].castToText();if("schema"===n.toLowerCase())return a[0].convertToText("schema",e.abortSignal);if("featureset"===n.toLowerCase())return a[0].convertToText("featureset",e.abortSignal)}}))},e.functions.gdbversion=function(n,o){return e.standardFunctionAsync(n,o,(async(e,a,i)=>{if(r.pcCheck(i,1,1,n,o),r.isFeature(i[0]))return i[0].gdbVersion();if(r.isFeatureSet(i[0])){return(await i[0].load()).gdbVersion}throw new t.ArcadeExecutionError(n,t.ExecutionErrorCodes.InvalidParameter,o)}))},e.functions.schema=function(o,a){return e.standardFunctionAsync(o,a,(async(e,i,c)=>{if(r.pcCheck(c,1,1,o,a),r.isFeatureSet(c[0]))return await c[0].load(),n.convertObjectToArcadeDictionary(c[0].schema(),r.defaultTimeZone(o));if(r.isFeature(c[0])){const e=r.featureSchema(c[0]);return e?n.convertObjectToArcadeDictionary(e,r.defaultTimeZone(o)):null}throw new t.ArcadeExecutionError(o,t.ExecutionErrorCodes.InvalidParameter,a)}))}}e.registerFunctions=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
