/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../intl","../../core/arrayUtils","../../core/compilerUtils","../../core/string","../../layers/support/domainUtils","../../layers/support/fieldUtils","../../smartMapping/support/utils","../support/dateUtils","../../intl/substitute"],(function(e,t,n,i,r,l,o,a,s,u){"use strict";const p=e=>"field"===e?.type,d=e=>"group"===e?.type,m=e=>"relationship"===e?.type,c=e=>!d(e)&&null!=e.group,y=e=>"field"===e.type,f=e=>"group"===e.type,E=e=>"relationship"===e.type,T=e=>e.reduce(((e,t)=>d(t)?[...e,...t.inputs]:[...e,t]),[]),g=e=>T(e).filter(p),b=e=>T(e).filter(m),I=e=>null!=e&&(F(e,"combo-box")||F(e,"radio-buttons")),F=(e,t)=>null!=e&&e.input?.type===t,V=e=>null!=e&&(F(e,"text-box")||F(e,"text-area")),h=({domain:e,inputType:t="text-box",dataType:n})=>"number"===n&&"text-box"===t&&(!e||"coded-value"!==e.type),v=e=>"items"in e,O={typeFieldName:null,types:[]};function x(e){const{attributes:t,fieldsIndex:i,label:l,timeZone:o}=e;if(!t||"object"!=typeof t)return l;const a=Object.keys(t).filter((e=>r.templateHasKey(l,e))),s=a.map((e=>t[e])),u=a.map((e=>i.get(e))).filter(n.isSome);return L(l,N({values:s,fields:u,timeZone:o}))}function N(e){const{fields:t,values:n}=e,i=e.timeZone??void 0,r=t.map(((e,t)=>{let r=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===r));t?.name&&(r=t.name)}return(a.isAnyDateField(e)||o.isTimeOnlyField(e))&&(r=s.getLabelForDateFieldValue(e,r,{timeZone:i,...s.getIntlOptionsForField(e)})),[e.name,r]}));return Object.fromEntries(r)}function L(e,t){return r.replace(r.replace(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((([e,t])=>[e.toLowerCase(),t]))))}const A=e=>e?"subtype-sublayer"===e.type?{typeFieldName:e.parent?.subtypeField,types:e.parent?.subtypes??[]}:"types"in e&&e.types?{typeFieldName:e.typeIdField,types:e.types.map((({id:e,name:t,domains:n})=>({code:e,name:t,domains:n})))}:O:O,D=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};e.LengthValidationError=void 0,(e.LengthValidationError||(e.LengthValidationError={})).TOO_SHORT="length-validation-error::too-short";const R={type:"number"},S={type:"number",intlOptions:{notation:"scientific"}};function U(e){return e>=1e7||e<=-1e7}const _=(t,n,i)=>{const{dataType:r,error:a,minLength:p,value:d,required:m}=t;if(!n||!a)return null;if(m&&null===d)return n.validationErrors.cannotBeNull;if(a===l.DomainValidationError.VALUE_OUT_OF_RANGE||a===o.NumericRangeValidationError.OUT_OF_RANGE){const{field:e,range:l}=t,o={type:"date",intlOptions:{timeZone:i??void 0,...s.getIntlOptionsForField(e)}};return u.substitute(n.validationErrors.outsideRange,l,{format:{max:"date"===r?o:null!=l.max&&U(l.max)?S:R,min:"date"===r?o:null!=l.min&&U(l.min)?S:R}})}return a===l.DomainValidationError.INVALID_CODED_VALUE?n.validationErrors.invalidCodedValue:a===o.TypeValidationError.INVALID_TYPE?n.validationErrors.invalidType:a===e.LengthValidationError.TOO_SHORT?u.substitute(n.validationErrors.tooShort,{min:p}):null},j=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,i=e.geometry?.type;return"polyline"===i||"polyline"===n?"line":i||n||"table"},w=e=>{const t=[];if(e.formTemplate){const{description:n,title:i}=e.formTemplate;e.fields?.forEach((e=>{const l=i&&r.templateHasKey(i,e.name),o=n&&r.templateHasKey(n,e.name);(l||o)&&t.push(e.name)}))}return t};function C(e){if("formTemplate"in e&&e.formTemplate){return(e.formTemplate.elements?.filter(y)??[]).some((({fieldName:t})=>!e.fieldsIndex.get(t)))}return!1}function G(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function H(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return i.neverReached(t.objectType),!1}}e.capabilitiesAllowEditType=D,e.flattenFieldInputs=g,e.flattenInputs=T,e.flattenRelationshipInputs=b,e.formTemplateHasInvalidFields=C,e.getComputedAttributes=N,e.getErrorMessageForFieldInput=_,e.getFieldsInTitleAndDesc=w,e.getIconForFeature=j,e.getNormalizedFeatureTypeInfo=A,e.isFieldElement=y,e.isFieldElementWithInputType=F,e.isFieldElementWithShowNoValueOptionInput=I,e.isFieldElementWithTextInput=V,e.isFieldInput=p,e.isGroupElement=f,e.isGroupInput=d,e.isInputInGroupInput=c,e.isNumberFieldInput=h,e.isRelationshipElement=E,e.isRelationshipInput=m,e.isTemplateItemGroup=v,e.parseFormTemplateString=x,e.substituteFieldTemplatesInString=L,e.valueIsInvalidSwitchValue=G,e.valueIsValidContingentValue=H,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
