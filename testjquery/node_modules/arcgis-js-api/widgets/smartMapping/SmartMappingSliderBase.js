/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../chunks/tslib.es6","../../Color","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../Histogram","../Slider","../Widget","./support/utils","../support/widgetUtils","../support/jsxFactory"],(function(e,t,i,o,n,a,s,r,l,p,m,d,c,g,h){"use strict";const u="zoom-cap",M={zoomCap:u,maxZoomCap:`${u}--max`,minZoomCap:`${u}--min`,zoomCapLine:`${u}--line`,zoomCapMask:`${u}--mask`,zoomCapUnderline:`${u}--underline`},b={interactiveTrack:!1};e.SmartMappingSliderBase=class extends d{constructor(e,t){super(e,t),this.histogram=new p({layout:"vertical"}),this.histogramConfig=null,this.slider=new m({syncedSegmentsEnabled:!0,thumbsConstrained:!1,layout:"vertical",visibleElements:{labels:!0,rangeLabels:!0},labelInputsEnabled:!0,rangeLabelInputsEnabled:!0}),this.viewModel=null,this.visibleElements={...b};const i=this.slider;!e?.hasTimeData||e?.inputParseFunction||e?.inputFormatFunction||i.set({labelInputsEnabled:!1,rangeLabelInputsEnabled:!1}),i.draggableSegmentsEnabled=!!e?.visibleElements?.interactiveTrack,this.addHandles([i.on("max-change",(e=>this.emit("max-change",e))),i.on("max-click",(e=>this.emit("max-click",e))),i.on("min-change",(e=>this.emit("min-change",e))),i.on("min-click",(e=>this.emit("min-click",e))),i.on("segment-click",(e=>this.emit("segment-click",e))),i.on("segment-drag",(e=>this.emit("segment-drag",e))),i.on("thumb-change",(e=>this.emit("thumb-change",e))),i.on("thumb-click",(e=>this.emit("thumb-click",e))),i.on("thumb-drag",(e=>this.emit("thumb-drag",e))),i.on("track-click",(e=>this.emit("track-click",e))),o.watch((()=>[this.histogramConfig,this.max,this.min,this.zoomOptions]),(()=>{const{histogram:e,histogramConfig:t,viewModel:{max:i,min:o}}=this,n=this.getParamsFromHistogramConfig(t);e.set({...n,max:i,min:o})})),o.watch((()=>this.labelFormatFunction),(()=>{const{histogram:e,labelFormatFunction:t}=this;e.set({labelFormatFunction:t})})),o.watch((()=>this.hasTimeData),(e=>{const{labelInputsEnabled:t,rangeLabelInputsEnabled:o}=this.slider,n=!e||this.inputFormatFunction&&this.inputParseFunction;i.set({labelInputsEnabled:t&&n,rangeLabelInputsEnabled:o&&n})})),o.watch((()=>this.visibleElements?.interactiveTrack),(e=>{i.draggableSegmentsEnabled=!!e}))]),this._onMaxZoomCapPointerDown=this._onMaxZoomCapPointerDown.bind(this),this._onMinZoomCapPointerDown=this._onMinZoomCapPointerDown.bind(this)}initialize(){const{histogramConfig:e={},viewModel:t}=this,{labelFormatFunction:i,max:o,min:n}=t,a=this.getParamsFromHistogramConfig(e);this.histogram.set({labelFormatFunction:i,...a,max:o,min:n}),this.slider.set({viewModel:t})}get hasTimeData(){return this.viewModel?.hasTimeData??!1}set hasTimeData(e){this.viewModel&&(this.viewModel.hasTimeData=e)}get inputFormatFunction(){return this.viewModel?.inputFormatFunction}set inputFormatFunction(e){this.viewModel&&(this.viewModel.inputFormatFunction=e)}get inputParseFunction(){return this.viewModel?.inputParseFunction}set inputParseFunction(e){this.viewModel&&(this.viewModel.inputParseFunction=e)}get labelFormatFunction(){return this.viewModel?.labelFormatFunction}set labelFormatFunction(e){this.viewModel&&(this.viewModel.labelFormatFunction=e)}get max(){return this.viewModel?.getUnzoomedMax()??this._get("max")??null}set max(e){this.viewModel?this.viewModel.max=e:this._set("max",e)}get min(){return this.viewModel?.getUnzoomedMin()??this._get("min")??null}set min(e){this.viewModel?this.viewModel.min=e:this._set("min",e)}get precision(){return this.viewModel?.precision??4}set precision(e){this.viewModel&&(this.viewModel.precision=e)}get state(){return this.viewModel?.state??"disabled"}get syncedSegmentsEnabled(){return this.slider?.syncedSegmentsEnabled}set syncedSegmentsEnabled(e){this.slider&&(this.slider.syncedSegmentsEnabled=e)}get values(){return this.viewModel?.values??[]}castVisibleElements(e){return{...b,...e}}get zoomOptions(){return this.viewModel?.zoomOptions}set zoomOptions(e){this.viewModel&&(this.viewModel.zoomOptions=e)}renderContent(e,t,i){return this.slider.extraNodes=[e,this.renderHistogram(i)],h.tsx("div",{class:t},this.slider.render())}renderHistogram(e){return this.histogramConfig?h.tsx("div",{class:e??void 0,key:"histogram"},this.histogram.render()):null}renderBackgroundFillDefinition(e){return h.tsx("pattern",{height:"15",id:e,patternUnits:"userSpaceOnUse",width:"15",x:"0",y:"0"},h.tsx("image",{height:"15",href:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgaGVpZ2h0PSIxNiIgd2lkdGg9IjE2Ij48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNjY2MiIC8+PHBhdGggZD0iTTAgMCBMOCAwIEw4IDggTDAgOCBaIiBmaWxsPSIjZmZmIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDgpIiAvPjxwYXRoIGQ9Ik0wIDAgTDggMCBMOCA4IEwwIDggWiIgZmlsbD0iI2NjYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOCw4KSIgLz48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNmZmYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgsMCkiIC8+PC9zdmc+",width:"15",x:"0",y:"0"}))}renderRampFillDefinition(e,t){return h.tsx("linearGradient",{id:e,x1:"0",x2:"0",y1:"0",y2:"1"},this.renderRampFillStops(t))}renderRampFillStops(e){return e.reverse().map(((e,t)=>this.renderStop(e,t)))}renderStop(e,t){const{color:i,offset:o,opacity:n}=this.getPropsForStop(e);return h.tsx("stop",{key:`${t}-stop`,offset:o,"stop-color":i,"stop-opacity":n})}renderZoomCaps(){return[this.renderMaxZoomCap(),this.renderMinZoomCap()]}renderMinZoomCap(){if(null!=this.zoomOptions?.min)return h.tsx("svg",{class:this.classes(M.zoomCap,M.minZoomCap),key:"bottom",onpointerdown:this._onMinZoomCapPointerDown,viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg"},h.tsx("polygon",{class:M.zoomCapMask,fill:"#1B8617",key:"mask",points:"0 11.3846154 30 11.3846154 30 1 25 5.38461538 20 1 15 5.38461538 10 1 5 5.38461538 0 1"}),h.tsx("polygon",{class:M.zoomCapUnderline,fill:"#69DCFF",key:"underline",points:"0 0 5 4.38461538 10 0 15 4.38461538 20 0 25 4.38461538 30 0 30 4.61538462 25 9 20 4.61538462 15 9 10 4.61538462 5 9 0 4.61538462"}),h.tsx("polygon",{class:M.zoomCapLine,fill:"#DA5656",key:"line",points:"0 1 5 5.38461538 10 1 15 5.38461538 20 1 25 5.38461538 30 1 30 5.61538462 25 10 20 5.61538462 15 10 10 5.61538462 5 10 0 5.61538462"}))}renderMaxZoomCap(){if(null!=this.zoomOptions?.max)return h.tsx("svg",{class:this.classes(M.zoomCap,M.maxZoomCap),key:"top",onpointerdown:this._onMaxZoomCapPointerDown,viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg"},h.tsx("polygon",{class:M.zoomCapMask,key:"mask",points:"0 -1.81994377e-12 30 -1.81994377e-12 30 8.23076923 25 3.61538462 20 8.23076923 15 3.61538462 10 8.23076923 5 3.61538462 0 8.23076923"}),h.tsx("polygon",{class:M.zoomCapUnderline,key:"underline",points:"0 5.61538462 5 1 10 5.61538462 15 1 20 5.61538462 25 1 30 5.61538462 30 10.2307692 25 5.61538462 20 10.2307692 15 5.61538462 10 10.2307692 5 5.61538462 0 10.2307692"}),h.tsx("polygon",{class:M.zoomCapLine,key:"line",points:"0 4.61538462 5 -1.87329639e-12 10 4.61538462 15 -1.87329639e-12 20 4.61538462 25 -1.87329639e-12 30 4.61538462 30 9.23076923 25 4.61538462 20 9.23076923 15 4.61538462 10 9.23076923 5 4.61538462 0 9.23076923"}))}getPropsForStop(e){const{color:t,offset:o}=e;return{color:t instanceof i?t.toCss(!0):i.fromString(t).toCss(!0),offset:(100*o).toFixed(2)+"%",opacity:t instanceof i?t.toRgba()[3]:null}}getParamsFromHistogramConfig(e){if(!e)return null;const{average:t,barCreatedFunction:i,bins:o,dataLineCreatedFunction:n,dataLineUpdatedFunction:a}=e;return{average:t,barCreatedFunction:i,bins:o,dataLineCreatedFunction:n,dataLineUpdatedFunction:a,dataLines:this._getDataLines(e)}}_onMaxZoomCapPointerDown(){const{zoomOptions:e}=this;if(null!=e?.max){const{min:t}=e;this.zoomOptions=null!=t?{min:t}:null}}_onMinZoomCapPointerDown(){const{zoomOptions:e}=this;if(null!=e?.min){const{max:t}=e;this.zoomOptions=null!=t?{max:t}:null}}_getDataLines(e){const{average:t,standardDeviation:i,standardDeviationCount:o}=e,{max:n,min:a}=this.viewModel.getBounds();return[...this._getStandardDeviationDataLines(i,t,o||1),...e.dataLines||[]].filter((({value:e})=>e<=n&&e>=a))}_getStandardDeviationDataLines(e,t,i){const{max:o,min:n}=this.viewModel,a=.06*(o-n);return c.getDeviationValues(e,t,i).filter((e=>Math.abs(t-e)>a)).map(((e,i,o)=>{const n=this.labelFormatFunction?this.labelFormatFunction(e):e,a=o.length/2,s=i>=a?i-a+1:a-i;return{value:e,label:`${e>t?"+":"-"}${1===s?"":s}Ïƒ ${n}`}}))}},t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"hasTimeData",null),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"histogram",void 0),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"histogramConfig",void 0),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"inputFormatFunction",null),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"inputParseFunction",null),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"labelFormatFunction",null),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"max",null),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"min",null),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"precision",null),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"slider",void 0),t.__decorate([n.property({readOnly:!0})],e.SmartMappingSliderBase.prototype,"state",null),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"syncedSegmentsEnabled",null),t.__decorate([n.property({readOnly:!0})],e.SmartMappingSliderBase.prototype,"values",null),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"viewModel",void 0),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"visibleElements",void 0),t.__decorate([a.cast("visibleElements")],e.SmartMappingSliderBase.prototype,"castVisibleElements",null),t.__decorate([n.property()],e.SmartMappingSliderBase.prototype,"zoomOptions",null),e.SmartMappingSliderBase=t.__decorate([l.subclass("esri.widgets.smartMapping.SmartMappingSliderBase")],e.SmartMappingSliderBase),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
