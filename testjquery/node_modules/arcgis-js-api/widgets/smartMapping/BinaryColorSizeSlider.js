/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../Color","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../renderers/visualVariables/support/SizeStop","../../symbols/support/cimSymbolUtils","./SmartMappingSliderBase","./BinaryColorSizeSlider/BinaryColorSizeSliderViewModel","./support/utils","../support/globalCss","../support/legacyIcon","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory"],(function(e,r,t,s,o,a,i,l,n,d,p,c,m,u,y,h,g){"use strict";var b;const v="esri-binary-color-size-slider",_={base:v,widgetIcon:u.legacyIcon.edit,rampElement:`${v}__ramp`,sliderContainer:`${v}__slider-container`,histogramContainer:`${v}__histogram-container`,zoomCapTop:`${v}__zoom-cap-top`,zoomCapBottom:`${v}__zoom-cap-bottom`,zoomCapLine:`${v}__zoom-cap-line`,zoomCapMask:`${v}__zoom-cap-mask`,zoomCapUnderline:`${v}__zoom-cap-underline`,primaryHandle:`${v}--primary-handle`,track:`${v}--interactive-track`},S={trackBackgroundColor:new r([224,224,224]),trackAboveFillColor:new r([149,149,149]),trackBelowFillColor:new r([149,149,149])};let f=b=class extends d.SmartMappingSliderBase{constructor(e,r){super(e,r),this._minRampFillWidth=.2,this._rampNode=null,this.messages=null,this.style={...S},this.viewModel=new p,this._rampFillId=`${this.id}-linear-gradient`}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}castStyle(e){return{...S,...e}}static fromRendererResult(e,r){const{size:{visualVariables:t},statistics:s}=e,{avg:o,stddev:a}=s,i=t[0].stops,l=e.renderer.authoringInfo.visualVariables[0],d=l.minSliderValue,p=l.maxSliderValue,c=e.renderer.classBreakInfos;let m,u,y=null;const h=e=>{if("cim"===e.type)return n.getCIMSymbolColor(e);if(e.symbolLayers){const r=e.symbolLayers?.at(0);return r.material?.color}return e.color};if(c.length>1){const e=c[0].symbol,r=c[1].symbol;u=h(e),m=h(r)}return 1===c.length&&(y=h(c[0].symbol)),new b({max:p,min:d,stops:i,histogramConfig:{average:o,standardDeviation:a,bins:r?r.bins:[]},style:{trackAboveFillColor:m,trackBelowFillColor:u,trackFillColor:y},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})}updateFromRendererResult(e,r){const{size:{visualVariables:t},statistics:s}=e,{avg:o,stddev:a}=s,i=t[0].stops,l=e.renderer.authoringInfo.visualVariables[0],d=l.minSliderValue,p=l.maxSliderValue,c=e.renderer.classBreakInfos;let m,u,y=null;const h=e=>{if("cim"===e.type)return n.getCIMSymbolColor(e);if(e.symbolLayers){const r=e.symbolLayers?.at(0);return r.material?.color}return e.color};if(c.length>1){const e=c[0].symbol,r=c[1].symbol;u=h(e),m=h(r)}1===c.length&&(y=h(c[0].symbol)),this.set({max:p,min:d,stops:i,histogramConfig:{average:o,standardDeviation:a,bins:r?r.bins:[]},style:{trackAboveFillColor:m,trackBelowFillColor:u,trackFillColor:y},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})}updateRenderer(e){if("univariate-color-size"!==e.authoringInfo?.type||"above-and-below"!==e.authoringInfo?.univariateTheme)return console.error("Input renderer must be a univariate renderer with an above-and-below theme."),null;const r=e.clone(),t=r.visualVariables.find((e=>"size"===e.type&&"outline"!==e.target&&e.stops)),{stops:s}=this;if(!t||!s)return console.error("No size stops available."),null;const o=r.visualVariables.indexOf(t);r.visualVariables.splice(o,1),t.stops=s,r.visualVariables.push(t);const a=s[5===s.length?2:1].value;return r.classBreakInfos[0].maxValue=a,r.classBreakInfos[1].minValue=a,r}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:r,minDataValue:t,stops:s}=e;if(s)this.stops=s;else{const[s,o]=c.getSizesFromVariable(e);this.stops=[new l({value:t,size:o}),new l({value:r,size:s})]}}render(){const{label:e,state:r,viewModel:{primaryHandleEnabled:t},visibleElements:s}=this,o="disabled"===r,a=this.classes(_.base,m.globalCss.widget,m.globalCss.panel,{[m.globalCss.disabled]:o,[_.primaryHandle]:t,[_.track]:!!s.interactiveTrack});return g.tsx("div",{"aria-label":e,class:a},o?null:this.renderContent(this._renderRamp(),_.sliderContainer,_.histogramContainer))}_renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:r}=this;return g.tsx("div",{afterCreate:y.storeNode,bind:this,class:_.rampElement,"data-node-ref":"_rampNode"},g.tsx("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},g.tsx("rect",{fill:c.getFillFromColor(e),height:"100%",width:"100%",x:"0",y:"0"}),this._renderPrimaryRamp(),this._renderPath()),r?this.renderZoomCaps():null)}_renderPrimaryRamp(){const{_rampFillId:e,style:{trackAboveFillColor:r,trackBelowFillColor:t},viewModel:s}=this;return[g.tsx("defs",null,this.renderRampFillDefinition(e,s.getGradientStopInfo(r,t)))]}_renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(null==e||null==r)return;const{stops:t,viewModel:{max:s,min:o},_rampFillId:a,_minRampFillWidth:i}=this,l=c.getDynamicPathForSizeStops({max:s,min:o,pathHeight:e,pathWidth:r,stops:t,padding:i});return g.tsx("path",{d:l,fill:`url(#${a})`})}};e.__decorate([t.property()],f.prototype,"handlesSyncedToPrimary",null),e.__decorate([t.property()],f.prototype,"label",null),e.__decorate([t.property(),h.messageBundle("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],f.prototype,"messages",void 0),e.__decorate([t.property()],f.prototype,"persistSizeRangeEnabled",null),e.__decorate([t.property()],f.prototype,"stops",null),e.__decorate([t.property()],f.prototype,"style",void 0),e.__decorate([s.cast("style")],f.prototype,"castStyle",null),e.__decorate([t.property()],f.prototype,"viewModel",void 0),f=b=e.__decorate([i.subclass("esri.widgets.smartMapping.BinaryColorSizeSlider")],f);return f}));
