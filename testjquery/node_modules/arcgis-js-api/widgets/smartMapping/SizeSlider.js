/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../Color","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../renderers/visualVariables/SizeVariable","../../renderers/visualVariables/support/SizeStop","./SmartMappingSliderBase","./SizeSlider/SizeSliderViewModel","./support/utils","../support/globalCss","../support/legacyIcon","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory"],(function(e,t,a,s,r,i,o,l,n,p,d,m,c,u,h,g,y){"use strict";var b;const z="esri-size-slider",_={base:z,widgetIcon:u.legacyIcon.edit,rampElement:`${z}__ramp`,sliderContainer:`${z}__slider-container`,histogramContainer:`${z}__histogram-container`,zoomCapTop:`${z}__zoom-cap-top`,zoomCapBottom:`${z}__zoom-cap-bottom`,zoomCapLine:`${z}__zoom-cap-line`,zoomCapMask:`${z}__zoom-cap-mask`,zoomCapUnderline:`${z}__zoom-cap-underline`,primaryHandle:`${z}--primary-handle`,track:`${z}--interactive-track`},v={trackFillColor:new t([149,149,149]),trackBackgroundColor:new t([224,224,224])};let S=b=class extends p.SmartMappingSliderBase{constructor(e,t){super(e,t),this._maxRampFillWidth=1,this._minRampFillWidth=.2,this._rampNode=null,this.messages=null,this.style={...v},this.viewModel=new d}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get primaryHandleEnabled(){return this.viewModel.primaryHandleEnabled}set primaryHandleEnabled(e){this.viewModel.primaryHandleEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}castStyle(e){return{...v,...e}}static fromRendererResult(e,t){const{visualVariables:a,statistics:s}=e,{avg:r,stddev:i}=s,o=a[0],[l,n]=m.getSizesFromVariable(o),p=e.renderer.authoringInfo.visualVariables[0],d=p.minSliderValue,c=p.maxSliderValue;return new b({max:c,min:d,stops:[{value:o.minDataValue,size:n},{value:o.maxDataValue,size:l}],histogramConfig:{average:r,standardDeviation:i,bins:t?t.bins:[]}})}updateFromRendererResult(e,t){const{visualVariables:a,statistics:s}=e,{avg:r,stddev:i}=s,o=a[0],[l,n]=m.getSizesFromVariable(o),p=e.renderer.authoringInfo.visualVariables[0],d=p.minSliderValue,c=p.maxSliderValue;this.set({max:c,min:d,stops:[{value:o.minDataValue,size:n},{value:o.maxDataValue,size:l}],histogramConfig:{average:r,standardDeviation:i,bins:t?t.bins:[]}})}updateVisualVariable(e){const t=e.clone(),{stops:a}=this;if(!e||!a)return null;if(t.stops)return t.stops=a,t;const s=a[0],r=a[a.length-1];let i=t.maxSize,o=t.minSize;if(i instanceof l){const e=i.stops,t=r.size/e[0].size,a=e.map((e=>(e.size*=t,e)));i.stops=a}else i=r.size;if(o instanceof l){const e=o.stops,t=s.size/e[0].size,a=e.map((e=>(e.size*=t,e)));o.stops=a}else o=s.size;return t.set({maxDataValue:r.value,minDataValue:s.value,maxSize:i,minSize:o}),t}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:t,minDataValue:a,stops:s}=e;if(s)this.stops=s;else{const[s,r]=m.getSizesFromVariable(e);this.stops=[new n({value:a,size:r}),new n({value:t,size:s})]}}render(){const{label:e,primaryHandleEnabled:t,state:a,visibleElements:s}=this,r="disabled"===a,i=this.classes(_.base,c.globalCss.widget,c.globalCss.panel,{[c.globalCss.disabled]:r,[_.primaryHandle]:t,[_.track]:!!s.interactiveTrack});return y.tsx("div",{"aria-label":e,class:i},r?null:this.renderContent(this._renderRamp(),_.sliderContainer,_.histogramContainer))}_renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:t}=this;return y.tsx("div",{afterCreate:h.storeNode,bind:this,class:_.rampElement,"data-node-ref":"_rampNode"},y.tsx("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},y.tsx("rect",{fill:m.getFillFromColor(e),height:"100%",width:"100%",x:"0",y:"0"}),this._renderPath()),t?this.renderZoomCaps():null)}_renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:t=0}=this._rampNode;if(null==e||null==t)return;const{primaryHandleEnabled:a,stops:s,style:{trackFillColor:r},values:i,viewModel:{max:o,min:l},_maxRampFillWidth:n,_minRampFillWidth:p}=this,d=[n,p];s[0].size<s[s.length-1].size&&d.reverse();const c=i.slice().sort(((e,t)=>e>t?1:-1)),[u,h]=d,[g,b]=c,z=a?m.getDynamicPathForSizeStops({max:o,min:l,pathHeight:e,pathWidth:t,stops:s,padding:h}):m.getPathForSizeStops({bottomValue:g,bottomWidth:u,max:o,min:l,pathHeight:e,pathWidth:t,topValue:b,topWidth:h});return y.tsx("path",{d:z,fill:m.getFillFromColor(r)})}};e.__decorate([a.property()],S.prototype,"handlesSyncedToPrimary",null),e.__decorate([a.property()],S.prototype,"label",null),e.__decorate([a.property(),g.messageBundle("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],S.prototype,"messages",void 0),e.__decorate([a.property()],S.prototype,"persistSizeRangeEnabled",null),e.__decorate([a.property()],S.prototype,"primaryHandleEnabled",null),e.__decorate([a.property()],S.prototype,"stops",null),e.__decorate([a.property()],S.prototype,"style",void 0),e.__decorate([s.cast("style")],S.prototype,"castStyle",null),e.__decorate([a.property()],S.prototype,"viewModel",void 0),S=b=e.__decorate([o.subclass("esri.widgets.smartMapping.SizeSlider")],S);return S}));
