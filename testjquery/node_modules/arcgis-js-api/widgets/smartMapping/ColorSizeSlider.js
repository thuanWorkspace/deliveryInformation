/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/Error","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../renderers/visualVariables/support/ColorSizeStop","../../renderers/visualVariables/support/ColorStop","../../renderers/visualVariables/support/SizeStop","./SmartMappingSliderBase","./ColorSizeSlider/ColorSizeSliderViewModel","./support/utils","../support/globalCss","../support/legacyIcon","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory"],(function(e,r,s,t,a,i,l,o,n,d,p,u,m,c,h,g,b,v){"use strict";var S;const y="esri-color-size-slider",z={base:y,widgetIcon:h.legacyIcon.edit,rampElement:`${y}__ramp`,sliderContainer:`${y}__slider-container`,histogramContainer:`${y}__histogram-container`,primaryHandle:`${y}--primary-handle`,track:`${y}--interactive-track`};let f=S=class extends p.SmartMappingSliderBase{constructor(e,r){super(e,r),this._backgroundFillColor="#e0e0e0",this._minRampFillWidth=.2,this._rampNode=null,this._maxRampFillWidth=1,this.messages=null,this.viewModel=new u,this._bgFillId=`${this.id}-bg-fill`,this._rampFillId=`${this.id}-linear-gradient`}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get primaryHandleEnabled(){return this.viewModel.primaryHandleEnabled}set primaryHandleEnabled(e){this.viewModel.primaryHandleEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}static fromRendererResult(e,s){const t=e.size.visualVariables,a=e.renderer.authoringInfo.univariateTheme,i=e.color?.visualVariable.stops,{statistics:l}=e,{avg:n,stddev:d}=l;if(!i)throw new r("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const p="above-and-below"===a,u=e.renderer.authoringInfo.visualVariables[0],m=u.minSliderValue,c=u.maxSliderValue,h=t.find((e=>"outline"!==e?.target&&!(e?.axis&&!e?.field&&!e?.valueExpression)&&(e?.field||e?.valueExpression))),g=h.stops,b=i.map(((e,r)=>{const{color:s,label:t,value:a}=e;let l;return l=g&&g.length>0?g[r].size:0===r?h.minSize:r===i.length-1?h.maxSize:null,new o({color:s,label:t,value:a,size:l})}));return new S({max:c,min:m,stops:b,primaryHandleEnabled:p,handlesSyncedToPrimary:p,persistSizeRangeEnabled:p,histogramConfig:{average:n,standardDeviation:d,bins:s?s.bins:[]}})}updateFromRendererResult(e,s){const t=e.size.visualVariables,a=e.renderer.authoringInfo.univariateTheme,i=e.color?.visualVariable.stops,{statistics:l}=e,{avg:n,stddev:d}=l;if(!i)throw new r("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const p="above-and-below"===a,u=e.renderer.authoringInfo.visualVariables[0],m=u.minSliderValue,c=u.maxSliderValue,h=t.find((e=>"outline"!==e?.target&&!(e?.axis&&!e?.field&&!e?.valueExpression)&&(e?.field||e?.valueExpression))),g=h.stops,b=i.map(((e,r)=>{const{color:s,label:t,value:a}=e;let l;return l=g&&g.length>0?g[r].size:0===r?h.minSize:r===i.length-1?h.maxSize:null,new o({color:s,label:t,value:a,size:l})}));this.set({max:c,min:m,stops:b,primaryHandleEnabled:p,handlesSyncedToPrimary:p,persistSizeRangeEnabled:p,histogramConfig:{average:n,standardDeviation:d,bins:s?s.bins:[]}})}updateRenderer(e){const{stops:r}=this,s=r[0],t=r[r.length-1],a=r[Math.floor(r.length/2)],i=e.clone(),l=i.visualVariables.map((e=>{if("size"===e.type){if("outline"===e?.target||e?.axis&&!e?.field&&!e?.valueExpression)return e;null!=e.minSize&&null!=e.maxSize?e.set({maxDataValue:t.value,minDataValue:s.value,maxSize:t.size,minSize:s.size}):e.stops&&e.set({stops:r.map((e=>{const{label:r,size:s,value:t}=e;return new d({label:r,size:s,value:t})}))})}else"color"===e.type&&e.set({stops:this.stops.map((e=>{const{color:r,label:s,value:t}=e;return new n({color:r,label:s,value:t})}))});return e}));if(i.visualVariables=l,i.classBreakInfos.length>1){const e=a.value;i.classBreakInfos[0].maxValue=e,i.classBreakInfos[1].minValue=e}return i}updateVisualVariables(e){return e.map((e=>{const r=e.clone();if("size"===e.type){if("outline"===e?.target||e?.axis&&!e?.field&&!e?.valueExpression)return r;if(null!=e.minSize&&null!=e.maxSize){const{stops:e}=this,s=e[0],t=e[e.length-1];r.set({maxDataValue:t.value,minDataValue:s.value,maxSize:t.size,minSize:s.size})}else e.stops&&r.set({stops:this.stops.map((e=>{const{label:r,size:s,value:t}=e;return new d({label:r,size:s,value:t})}))})}else"color"===e.type&&r.set({stops:this.stops.map((e=>{const{color:r,label:s,value:t}=e;return new n({color:r,label:s,value:t})}))});return r}))}render(){const{label:e,primaryHandleEnabled:r,state:s,visibleElements:t}=this,a="disabled"===s,i=this.classes(z.base,c.globalCss.widget,c.globalCss.panel,{[c.globalCss.disabled]:a,[z.primaryHandle]:r,[z.track]:!!t.interactiveTrack});return v.tsx("div",{"aria-label":e,class:i},a?null:this.renderContent(this._renderRamp(),z.sliderContainer,z.histogramContainer))}_renderRamp(){const{_bgFillId:e,_rampFillId:r,viewModel:s,zoomOptions:t}=this,a=s.getStopInfo();return v.tsx("div",{afterCreate:g.storeNode,bind:this,class:z.rampElement,"data-node-ref":"_rampNode"},v.tsx("svg",{xmlns:"http://www.w3.org/2000/svg"},v.tsx("defs",null,this.renderRampFillDefinition(r,a),this.renderBackgroundFillDefinition(e)),v.tsx("rect",{fill:this._backgroundFillColor,height:"100%",width:"100%",x:"0",y:"0"}),this._renderPaths()),t?this.renderZoomCaps():null)}_renderPaths(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(null==e||null==r)return;const{primaryHandleEnabled:s,stops:t,values:a,viewModel:{max:i,min:l},_bgFillId:o,_maxRampFillWidth:n,_minRampFillWidth:d,_rampFillId:p}=this,u=[n,d];t[0].size<t[t.length-1].size&&u.reverse();const c=a.slice().sort(((e,r)=>e>r?1:-1)),[h,g]=u,[b,S]=c,y=s?m.getDynamicPathForSizeStops({max:i,min:l,pathHeight:e,pathWidth:r,stops:t,padding:d}):m.getPathForSizeStops({bottomValue:b,bottomWidth:h,max:i,min:l,pathHeight:e,pathWidth:r,topValue:S,topWidth:g});return[v.tsx("path",{d:y,fill:`url(#${o})`,key:"background"}),v.tsx("path",{d:y,fill:`url(#${p})`,key:"fill"})]}};e.__decorate([s.property()],f.prototype,"label",null),e.__decorate([s.property(),b.messageBundle("esri/widgets/smartMapping/ColorSizeSlider/t9n/ColorSizeSlider")],f.prototype,"messages",void 0),e.__decorate([s.property()],f.prototype,"persistSizeRangeEnabled",null),e.__decorate([s.property()],f.prototype,"primaryHandleEnabled",null),e.__decorate([s.property()],f.prototype,"stops",null),e.__decorate([s.property()],f.prototype,"viewModel",void 0),f=S=e.__decorate([l.subclass("esri.widgets.smartMapping.ColorSizeSlider")],f);return f}));
