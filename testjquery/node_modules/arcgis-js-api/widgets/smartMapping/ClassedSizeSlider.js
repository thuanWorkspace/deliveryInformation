/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../Color","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../renderers/support/ClassBreakInfo","./SmartMappingSliderBase","./ClassedSizeSlider/ClassedSizeSliderViewModel","./support/utils","../support/globalCss","../support/legacyIcon","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory"],(function(e,s,r,t,a,i,o,l,n,c,d,p,m,u,h,b){"use strict";var g;const k="esri-classed-size-slider",y={base:k,widgetIcon:m.legacyIcon.edit,rampElement:`${k}__ramp`,sliderContainer:`${k}__slider-container`,histogramContainer:`${k}__histogram-container`,track:`${k}--interactive-track`},w={trackFillColor:new s([149,149,149]),trackBackgroundColor:new s([224,224,224])};let _=g=class extends n.SmartMappingSliderBase{constructor(e,s){super(e,s),this._rampNode=null,this.messages=null,this.style={...w},this.viewModel=new c}get breaks(){return this.viewModel.breaks}set breaks(e){this.viewModel.breaks=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}castStyle(e){return{...w,...e}}static fromRendererResult(e,s){const{renderer:{classBreakInfos:r}}=e,t=r.map((e=>{const s=e.symbol;let r;switch(s.type){case"simple-line":r=s.width;break;case"simple-marker":r=s.size;break;case"picture-marker":r=s.height}return{min:e.minValue,max:e.maxValue,size:r}}));return new g({breaks:t,histogramConfig:{bins:s?s.bins:[]}})}updateClassBreakInfos(e){const s=this.breaks;if(s.length===e.length)return e.map(((e,r)=>{const t=e.symbol;switch(t.type){case"simple-line":t.width=s[r].size;break;case"simple-marker":t.size=s[r].size;break;case"picture-marker":{const e=s[r].size,a=t.width,i=t.height;t.height=e,t.width=e/i*a;break}}return new l({minValue:s[r].min,maxValue:s[r].max,symbol:t})}));console.error(`Number of input breakInfos must match number of slider breaks: ${s.length}`)}updateFromRendererResult(e,s){const{renderer:{classBreakInfos:r}}=e,t=r.map((e=>{const s=e.symbol;let r;switch(s.type){case"simple-line":r=s.width;break;case"simple-marker":r=s.size;break;case"picture-marker":r=s.height}return{min:e.minValue,max:e.maxValue,size:r}}));this.set({breaks:t}),s?.bins&&(this.histogramConfig.bins=s.bins)}render(){const{state:e,label:s,visibleElements:r}=this,t="disabled"===e,a=this.classes(y.base,p.globalCss.widget,p.globalCss.panel,{[p.globalCss.disabled]:t,[y.track]:!!r.interactiveTrack});return b.tsx("div",{"aria-label":s,class:a},t?null:this.renderContent(this._renderRamp(),y.sliderContainer,y.histogramContainer))}_renderRamp(){const{style:{trackBackgroundColor:e}}=this;return b.tsx("div",{afterCreate:u.storeNode,bind:this,class:y.rampElement,"data-node-ref":"_rampNode"},b.tsx("svg",{xmlns:"http://www.w3.org/2000/svg"},b.tsx("rect",{fill:d.getFillFromColor(e),height:"100%",width:"100%",x:"0",y:"0"}),this._renderPath()))}_renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:s=0}=this._rampNode;if(null==e||null==s)return;const{breaks:r,viewModel:{max:t,min:a},style:{trackFillColor:i}}=this,o=t-a,l=s/r.length,n=r.map((s=>e-Math.round((s.min-a)/o*e)+1)).reverse(),c=r[0].size>r[r.length-1].size||!1;let p=c?l:s,m=`M${p} 0 `;return n.forEach(((e,r)=>{const t=l*(r+1);m+=`L${p} ${e} `,p=c?l+t:s-t,m+=`L${p} ${e} `})),m+=`L0 ${e} L0 ${e} L0 0 Z`,b.tsx("path",{d:m,fill:d.getFillFromColor(i)})}};e.__decorate([r.property()],_.prototype,"breaks",null),e.__decorate([r.property()],_.prototype,"label",null),e.__decorate([r.property(),h.messageBundle("esri/widgets/smartMapping/ClassedSizeSlider/t9n/ClassedSizeSlider")],_.prototype,"messages",void 0),e.__decorate([r.property()],_.prototype,"style",void 0),e.__decorate([t.cast("style")],_.prototype,"castStyle",null),e.__decorate([r.property()],_.prototype,"viewModel",void 0),_=g=e.__decorate([o.subclass("esri.widgets.smartMapping.ClassedSizeSlider")],_);return _}));
