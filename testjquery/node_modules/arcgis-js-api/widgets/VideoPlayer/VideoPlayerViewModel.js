/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/Accessor","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../layers/video/videoUtils"],(function(e,t,r,l,i,a,o,s,n){"use strict";const y="esri.widgets.VideoPlayerViewModel";function d(e,t){const r={};for(const l of t){const t=e.get(l);t&&(r[t.name]=t.value)}return r}let h=class extends t{constructor(e){super(e),this.followingMode="follow-both",this.layer=null,this.seekLength=10,this.view=null}initialize(){this.addHandles([r.watch((()=>this.layer),(e=>{e&&e.load().then((()=>this._followTelemetry())).catch((()=>{}))}),r.initial),r.watch((()=>[this.followingMode]),(()=>this._followTelemetry()),r.initial)])}get _layerView(){return this.layer&&this.view?this.view.allLayerViews.find((e=>e.layer===this.layer))??null:null}get buffered(){return this.layer?.buffered||0}get currentTime(){return this.layer?.currentTime||0}get duration(){return this.layer?.duration||0}get ended(){return this.layer?.ended??!0}get metadata(){const e=this.layer?.metadata;return e?{missionInfo:d(e,[n.VideoMetadataEntryId.MissionId,n.VideoMetadataEntryId.PrecisionTimeStamp]),platformInfo:d(e,[n.VideoMetadataEntryId.PlatformTailNumber,n.VideoMetadataEntryId.PlatformTrueAirspeed,n.VideoMetadataEntryId.PlatformCallSign,n.VideoMetadataEntryId.PlatformDesignation,n.VideoMetadataEntryId.PlatformGroundRange]),frameInfo:d(e,[n.VideoMetadataEntryId.FrameCenterElevation,n.VideoMetadataEntryId.FrameCenterLatitude,n.VideoMetadataEntryId.FrameCenterLongitude])}:null}get playing(){return this.layer?.playing??!1}get state(){return this.layer?.loadError?"error":this.layer?.state}play(){this.layer?.play()}pause(){this.layer?.pause()}seekBackward(){if(this.layer){const e=this.layer.currentTime-this.seekLength;e<=0?this.layer.reset():this.layer.setCurrentTime(e)}}seekForward(){if(this.layer){const e=this.layer.currentTime+this.seekLength;e>=this.layer.duration?this.layer.reset():this.layer.setCurrentTime(e)}}seekToBeginning(){this.layer?.setCurrentTime(0)}seekToEnding(){this.layer?.setCurrentTime(this.layer.duration)}seekTo(e){this.layer?.setCurrentTime(e)}toggleSensorDisplay(){this._layerView?.visibleTelemetryElements&&(this._layerView.visibleTelemetryElements.sensorLocation=!this._layerView.visibleTelemetryElements.sensorLocation)}toggleSensorSightLineDisplay(){this._layerView?.visibleTelemetryElements&&(this._layerView.visibleTelemetryElements.lineOfSight=!this._layerView.visibleTelemetryElements.lineOfSight)}toggleSensorTrailDisplay(){this._layerView?.visibleTelemetryElements&&(this._layerView.visibleTelemetryElements.sensorTrail=!this._layerView.visibleTelemetryElements.sensorTrail)}toggleFrameCenterDisplay(){this._layerView?.visibleTelemetryElements&&(this._layerView.visibleTelemetryElements.frameCenter=!this._layerView.visibleTelemetryElements.frameCenter)}toggleFrameOutlineDisplay(){this._layerView?.visibleTelemetryElements&&(this._layerView.visibleTelemetryElements.frameOutline=!this._layerView.visibleTelemetryElements.frameOutline)}changePlaybackSpeed(e){this.layer&&(this.layer.playbackRate=e)}changeGraphicsColor(e){this._layerView&&(this._layerView.symbolColor=e)}_followTelemetry(){this.removeHandles("follow"),this.view&&this.layer&&this.addHandles(r.watch((()=>this.layer?.telemetry),(()=>{const e=[],t="follow-sensor"===this.followingMode||"follow-both"===this.followingMode,r="follow-frame"===this.followingMode||"follow-both"===this.followingMode;t&&this.layer?.telemetry.sensorLocation&&e.push(this.layer.telemetry.sensorLocation),r&&this.layer?.telemetry.frameCenter&&e.push(this.layer.telemetry.frameCenter),e.length&&this.view?.goTo(e).catch((()=>{}))}),r.initial),"follow")}};e.__decorate([l.property()],h.prototype,"_layerView",null),e.__decorate([l.property({readOnly:!0})],h.prototype,"buffered",null),e.__decorate([l.property({readOnly:!0})],h.prototype,"currentTime",null),e.__decorate([l.property({readOnly:!0})],h.prototype,"duration",null),e.__decorate([l.property({readOnly:!0})],h.prototype,"ended",null),e.__decorate([l.property()],h.prototype,"followingMode",void 0),e.__decorate([l.property()],h.prototype,"layer",void 0),e.__decorate([l.property({readOnly:!0})],h.prototype,"metadata",null),e.__decorate([l.property({readOnly:!0})],h.prototype,"playing",null),e.__decorate([l.property()],h.prototype,"seekLength",void 0),e.__decorate([l.property({readOnly:!0})],h.prototype,"state",null),e.__decorate([l.property()],h.prototype,"view",void 0),h=e.__decorate([s.subclass(y)],h);return h}));
