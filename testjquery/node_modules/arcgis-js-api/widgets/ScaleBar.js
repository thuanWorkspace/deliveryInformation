/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../chunks/tslib.es6","../core/deprecate","../core/Logger","../core/reactiveUtils","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","../intl/number","../properties/defaultUnit","./Widget","./ScaleBar/css","./ScaleBar/ScaleBarViewModel","./support/globalCss","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],(function(e,t,s,r,i,a,o,l,n,c,d,p,u,h,v,y,b,m,g){"use strict";function w(e,t){return d.formatNumber(e,{style:"unit",unit:t,unitDisplay:"short"})}const _="esri.widgets.ScaleBar",f=s.getLogger(_);let C=class extends u{constructor(e,t){super(e,t),this.messages=null,this.style="line",this.viewModel=new v}initialize(){this.addHandles(r.watch((()=>{const{view:e}=this;return[e?.stationary,e?.center,e?.scale,e?.zoom]}),(([e])=>{e&&this.scheduleRender()})))}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get unit(){return this._defaultUnit}set unit(e){"non-metric"===e&&t.deprecatedProperty(f,"unit",{replacement:"Please use 'imperial' instead of 'non-metric'.",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-ScaleBar.html#unit",version:"4.27",warnOnce:!0}),this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e="disabled"===this.viewModel.state,t={[y.globalCss.disabled]:e};let s,r;if(!e){const{unit:e,style:t}=this,i="metric"===e||"dual"===e,a=100,o="dual"===e?"line":t;if("imperial"===e||"non-metric"===e||"dual"===e){const e=this.viewModel.getScaleBarProperties(a,"imperial");e&&(r="ruler"===o?this._renderRuler(e):this._renderLine(e,"bottom"))}if(i){const e=this.viewModel.getScaleBarProperties(a,"metric");e&&(s="ruler"===o?this._renderRuler(e):this._renderLine(e,"top"))}}return g.tsx("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(h.css.base,y.globalCss.widget,t)},s,r)}_renderRuler(e){const{length:t,unit:s,value:r}=e,i=Math.round(t),a=w(r,s);return g.tsx("div",{class:this.classes(h.css.barContainer,h.css.rulerBarContainer),key:h.css.rulerBarContainer},g.tsx("div",{class:h.css.ruler,styles:{width:`${i}px`}},g.tsx("div",{class:h.css.rulerBlock}),g.tsx("div",{class:h.css.rulerBlock}),g.tsx("div",{class:h.css.rulerBlock}),g.tsx("div",{class:h.css.rulerBlock})),g.tsx("div",{class:this.classes(h.css.labelContainer,h.css.rulerLabelContainer)},g.tsx("div",{class:h.css.label},"0"),g.tsx("div",{class:h.css.label},a)))}_renderLine(e,t){const{length:s,unit:r,value:i}=e,a=Math.round(s),o=w(i,r),l={[h.css.topLabelContainer]:"top"===t,[h.css.bottomLabelContainer]:"bottom"===t},n=g.tsx("div",{class:this.classes(h.css.labelContainer,h.css.lineLabelContainer,l),key:h.css.labelContainer},g.tsx("div",{class:h.css.label},o)),c={[h.css.topLine]:"top"===t,[h.css.bottomLine]:"bottom"===t},d=g.tsx("div",{class:this.classes(h.css.line,c),key:h.css.line,styles:{width:`${a}px`}});return g.tsx("div",{class:this.classes(h.css.barContainer,h.css.lineBarContainer),key:h.css.lineBarContainer},[d,n])}_handleRootCreateOrUpdate(e){if(!this.viewModel)return;const{scaleComputedFrom:t}=this.viewModel,s=e.getBoundingClientRect(),r=s.left+window.pageXOffset,a=s.top+window.pageYOffset,o=i.createScreenPoint(r,a);(o.x!==t.x||o.y!==t.y)&&(this.viewModel.scaleComputedFrom=o)}};e.__decorate([a.property(p.defaultUnitPropertyMetadata)],C.prototype,"_defaultUnit",void 0),e.__decorate([a.property()],C.prototype,"label",null),e.__decorate([a.property(),m.messageBundle("esri/widgets/ScaleBar/t9n/ScaleBar")],C.prototype,"messages",void 0),e.__decorate([a.property({type:["ruler","line"]})],C.prototype,"style",void 0),e.__decorate([a.property({type:["metric","imperial","dual","non-metric"]})],C.prototype,"unit",null),e.__decorate([a.property()],C.prototype,"view",null),e.__decorate([a.property()],C.prototype,"viewModel",void 0),C=e.__decorate([c.subclass(_)],C);return C}));
