/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/Accessor","../../core/Collection","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../views/layers/support/ClipRect"],(function(e,i,t,r,s,o,n,a,l,p){"use strict";function c(e,i){const t=10**i;return Math.round(e*t)/t}const y={left:0,right:0,top:0,bottom:0};let d=class extends i{constructor(e){super(e),this._leadingClips=new Map,this._trailingClips=new Map,this.direction="horizontal",this.leadingLayers=new t,this.max=100,this.min=0,this.precision=4,this.step=.5,this.stepMultiplier=10,this.trailingLayers=new t,this.view=null}initialize(){this.addHandles([r.watch((()=>[this.view,this.view?.ready,this.position,this.direction]),(()=>this._clipLayers()),r.initial),r.on((()=>this.leadingLayers),"change",(()=>this._clipLeadingLayers())),r.on((()=>this.trailingLayers),"change",(()=>this._clipTrailingLayers()))])}destroy(){this._removeExistingClips()}get position(){return 25}set position(e){const{precision:i,min:t,max:r}=this;this._set("position",c(Math.max(Math.min(e,r),t),i))}get state(){const{view:e}=this;return e&&e.ready?"ready":"disabled"}_clipLayers(){this._clipLeadingLayers(),this._clipTrailingLayers()}_clipLeadingLayers(){this._removeClips("leading");const{leadingLayers:e}=this;e.forEach((e=>this._clipLayer({layer:e,type:"leading"})))}_clipTrailingLayers(){this._removeClips("trailing");const{trailingLayers:e}=this;e.forEach((e=>this._clipLayer({layer:e,type:"trailing"})))}async _getLayerView(e){const{view:i}=this;if(!e||!i)return null;const t=await i.whenLayerView(e);return"clips"in t?t:null}_getVerticalClipRect(e){const{position:i}=this;return"leading"===e?new p({...y,bottom:100-i+"%"}):"trailing"===e?new p({...y,top:`${i}%`}):null}_getHorizontalClipRect(e){const{position:i}=this;return"leading"===e?new p({...y,right:100-i+"%"}):"trailing"===e?new p({...y,left:`${i}%`}):null}_getClipRect(e){const{direction:i}=this;return"vertical"===i?this._getVerticalClipRect(e):"horizontal"===i?this._getHorizontalClipRect(e):null}async _clipLayer(e){const{_leadingClips:i,_trailingClips:t}=this,{layer:r,type:s}=e,o="trailing"===s?t:"leading"===s?i:null,n=await this._getLayerView(r);if(!(n&&"clips"in n&&o&&n.hasOwnProperty("clips")))return;const a=o.get(n);a&&n.clips.remove(a);const l=this._getClipRect(s);l&&(o.set(n,l),n.clips.add(l))}_removeClips(e){const{_leadingClips:i,_trailingClips:t}=this,r="trailing"===e?t:"leading"===e?i:null;r&&(r.forEach(((e,i)=>{i&&i.hasOwnProperty("clips")&&i.clips.remove(e)})),r.clear())}_removeExistingClips(){this._removeClips("leading"),this._removeClips("trailing")}};e.__decorate([s.property()],d.prototype,"direction",void 0),e.__decorate([s.property({type:t,nonNullable:!0})],d.prototype,"leadingLayers",void 0),e.__decorate([s.property({readOnly:!0})],d.prototype,"max",void 0),e.__decorate([s.property({readOnly:!0})],d.prototype,"min",void 0),e.__decorate([s.property()],d.prototype,"position",null),e.__decorate([s.property()],d.prototype,"precision",void 0),e.__decorate([s.property({readOnly:!0})],d.prototype,"state",null),e.__decorate([s.property()],d.prototype,"step",void 0),e.__decorate([s.property()],d.prototype,"stepMultiplier",void 0),e.__decorate([s.property({type:t,nonNullable:!0})],d.prototype,"trailingLayers",void 0),e.__decorate([s.property()],d.prototype,"view",void 0),d=e.__decorate([l.subclass("esri.widgets.Swipe.SwipeViewModel")],d);return d}));
