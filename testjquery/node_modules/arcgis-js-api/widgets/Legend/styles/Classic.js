/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../Widget","./ClassicCSS","./support/relationshipUtils","./support/univariateUtils","../support/styleUtils","../../support/globalCss","../../support/Heading","../../support/widgetUtils","../../support/decorators/messageBundle","../../support/jsxFactory"],(function(e,s,t,a,r,i,l,o,n,c,p,d,y,m,v,h){"use strict";const g=`${o.legend}__`,u=24,b={display:"flex",alignItems:"flex-start"},x={marginLeft:"3px"},f={display:"table-cell",verticalAlign:"middle"};let L=class extends l{constructor(e,s){super(e,s),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return h.tsx("div",null,s&&s.length?s:h.tsx("div",{class:o.css.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const s=!!e.children.length,t=`${g}${e.layer.uid}-version-${e.version}`,a=e.title?y.Heading({level:this.headingLevel,class:this.classes(d.globalCss.heading,o.css.label)},e.title):null;if(s){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return h.tsx("div",{class:this.classes(o.css.service,o.css.groupLayer),key:t},a,s)}{const s=e.legendElements;if(s&&!s.length)return null;const r=s.map((s=>this._renderLegendForElement(s,e.layer,e.effectList))).filter((e=>!!e));if(!r.length)return null;const i={[o.css.groupLayerChild]:!!e.parent};return h.tsx("div",{class:this.classes(o.css.service,i),key:t},a,h.tsx("div",{class:o.css.layer},r))}}_renderLegendForElement(e,s,t,a){const r="color-ramp"===e.type,i="opacity-ramp"===e.type,l="size-ramp"===e.type;let c=null;if("symbol-table"===e.type||l){const a=e.infos.map((a=>this._renderLegendForElementInfo(a,s,t,l,e.legendType))).filter((e=>!!e));a.length&&(c=h.tsx("div",{class:o.css.layerBody},a))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?c=this._renderLegendForRamp(e,s.opacity):"relationship-ramp"===e.type?c=n.renderRelationshipRamp(e,this.id,{opacity:s.opacity,effectList:t,ariaLabel:this.messages.previewRelationshipRampAriaLabel}):"pie-chart-ramp"===e.type?c=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?c=this._renderUnivariateAboveAndBelowRamp(e,s.opacity,t):"univariate-color-size-ramp"===e.type&&(c=this._renderUnivariateColorSizeRamp(e,s.opacity,t));if(!c)return null;const d=e.title;let y=null;if("string"==typeof d)y=d;else if(d){const e=p.getTitle(this.messages,d,r||i);y=p.isRendererTitle(d,r||i)&&d.title?`${d.title} (${e})`:e}const m=a?o.css.layerChildTable:o.css.layerTable,v=y?h.tsx("div",{class:o.css.layerCaption},y):null,g={[o.css.layerTableSizeRamp]:l||!a};return h.tsx("div",{class:this.classes(m,g)},v,c)}_renderPieChartRamp(e){return h.tsx("div",{afterCreate:p.attachToNode,bind:e.preview})}_renderUnivariateAboveAndBelowRamp(e,s,t){const{sizeRampElement:a,colorRampElement:r}=c.getUnivariateAboveAndBelowRampElements(e,s);if(!a)return null;const i=this.messages?.previewColorRampAriaLabel,l=c.getUnivariateColorRampSize(a,"above",!0),n=c.getUnivariateColorRampSize(a,"below",!0),d=12,y=c.getUnivariateColorRampPreview(r,{width:d,height:l,rampAlignment:"vertical",opacity:s,type:"above",effectList:t,ariaLabel:i}),m=c.getUnivariateColorRampPreview(r,{width:d,height:n,rampAlignment:"vertical",opacity:s,type:"below",effectList:t,ariaLabel:i}),v=c.getUnivariateColorRampMargin(a),g=a.infos.map((e=>e.label)),u=g.map(((e,s)=>{const t=2===s;return 0===s?h.tsx("div",{class:e?y?o.css.univariateAboveAndBelowLabel:o.css.rampLabel:void 0,key:s},e):t?h.tsx("div",null):null})),L=g.length-1,C=Math.floor(g.length/2),w=g.map(((e,s)=>s===C||s===L?h.tsx("div",{class:e?y?o.css.univariateAboveAndBelowLabel:o.css.rampLabel:void 0,key:s},e):null)),R={display:"table-cell",verticalAlign:"middle"},_={marginTop:`${v}px`},A={height:`${l}px`},T={height:`${n}px`};return h.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:b},h.tsx("div",{class:o.css.layerBody},a.infos.map(((e,s)=>h.tsx("div",{class:this.classes(o.css.layerRow,o.css.sizeRamp)},h.tsx("div",{afterCreate:p.attachToNode,bind:e.preview,class:o.css.symbol,styles:R}),y||s%2!=0?null:h.tsx("div",{class:o.css.layerInfo},g[s]))))),y?h.tsx("div",{key:"color-ramp-preview",styles:_},h.tsx("div",{styles:x},h.tsx("div",{styles:f},h.tsx("div",{afterCreate:p.attachToNode,bind:y,class:o.css.rampContainer})),h.tsx("div",{styles:f},h.tsx("div",{class:o.css.rampLabelsContainer,styles:A},u))),h.tsx("div",{styles:x},h.tsx("div",{styles:f},h.tsx("div",{afterCreate:p.attachToNode,bind:m,class:o.css.rampContainer})),h.tsx("div",{styles:f},h.tsx("div",{class:o.css.rampLabelsContainer,styles:T},w)))):null)}_renderUnivariateColorSizeRamp(e,s,t){const{sizeRampElement:a,colorRampElement:r}=c.getUnivariateColorSizeRampElements(e);if(!a)return null;const i=c.getUnivariateColorRampMargin(a),l=12,n=c.getUnivariateColorRampSize(a,"full",!1),d=c.getUnivariateColorRampPreview(r,{width:l,height:n,rampAlignment:"vertical",opacity:s,type:"full",effectList:t,ariaLabel:this.messages?.previewColorRampAriaLabel}),y=a.infos.length-1,m=a.infos.map(((e,s)=>0===s||s===y?h.tsx("div",{class:e.label?r?o.css.univariateAboveAndBelowLabel:o.css.rampLabel:void 0,key:s},e.label):null)),v={display:"table-cell",verticalAlign:"middle"},g={marginTop:`${i}px`},u={height:`${n}px`};return h.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:b},h.tsx("div",{class:o.css.layerBody},a.infos.map((e=>h.tsx("div",{class:this.classes(o.css.layerRow,o.css.sizeRamp)},h.tsx("div",{afterCreate:p.attachToNode,bind:e.preview,class:o.css.symbol,styles:v}))))),h.tsx("div",{key:"color-ramp-preview",styles:g},h.tsx("div",{styles:x},h.tsx("div",{styles:f},h.tsx("div",{afterCreate:p.attachToNode,bind:d,class:o.css.rampContainer})),h.tsx("div",{styles:f},h.tsx("div",{class:o.css.rampLabelsContainer,styles:u},m)))))}_renderLegendForRamp(e,s){const t=e.infos,a="opacity-ramp"===e.type,r="heatmap-ramp"===e.type,i="stretch-ramp"===e.type,l=e.preview,n=a?o.css.opacityRamp:"";l.className=`${o.css.colorRamp} ${n}`,null!=s&&(l.style.opacity=s.toString());const c=t.map((e=>h.tsx("div",{class:e.label?o.css.rampLabel:void 0},r?this.messages[e.label]||e.label:i?p.getStretchStopLabel(e,this.messages):e.label))),d={width:`${u}px`},y={height:l.style.height};return h.tsx("div",{class:o.css.layerRow},h.tsx("div",{class:o.css.symbolContainer,styles:d},h.tsx("div",{afterCreate:p.attachToNode,bind:l,class:o.css.rampContainer})),h.tsx("div",{class:o.css.layerInfo},h.tsx("div",{class:o.css.rampLabelsContainer,styles:y},c)))}_renderLegendForElementInfo(e,s,t,a,r){if(e.type)return this._renderLegendForElement(e,s,t,!0);let i=null;const l=p.isImageryStretchedLegend(s,r);if(e.preview?i=h.tsx("div",{afterCreate:p.attachToNode,bind:e.preview,class:o.css.symbol}):e.src&&(i=this._renderImage(e,s,l)),!i)return null;const n={[o.css.imageryLayerInfoStretched]:l},c={[o.css.imageryLayerInfoStretched]:l,[o.css.sizeRamp]:!l&&a};return h.tsx("div",{class:o.css.layerRow},h.tsx("div",{class:this.classes(o.css.symbolContainer,c)},i),h.tsx("div",{class:this.classes(o.css.layerInfo,n)},p.getTitle(this.messages,e.label,!1)||""))}_renderImage(e,s,t){const{label:a,src:r,opacity:i}=e,l={[o.css.imageryLayerStretchedImage]:t,[o.css.symbol]:!t},n={opacity:`${null!=i?i:s.opacity}`};return h.tsx("img",{alt:p.getTitle(this.messages,a,!1),"aria-label":p.getTitle(this.messages,a,!1),border:0,class:this.classes(l),height:e.height,src:r,styles:n,width:e.width})}};e.__decorate([s.property()],L.prototype,"activeLayerInfos",void 0),e.__decorate([s.property()],L.prototype,"headingLevel",void 0),e.__decorate([s.property(),v.messageBundle("esri/widgets/Legend/t9n/Legend")],L.prototype,"messages",void 0),e.__decorate([s.property({readOnly:!0})],L.prototype,"type",void 0),L=e.__decorate([i.subclass("esri.widgets.Legend.styles.Classic")],L);return L}));
