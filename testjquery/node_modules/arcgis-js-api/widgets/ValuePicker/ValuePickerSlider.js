/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../../chunks/tslib.es6","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../Slider","../support/componentsUtils","../support/widgetUtils","../support/jsxFactory","./ValuePickerBaseComponent","./ValuePickerSliderVisibleElements"],(function(e,t,s,i,o,r,l,n,a,p,u,c,d,h,_){"use strict";const v="esri-value-picker__slider",m={minorTick:`${v}__tick-minor`,majorTick:`${v}__tick-major`,stepsTick:`${v}__tick-steps`,tooltip:`${v}__tooltip`};function y(e){return(t,s)=>{s?.classList.add(e)}}let b=class extends h{constructor(e,t){super(e,t),this._majorTickCreatedFunction=y(m.majorTick),this._minorTickCreatedFunction=y(m.minorTick),this._stepsTickCreatedFunction=y(m.stepsTick),this._thumbNode=null,this._tooltip=null,this._slider=new p({thumbCreatedFunction:(e,t,s)=>{this._thumbNode=s}}),this.labelFormatFunction=null,this.labels=null,this.min=null,this.minorTicks=null,this.majorTicks=null,this.max=null,this.reversed=!1,this.steps=null,this.type="slider",this.visibleElements=new _,this._thumbDragDebounced=s.debounce((async e=>{await(this._tooltip?.reposition(!1))}))}initialize(){this.addHandles([i.watch((()=>this.viewModel?.values),(e=>{this._slider.values=e}),i.initial),i.watch((()=>this._slider.values),(e=>{this.viewModel&&this.viewModel.values!==e&&(this.viewModel.values=e)})),this._slider.on("thumb-drag",this._thumbDragDebounced)])}destroy(){this._slider.destroy()}loadDependencies(){return u.loadCalciteComponents({tooltip:()=>new Promise(((t,s)=>e(["../../chunks/calcite-tooltip"],t,s)))})}get _ascending(){const{reversed:e,viewModel:t}=this;if(!t)return null;const{layout:s}=t;return"horizontal"===s&&!e||"vertical"===s&&e}get canNext(){const{_ascending:e,min:t,max:s,steps:i,viewModel:o}=this;if(null==e||null==t||null==s||!i?.length||!o)return!1;const{values:r}=o,l=r?.[0];return null==l||(e?l!==i[i.length-1]:l!==i[0])}get canPlay(){return null!=this.viewModel&&!!this.steps?.length&&null!=this.min&&null!=this.max}get canPrevious(){const{_ascending:e,min:t,max:s,steps:i,viewModel:o}=this;if(null==e||null==t||null==s||!i?.length||!o)return!1;const{values:r}=o,l=r?.[0];return null==l||(e?l!==i[0]:l!==i[i.length-1])}render(){const{labels:e,labelFormatFunction:t,min:s,max:i,steps:o,minorTicks:r,majorTicks:l,reversed:n,viewModel:a}=this;if(!a)return d.tsx("div",null);const{disabled:p,layout:u}=a,c=`${u}${n?"-reversed":""}`,h="position",_=[];return null!=s&&null!=i&&(r&&_.push({mode:h,values:r,tickCreatedFunction:this._minorTickCreatedFunction}),l&&_.push({mode:h,values:l,tickCreatedFunction:this._majorTickCreatedFunction}),e&&_.push({mode:h,values:e,labelsVisible:!0}),this.visibleElements.steps&&this.steps&&_.push({mode:h,values:this.steps,tickCreatedFunction:this._stepsTickCreatedFunction})),this._slider.set({disabled:p,labelFormatFunction:t,layout:c,min:s,max:i,steps:o,tickConfigs:_}),d.tsx("div",{class:v},this._slider.render(),this._renderToolTip())}animate(e){this._step(1,e)}next(){this._step(this._ascending?1:-1)}previous(){this._step(this._ascending?-1:1)}_onTooltipAfterCreate(e){this._tooltip=e}_renderToolTip(){if(!this.visibleElements.thumbTooltip||!this._thumbNode||!this._slider.values)return null;const e=this._slider.viewModel.getLabelForValue(this._slider.values[0],"value");return e?d.tsx("calcite-tooltip",{afterCreate:this._onTooltipAfterCreate,class:m.tooltip,referenceElement:this._thumbNode},e):null}_step(e,t=!1){if(!this.viewModel||!this.steps?.length)return;if(!this.viewModel.values||!this.steps.includes(this.viewModel.values[0]))return void(this.viewModel.values=[this.steps[0]]);const s=this.steps.indexOf(this.viewModel.values[0])+e;s<0||s>=this.steps.length?this.viewModel.loop||t?this.viewModel.values=[this.steps[1===e?0:this.steps.length-1]]:"playing"===this.viewModel.state&&this.viewModel.pause():this.viewModel.values=[this.steps[s]]}};t.__decorate([o.property()],b.prototype,"_ascending",null),t.__decorate([o.property()],b.prototype,"canNext",null),t.__decorate([o.property()],b.prototype,"canPlay",null),t.__decorate([o.property()],b.prototype,"canPrevious",null),t.__decorate([o.property()],b.prototype,"labelFormatFunction",void 0),t.__decorate([o.property()],b.prototype,"labels",void 0),t.__decorate([o.property()],b.prototype,"min",void 0),t.__decorate([o.property()],b.prototype,"minorTicks",void 0),t.__decorate([o.property()],b.prototype,"majorTicks",void 0),t.__decorate([o.property()],b.prototype,"max",void 0),t.__decorate([o.property({nonNullable:!0})],b.prototype,"reversed",void 0),t.__decorate([o.property()],b.prototype,"steps",void 0),t.__decorate([o.property()],b.prototype,"type",void 0),t.__decorate([o.property({type:_,nonNullable:!0})],b.prototype,"visibleElements",void 0),b=t.__decorate([a.subclass("esri.widgets.ValuePicker.ValuePickerSlider")],b);return b}));
