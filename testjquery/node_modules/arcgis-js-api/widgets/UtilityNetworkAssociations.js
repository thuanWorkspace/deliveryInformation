/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","./Widget","./support/componentsUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","./UtilityNetworkAssociations/UtilityNetworkAssociationsLineSymbolPicker","./UtilityNetworkAssociations/UtilityNetworkAssociationsViewModel","./UtilityNetworkAssociations/VisibleElements"],(function(t,s,e,i,o,n,a,l,c,r,d,h,A,u,w,m){"use strict";const b="esri-un-associations",p={action:`${b}__action`,actionRefresh:`${b}__action-refresh`,blockContent:`${b}__block-content`,blockSectionSettings:`${b}__block-section-settings`,divControlsMain:`${b}__div-controls-main`,label:`${b}__label`,labelAndSlider:`${b}__label-and-slider`,labelAndToggle:`${b}__label-and-toggle`,slider:`${b}__slider`,statusIconContainer:`${b}__status-icon-container`,statusIconWarning:`${b}__status-icon-warning`,switch:`${b}__switch`,switchContainer:`${b}__switch-container`,widgetContainer:`${b}__widget-container`};let g=class extends c{constructor(t,s){super(t,s),this._autoRefreshAssociations=!0,this._associationsOptionsEnabled=!1,this._maxAllowableAssociationsSliderMax=1e3,this._maxAllowableAssociationsSliderMin=250,this._maxAllowableAssociationsSliderStep=250,this.messages=null,this.messagesCommon=null,this.viewModel=new w,this.visibleElements=new m}initialize(){this.addHandles([e.watch((()=>[this.view?.stationary,this.showAssociationsEnabled,this.includeConnectivityAssociations,this.includeStructuralAttachmentAssociations,this.maxAllowableAssociations]),(()=>{!0===this.autoRefreshAssociations&&(!0===this.showAssociationsEnabled?this.viewModel.showAssociations():this.viewModel.removeAssociations())}))])}get autoRefreshAssociations(){return this._autoRefreshAssociations}set autoRefreshAssociations(t){this._autoRefreshAssociations=t}get connectivityAssociationsLineSymbol(){return this.viewModel.connectivityAssociationsLineSymbol}set connectivityAssociationsLineSymbol(t){this.viewModel.connectivityAssociationsLineSymbol=t}get includeConnectivityAssociations(){return this.viewModel.includeConnectivityAssociations}set includeConnectivityAssociations(t){this.viewModel.includeConnectivityAssociations=t}get includeStructuralAttachmentAssociations(){return this.viewModel.includeStructuralAttachmentAssociations}set includeStructuralAttachmentAssociations(t){this.viewModel.includeStructuralAttachmentAssociations=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get maxAllowableAssociations(){return this.viewModel.maxAllowableAssociations}set maxAllowableAssociations(t){this.viewModel.maxAllowableAssociations=t}get maxAllowableAssociationsSliderMax(){return this._maxAllowableAssociationsSliderMax}set maxAllowableAssociationsSliderMax(t){t<=this.maxAllowableAssociationsSliderMin||(this._maxAllowableAssociationsSliderMax=t)}get maxAllowableAssociationsSliderMin(){return this._maxAllowableAssociationsSliderMin}set maxAllowableAssociationsSliderMin(t){t<0||t>=this.maxAllowableAssociationsSliderMax||(this._maxAllowableAssociationsSliderMin=t)}get maxAllowableAssociationsSliderStep(){return this._maxAllowableAssociationsSliderStep}set maxAllowableAssociationsSliderStep(t){this._maxAllowableAssociationsSliderStep=t}get showArrowsConnectivity(){return this.viewModel.showArrowsConnectivity}set showArrowsConnectivity(t){this.viewModel.showArrowsConnectivity=t}get showArrowsStructuralAttachment(){return this.viewModel.showArrowsStructuralAttachment}set showArrowsStructuralAttachment(t){this.viewModel.showArrowsStructuralAttachment=t}get showAssociationsEnabled(){return this.viewModel.showAssociationsEnabled}set showAssociationsEnabled(t){this.viewModel.showAssociationsEnabled=t}get structuralAttachmentAssociationsLineSymbol(){return this.viewModel.structuralAttachmentAssociationsLineSymbol}set structuralAttachmentAssociationsLineSymbol(t){this.viewModel.structuralAttachmentAssociationsLineSymbol=t}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(t){this.viewModel.utilityNetwork=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{label:t}=this;return A.tsx("div",{class:p.widgetContainer},A.tsx("calcite-block",{class:p.blockContent,collapsible:!0,heading:t},this._renderStatusIcon(),this.autoRefreshAssociations?this._renderShowAssociationsSwitch():this._renderRefreshAssociationsAction(),this._renderContent()))}loadDependencies(){return r.loadCalciteComponents({action:()=>new Promise(((s,e)=>t(["../chunks/calcite-action"],s,e))),block:()=>new Promise(((s,e)=>t(["../chunks/calcite-block"],s,e))),"block-section":()=>new Promise(((s,e)=>t(["../chunks/calcite-block-section"],s,e))),icon:()=>new Promise(((s,e)=>t(["../chunks/calcite-icon"],s,e))),label:()=>new Promise(((s,e)=>t(["../chunks/calcite-label"],s,e))),notice:()=>new Promise(((s,e)=>t(["../chunks/calcite-notice"],s,e))),panel:()=>new Promise(((s,e)=>t(["../chunks/calcite-panel"],s,e))),slider:()=>new Promise(((s,e)=>t(["../chunks/calcite-slider"],s,e))),switch:()=>new Promise(((s,e)=>t(["../chunks/calcite-switch"],s,e))),tooltip:()=>new Promise(((s,e)=>t(["../chunks/calcite-tooltip"],s,e)))})}_connectivityAssociationsSwitchChange(t){this.includeConnectivityAssociations=t.target.checked}_getLoadErrorMessagesAsNotices(t,s){return A.tsx("calcite-notice",{closable:!1,key:`error-notice-${s}`,kind:"warning",open:!0,scale:"s"},A.tsx("div",{slot:"message"},t))}_maxAllowableAssociationsSliderChange(t){this.maxAllowableAssociations=Number(t.target.value)}_refreshAssociations(){const{viewModel:t,viewModel:{state:s}}=this;"ready"!==s&&"warning"!==s||t.showAssociations()}_renderConnectivityAsssociationsSettings(){const{messages:{input:{enableConnectivity:t}},visibleElements:{connectivityAssociationsSettings:s}}=this;if(s)return A.tsx("calcite-block-section",{class:p.blockSectionSettings,text:t},A.tsx(u,{id:`${this.id}-symbol-picker-connectivity`,lineSymbol:this.connectivityAssociationsLineSymbol,showArrows:this.showArrowsConnectivity,visibleElements:s}))}_renderConnectivityAssociationsToggle(){const{messages:{input:{enableConnectivity:t}}}=this;return A.tsx("div",{class:p.labelAndToggle,key:"connectivityAssociationsToggleDiv"},A.tsx("calcite-label",{class:p.label},t),A.tsx("calcite-switch",{bind:this,checked:this.includeConnectivityAssociations,disabled:!this._associationsOptionsEnabled&&this.autoRefreshAssociations,onCalciteSwitchChange:this._connectivityAssociationsSwitchChange}))}_renderContent(){const{viewModel:{loadErrors:t,state:s}}=this;return"disabled"===s?A.tsx("div",{class:p.divControlsMain,key:"loadErrorsDiv"},t.items.map(this._getLoadErrorMessagesAsNotices)):A.tsx("calcite-panel",{disabled:"loading"===s},A.tsx("div",{class:p.divControlsMain},this._renderConnectivityAssociationsToggle(),this._renderStructuralAttachmentAssociationsToggle(),this._renderSettingsPane()))}_renderLoadingAction(t,s,e){return A.tsx("div",{key:t,slot:"control"},A.tsx("calcite-action",{id:s,loading:!0,text:e}),A.tsx("calcite-tooltip",{referenceElement:s},A.tsx("span",null,e)))}_renderMaxAllowableAssociationsSlider(){const{messages:{input:{maxAllowableAssociations:t}},visibleElements:{maxAllowableAssociationsSlider:s}}=this;if(s)return A.tsx("div",{class:p.labelAndSlider},A.tsx("calcite-label",{class:p.label},t),A.tsx("calcite-slider",{bind:this,class:p.slider,labelTicks:!0,max:this.maxAllowableAssociationsSliderMax,min:this.maxAllowableAssociationsSliderMin,scale:"s",snap:!0,step:this.maxAllowableAssociationsSliderStep,ticks:this.maxAllowableAssociationsSliderStep,value:this.maxAllowableAssociations,onCalciteSliderChange:this._maxAllowableAssociationsSliderChange}))}_renderRefreshAssociationsAction(){const{messages:{input:{refreshAssociations:t}},messagesCommon:{loading:s},viewModel:{state:e}}=this,i=`${this.id}-refresh-action`;if("disabled"!==e)return A.tsx("div",{class:p.actionRefresh,slot:"control"},A.tsx("calcite-action",{bind:this,class:p.action,icon:"refresh-",id:i,loading:"loading"===e,onclick:this._refreshAssociations,text:t}),A.tsx("calcite-tooltip",{referenceElement:i},A.tsx("span",null,"loading"===e?s:t)))}_renderSettingsPane(){const{messagesCommon:{settings:t},visibleElements:{maxAllowableAssociationsSlider:s,connectivityAssociationsSettings:e,structuralAttachmentAssociationsSettings:i}}=this;if(s||e||i)return A.tsx("calcite-block",{class:p.blockContent,collapsible:!0,heading:t},this._renderMaxAllowableAssociationsSlider(),this._renderConnectivityAsssociationsSettings(),this._renderStructuralAttachmentAsssociationsSettings())}_renderShowAssociationsSwitch(){const{messages:{input:{enableAssociations:t}},messagesCommon:{loading:s},viewModel:{state:e}}=this,i=`${this.id}-show-associations-switch`;if("disabled"!==e)return"loading"===e?this._renderLoadingAction("loadingActionDiv",`${this.id}-loading-action`,s):A.tsx("div",{class:p.switchContainer,key:"switchDiv",slot:"control"},A.tsx("calcite-switch",{bind:this,checked:this.showAssociationsEnabled,class:p.switch,id:i,onCalciteSwitchChange:this._showAssociationsSwitchChange}),A.tsx("calcite-tooltip",{referenceElement:i},A.tsx("span",null,t)))}_renderStatusIcon(){const{messagesCommon:{executing:t},viewModel:{executionError:s,state:e}}=this;switch(e){case"disabled":return this._renderWarningIcon("statusDiv",`${this.id}-disabled-icon`,null);case"warning":return this._renderWarningIcon("statusDiv",`${this.id}-warning-icon`,s);case"executing":return this._renderLoadingAction("executingActionDiv",`${this.id}-executing-action`,t);default:return}}_renderStructuralAttachmentAsssociationsSettings(){const{messages:{input:{enableStructuralAttachment:t}},visibleElements:{structuralAttachmentAssociationsSettings:s}}=this;if(s)return A.tsx("calcite-block-section",{class:p.blockSectionSettings,text:t},A.tsx(u,{id:`${this.id}-symbol-picker-structural-attachment`,lineSymbol:this.structuralAttachmentAssociationsLineSymbol,showArrows:this.showArrowsStructuralAttachment,visibleElements:s}))}_renderStructuralAttachmentAssociationsToggle(){const{messages:{input:{enableStructuralAttachment:t}}}=this;return A.tsx("div",{class:p.labelAndToggle,key:"structuralAttachmentAssociationsToggleDiv"},A.tsx("calcite-label",{class:p.label},t),A.tsx("calcite-switch",{bind:this,checked:this.includeStructuralAttachmentAssociations,disabled:!this._associationsOptionsEnabled&&this.autoRefreshAssociations,onCalciteSwitchChange:this._structuralAttAssociationsSwitchChange}))}_showAssociationsSwitchChange(t){const{viewModel:s}=this;this.showAssociationsEnabled=t.target.checked,this._associationsOptionsEnabled=t.target.checked,this.showAssociationsEnabled||s.removeAssociations()}_structuralAttAssociationsSwitchChange(t){this.includeStructuralAttachmentAssociations=t.target.checked}_renderWarningIcon(t,s,e){return e?A.tsx("div",{class:p.statusIconContainer,key:t,slot:"control"},A.tsx("calcite-icon",{class:p.statusIconWarning,icon:"exclamation-mark-triangle",id:s,scale:"s"}),A.tsx("calcite-tooltip",{referenceElement:s},A.tsx("span",null,e))):A.tsx("div",{class:p.statusIconContainer,key:t,slot:"control"},A.tsx("calcite-icon",{class:p.statusIconWarning,icon:"exclamation-mark-triangle",id:s,scale:"s"}))}};s.__decorate([i.property()],g.prototype,"autoRefreshAssociations",null),s.__decorate([i.property()],g.prototype,"connectivityAssociationsLineSymbol",null),s.__decorate([i.property()],g.prototype,"includeConnectivityAssociations",null),s.__decorate([i.property()],g.prototype,"includeStructuralAttachmentAssociations",null),s.__decorate([i.property()],g.prototype,"label",null),s.__decorate([i.property()],g.prototype,"maxAllowableAssociations",null),s.__decorate([i.property()],g.prototype,"maxAllowableAssociationsSliderMax",null),s.__decorate([i.property()],g.prototype,"maxAllowableAssociationsSliderMin",null),s.__decorate([i.property()],g.prototype,"maxAllowableAssociationsSliderStep",null),s.__decorate([i.property(),h.messageBundle("esri/widgets/UtilityNetworkAssociations/t9n/UtilityNetworkAssociations")],g.prototype,"messages",void 0),s.__decorate([i.property(),h.messageBundle("esri/t9n/common")],g.prototype,"messagesCommon",void 0),s.__decorate([i.property()],g.prototype,"showArrowsConnectivity",null),s.__decorate([i.property()],g.prototype,"showArrowsStructuralAttachment",null),s.__decorate([i.property()],g.prototype,"showAssociationsEnabled",null),s.__decorate([i.property()],g.prototype,"structuralAttachmentAssociationsLineSymbol",null),s.__decorate([i.property()],g.prototype,"utilityNetwork",null),s.__decorate([i.property()],g.prototype,"view",null),s.__decorate([i.property({type:w})],g.prototype,"viewModel",void 0),s.__decorate([i.property({type:m,nonNullable:!0})],g.prototype,"visibleElements",void 0),g=s.__decorate([l.subclass("esri.widgets.UtilityNetworkAssociations")],g);return g}));
