/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/Collection","../../core/Evented","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../LayerList/support/layerListUtils","./ListItem"],(function(e,t,s,i,a,r,o,l,c,d,n){"use strict";const h={map:"map",tables:"tables",layerListMode:"layer-list-mode"},m="hide",p=t.ofType(n);let b=class extends s.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.tableItems=new p,this.map=null}initialize(){this.addHandles([i.watch((()=>[this.map,this.map?.loaded]),(()=>this._mapHandles()),i.initial),i.watch((()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled]),(()=>this._recompileList()))],h.map)}destroy(){this.map=null,this.tableItems.removeAll()}get state(){const e=this.map?.loadStatus;return"string"==typeof e?"loaded"===e?"ready":"loading"===e?"loading":"disabled":"disabled"}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}_mapHandles(){const{map:e}=this;this.removeHandles(h.tables),this._compileList(),e&&this.addHandles(i.watch((()=>this.map?.allTables?.toArray()),(()=>this._compileList()),i.initial),h.tables)}_removeAllItems(){this.tableItems.removeAll()}_getViewableTables(e){if(e)return e.filter((e=>d.findLayerListMode(e)!==m))}_watchTablesListMode(e){this.removeHandles(h.layerListMode),e&&e.forEach((e=>{this.addHandles(i.watch((()=>e.listMode),(()=>this._compileList())),h.layerListMode)}))}_compileList(){const e=this.map?.tables;this._watchTablesListMode(e);const t=this._getViewableTables(e);t?.length?(this._createNewItems(t),this._removeItems(t),this._sortItems(t)):this._removeAllItems()}_createNewItems(e){const{tableItems:t,listItemCreatedFunction:s,checkPublishStatusEnabled:i}=this;e.forEach((e=>{t.find((t=>t.layer===e))||t.add(new n({checkPublishStatusEnabled:i,layer:e,listItemCreatedFunction:s}))}))}_removeItems(e){const{tableItems:t}=this;t.forEach((s=>{if(!s)return;const i=e?.find((e=>s.layer===e));i||t.remove(s)}))}_sortItems(e){const{tableItems:t}=this;t.sort(((t,s)=>{const i=e.indexOf(t.layer),a=e.indexOf(s.layer);return i>a?-1:i<a?1:0}))}_recompileList(){this._removeAllItems(),this._compileList()}};e.__decorate([a.property()],b.prototype,"checkPublishStatusEnabled",void 0),e.__decorate([a.property()],b.prototype,"listItemCreatedFunction",void 0),e.__decorate([a.property({type:p,readOnly:!0})],b.prototype,"tableItems",void 0),e.__decorate([a.property()],b.prototype,"map",void 0),e.__decorate([a.property({readOnly:!0})],b.prototype,"state",null),b=e.__decorate([c.subclass("esri.widgets.TableList.TableListViewModel")],b);return b}));
