/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../core/Logger","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","./Widget","./Daylight/css","./Daylight/DaylightViewModel","./Daylight/VisibleElements","./Daylight/support/daylightUtils","./Daylight/support/SliderWithDropdown","./support/componentsUtils","./support/DatePicker","./support/globalCss","./support/Heading","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],(function(e,t,s,i,l,o,a,r,n,d,c,h,p,g,u,y,_,b,m,w,v,k){"use strict";const S=/(.*)\s(.*)/,C="date",P="esri.widgets.Daylight";let M=class extends d{constructor(e,t){super(e,t),this.headingLevel=3,this.iconClass=c.css.widgetIcon,this.icon=null,this.viewModel=new h,this.visibleElements=new p,this.dateOrSeason=C,this._timeSlider=new u({viewModel:this.viewModel.timeSliderViewModel,steps:this.timeSliderSteps,labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:this._onPrimaryTickCreated.bind(this)},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:this._onSecondaryTickCreated.bind(this)}]}),this._datePicker=new _({viewModel:this.viewModel.datePickerViewModel,commitOnMonthChange:!0}),this._onPlayDayClick=()=>{this.viewModel.toggleDayPlaying()},this._onYearPlayClick=()=>{this.viewModel.toggleYearPlaying()},this._onSeasonChange=e=>{this.viewModel.currentSeason=e.target.value},this._onSunLightingCheckboxChange=()=>{this.viewModel.toggleSunLightingEnabled()},this._onShadowCheckboxChange=()=>{this.viewModel.toggleDirectShadowsEnabled()}}get label(){return this.messages?.title??""}set label(e){this._overrideIfSome("label",e)}get playSpeedMultiplier(){return this.viewModel.playSpeedMultiplier}set playSpeedMultiplier(e){this.viewModel.playSpeedMultiplier=e}get timeSliderSteps(){return this._timeSlider?.steps??5}set timeSliderSteps(e){this._timeSlider.steps=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get test(){return{datePicker:this._datePicker}}get _useAmPm(){const e=this._timeSlider.viewModel.getLabelForValue(0,"tick");return null!=e&&S.test(e)}postInitialize(){this.viewModel.isSupported&&this.addHandles([i.watch((()=>this.viewModel.datePickerViewModel),(e=>this._datePicker.viewModel=e),i.syncAndInitial),i.watch((()=>this.viewModel.timeSliderViewModel),(e=>this._timeSlider.viewModel=e),i.syncAndInitial),i.watch((()=>this.visibleElements?.timezone),(e=>this._timeSlider.showDropDown=e),i.syncAndInitial),i.watch((()=>!this.viewModel.sunLightingEnabled),(e=>{this._datePicker.disabled=e,this._timeSlider.disabled=e}),i.syncAndInitial),i.when((()=>!this.visible),(()=>this._datePicker?.close(!1)),i.sync)])}destroy(){this._datePicker.destroy(),this._timeSlider.destroy()}render(){const{messages:e,viewModel:t,visibleElements:s}=this,i=t.isSupported;return k.tsx("div",{class:this.classes(c.css.base,b.globalCss.widget)},i?k.tsx(k.tsxFragment,null,s.header?k.tsx(m.Heading,{level:this.headingLevel},e.title):null,this._renderTimeOptions(),s.datePicker?this._renderDateOrSeason():null,s.sunLightingToggle?this._renderSunLightingToggle():null,s.shadowsToggle?this._renderShadowsToggle():null):k.tsx("div",{class:c.css.panelError,key:"unsupported"},k.tsx("p",null,e.unsupported)))}loadDependencies(){return y.loadCalciteComponents({button:()=>new Promise(((t,s)=>e(["../chunks/calcite-button"],t,s))),checkbox:()=>new Promise(((t,s)=>e(["../chunks/calcite-checkbox"],t,s))),label:()=>new Promise(((t,s)=>e(["../chunks/calcite-label"],t,s))),option:()=>new Promise(((t,s)=>e(["../chunks/calcite-option"],t,s))),select:()=>new Promise(((t,s)=>e(["../chunks/calcite-select"],t,s)))})}_renderTimeOptions(){const{viewModel:e,visibleElements:t,messages:s}=this,{directShadowsEnabled:i,dayPlaying:l}=e,o=!e.sunLightingEnabled;return k.tsx("div",{class:this.classes(c.css.dayContainer,{[c.css.sliderShadowOn]:i,[c.css.sliderShadowOff]:!i,[c.css.sliderDateOn]:t.datePicker,[c.css.sliderDateOff]:!t.datePicker,[c.css.sliderAmPmOn]:this._useAmPm,[c.css.containerDisabled]:o}),key:"daylight-time-options"},this._timeSlider.render(),t.playButtons?this._renderPlayPauseButton({playing:l,disabled:o,label:s.playDay,onClick:this._onPlayDayClick}):null)}_renderDateOptions(){const{viewModel:e,visibleElements:t,messages:s}=this,{yearPlaying:i}=e,l=!e.sunLightingEnabled;return k.tsx("div",{class:this.classes(c.css.dateContainer,l&&c.css.containerDisabled),key:"daylight-date"},this._datePicker.render(),t.playButtons?this._renderPlayPauseButton({playing:i,disabled:l,label:s.playYear,onClick:this._onYearPlayClick}):null)}_renderPlayPauseButton({playing:e,disabled:t,label:s,onClick:i}){return k.tsx("calcite-button",{appearance:"solid",class:c.css.playPauseButton,disabled:t,iconStart:e?"pause-f":"play-f",label:s,onclick:i,round:!0,title:s,type:"button"})}_renderSeasonSelect(){const{messages:e,viewModel:t}=this,s=!t.sunLightingEnabled;return k.tsx("calcite-select",{class:this.classes(c.css.seasonPicker),disabled:s,label:e.season,onCalciteSelectChange:this._onSeasonChange},g.orderedSeasons.map((s=>k.tsx("calcite-option",{selected:t.currentSeason===s,value:s},e[s]))))}_renderDateOrSeason(){return"date"===this.dateOrSeason?this._renderDateOptions():this._renderSeasonSelect()}_renderSunLightingToggle(){const e=this.messages?.sunLightingToggle;return k.tsx("calcite-label",{key:"date-time-toggle",layout:"inline",scale:"s",title:e?.tooltip},k.tsx("calcite-checkbox",{checked:this.viewModel.sunLightingEnabled,class:c.css.sunLightingCheckbox,onCalciteCheckboxChange:this._onSunLightingCheckboxChange}),e?.label)}_renderShadowsToggle(){const e=this.messages.shadowsToggle;return k.tsx("calcite-label",{key:"shadow-toggle",layout:"inline",scale:"s",title:e?.tooltip},k.tsx("calcite-checkbox",{checked:this.viewModel.directShadowsEnabled,class:c.css.shadowsCheckbox,onCalciteCheckboxChange:this._onShadowCheckboxChange}),e.label)}_onPrimaryTickCreated(e,t,s){t.classList.add(...x,b.globalCss.primaryTick),s.classList.add(...x,b.globalCss.primaryTickLabel),s.onclick=t.onclick=this._makeGoToTime(e);const i=s.textContent,l=null!=i&&S.exec(i);l&&(s.innerHTML=`${l[1]}<br><div class=${b.globalCss.primaryTickAmPm}>${l[2]}</div>`)}_onSecondaryTickCreated(e,t){t.classList.add(...x,b.globalCss.secondaryTick),t.onclick=this._makeGoToTime(e)}_makeGoToTime(e){return()=>{this.viewModel.timeSliderPosition=e}}};t.__decorate([l.property(),v.messageBundle("esri/widgets/Daylight/t9n/Daylight")],M.prototype,"messages",void 0),t.__decorate([l.property(),v.messageBundle("esri/widgets/support/t9n/timezone")],M.prototype,"timezoneMessages",void 0),t.__decorate([l.property()],M.prototype,"headingLevel",void 0),t.__decorate([l.property()],M.prototype,"iconClass",void 0),t.__decorate([l.property()],M.prototype,"icon",void 0),t.__decorate([l.property()],M.prototype,"label",null),t.__decorate([l.property()],M.prototype,"playSpeedMultiplier",null),t.__decorate([l.property()],M.prototype,"timeSliderSteps",null),t.__decorate([l.property()],M.prototype,"view",null),t.__decorate([l.property({type:h})],M.prototype,"viewModel",void 0),t.__decorate([l.property({type:p,nonNullable:!0})],M.prototype,"visibleElements",void 0),t.__decorate([l.property({cast:e=>"season"===e||"date"===e?e:(s.getLogger(P).warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${C}".`),C)})],M.prototype,"dateOrSeason",void 0),t.__decorate([l.property()],M.prototype,"_timeSlider",void 0),t.__decorate([l.property()],M.prototype,"_useAmPm",null),t.__decorate([l.property()],M.prototype,"_datePicker",void 0),M=t.__decorate([n.subclass(P)],M);const x=["esri-interactive","esri-widget__anchor"];return M}));
