/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/Accessor","../../core/arrayUtils","../../core/Collection","../../core/collectionUtils","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/accessorSupport/decorators/subclass","./support/layerUtils","./support/validation"],(function(e,t,l,a,r,s,o,i,n,d,u,h){"use strict";let y=class extends t{constructor(e){super(e),this.state="disabled",this._valueBeforeReady=null,this._domainInfo=h.getDomainInfo([]),this._loadLayers=u.createLoadLayersFunction(),this.layers=new a}initialize(){this.addHandles(this.layers.on("change",(()=>this._onLayersChange()))),this._onLayersChange()}destroy(){this._set("state","disabled")}get enabled(){return this.allowedValues.length>0&&this._get("enabled")}set enabled(e){e!==this.enabled&&this.allowedValues.length>0&&this._set("enabled",e)}get value(){return("ready"===this.state?this._get("value"):this._valueBeforeReady)??0}set value(e){if("ready"!==this.state)return void(this._valueBeforeReady=e);if(e===this.value)return;const t=h.getValidNumber(e,this);null!=t&&this._set("value",t)}get min(){return h.getMin(this.allowedValues)}get max(){return h.getMax(this.allowedValues)}get allowedValues(){return this._domainInfo.allowedValues}get hasNext(){if(!this.enabled)return!0;const e=this._valueIndex;return e>=0&&e<this.allowedValues.length-1}get hasPrevious(){return!this.enabled||this._valueIndex>0}set layers(e){const t=this._get("layers");this._set("layers",r.referenceSetter(e,t))}get filterExpressions(){return{solid:null,xRay:null}}get _valueIndex(){return l.binaryIndexOf(this.allowedValues,this.value)}select(e){if("ready"!==this.state)return void(this._valueBeforeReady=e);null!=h.getValidNumber(e,this)&&(this.enabled=!0,this.value=e)}clear(){"ready"===this.state?this.enabled=!1:this._valueBeforeReady=null}next(){const{state:e,allowedValues:t,enabled:l,hasNext:a,_valueIndex:r}=this;if("ready"===e||null==this._valueBeforeReady){if(0!==t.length)return l?void(a&&(this.value=t[r+1])):(this.enabled=!0,void(this.value=t[0]))}else this._valueBeforeReady++}previous(){const{state:e,allowedValues:t,enabled:l,hasPrevious:a,_valueIndex:r}=this;if("ready"===e||null==this._valueBeforeReady){if(0!==t.length)return l?void(a&&(this.value=t[r-1])):(this.enabled=!0,void(this.value=t[t.length-1]))}else this._valueBeforeReady++}getValueLabel(e){return 0===this.layers.length?null:this._domainInfo.fieldValueMap.get(e)??null}async _onLayersChange(){if(this._set("state","loading"),this._domainInfo=h.getDomainInfo([]),0!==this.layers.length)try{await this._loadLayers(this.layers),this._setup()}catch(e){s.isAbortError(e)||this._set("state","failed")}}};e.__decorate([o.property({value:!1,nonNullable:!0})],y.prototype,"enabled",null),e.__decorate([o.property({nonNullable:!0})],y.prototype,"value",null),e.__decorate([o.property({readOnly:!0})],y.prototype,"min",null),e.__decorate([o.property({readOnly:!0})],y.prototype,"max",null),e.__decorate([o.property({readOnly:!0})],y.prototype,"allowedValues",null),e.__decorate([o.property({readOnly:!0})],y.prototype,"hasNext",null),e.__decorate([o.property({readOnly:!0})],y.prototype,"hasPrevious",null),e.__decorate([o.property({type:a,nonNullable:!0})],y.prototype,"layers",null),e.__decorate([o.property({nonNullable:!0})],y.prototype,"state",void 0),e.__decorate([o.property()],y.prototype,"_valueBeforeReady",void 0),e.__decorate([o.property({readOnly:!0})],y.prototype,"_valueIndex",null),e.__decorate([o.property()],y.prototype,"_domainInfo",void 0),y=e.__decorate([d.subclass("esri.widgets.BuildingExplorer.BuildingNumericFilterViewModel")],y);return y}));
