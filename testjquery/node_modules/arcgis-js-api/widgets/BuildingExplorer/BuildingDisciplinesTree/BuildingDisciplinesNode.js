/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../../chunks/tslib.es6","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../Widget","../support/LayerTreeNode","../../support/legacyIcon","../../support/widgetUtils","../../support/jsxFactory"],(function(e,s,i,t,l,o,r,a,d,n,c,h){"use strict";var g;const p={expand:"expand",collapse:"collapse",hideSublayer:"hideSublayer",showSublayer:"showSublayer"},b="esri-building-disciplines-tree-node",_={base:b,root:`${b}--root`,leaf:`${b}--leaf`,label:`${b}__label`,checkbox:`${b}__checkbox`,checkboxChecked:`${b}__checkbox--checked`,checkboxIndeterminate:`${b}__checkbox--indeterminate`,collapseToggle:`${b}__collapse-toggle`,collapseToggleCollapsed:`${b}__collapse-toggle--collapsed`,children:`${b}__children`,level:e=>`${b}--level-${e}`};let y=g=class extends a{constructor(e){super(e),this.messages=p,this.toggleSiblingsVisibility=!1,this._childWidgets=[],this._updateChildWidgets=()=>{this._destroyChildWidgets(),this._childWidgets=this.node.children.toArray().reverse().map((e=>new g({node:e,messages:this.messages,toggleSiblingsVisibility:this.toggleSiblingsVisibility})))}}initialize(){this.addHandles([s.on((()=>this.node.children),"after-changes",this._updateChildWidgets,{onListenerAdd:this._updateChildWidgets,onListenerRemove:this._updateChildWidgets}),s.watch((()=>[this.messages,this.toggleSiblingsVisibility]),this._updateChildWidgets,s.initial)])}destroy(){this._destroyChildWidgets()}render(){const e=this.node,s=e.isRoot,i=e.isLeaf;return e.isDiscipline&&i?h.tsx("div",{key:`${e.id}-empty`}):h.tsx("div",{"aria-expanded":e.collapsed?"false":"true",bind:this,class:this.classes(_.base,_.level(e.level),{[_.root]:s,[_.leaf]:i}),key:e.id,onkeydown:this._onKeydown,role:"treeitem",tabIndex:i?void 0:0},h.tsx("label",{bind:this,class:_.label,onclick:this._onCheckboxToggle},this._renderCollapseToggle(),this._renderCheckbox(),h.tsx("span",null,e.title)),this._renderChildren(e))}_renderCheckbox(){const e=this.node.visible,s=!0===e,i=null===e,t=s?this.messages?.hideSublayer:this.messages?.showSublayer;return h.tsx("button",{"aria-checked":s?"true":"false","aria-label":t,bind:this,class:this.classes(_.checkbox,{[_.checkboxChecked]:s,[n.legacyIcon.checkMark]:s,[_.checkboxIndeterminate]:i,[n.legacyIcon.minus]:i}),onclick:this._onCheckboxToggle,role:"checkbox",title:t,type:"button"})}_renderCollapseToggle(){if(!this.node.hasChildren)return null;const e=this.node.collapsed,s=e?this.messages?.expand:this.messages?.collapse;return h.tsx("div",{"aria-label":s,bind:this,class:this.classes(_.collapseToggle,n.legacyIcon.right,{[_.collapseToggleCollapsed]:e}),onclick:this._onCollapseToggle,title:s})}_renderChildren(e){return!e.hasChildren||e.collapsed?null:h.tsx("div",{class:_.children},this._childWidgets.map((e=>e.render())))}_onKeydown(e){switch(e.key){case"Space":case"Enter":if(!e.target.classList.contains(_.base))return;e.stopPropagation(),this.node.toggleVisibility();break;case"ArrowLeft":e.stopPropagation(),this.node.toggleCollapsed(!c.isRTL(this.container));break;case"ArrowRight":e.stopPropagation(),this.node.toggleCollapsed(c.isRTL(this.container))}}_onCheckboxToggle(e){e.preventDefault(),e.stopPropagation();(e.metaKey||e.ctrlKey)&&this.toggleSiblingsVisibility?this.node.toggleAllSiblingsVisibility():this.node.toggleVisibility()}_onCollapseToggle(e){e.preventDefault(),e.stopPropagation(),this.node.toggleCollapsed()}_destroyChildWidgets(){this._childWidgets.forEach((e=>e.destroy())),this._childWidgets=[]}};e.__decorate([i.property({type:d.LayerTreeNode})],y.prototype,"node",void 0),e.__decorate([i.property()],y.prototype,"messages",void 0),e.__decorate([i.property({nonNullable:!0})],y.prototype,"toggleSiblingsVisibility",void 0),e.__decorate([i.property()],y.prototype,"_childWidgets",void 0),y=g=e.__decorate([r.subclass("esri.widgets.BuildingExplorer.BuildingDisciplinesTree.BuildingDisciplinesNode")],y);return y}));
