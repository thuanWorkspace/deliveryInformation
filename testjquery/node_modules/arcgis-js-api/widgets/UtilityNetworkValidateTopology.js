/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","./Widget","./support/componentsUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","./UtilityNetworkValidateTopology/UtilityNetworkValidateTopologyViewModel"],(function(t,e,s,o,i,n,a,r,c,l,d,u,p){"use strict";const x="esri-un-validate-topology",g={container:`${x}__container`,content:`${x}__content`,controlsContainer:`${x}__controls-container`,statusIconError:`${x}__status-icon-error`,statusIconSuccess:`${x}__status-icon-success`,statusIconContainer:`${x}__status-icon-container`};let h=class extends r{constructor(t,e){super(t,e),this.messages=null,this.viewModel=new p}loadDependencies(){return c.loadCalciteComponents({action:()=>new Promise(((e,s)=>t(["../chunks/calcite-action"],e,s))),block:()=>new Promise(((e,s)=>t(["../chunks/calcite-block"],e,s))),icon:()=>new Promise(((e,s)=>t(["../chunks/calcite-icon"],e,s))),notice:()=>new Promise(((e,s)=>t(["../chunks/calcite-notice"],e,s))),option:()=>new Promise(((e,s)=>t(["../chunks/calcite-option"],e,s))),select:()=>new Promise(((e,s)=>t(["../chunks/calcite-select"],e,s))),tooltip:()=>new Promise(((e,s)=>t(["../chunks/calcite-tooltip"],e,s)))})}get extentToValidate(){return this.viewModel.extentToValidate}set extentToValidate(t){this.viewModel.extentToValidate=t}get label(){return this.messages?.label??""}set label(t){this._overrideIfSome("label",t)}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(t){this.viewModel.utilityNetwork=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{viewModel:t}=this;return"disabled"===t.state?u.tsx("div",{class:g.container},u.tsx("calcite-block",{class:g.content,collapsible:!1,heading:this.label,open:!0},this._renderLoadErrorStatusIcon(),this._renderLoadErrorsNotices())):u.tsx("div",{class:g.container},u.tsx("calcite-block",{class:g.content,collapsible:!0,heading:this.label,open:!1},this._renderStatusIcon(),this._renderValidateTopologyAction(),this._renderControls()))}_extentOptionSelectChange(t){this.extentToValidate=t.target.value}_getLoadErrorMessagesAsNotices(t,e){return u.tsx("calcite-notice",{closable:!1,key:"error-notice-"+e,kind:"warning",open:!0,scale:"s"},u.tsx("div",{slot:"message"},t))}_handleValidateTopologyAction(){this.viewModel.validateTopology().catch((()=>{}))}_renderControls(){const{viewModel:t}=this;return"failed"===t.state?u.tsx("div",{class:g.controlsContainer},this._renderExtentOptionSelect(),this._renderStatusNotice()):this._renderExtentOptionSelect()}_renderExtentOptionSelect(){const{messages:t,viewModel:e}=this;return u.tsx("div",{key:"selectExtentDiv"},u.tsx("calcite-select",{bind:this,disabled:"loading"===e.state||"executing"===e.state,label:t.input.extentToValidate,onCalciteSelectChange:this._extentOptionSelectChange},u.tsx("calcite-option",{value:"current"},t.input.currentExtent),u.tsx("calcite-option",{value:"entire"},t.input.entireExtent)))}_renderLoadErrorsNotices(){const{viewModel:t}=this;return u.tsx("div",{class:g.controlsContainer,key:"loadErrorsDiv"},t.loadErrors.items.map(this._getLoadErrorMessagesAsNotices))}_renderLoadErrorStatusIcon(){return u.tsx("div",{class:g.statusIconContainer,key:"statusDiv",slot:"control"},u.tsx("calcite-icon",{class:g.statusIconError,icon:"exclamation-mark-triangle",scale:"s"}))}_renderStatusIcon(){const{messages:t,viewModel:e}=this,s=`${this.id}-validation-status-action`,o=`${this.id}-error-status-icon`,i=`${this.id}-success-status-icon`,n=t=>{setTimeout((()=>{t.innerHTML=""}),3500)};return"executing"===e.state?u.tsx("div",{key:"statusDivExecuting",slot:"control"},u.tsx("calcite-action",{id:s,loading:!0,text:t.status.executing,textEnabled:!1}),u.tsx("calcite-tooltip",{referenceElement:s},u.tsx("span",null,t.status.executing))):"success"===e.state?u.tsx("div",{afterCreate:n,class:g.statusIconContainer,key:"statusDivSuccess",slot:"control"},u.tsx("calcite-icon",{class:g.statusIconSuccess,icon:"check-circle",id:i,scale:"s"}),u.tsx("calcite-tooltip",{referenceElement:i},u.tsx("span",null,t.status.success))):"failed"===e.state?u.tsx("div",{class:g.statusIconContainer,key:"statusDivFailed",slot:"control"},u.tsx("calcite-icon",{class:g.statusIconError,icon:"exclamation-mark-triangle",id:o,scale:"s"}),u.tsx("calcite-tooltip",{referenceElement:o},u.tsx("span",null,e.executionError))):u.tsx("div",{class:g.statusIconContainer,key:"statusDiv",slot:"control"})}_renderStatusNotice(){const{viewModel:t}=this;return u.tsx("div",{key:"executionErrorDiv"},u.tsx("calcite-notice",{closable:!0,kind:"warning",open:!0,scale:"s"},u.tsx("div",{slot:"message"},t.executionError)))}_renderValidateTopologyAction(){const{messages:t,viewModel:e}=this,s=`${this.id}-validation-action`;return u.tsx("div",{key:"actionDiv",slot:"control"},u.tsx("calcite-action",{bind:this,disabled:"executing"===e.state,icon:"play-f",id:s,loading:"loading"===e.state,onclick:this._handleValidateTopologyAction,text:t.input.validateTopology,textEnabled:!1}),u.tsx("calcite-tooltip",{referenceElement:s},u.tsx("span",null,"loading"===e.state?t.status.loading:t.input.validateTopology)))}};e.__decorate([s.property()],h.prototype,"extentToValidate",null),e.__decorate([s.property()],h.prototype,"label",null),e.__decorate([s.property(),d.messageBundle("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology")],h.prototype,"messages",void 0),e.__decorate([s.property()],h.prototype,"utilityNetwork",null),e.__decorate([s.property()],h.prototype,"view",null),e.__decorate([s.property({type:p})],h.prototype,"viewModel",void 0),h=e.__decorate([a.subclass("esri.widgets.UtilityNetworkValidateTopology")],h);return h}));
