/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../TimeInterval","../core/arrayUtils","../core/compilerUtils","../core/reactiveUtils","../core/timeUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","../intl/date","../time/timeZoneUtils","./Slider","./Widget","./support/componentsUtils","./support/globalCss","./support/legacyIcon","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/widgetUtils","../support/themeUtils","./TimeSlider/css","./TimeSlider/TimeSliderViewModel"],(function(t,e,i,s,a,o,r,n,l,u,c,m,d,p,h,v,y,x,f,g,_,b,w,k,T){"use strict";const E=3,C=858,M=[{minor:{value:100,unit:"milliseconds"},major:{value:1,unit:"seconds"},format:{second:"numeric"}},{minor:{value:500,unit:"milliseconds"},major:{value:5,unit:"seconds"},format:{second:"numeric"}},{minor:{value:1,unit:"seconds"},major:{value:20,unit:"seconds"},format:{minute:"numeric",second:"numeric"}},{minor:{value:2,unit:"seconds"},major:{value:30,unit:"seconds"},format:{minute:"numeric",second:"numeric"}},{minor:{value:10,unit:"seconds"},major:{value:1,unit:"minutes"},format:{minute:"numeric"}},{minor:{value:15,unit:"seconds"},major:{value:5,unit:"minutes"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:1,unit:"minutes"},major:{value:20,unit:"minutes"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:5,unit:"minutes"},major:{value:2,unit:"hours"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:15,unit:"minutes"},major:{value:6,unit:"hours"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:1,unit:"hours"},major:{value:1,unit:"days"},format:{day:"numeric",month:"short"}},{minor:{value:6,unit:"hours"},major:{value:1,unit:"weeks"},format:{day:"numeric",month:"short"}},{minor:{value:1,unit:"days"},major:{value:1,unit:"months"},format:{month:"long"}},{minor:{value:2,unit:"days"},major:{value:1,unit:"months"},format:{month:"short"}},{minor:{value:3,unit:"days"},major:{value:1,unit:"months"},format:{month:"short"}},{minor:{value:4,unit:"days"},major:{value:3,unit:"months"},format:{month:"short",year:"numeric"}},{minor:{value:1,unit:"weeks"},major:{value:1,unit:"years"},format:{year:"numeric"}},{minor:{value:1,unit:"months"},major:{value:1,unit:"years"},format:{year:"numeric"}},{minor:{value:2,unit:"months"},major:{value:2,unit:"years"},format:{year:"numeric"}},{minor:{value:1,unit:"years"},major:{value:1,unit:"decades"},format:{year:"numeric"}},{minor:{value:2,unit:"years"},major:{value:5,unit:"decades"},format:{year:"numeric"}},{minor:{value:5,unit:"decades"},major:{value:10,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:1,unit:"centuries"},major:{value:10,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:2,unit:"centuries"},major:{value:20,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:5,unit:"centuries"},major:{value:50,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:10,unit:"centuries"},major:{value:100,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:20,unit:"centuries"},major:{value:200,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:50,unit:"centuries"},major:{value:500,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:100,unit:"centuries"},major:{value:1e3,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:200,unit:"centuries"},major:{value:1e3,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:500,unit:"centuries"},major:{value:5e3,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:1e3,unit:"centuries"},major:{value:1e4,unit:"centuries"},format:{era:"short",year:"numeric"}}];let S=class extends p{constructor(t,e){super(t,e),this._ignoreNextSliderUpdate=!1,this._slider=new d({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),this._tickFormat=null,this.disabled=!1,this.iconClass=k.css.widgetIcon,this.icon=null,this.labelFormatFunction=null,this.messages=null,this.messagesCommon=null,this.tickConfigs=null,this.timeVisible=!1,this.viewModel=new T}initialize(){this.addHandles([o.watch((()=>this._slider.values),(t=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const e=this.viewModel.valuesToTimeExtent(t);null!=this.timeExtent?null!=e?this.timeExtent.equals(e)||(this.timeExtent=e):this.timeExtent=null:null!=e&&(this.timeExtent=e)})),o.watch((()=>this.effectiveStops),(()=>this._updateSliderSteps()),o.initial)])}loadDependencies(){return h.loadCalciteComponents({action:()=>new Promise(((e,i)=>t(["../chunks/calcite-action"],e,i))),"action-menu":()=>new Promise(((e,i)=>t(["../chunks/calcite-action-menu"],e,i)))})}destroy(){this._slider.destroy(),this._tickFormat=null}get _dateFormat(){return this._getIntlOptions("short-date")}get _timeFormat(){return this._getIntlOptions("long-time")}get actions(){return this.viewModel.actions}set actions(t){this.viewModel.actions=t}get effectiveStops(){return this.viewModel.effectiveStops}get fullTimeExtent(){return this.viewModel.fullTimeExtent}set fullTimeExtent(t){this.viewModel.fullTimeExtent=t}get interactive(){return!(this.disabled||"disabled"===this.viewModel.state||this.timeZone===m.unknown)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}set layout(t){["auto","compact","wide"].includes(t)||(t="auto"),this._set("layout",t)}get loop(){return this.viewModel.loop}set loop(t){this.viewModel.loop=t}get mode(){return this.viewModel.mode}set mode(t){this.viewModel.mode=t}get playRate(){return this.viewModel.playRate}set playRate(t){this.viewModel.playRate=t}get stops(){return this.viewModel.stops}set stops(t){this.viewModel.stops=t}get tickFormats(){const{timeZone:t}=this;return M.map((({minor:e,major:s,format:a})=>({minor:new i(e),major:new i(s),format:{...a,timeZone:t}})))}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(t){this.viewModel.timeExtent=t}get timeZone(){return this.viewModel.view?.timeZone??m.system}set timeZone(t){this._overrideIfSome("timeZone",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}static async getPropertiesFromWebMap(t,e){return T.getPropertiesFromWebMap(t,e)}next(){return this.viewModel.next()}play(){return this.viewModel.play()}previous(){return this.viewModel.previous()}stop(){return this.viewModel.stop()}render(){const{_slider:t,actions:e,domNode:i,effectiveStops:a,fullTimeExtent:o,interactive:r,messages:n,messagesCommon:l,mode:u,tickConfigs:m,timeExtent:d,timeVisible:p,viewModel:{state:h,timeExtentValues:x}}=this;if(null!=o){const{start:e,end:i}=o;if(null!=e&&null!=i){const s=e.getTime(),a=i.getTime(),o=t.min!==s||t.max!==a;if(o&&(t.min=s,t.max=a),null!=m)t.tickConfigs!==m&&(t.tickConfigs=m);else{const e=(a-s)/(t.trackElement?.offsetWidth||400),i=this.tickFormats.find((t=>t.minor.toMilliseconds()>E*e))??this.tickFormats.at(-1),r=this._tickFormat!==i&&null!=i;if(r&&(this._tickFormat=i),o||r){const e={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(t,e)=>{e?.classList.add(k.css.sliderMinorTick)}},s={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(t,e)=>{e?.classList.add(k.css.sliderMajorTick)},labelFormatFunction:t=>c.formatDate(t,i.format)};t.tickConfigs=[e,s]}}}}const f=null==this.fullTimeExtent?.start||null==this.fullTimeExtent.end||null==this.timeExtent||this.timeExtent.isAllTime||this.timeExtent.isEmpty||null!=this.timeExtent.start&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||null!=this.timeExtent.end&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(f)switch(this._ignoreNextSliderUpdate=!0,u){case"time-window":t.values=[t.min,t.max];break;case"instant":case"cumulative-from-end":t.values=[t.min];break;case"cumulative-from-start":t.values=[t.max]}else null!=x?s.equals(t.values,x)||(t.values=x):t.values=null;t.disabled=!r;const g="ready"===h,T="playing"===h,M=f||!r||null==a||0===a.length,S="auto"===this.layout?i.clientWidth<C?"compact":"wide":this.layout,j=_.tsx("div",{class:k.css.animation},_.tsx("button",{"aria-disabled":M?"true":"false","aria-label":T?l.control.stop:l.control.play,bind:this,class:this.classes(v.globalCss.widgetButton,k.css.animationButton,M&&v.globalCss.buttonDisabled),disabled:M,onclick:this._playOrStopClick,title:T?l.control.stop:l.control.play,type:"button"},_.tsx("div",{class:this.classes((g||M)&&y.legacyIcon.play,T&&y.legacyIcon.pause)}))),F=null!=this.labelFormatFunction?_.tsx("div",{afterCreate:this._createLabel,afterUpdate:this._createLabel,bind:this,class:k.css.timeExtentDate,"data-date":d?[d.start,d.end]:null,"data-layout":S,"data-type":"extent",key:"extent"}):null==d||null!=d&&d.isAllTime?[_.tsx("div",{class:this.classes(k.css.warning,y.legacyIcon.noticeTriangle)}),_.tsx("div",{class:k.css.warningText,key:"warning-text"},n.noTimeExtent)]:d.isEmpty?[_.tsx("div",{class:this.classes(k.css.warning,y.legacyIcon.noticeTriangle)}),_.tsx("div",{class:k.css.warningText,key:"warning-text"},n.emptyTimeExtent)]:[null!=d.start&&_.tsx("div",{class:k.css.timeExtentGroup,key:"start-date-group"},_.tsx("div",{class:k.css.timeExtentDate,key:"start-date"},this._formatDate(d.start)),p?_.tsx("div",{class:k.css.timeExtentTime,key:"start-time"},this._formatTime(d.start)):null),null!=d.start&&null!=d.end&&d.start.getTime()!==d.end.getTime()&&_.tsx("div",{class:k.css.timeExtentSeparator,key:"separator"},"â€“"),null!=d.end&&(null==d.start||d.start.getTime()!==d.end.getTime())&&_.tsx("div",{class:k.css.timeExtentGroup,key:"end-date-group"},_.tsx("div",{class:k.css.timeExtentDate,key:"end-date"},this._formatDate(d.end)),p?_.tsx("div",{class:k.css.timeExtentTime,key:"end-time"},this._formatTime(d.end)):null)],D=_.tsx("div",{class:this.classes(k.css.timeExtent,!r&&v.globalCss.buttonDisabled)},[F]),I=null!=this.labelFormatFunction?_.tsx("div",{afterCreate:this._createLabel,afterUpdate:this._createLabel,bind:this,class:k.css.minDate,"data-date":o?.start,"data-layout":S,"data-type":"min",key:"min-date"}):null!=o?.start&&[_.tsx("div",{class:k.css.minDate,key:"min-date"},this._formatDate(o.start)),p&&_.tsx("div",{class:k.css.minTime,key:"min-time"},this._formatTime(o.start))],U=_.tsx("div",{class:this.classes(k.css.min,!r&&v.globalCss.buttonDisabled)},[I]),L=_.tsx("div",{class:k.css.slider},t.render()),Z=null!=this.labelFormatFunction?_.tsx("div",{afterCreate:this._createLabel,afterUpdate:this._createLabel,bind:this,class:k.css.maxDate,"data-date":o?.end,"data-layout":S,"data-type":"max",key:"max-date"}):null!=o?.end&&[_.tsx("div",{class:k.css.maxDate,key:"max-date"},this._formatDate(o.end)),p&&_.tsx("div",{class:k.css.maxTime,key:"max-time"},this._formatTime(o.end))],R=_.tsx("div",{class:this.classes(k.css.max,!r&&v.globalCss.buttonDisabled)},[Z]),B=_.tsx("div",{class:k.css.previous},_.tsx("button",{"aria-disabled":M?"true":"false","aria-label":l.pagination.previous,bind:this,class:this.classes(v.globalCss.widgetButton,k.css.previousButton,(T||M)&&v.globalCss.buttonDisabled),disabled:M,onclick:this._previousClick,title:l.pagination.previous,type:"button"},_.tsx("div",{class:y.legacyIcon.reverse}))),O=_.tsx("div",{class:k.css.next},_.tsx("button",{"aria-disabled":M?"true":"false","aria-label":l.pagination.next,bind:this,class:this.classes(v.globalCss.widgetButton,k.css.nextButton,(T||M)&&v.globalCss.buttonDisabled),disabled:M,onclick:this._nextClick,title:l.pagination.next,type:"button"},_.tsx("div",{class:y.legacyIcon.forward}))),A=e?.length>0,P=A&&_.tsx("div",{class:k.css.actions,title:l.options},_.tsx("calcite-action-menu",{class:k.css.actionsButton,label:l.options},e.toArray().map((t=>_.tsx("calcite-action",{bind:this,icon:t.icon,id:t.id,onclick:()=>this.viewModel.triggerAction(t),text:t.title,textEnabled:!0})))));return _.tsx("div",{afterCreate:t=>{this.addHandles(b.onResize(t,(()=>this.scheduleRender())))},"aria-label":n.widgetLabel,class:this.classes(k.css.timeSlider,v.globalCss.widget,`${k.css.timeSliderMode}${u}`,`${k.css.timeSliderLayout}${S}`,!r&&v.globalCss.disabled,f&&k.css.timeSliderOutOfBounds,A&&k.css.hasActions,w.getCalciteThemeClass())},"wide"===S&&_.tsx("div",{class:k.css.timeSliderRow},_.tsx("div",{class:k.css.playbackControls},[j,D,U,L,R,B,O]),P),"compact"===S&&[_.tsx("div",{class:k.css.timeSliderRow,key:"time-slider-row-1"},[D,P]),_.tsx("div",{class:k.css.timeSliderRow,key:"time-slider-row-2"},[L]),_.tsx("div",{class:k.css.timeSliderRow,key:"time-slider-row-3"},[U,B,j,O,R])])}updateWebDocument(t){this.viewModel?.updateWebDocument(t)}_createLabel(t){if(null==this.labelFormatFunction)return;const e=t.getAttribute("data-type"),i=t.getAttribute("data-layout"),s=t["data-date"];this.labelFormatFunction(s,e,t,i)}_formatDate(t){return c.formatDate(t,this._dateFormat)}_formatTime(t){return c.formatDate(t,this._timeFormat)}_getIntlOptions(t){const{timeZone:e}=this;return{...c.convertDateFormatToIntlOptions(t),timeZone:e}}_getTickPositions(t){const{fullTimeExtent:e}=this;if(null==e?.start||null==e.end)return[];const{start:i,end:s}=e,a=[],{value:o,unit:n}=t;let l=r.truncateDate(i,n,this.timeZone);for(;l.getTime()<=s.getTime();)l.getTime()>=i.getTime()&&a.push(l.getTime()),l=r.offsetDate(l,o,n,this.timeZone);return a}_updateSliderSteps(){this._slider.steps=null!=this.effectiveStops&&this.effectiveStops.length>0?this.effectiveStops.map((t=>t.getTime())):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:a.neverReached(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};e.__decorate([n.property()],S.prototype,"_dateFormat",null),e.__decorate([n.property()],S.prototype,"_timeFormat",null),e.__decorate([n.property()],S.prototype,"actions",null),e.__decorate([n.property()],S.prototype,"disabled",void 0),e.__decorate([n.property()],S.prototype,"effectiveStops",null),e.__decorate([n.property()],S.prototype,"fullTimeExtent",null),e.__decorate([n.property()],S.prototype,"iconClass",void 0),e.__decorate([n.property()],S.prototype,"icon",void 0),e.__decorate([n.property({readOnly:!0})],S.prototype,"interactive",null),e.__decorate([n.property()],S.prototype,"label",null),e.__decorate([n.property()],S.prototype,"labelFormatFunction",void 0),e.__decorate([n.property({value:"auto"})],S.prototype,"layout",null),e.__decorate([n.property()],S.prototype,"loop",null),e.__decorate([n.property(),f.messageBundle("esri/widgets/TimeSlider/t9n/TimeSlider")],S.prototype,"messages",void 0),e.__decorate([n.property(),f.messageBundle("esri/t9n/common")],S.prototype,"messagesCommon",void 0),e.__decorate([n.property()],S.prototype,"mode",null),e.__decorate([n.property()],S.prototype,"playRate",null),e.__decorate([n.property()],S.prototype,"stops",null),e.__decorate([n.property()],S.prototype,"tickConfigs",void 0),e.__decorate([n.property()],S.prototype,"tickFormats",null),e.__decorate([n.property()],S.prototype,"timeExtent",null),e.__decorate([n.property({nonNullable:!0})],S.prototype,"timeVisible",void 0),e.__decorate([n.property()],S.prototype,"timeZone",null),e.__decorate([n.property()],S.prototype,"view",null),e.__decorate([n.property({type:T}),g.vmEvent("trigger-action")],S.prototype,"viewModel",void 0),e.__decorate([x.accessibleHandler()],S.prototype,"_playOrStopClick",null),e.__decorate([x.accessibleHandler()],S.prototype,"_previousClick",null),e.__decorate([x.accessibleHandler()],S.prototype,"_nextClick",null),S=e.__decorate([u.subclass("esri.widgets.TimeSlider")],S);return S}));
