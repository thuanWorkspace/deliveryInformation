/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../core/promiseUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","./Widget","./Measurement/MeasurementViewModel","./support/legacyIcon","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],(function(e,t,i,r,s,a,o,n,l,d,c,u,p,g,w){"use strict";const h=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),v={base:"esri-measurement",widgetIcon:u.legacyIcon.measure};function _(e){return"esri.widgets.AreaMeasurement2D"===e?.declaredClass||"esri.widgets.AreaMeasurement3D"===e?.declaredClass}let y=class extends d{constructor(e,t){super(e,t),this._widgets=new Map,this.activeWidget=null,this.iconClass=v.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new c}initialize(){this.activeWidget&&this.viewModel.set("activeViewModel",this.activeWidget.viewModel),this.view&&this.activeTool&&this._getActiveWidget().then((e=>{this._set("activeWidget",e)})),this.addHandles([r.watch((()=>[this.view,this.activeTool]),(async()=>{this._set("activeWidget",await this._getActiveWidget())})),r.watch((()=>this.activeWidget),((e,t)=>{this.viewModel.set("activeViewModel",e?e.viewModel:null),t&&(t.visible=!1)})),r.watch((()=>[this.areaUnit,this.linearUnit,this.uiStrings]),(()=>this._updateSubWidgetProperties()))])}destroy(){this._destroyWidgets()}get activeTool(){return this.viewModel.activeTool}set activeTool(e){this.viewModel.activeTool=e}get areaUnit(){return this.viewModel.areaUnit}set areaUnit(e){this.viewModel.areaUnit=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get linearUnit(){return this.viewModel.linearUnit}set linearUnit(e){this.viewModel.linearUnit=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const{activeWidget:e}=this,t=e&&!e.destroyed?e.render():null;return w.tsx("div",{class:v.base},t)}clear(){this.activeTool=null,this._destroyWidgets()}startMeasurement(){const{activeViewModel:e}=this.viewModel;e&&i.ignoreAbortErrors(e.start())}async _createWidget(t){const{areaUnit:i,linearUnit:r,view:s}=this;if(!s)return null;switch(t){case"area":{const{type:r}=s;switch(r){case"2d":return new(0,(await new Promise(((t,i)=>e(["./AreaMeasurement2D"],(e=>t(h(e))),i)))).default)({view:s,unit:i,uiStrings:this._createUIStringsForWidget(t)});case"3d":return new(0,(await new Promise(((t,i)=>e(["./AreaMeasurement3D"],(e=>t(h(e))),i)))).default)({view:s,unit:i,uiStrings:this._createUIStringsForWidget(t)});default:return null}}case"distance":{const{type:i}=s;if("2d"===i){return new(0,(await new Promise(((t,i)=>e(["./DistanceMeasurement2D"],(e=>t(h(e))),i)))).default)({view:s,unit:r,uiStrings:this._createUIStringsForWidget(t)})}return null}case"direct-line":{const{type:i}=s;if("3d"===i){return new(0,(await new Promise(((t,i)=>e(["./DirectLineMeasurement3D"],(e=>t(h(e))),i)))).default)({view:s,unit:r,uiStrings:this._createUIStringsForWidget(t)})}return null}default:return null}}_destroyWidgets(){this._widgets.forEach((e=>e.destroy())),this._widgets.clear()}async _getActiveWidget(){const{activeTool:e,view:t}=this;if(!t||!e)return null;let i=null;if(this._widgets.has(e))i=this._widgets.get(e),i.visible=!0;else{if(i=await this._createWidget(e),!i)return null;await i.viewModel.start(),this._widgets.set(e,i)}return i}_createUIStringsForWidget(e){if(!this.uiStrings)return;const t=e+"-"+this.view?.type;return this.uiStrings[t]}_updateSubWidgetProperties(){this._widgets.forEach(((e,t)=>{const{areaUnit:i,linearUnit:r}=this;e.unit=_(e)?i:r,e.uiStrings=this._createUIStringsForWidget(t)}))}};t.__decorate([s.property()],y.prototype,"activeTool",null),t.__decorate([s.property({readOnly:!0})],y.prototype,"activeWidget",void 0),t.__decorate([s.property()],y.prototype,"areaUnit",null),t.__decorate([s.property()],y.prototype,"iconClass",void 0),t.__decorate([s.property()],y.prototype,"icon",void 0),t.__decorate([s.property()],y.prototype,"label",null),t.__decorate([s.property()],y.prototype,"linearUnit",null),t.__decorate([s.property(),g.messageBundle("esri/widgets/Measurement/t9n/Measurement")],y.prototype,"messages",void 0),t.__decorate([s.property()],y.prototype,"uiStrings",void 0),t.__decorate([s.property()],y.prototype,"view",null),t.__decorate([s.property({type:c})],y.prototype,"viewModel",void 0),y=t.__decorate([l.subclass("esri.widgets.Measurement")],y);return y}));
