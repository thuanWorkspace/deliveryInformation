/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../Graphic","../../../geometry/Polygon","../../../rest/locator/addressToLocations","../../../rest/locator/locationToAddress","../../../rest/locator/suggestLocations","../../../rest/support/AddressToLocationsParameters","../../../rest/support/LocationToAddressParameters","../../../rest/support/SuggestLocationsParameters","./geometryUtils"],(function(e,t,o,r,n,s,c,a,i,u){"use strict";const l="Single Line Input",d=3e5;function g(e,t){return e.location?v(e,t):I(e,t)}function f(e,t){if(t.localSearchDisabled)return null;const o=e?.scale;return"number"==typeof o&&o<=d?e?.extent?.center:null}async function m(e,t){const{source:o,spatialReference:r,view:n,suggestTerm:c,maxSuggestions:a,sourceIndex:u}=e,l=new i,{apiKey:d,url:g}=o,m=w(o,n),y=t?.signal;if(!g)return null;d&&(l.apiKey=d),o.categories&&(l.categories=o.categories),r&&(l.outSpatialReference=r);const p=f(n,o);p&&(l.location=p);if(!c.trim())return null;const{prefix:x="",suffix:S=""}=o,v=`${x}${c}${S}`;return l.text=v,m&&(l.searchExtent=m),l.maxSuggestions=a,o.countryCode&&(l.countryCode=o.countryCode),s.suggestLocations(g,l,{signal:y}).then((e=>G(e,u)))}function y(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function p(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}function x(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}const S="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";async function v(e,t){const{source:o,spatialReference:r,location:s,sourceIndex:c,view:i}=e,{apiKey:u,url:l,zoomScale:d,defaultZoomScale:g}=o;if(null==l)return[];const f=i?.scale,m=t?.signal,y=new a;y.location=s,u&&(y.apiKey=u),r&&(y.outSpatialReference=r);try{return b([await n.locationToAddress(l,y,{signal:m})],{sourceIndex:c,scale:f,view:i,zoomScale:d,defaultZoomScale:g})}catch(p){return[]}}function w(e,t){const{filter:o,withinViewEnabled:r}=e,n=t?.scale,s=t?.extent,c=o?.geometry;return u.createExtentFromGeometry(c,t,n)||(r&&s?s:void 0)}async function I(e,t){const{source:o,suggestResult:n,spatialReference:s,view:a,maxResults:i,sourceIndex:u}=e,d=o?.zoomScale,g=o?.defaultZoomScale,m=n.text?.trim();if(!m)return null;const y=!n.key&&o.prefix?o.prefix:"",p=!n.key&&o.suffix?o.suffix:"",x=`${y}${n.text}${p}`,S=new c,{apiKey:v,url:I}=o,L=a?.scale,G=w(o,a),T=t?.signal;if(v&&(S.apiKey=v),!I)return null;o.categories&&(S.categories=o.categories),o.locationType&&(S.locationType=o.locationType),s&&(S.outSpatialReference=s);const h=f(a,o);h&&(S.location=h),S.maxLocations=i,G&&(S.searchExtent=G),o.countryCode&&(S.countryCode=o.countryCode);const{key:R}=n,$=`${R}`;return R&&(S.magicKey=$),S.address={},S.address[o.singleLineFieldName||l]=x,o.outFields&&(S.outFields=o.outFields),r.addressToLocations(I,S,{signal:T}).then((e=>b(e,{key:$,scale:L,sourceIndex:u,view:a,zoomScale:d,defaultZoomScale:g})))}function L(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}function G(e,t){return e.map((e=>L(e,t)))}function T(e,r){const{key:n,scale:s,sourceIndex:c,view:a,zoomScale:i,defaultZoomScale:l}=r,{attributes:d,extent:g,location:f,address:m}=e,y=new t({geometry:f,attributes:d}),p=g||f,x=u.createExtentFromGeometry(p,a,s),S="number"==typeof i?u.scaleExtent(x,a,i):"number"==typeof l&&"point"===p?.type?u.scaleExtent(x,a,l):x,v=f?`${f.x},${f.y}`:"",w=m||v,I=y.clone();return null!=S&&(I.geometry=o.fromExtent(S)),{extent:S,feature:y,target:I,key:n,name:w,sourceIndex:c}}function b(e,t){return e.filter(Boolean).map((e=>T(e,t)))}e.getLocation=f,e.getResults=g,e.getSuggestions=m,e.isArcGISWorldGeocoder=x,e.isMeteredArcGISWorldGeocoder=y,e.isProxiedArcGISWorldGeocoder=p,e.meteredArcGISLocatorUrl=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
