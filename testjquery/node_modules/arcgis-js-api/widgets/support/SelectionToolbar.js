/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../../chunks/tslib.es6","../../core/deprecate","../../core/handleUtils","../../core/Logger","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../Widget","./componentsUtils","./globalCss","./legacyIcon","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SelectionToolbar/SelectionToolbarViewModel"],(function(e,o,t,s,l,i,r,c,a,n,d,p,u,h,g,v,_,T,m){"use strict";const y={lassoTool:!0,rectangleTool:!0},b={createTool:"polygon",createOptions:{mode:"freehand"}},f={createTool:"rectangle"},w="esri-selection-toolbar",C={base:w,widgetIcon:g.legacyIcon.vertexGps,container:`${w}__container`,toolButton:`${w}__tool-button`};let M=class extends p{constructor(e,o){super(e,o),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.messages=null,this.toolConfigs=[],this.viewModel=new m,this.visibleElements={...y},this._viewModelHandlesGroup=s.handlesGroup([this.viewModel.on("selection-change",(e=>this.emit("selection-change",e))),this.viewModel.on("complete",(e=>{this._set("activeToolInfo",null),this.emit("complete",e)}))])}destroy(){this._viewModelHandlesGroup=i.removeMaybe(this._viewModelHandlesGroup)}loadDependencies(){return u.loadCalciteComponents({action:()=>new Promise(((o,t)=>e(["../../chunks/calcite-action"],o,t))),icon:()=>new Promise(((o,t)=>e(["../../chunks/calcite-icon"],o,t)))})}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return t.deprecatedProperty(l.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){t.deprecatedProperty(l.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...y,...e}}get visibleToolCount(){const{view:e,toolConfigs:o,visibleElements:t}=this;return(o?.length??0)+("2d"===e?.type?(t.lassoTool?1:0)+(t.rectangleTool?1:0):0)}activate(e){switch(this.cancel(),e){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(e)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return T.tsx("div",{"aria-label":this.label,class:this.classes(C.base,h.globalCss.widget)},T.tsx("div",{class:C.container},this._renderDefaultTools(),this._renderCustomTools()))}_renderDefaultTools(){if("2d"===this.view?.type)return[this._renderRectangleTool(),this._renderLassoTool()]}_renderCustomTools(){if(this.toolConfigs?.length)return this.toolConfigs.map((e=>T.tsx("calcite-action",{active:this.activeToolInfo?.toolName===e.toolName,bind:this,class:C.toolButton,label:e.toolName,onclick:()=>this._onCustomToolClick(e.toolName),scale:"s",text:e.toolName,title:e.toolName},T.tsx("calcite-icon",{icon:e.icon||"selection",scale:"s"}))))}_renderLassoTool(){const{activeToolInfo:e,messages:o,visibleElements:t}=this;if(t.lassoTool)return T.tsx("calcite-action",{active:"lasso"===e?.toolName,bind:this,label:o.selectByLasso,onclick:this._onLassoToolClick,scale:"s",text:o.selectByLasso,title:o.selectByLasso},T.tsx("calcite-icon",{icon:"lasso-select",scale:"s"}))}_renderRectangleTool(){const{activeToolInfo:e,messages:o,visibleElements:t}=this;if(t.rectangleTool)return T.tsx("calcite-action",{active:"rectangle"===e?.toolName,bind:this,label:o.selectByRectangle,onclick:this._onRectangleToolClick,scale:"s",text:o.selectByRectangle,title:o.selectByRectangle},T.tsx("calcite-icon",{icon:"cursor-marquee",scale:"s"}))}_onCustomToolClick(e){this._toggleTool(e)}_onLassoToolClick(){this._toggleTool("lasso")}_onRectangleToolClick(){this._toggleTool("rectangle")}_activateTool(e){const o=this._getToolOptions(e);if(!o)return;const t=this.viewModel.activate(o);t&&this._set("activeToolInfo",{toolName:e,operation:t})}_toggleTool(e){if(this.activeToolInfo){const o=this.activeToolInfo.toolName;if(this.cancel(),o===e)return}this._activateTool(e)}_getToolOptions(e){if("lasso"===e)return b;if("rectangle"===e)return f;const o=this.toolConfigs.find((o=>o.toolName===e));if(!o)return;const{createTool:t,createOptions:s,selectionOptions:l}=o;return{createTool:t,createOptions:s,selectionOptions:l}}};o.__decorate([r.property({readOnly:!0})],M.prototype,"activeToolInfo",void 0),o.__decorate([r.property()],M.prototype,"label",null),o.__decorate([r.property()],M.prototype,"layers",null),o.__decorate([r.property(),_.messageBundle("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],M.prototype,"messages",void 0),o.__decorate([r.property()],M.prototype,"sources",null),o.__decorate([r.property()],M.prototype,"toolConfigs",void 0),o.__decorate([r.property()],M.prototype,"view",null),o.__decorate([r.property()],M.prototype,"viewModel",void 0),o.__decorate([r.property()],M.prototype,"visibleElements",void 0),o.__decorate([c.cast("visibleElements")],M.prototype,"castVisibleElements",null),o.__decorate([r.property()],M.prototype,"visibleToolCount",null),M=o.__decorate([d.subclass("esri.widgets.support.SelectionToolbar")],M);return M}));
