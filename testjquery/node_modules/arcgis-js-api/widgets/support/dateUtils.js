/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../intl","../../core/has","../../core/Error","../../core/mathUtils","../../intl/date","../../time/timeZoneUtils","./dataUtils","../../chunks/datetime","../../intl/locale"],(function(e,t,n,a,i,o,l,r,m,u){"use strict";const s=l.utc,f={date:null,time:null,timeZoneOffset:null},c=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),d="yyyy-MM-dd",p="TT";var T;e.TimeStampOffsetPattern=void 0,(T=e.TimeStampOffsetPattern||(e.TimeStampOffsetPattern={})).HM="HH:mm",T.HMS="HH:mm:ss",T.HMS_MS="HH:mm:ss.SSS";const y=[e.TimeStampOffsetPattern.HMS_MS,e.TimeStampOffsetPattern.HMS,e.TimeStampOffsetPattern.HM,p],S="latn",O=new Set(["date-only","time-only","timestamp-offset"]),D=e=>"valueAsDate"in e;function v(e){return{locale:u.getLocale(),numberingSystem:S,zone:e??s}}function F(e){return e?.isValid?e.toMillis():null}function h(e,t){return null===e?null:m.DateTime.fromMillis(e,v(t))}function g(t){if(null==t||!r.isString(t)||""===t)return f;const n=m.DateTime.fromISO(t,{setZone:!0});return{date:n.toFormat(d,v()),time:n.toFormat(e.TimeStampOffsetPattern.HMS_MS,v()),timeZoneOffset:n.offset.toString()}}function I(e,t){if(null==e||!r.isNumber(e)||isNaN(e))return f;const n=h(e,t);return n?{date:n.toFormat(d,v(t)),time:n.toFormat(p,v(t))}:f}function M(e){switch(e.type){case"date":default:return o.convertDateFormatToIntlOptions("short-date-short-time");case"date-only":return o.convertDateFormatToIntlOptions("short-date");case"time-only":return o.convertDateFormatToIntlOptions("short-time");case"timestamp-offset":return{...o.convertDateFormatToIntlOptions("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function V(e,t,n){if(!e||null==t)return null;switch(e.type){case"date":return o.formatDate(t,n);case"date-only":return o.formatDateOnly(t,n);case"time-only":return o.formatTimeOnly(t,n);case"timestamp-offset":return o.formatTimestamp(t,n);default:return null}}function w(e){const{dateComponent:t,timeComponent:n,timeZoneComponent:a,oldValue:i}=e;if(!t?.value||!n?.value)return null;const{year:o,month:r,day:u}=m.DateTime.fromFormat(t.value,d),{hour:s,minute:f,second:c,millisecond:p}=H(n,l.utc)??m.DateTime.now(),T=g(i),y=null!=a?.value?parseInt(a.value,10):null!=T.timeZoneOffset?parseInt(T.timeZoneOffset,10):(new Date).getTimezoneOffset(),S=m.FixedOffsetZone.instance(y),O=m.DateTime.fromObject({year:o,month:r,day:u,hour:s,minute:f,second:c,millisecond:p},{zone:S});return O.isValid?O.toISO({includeOffset:!0}):null}function C(e){const{dateComponent:t,timeComponent:n,timeZone:a,max:i,min:o,oldValue:l}=e,r=H(t,a);let u=!!e.applyRange;if(!r)return null;let s=null;if(null!=n?.value){const e=H(n,a),t=Date.now(),o=null!=i&&i<t?i:t,l=m.DateTime.fromMillis(o,v(a)),u=r||l,{year:f,month:c,day:d}=u,{hour:p,minute:T,second:y,millisecond:S}=e||l;s=u.set({year:f,month:c,day:d,hour:p,minute:T,second:y,millisecond:S})}else{const e=h(Z({value:l??Date.now(),max:i,min:o}),a),{year:t,month:n,day:m}=r,{hour:f,minute:c,second:d,millisecond:p}=e;u=!0,s=r.set({year:t,month:n,day:m,hour:f,minute:c,second:d,millisecond:p})}if(!s.isValid)return null;const f=s.toMillis();return u?Z({value:f,max:i,min:o}):f}function H(e,t){if(!e||null==e.value||Array.isArray(e.value))return null;let n=null;return n=D(e)?m.DateTime.fromFormat(e.value,d,v(t)):R(e.value),n?.isValid?n:null}function x(e){const{max:t,min:n,value:a}=e;return!isNaN(a)&&(!(null!=t&&a>t)&&!(null!=n&&a<n))}function Z(e){const{max:t,min:n,value:a}=e;return null!=t&&null!=n?i.clamp(a,n,t):null!=t&&a>t?t:null!=n&&a<n?n:a}function b(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new a("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const n=t.split(":"),i=new Array(3);for(let a=0;a<3;a++){const e=n.at(a)??"";i[a]=e.padStart(2,"0")}return i.join(":")}function P(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return b(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function N(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function A(e){return m.DateTime.fromFormat(e,d)}function R(e){let t=null;return y.find((n=>(t=m.DateTime.fromFormat(e,n),t.isValid))),t}function U(e){return m.DateTime.fromISO(e)}function j(e){const{type:t,range:n,value:a}=e;if(null==a||!n)return!0;if("date"===t)return x({value:a,min:n.min,max:n.max});const{rawMax:i,rawMin:o}=n;if(!r.isString(i)||!r.isString(o)||!r.isString(a))return!0;let l=null,u=null,s=null;switch(t){case"date-only":l=A(i),u=A(o),s=A(a);break;case"time-only":l=R(i),u=R(o),s=R(a);break;case"timestamp-offset":l=U(i),u=U(o),s=U(a)}return!(l?.isValid&&u?.isValid&&s?.isValid)||(m.Interval.fromDateTimes(u,l).contains(s)||u.valueOf()===s.valueOf()||l.valueOf()===s.valueOf())}e.arcadeDateToFieldValue=P,e.clampValueToRange=Z,e.createDateTimeFromFieldValue=h,e.dateFieldsWithStringFieldValue=O,e.dateOnlyToDateTime=A,e.dateTimeIsInRange=j,e.dateTimeToFieldValue=F,e.defaultDatePattern=d,e.defaultTimePattern=p,e.getDefaultLocaleOptions=v,e.getISOFieldValueFromDateComponents=w,e.getIntlOptionsForField=M,e.getLabelForDateFieldValue=V,e.getLocalDateTimeFromComponent=H,e.getUnixFieldValueFromDateComponents=C,e.isArcadeDate=N,e.isCalciteDateComponent=D,e.normalizeTimeOnlyString=b,e.numberingSystem=S,e.prepareISOFieldValueForDateComponents=g,e.prepareUnixFieldValueForDateComponents=I,e.supportedTimeFormats=y,e.timeOnlyToDateTime=R,e.timeResolutionToStepMap=c,e.timestampOffsetToDateTime=U,e.valueIsInRange=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
