/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../config","../../core/Error","../../core/has","../../core/Logger","../../geometry/Point","../../geometry/support/webMercatorUtils","../../portal/Portal","../../rest/geometryService/project","../../rest/support/ProjectParameters"],(function(e,t,o,r,i,n,c,s,u,a){"use strict";const l=i.getLogger("esri.widgets.support.geolocationUtils"),g={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function d(){const e=r("esri-geolocation");return e||l.warn("geolocation-unsupported","Geolocation unsupported."),e}function m(){const e=window.isSecureContext;return e||l.warn("insecure-context","Geolocation requires a secure origin."),e}function p(){return d()&&m()}function f(e){const t=15e3;return e||(e=g),new Promise(((r,i)=>{setTimeout((()=>i(new o("geolocation:timeout","getting the current geolocation position timed out"))),t),navigator.geolocation.getCurrentPosition(r,i,e??void 0)}))}let v;function w(e,t){if(v)return v(e,t);const{position:r,view:i}=e,n=P(r),c=n?.coords;if(!c)throw new o("geometry-service:no-coords","Geolocation has no coordinates");return S(h(c),i,t)}function y(e){v=e}function P(e){const t=e&&e.coords||{},o={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e?{coords:o,timestamp:e.timestamp}:e}function h({longitude:e,latitude:t,altitude:o}){return new n({longitude:e,latitude:t,z:o||void 0,spatialReference:{wkid:4326}})}function S(e,t,r){if(!t)return Promise.resolve(e);const i=t.spatialReference;return i.isWGS84?Promise.resolve(e):i.isWebMercator?Promise.resolve(c.geographicToWebMercator(e)):b(r).then((t=>{if(!t)throw new o("geometry-service:missing-url","Geometry service URL is missing");const n=new a({geometries:[e],outSpatialReference:i});return u.project(t,n,r).then((e=>e[0]))}))}function b(e){if(t.geometryServiceUrl)return Promise.resolve(t.geometryServiceUrl);const o=s.getDefault();return o.load(e).catch((()=>{})).then((()=>o.helperServices?.geometry?.url))}e.getCurrentPosition=f,e.overridePositionToPoint=y,e.positionToPoint=w,e.supported=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
