/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../analysis/AreaMeasurementAnalysis","../../core/reactiveUtils","../../core/unitUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../properties/defaultUnit","../../views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DTool","../support/InteractiveAnalysisViewModel"],(function(e,t,s,i,n,r,a,l,o,u,d,p){"use strict";let c=class extends p.InteractiveAnalysisViewModel{constructor(e){super(e),this.analysis=null,this.supportedViewType="3d",this.unsupportedErrorMessage="AreaMeasurement3DViewModel is only supported in 3D views.",this._userUnitOptions=null,this._userUnit=null}initialize(){this.addHandles(s.watch((()=>({analysis:this.analysis,unit:this.unit})),(({analysis:e,unit:t})=>{null!=e&&(e.unit=t)}),s.syncAndInitial))}get state(){return this.disabled||!this.ready?"disabled":null==this.tool?"ready":this.tool.state}get measurement(){if(null==this.tool||this.disabled||this.tool.destroyed)return null;const{analysisView:e}=this;if(null==e)return null;const t=e.analysisVisualization,s=t.viewData,i=s.measurementData,n=i.validMeasurement,r="euclidean"===s.mode,a=0===(r?i.intersectingSegments:i.geodesicIntersectingSegments).size,l=a?n?"available":"unavailable":"invalid";return{mode:r?"euclidean":"geodesic",area:{text:a&&n?t.areaLabel:null,state:l},perimeterLength:{text:a&&n?t.perimeterLengthLabel:null,state:l}}}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null}get unit(){return null!=this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}constructAnalysis(){return new t}constructTool(){return new d({view:this.view,analysis:this.analysis,analysisViewData:this.analysisView,visible:this.visible})}_findSelectableUnit(e,t){const{unitOptions:s}=this;return s.includes(e)?e:null!=t?this._findSelectableUnit(t):s[0]}_filteredOrAllUnits(e){if(null==e)return i.measurementAreaUnits.slice();const t=e.filter((e=>i.measurementAreaUnits.includes(e)));return 0===t.length?i.measurementAreaUnits.slice():t}};e.__decorate([n.property({type:t})],c.prototype,"analysis",void 0),e.__decorate([n.property({readOnly:!0})],c.prototype,"state",null),e.__decorate([n.property({readOnly:!0})],c.prototype,"measurement",null),e.__decorate([n.property()],c.prototype,"unitOptions",null),e.__decorate([n.property()],c.prototype,"unit",null),e.__decorate([n.property(u.defaultUnitPropertyMetadata)],c.prototype,"defaultUnit",void 0),e.__decorate([n.property()],c.prototype,"_userUnit",void 0),c=e.__decorate([o.subclass("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],c);return c}));
