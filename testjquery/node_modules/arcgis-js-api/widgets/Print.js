/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../chunks/tslib.es6","../core/Collection","../core/events","../core/lang","../core/Logger","../core/reactiveUtils","../core/urlUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","../rest/utils","./Widget","./Print/FileLink","./Print/PrintViewModel","./Print/TemplateOptions","./support/globalCss","./support/Heading","./support/legacyIcon","./support/Popover","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],(function(t,e,a,s,i,n,o,l,r,d,p,c,u,h,m,_,b,g,y,x,v,f){"use strict";const T=e.ofType(u),C="MAP_ONLY";var w;!function(t){t.layout="layoutTab",t.mapOnly="mapOnlyTab"}(w||(w={}));const O="esri-print",I=`${O}__advanced-options-button`,L={base:O,widgetIcon:g.legacyIcon.printer,headerTitle:`${O}__header-title`,inputText:`${O}__input-text`,layoutTabList:`${O}__layout-tab-list`,layoutTab:`${O}__layout-tab`,layoutSection:`${O}__layout-section`,mapOnlySection:`${O}__map-only-section`,scaleInput:`${O}__scale-input`,templateList:`${O}__template-list`,templateListScroller:`${O}__template-list-scroller`,templateListFooter:`${O}__template-list-footer`,loader:`${O}__loader`,advancedOptionsButton:I,advancedOptionsButtonContainer:`${I}-container`,advancedOptionsButtonTitle:`${I}-title`,advancedOptionsButtonIconOpened:`${I}-icon--opened`,advancedOptionsButtonIconClosed:`${I}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${I}-icon--closed-rtl`,refreshButton:`${O}__refresh-button`,swapButton:`${O}__swap-button`,linkButton:`${O}__link-button`,printButton:`${O}__export-button`,templateButton:`${O}__template-button`,formSectionContainer:`${O}__form-section-container`,advancedOptionsSection:`${O}__advanced-options-section`,advancedOptionsContainer:`${O}__advanced-options-container`,authorInfoContainer:`${O}__author-info-container`,copyrightInfoContainer:`${O}__copyright-info-container`,exportedFilesContainer:`${O}__export-panel-container`,exportedFilesTitle:`${O}__export-title`,exportedFile:`${O}__exported-file`,exportedFileLink:`${O}__exported-file-link`,exportedFileLinkTitle:`${O}__exported-file-link-title`,heightContainer:`${O}__height-container`,legendInfoContainer:`${O}__legend-info-container`,printWidgetContainer:`${O}__container`,panelContainer:`${O}__panel-container`,scaleInfoContainer:`${O}__scale-info-container`,scaleInputContainer:`${O}__scale-input-container`,sizeContainer:`${O}__size-container`,widthContainer:`${O}__width-container`,panelError:`${O}__panel--error`,exportedFileError:`${O}__exported-file--error`},k="User sets an invalid layout, resetting it to the default valid one...",S="User sets an invalid format, resetting it to the default valid one...";function $(t){const e=8.3333,a=11.4583;return{width:Math.round(t*e),height:Math.round(t*a)}}function M(t){return!isNaN(t)&&t>0}function F(t){return t?.toUpperCase()===C}let E=class extends c{constructor(t,e){super(t,e),this._activeTabFocusRequested=!1,this._advancedOptionsVisibleForLayout=!1,this._advancedOptionsVisibleForMapOnly=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._focusedTemplateIndex=0,this._layoutTabSelected=!0,this._pendingExportScroll=!1,this._rootNode=null,this._selectTemplateNode=null,this._templateListPopover=new y({owner:this,placement:"top",offset:[0,-100],anchorElement:()=>this._selectTemplateNode,renderContentFunction:this._renderTemplateList}),this.exportedLinks=new T,this.headingLevel=3,this.iconClass=L.widgetIcon,this.icon=null,this.templateOptions=new m,this.viewModel=new h,this._handleTemplateListCreation=t=>t.focus(),this._handleTemplateChildBlur=t=>{const e=t.relatedTarget?.closest(`.${L.templateList}`);e||this._handleCloseTemplateSelection()},this._handleCloseTemplateSelection=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!1,this._selectTemplateNode?.focus()},this._handleSelectTemplateClick=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!0},this._handleTemplateListClick=t=>{const e=P(t.target);e&&this._applyTemplate(e)},this._handleTemplateListKeyDown=t=>{if(this._focusedTemplateIndex){if(x.isActivationKey(t.key))return this._applyTemplate(this.viewModel.defaultTemplates.at(this._focusedTemplateIndex)),void t.preventDefault();if("ArrowDown"===t.key||"ArrowUp"===t.key){const{defaultTemplates:e}=this.viewModel,a="ArrowDown"===t.key?1:-1,s=(this._focusedTemplateIndex+a)%e.length;this._focusedTemplateIndex=s<0?e.length-1:s;const i=t.currentTarget;x.keepMenuItemWithinView(i.querySelectorAll(`.${_.globalCss.menuItem}`)[this._focusedTemplateIndex],i.parentElement),t.preventDefault()}"Escape"===t.key&&this._handleCloseTemplateSelection()}},this._removeLink=t=>{const e=t.currentTarget["data-item"];e&&"error"===e.state&&this.exportedLinks.remove(e)},this._handleLinkClick=t=>{const e=t.currentTarget,{href:a}=e,s=p.getToken(this.viewModel.effectivePrintServiceUrl);if(!s)return;if(!t.isTrusted)return void t.stopPropagation();t.preventDefault();const i=new URL(a);i.searchParams.set("token",s),e.href=i.href,e.click(),e.href=a},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([n.watch((()=>this.viewModel?.templatesInfo),(t=>{const{format:e,layout:a}=this.templateOptions;if(t){const s=a===t.layout.defaultValue||F(a)||t.layout.choiceList&&a&&t.layout.choiceList.includes(a),n=e===t.format.defaultValue||t.format.choiceList&&e&&t.format.choiceList.includes(e);s||(a&&i.getLogger(this).warn(k),this.templateOptions.layout=t.layout.defaultValue),n||(e&&i.getLogger(this).warn(S),this.templateOptions.format=t.format.defaultValue),F(a)&&(this._layoutTabSelected=!1)}}),n.initial),n.watch((()=>this.templateOptions?.format),(t=>{const{viewModel:{templatesInfo:e}}=this;if(e&&t){let a=!1;e.format.choiceList&&e.format.choiceList.forEach((e=>{e.toUpperCase()===t.toUpperCase()&&(this.templateOptions.format=e,a=!0)})),a||(this.templateOptions.format=e.format.defaultValue,i.getLogger(this).warn(S)),this.scheduleRender()}}),n.initial),n.watch((()=>this.templateOptions?.layout),(t=>{const{viewModel:{templatesInfo:e}}=this;if(e&&t){this._layoutTabSelected=!F(t);let a=!this._layoutTabSelected;a||e.layout.choiceList&&e.layout.choiceList.forEach((e=>{e.toUpperCase()===t.toUpperCase()&&(this.templateOptions.layout=e,a=!0)})),a||(this.templateOptions.layout=e.layout.defaultValue,i.getLogger(this).warn(k));const n=this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=n?s.clone(n):null,this.scheduleRender()}}),n.initial),n.watch((()=>this.templateOptions?.dpi),(t=>{t<=0?this.templateOptions.dpi=1:this.scheduleRender()}),n.initial),n.watch((()=>this.viewModel?.view?.scale),(t=>{const{scale:e,scaleEnabled:a}=this.templateOptions;a&&e||(this.templateOptions.scale=t)}),n.initial)]);const{height:t,width:e}=this.templateOptions;this.templateOptions.width=e||800,this.templateOptions.height=t||1100;const a=setTimeout((()=>{this._awaitingServerResponse=!0,this.scheduleRender()}),500);this.viewModel.load().then((()=>clearTimeout(a)))}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(t){this.viewModel.allowedFormats=t}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(t){this.viewModel.allowedLayouts=t}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(t){this.viewModel.extraParameters=t}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(t){this.viewModel.includeDefaultTemplates=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get portal(){return this.viewModel.portal}set portal(t){this.viewModel.portal=t}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(t){this.viewModel.printServiceUrl=t}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(t){this.viewModel.templateCustomTextElements=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{attributionEnabled:t,author:e,copyright:a,dpi:s,format:i,height:n,layout:o,legendEnabled:l,northArrowEnabled:r,scaleEnabled:d,scale:p,width:c}=this.templateOptions,u="ready"!==this.viewModel?.state,h=this._renderTitleOrFileNameSection(),{includeDefaultTemplates:m,messages:y,viewModel:x}=this,v=this.viewModel?.templatesInfo?.format?.choiceList||[],T=v.length>0?v.map((t=>{const e=t===i;return f.tsx("option",{key:t,selected:e,value:t},t.toUpperCase())})):f.tsx("option",{key:"format-default-option"},y.formatDefaultOption),C=f.tsx("div",{class:L.formSectionContainer},f.tsx("label",null,y.fileFormatTitle,f.tsx("select",{bind:this,class:_.globalCss.select,"data-target-property":"format",onchange:this._updateFromOption},T))),O=this.viewModel?.templatesInfo?.layout?.choiceList,I=O?.length?O.map((t=>f.tsx("option",{key:t,selected:t===o,value:t},y[t]||t))):f.tsx("option",{key:"layout-default-option"},y.layoutDefaultOption),k=f.tsx("div",{class:L.formSectionContainer},f.tsx("label",null,y.layoutTitle,f.tsx("select",{bind:this,class:_.globalCss.select,"data-target-property":"layout",onchange:this._updateFromOption},I))),S=f.tsx("div",{class:L.formSectionContainer},f.tsx("label",null,y.dpi,f.tsx("input",{bind:this,class:this.classes(L.inputText,_.globalCss.input),"data-input-name":"dpi",min:"1",onchange:this._handleDPIChange,tabIndex:0,type:"number",value:`${s}`}))),$=f.tsx("div",{class:this.classes(L.scaleInfoContainer,L.formSectionContainer)},f.tsx("label",null,f.tsx("input",{bind:this,checked:d,"data-option-name":"scaleEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),y.scale),f.tsx("div",{class:L.scaleInputContainer},f.tsx("input",{"aria-label":y.scaleLabel,"aria-valuenow":`${p}`,bind:this,class:this.classes(L.inputText,_.globalCss.input,L.scaleInput),"data-input-name":"scale",disabled:!d,onchange:this._updateInputValue,role:"spinbutton",tabIndex:0,type:"number",value:`${p}`}),f.tsx("button",{"aria-label":y.reset,bind:this,class:this.classes(_.globalCss.widgetButton,L.refreshButton,g.legacyIcon.refresh),onclick:this._resetToCurrentScale,tabIndex:0,type:"button"}))),M=this._advancedOptionsVisibleForLayout?f.tsx("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:L.advancedOptionsContainer},$,f.tsx("div",{class:this.classes(L.authorInfoContainer,L.formSectionContainer)},f.tsx("label",null,y.author,f.tsx("input",{bind:this,class:this.classes(L.inputText,_.globalCss.input),"data-input-name":"author",onchange:this._updateInputValue,tabIndex:0,type:"text",value:e??""}))),f.tsx("div",{class:this.classes(L.copyrightInfoContainer,L.formSectionContainer)},f.tsx("label",null,y.copyright,f.tsx("input",{bind:this,class:this.classes(L.inputText,_.globalCss.input),"data-input-name":"copyright",onchange:this._updateInputValue,tabIndex:0,type:"text",value:a??""}))),S,f.tsx("div",{class:this.classes(L.legendInfoContainer,L.formSectionContainer)},f.tsx("label",null,f.tsx("input",{bind:this,checked:l,"data-option-name":"legendEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),y.legend)),this.viewModel.templateToNorthArrowInfo[o]?f.tsx("div",{class:this.classes(L.legendInfoContainer,L.formSectionContainer),key:"north-arrow"},f.tsx("label",null,f.tsx("input",{bind:this,checked:r,"data-option-name":"northArrowEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),y.northArrow)):null,this._renderCustomTextElementSection()):null,F=this._advancedOptionsVisibleForMapOnly?f.tsx("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:L.advancedOptionsContainer},$,S,f.tsx("div",{class:L.formSectionContainer},f.tsx("label",null,f.tsx("input",{bind:this,checked:t,"data-option-name":"attributionEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),y.attribution)),this._renderCustomTextElementSection()):null,E=this._layoutTabSelected?f.tsx("section",{"aria-labelledby":`${this.id}__layoutTab`,class:L.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},f.tsx("div",{class:L.panelContainer},h,k,this._layoutTabSelected?C:null),f.tsx("div",{class:this.classes(L.panelContainer,L.advancedOptionsSection)},f.tsx("button",{"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false","aria-label":y.advancedOptions,bind:this,class:L.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},f.tsx("div",{class:L.advancedOptionsButtonContainer},f.tsx("span",{"aria-hidden":"true",class:this.classes(g.legacyIcon.rightTriangleArrow,L.advancedOptionsButtonIconClosed)}),f.tsx("span",{"aria-hidden":"true",class:this.classes(g.legacyIcon.leftTriangleArrow,L.advancedOptionsButtonIconClosed_RTL)}),f.tsx("span",{"aria-hidden":"true",class:this.classes(g.legacyIcon.downArrow,L.advancedOptionsButtonIconOpened)}),f.tsx("span",{class:L.advancedOptionsButtonTitle},y.advancedOptions))),M)):f.tsx("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:L.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},f.tsx("div",{class:L.panelContainer},h,this._layoutTabSelected?null:C,f.tsx("div",{class:this.classes(L.sizeContainer,L.formSectionContainer)},f.tsx("div",{class:L.widthContainer},f.tsx("label",null,y.width,f.tsx("input",{bind:this,class:this.classes(L.inputText,_.globalCss.input),"data-input-name":"width",onchange:this._updateInputValue,tabIndex:0,type:"number",value:`${c}`}))),f.tsx("div",{class:L.heightContainer},f.tsx("label",null,y.height,f.tsx("input",{bind:this,class:this.classes(L.inputText,_.globalCss.input),"data-input-name":"height",onchange:this._updateInputValue,tabIndex:0,type:"number",value:`${n}`}))),f.tsx("button",{"aria-label":y.swap,bind:this,class:this.classes(_.globalCss.widgetButton,L.swapButton,g.legacyIcon.swap),onclick:this._switchInput,tabIndex:0,type:"button"})),f.tsx("div",{class:this.classes(L.panelContainer,L.advancedOptionsSection)},f.tsx("button",{"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false","aria-label":y.advancedOptions,bind:this,class:L.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},f.tsx("div",{class:L.advancedOptionsButtonContainer},f.tsx("span",{"aria-hidden":"true",class:this.classes(g.legacyIcon.rightTriangleArrow,L.advancedOptionsButtonIconClosed)}),f.tsx("span",{"aria-hidden":"true",class:this.classes(g.legacyIcon.leftTriangleArrow,L.advancedOptionsButtonIconClosed_RTL)}),f.tsx("span",{"aria-hidden":"true",class:this.classes(g.legacyIcon.downArrow,L.advancedOptionsButtonIconOpened)}),f.tsx("span",{class:L.advancedOptionsButtonTitle},y.advancedOptions))),F))),P=this.exportedLinks.toArray(),V=this._renderExportedLink(P),A={[_.globalCss.buttonDisabled]:u||!o&&!i},{view:B}=this,D=!B||"2d"!==B.type,N=f.tsx("div",{class:L.panelError},D?y.sceneViewError:y.serviceError),U=f.tsx("div",null,f.tsx("ul",{bind:this,class:L.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},f.tsx("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._layoutTabSelected}`,class:L.layoutTab,"data-tab-id":w.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},y.layoutTab),f.tsx("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${!this._layoutTabSelected}`,class:L.layoutTab,"data-tab-id":w.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},y.mapOnlyTab)),E,f.tsx("button",{"aria-label":y.exportDescription,bind:this,class:this.classes(L.printButton,_.globalCss.button,A),disabled:u,onclick:this._handlePrintMap,tabIndex:0,type:"button"},y.export),m&&x.defaultTemplates.length>0?this._renderTemplateSectionTrigger():null,f.tsx("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:L.exportedFilesContainer},f.tsx(b.Heading,{class:L.exportedFilesTitle,level:this.headingLevel},y.exportText),P.length>0?null:f.tsx("div",null,f.tsx("div",null,y.exportHint)),V)),R=f.tsx("div",{class:L.printWidgetContainer},f.tsx("header",{class:L.headerTitle},y.export),this.error||D||!this.view?N:U),H="initializing"===this.viewModel?.state?this._renderLoader():R;return f.tsx("div",{afterCreate:this._handleRootAfterCreate,bind:this,class:this.classes(L.base,_.globalCss.widget,_.globalCss.panel)},H)}_renderTemplateSectionTrigger(){const{messages:t,_templateListPopover:e}=this,a=e.open;return f.tsx("button",{afterCreate:t=>this._selectTemplateNode=t,"aria-controls":a?`${this.id}__template-selection`:"","aria-label":t.selectTemplateDescription,"aria-pressed":a.toString(),class:this.classes(_.globalCss.button,_.globalCss.buttonTertiary,L.templateButton),onclick:this._handleSelectTemplateClick,title:t.selectTemplateDescription,type:"button"},t.selectTemplate)}_renderCustomTextElementSection(){const{templateOptions:{customTextElements:t}}=this;return t?f.tsx("div",{class:L.formSectionContainer,key:"custom-text-elements"},t.map((t=>{const[e,a]=Object.entries(t)[0];return"date"===e?null:f.tsx("label",{key:e},e,f.tsx("input",{bind:this,class:this.classes(L.inputText,_.globalCss.input),"data-input-custom":!0,"data-input-name":e,onchange:this._updateInputValue,type:"text",value:a}))}))):null}_renderTemplateList(){const{messages:t,messagesCommon:e,viewModel:a}=this,{defaultTemplates:s}=a,i=t.selectTemplateDescription,n=`${this.id}__template-selection`;return f.tsx("div",{class:this.classes(L.templateList,_.globalCss.widget,_.globalCss.panel),id:n},f.tsx(b.Heading,{class:_.globalCss.menuHeader,level:this.headingLevel},t.selectTemplate),f.tsx("div",{class:L.templateListScroller},f.tsx("ul",{afterCreate:this._handleTemplateListCreation,"aria-activedescendant":`${this.id}__template-item--${this._focusedTemplateIndex}`,"aria-label":i,class:_.globalCss.menuList,key:"templates",onblur:this._handleTemplateChildBlur,onclick:this._handleTemplateListClick,onkeydown:this._handleTemplateListKeyDown,role:"listbox",tabIndex:0,title:i},s.toArray().map(((e,a)=>{const s=a===this._focusedTemplateIndex,i=e.description??"",n=e.label??"";return f.tsx("li",{"aria-label":i,class:this.classes(_.globalCss.menuItem,{[_.globalCss.menuItemFocus]:s}),"data-template":e,id:`${this.id}__template-item--${a}`,key:n,title:i},F(n)?t.mapOnlyTab:n)})))),f.tsx("div",{class:L.templateListFooter},f.tsx("button",{class:this.classes(_.globalCss.button,_.globalCss.buttonSecondary),onblur:this._handleTemplateChildBlur,onclick:this._handleCloseTemplateSelection,type:"button"},e.done)))}_applyTemplate(t){const{format:e,layout:a,layoutOptions:s}=t,{templateOptions:i}=this;this._templateListPopover.open=!1,this._toggleTab("map-only"===a?w.mapOnly:w.layout,!1),e&&(i.format=e),a&&(i.layout=a),this._focusedTemplateIndex=null,i.legendEnabled=s?.legend??i.legendEnabled,this._handleCloseTemplateSelection()}_renderTitleOrFileNameSection(){const{templateOptions:t,messages:e}=this;let a,s,i,n;return this._layoutTabSelected?(a=e.title,s=e.titlePlaceHolder,i=t.title,n="title"):(a=e.fileName,s=e.fileNamePlaceHolder,i=t.fileName,n="fileName"),f.tsx("div",{class:L.formSectionContainer,key:n},f.tsx("label",null,a,f.tsx("input",{bind:this,class:this.classes(L.inputText,_.globalCss.input),"data-input-name":n,onchange:this._updateInputValue,placeholder:s,tabIndex:0,type:"text",value:i??""})))}_handleRootAfterCreate(t){this._rootNode=t,this.addHandles(a.on(t,"scroll",(()=>{this._templateListPopover.open&&this._handleCloseTemplateSelection()})))}_focusOnTabChange(t){if(!this._activeTabFocusRequested)return;const e=t.getAttribute("data-tab-id");("layoutTab"===e&&this._layoutTabSelected||"mapOnlyTab"===e&&!this._layoutTabSelected)&&(t.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const t={[L.loader]:this._awaitingServerResponse};return f.tsx("div",{class:this.classes(t),key:"loader"})}_createFileLink(t,e){const a=e||this.messages.untitled,s=t.format.toLowerCase(),i=s.includes("png")?"png":s,n=a+i;return void 0!==this._exportedFileNameMap[n]?this._exportedFileNameMap[n]++:this._exportedFileNameMap[n]=0,new u({name:a,extension:i,count:this._exportedFileNameMap[n]})}_resetToCurrentScale(){this.templateOptions.scale=this.viewModel.view?.scale}_updateCustomTextElementValue(t,e,a){t.find((t=>{const[a]=Object.entries(t)[0];return a===e}))[e]=a}_updateInputValue(t){const e=t.target,a=e.getAttribute("data-input-name"),s=!!e["data-input-custom"],{templateOptions:i}=this;if(s)return void this._updateCustomTextElementValue(i.customTextElements,a,e.value);let n;if("number"===e.type){if(!M(e.valueAsNumber)){const t=i[a];return void(e.value=`${t}`)}n=e.valueAsNumber}else n=e.value;i[a]=n}_handleDPIChange(t){this._updateInputValue(t);const e=t.currentTarget.valueAsNumber,{height:a,width:s}=$(e),{templateOptions:i}=this;i.height=a,i.width=s}_handlePrintMap(){this._pendingExportScroll=!0;const{templateOptions:t}=this,e=this.viewModel.toPrintTemplate(t),a=this._layoutTabSelected?e.layoutOptions?.titleText:t.fileName,s=this._createFileLink(e,a);this.exportedLinks.add(s),this.emit("submit",{link:s}),this.viewModel.print(e).then((t=>{s.set({url:t&&t.url,state:"ready"})})).catch((t=>{s.set({error:t,state:"error"})})).then((()=>{this.emit("complete",{link:s}),this.scheduleRender()}))}_updateFromOption(t){const e=t.target,a=e.selectedOptions?e.selectedOptions.item(0)?.value:e.options[e.selectedIndex].value,s=e.getAttribute("data-target-property");this.templateOptions[s]=a}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_showAdvancedOptions(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const t=this._rootNode;if(!t)return;const{clientHeight:e,scrollHeight:a}=t,s=a-e;s>0&&(t.scrollTop=s)}_toggleInputValue(t){const e=t.target,a=e.getAttribute("data-option-name");this.templateOptions[a]=e.checked,"scaleEnabled"===a&&(this.templateOptions[a]||this._resetToCurrentScale())}_renderExportedLink(t){const e=this.messages;return t.map((t=>{const{error:a,url:s,state:i}=t,n=t.formattedName??"",l="error"===i,r="pending"===i,d="ready"===i,p={[_.globalCss.anchorDisabled]:r||l};let c=s||null;c&&(c=o.addProxy(c));const u=o.hasSameOrigin(s,location.href),h={[g.legacyIcon.loadingIndicator]:r,[_.globalCss.rotating]:r,[g.legacyIcon.download]:u&&d,[g.legacyIcon.launchLinkExternal]:!u&&d,[g.legacyIcon.error]:l,[L.exportedFileError]:l},m={[L.exportedFileError]:l};let b;b=r?e.pending:d?e.ready:e.errorMessage;const y=l?"print-task:cim-symbol-unsupported"===a?.name?e.exportWebMapCIMError:e.exportWebMapError:"";return f.tsx("div",{"aria-label":b,class:L.exportedFile,"data-item":t,key:n,onclick:this._removeLink,title:y},f.tsx("a",{"aria-label":`${n}. ${e.linkReady}`,class:this.classes(L.exportedFileLink,_.globalCss.anchor,p),download:n,href:c??"",onclick:this._handleLinkClick,rel:"noreferrer",tabIndex:0,target:"_blank"},f.tsx("span",{class:this.classes(h)}),f.tsx("span",{class:this.classes(L.exportedFileLinkTitle,m)},n)))}))}_toggleLayoutPanel(t){const e=t.target;this._toggleTab(e.getAttribute("data-tab-id"))}_toggleTab(t,e=!0){if(this._layoutTabSelected=t===w.layout,this._layoutTabSelected){const t=this.viewModel?.templatesInfo?.layout?.choiceList;this.templateOptions.layout=t?t[0]:"letter-ansi-a-landscape"}else this.templateOptions.layout=C;e&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(t){const e=a.eventKey(t),s=t.target.getAttribute("data-tab-id");if(x.isActivationKey(e))return this._toggleTab(s),t.preventDefault(),void t.stopPropagation();"ArrowLeft"!==e&&"ArrowRight"!==e||(this._toggleTab(s===w.layout?w.mapOnly:w.layout),t.preventDefault(),t.stopPropagation())}};function P(t){return t?.["data-template"]}t.__decorate([l.property()],E.prototype,"allowedFormats",null),t.__decorate([l.property()],E.prototype,"allowedLayouts",null),t.__decorate([l.property()],E.prototype,"error",null),t.__decorate([l.property({type:T})],E.prototype,"exportedLinks",void 0),t.__decorate([l.property()],E.prototype,"extraParameters",null),t.__decorate([l.property()],E.prototype,"headingLevel",void 0),t.__decorate([l.property()],E.prototype,"iconClass",void 0),t.__decorate([l.property()],E.prototype,"icon",void 0),t.__decorate([l.property()],E.prototype,"includeDefaultTemplates",null),t.__decorate([l.property()],E.prototype,"label",null),t.__decorate([l.property(),v.messageBundle("esri/widgets/Print/t9n/Print")],E.prototype,"messages",void 0),t.__decorate([l.property(),v.messageBundle("esri/t9n/common")],E.prototype,"messagesCommon",void 0),t.__decorate([l.property()],E.prototype,"portal",null),t.__decorate([l.property()],E.prototype,"printServiceUrl",null),t.__decorate([l.property()],E.prototype,"templateCustomTextElements",null),t.__decorate([l.property({type:m})],E.prototype,"templateOptions",void 0),t.__decorate([l.property()],E.prototype,"view",null),t.__decorate([l.property({type:h})],E.prototype,"viewModel",void 0),E=t.__decorate([d.subclass("esri.widgets.Print")],E);return E}));
