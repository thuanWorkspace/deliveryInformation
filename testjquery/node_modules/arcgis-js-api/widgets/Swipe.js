/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../chunks/tslib.es6","../core/events","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","./Widget","./support/globalCss","./support/legacyIcon","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","./Swipe/SwipeViewModel"],(function(e,t,i,r,n,o,s,a,l,d,c,p,h,v){"use strict";const _="esri-swipe",u={base:_,widgetIcon:d.legacyIcon.upDownArrows,baseDisabled:`${_}--disabled`,vertical:`${_}--vertical`,horizontal:`${_}--horizontal`,container:`${_}__container`,divider:`${_}__divider`,handle:`${_}__handle`,handleHidden:`${_}__handle--hidden`,handleIcon:`${_}__handle-icon`},g={handle:!0,divider:!0};let w=class extends a{constructor(e,t){super(e,t),this.disabled=!1,this.iconClass=u.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new v,this._pointerOffset=0,this._container=null,this._onContainerPointerDown=this._onContainerPointerDown.bind(this),this._onContainerPointerMove=this._onContainerPointerMove.bind(this),this._onContainerPointerUp=this._onContainerPointerUp.bind(this)}get direction(){return this.viewModel.direction}set direction(e){this.viewModel.direction=e}get dragLabel(){return this.messages?.dragLabel??""}set dragLabel(e){this._overrideIfSome("dragLabel",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get leadingLayers(){return this.viewModel.leadingLayers}set leadingLayers(e){this.viewModel.leadingLayers=e}get position(){return this.viewModel.position}set position(e){this.viewModel.position=e}get trailingLayers(){return this.viewModel.trailingLayers}set trailingLayers(e){this.viewModel.trailingLayers=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set visibleElements(e){this._set("visibleElements",{...g,...e})}get visibleElements(){return this._get("visibleElements")||g}render(){const{state:e,direction:t}=this.viewModel,i="disabled"===e||this.disabled,r={[l.globalCss.disabled]:i,[u.baseDisabled]:i,[u.vertical]:"vertical"===t,[u.horizontal]:"horizontal"===t};return h.tsx("div",{class:this.classes(u.base,l.globalCss.widget,r)},"disabled"===e?null:this._renderContainer())}_renderHandle(){const{direction:e}=this.viewModel,{visibleElements:t}=this,i={[d.legacyIcon.dragHorizontal]:"vertical"===e,[d.legacyIcon.dragVertical]:"horizontal"===e},r=this.classes(u.handle,!t.handle&&u.handleHidden);return h.tsx("div",{class:r,key:"handle",role:"presentation"},h.tsx("span",{"aria-hidden":"true",class:this.classes(u.handleIcon,i)}))}_renderDivider(){const{visibleElements:e}=this;return e&&e.divider?h.tsx("div",{class:u.divider,key:"divider",role:"presentation"}):null}_renderContent(){return[this._renderDivider(),this._renderHandle()]}_renderContainer(){const{disabled:e,dragLabel:t,viewModel:i}=this,{max:r,min:n,direction:o,position:s}=i,a=`${s}%`,l={top:"vertical"===o?a:void 0,left:"vertical"===o?void 0:a},d=this._renderContent();return e?h.tsx("div",{class:u.container,key:"container",role:"presentation",styles:l},d):h.tsx("div",{afterCreate:this._afterContainerCreate,"aria-label":t,"aria-orientation":o,"aria-valuemax":`${r}`,"aria-valuemin":`${n}`,"aria-valuenow":`${s}`,"aria-valuetext":a,bind:this,class:u.container,key:"container",onkeydown:this._onContainerKeyDown,role:"slider",styles:l,tabIndex:0,title:t,"touch-action":"none"},d)}_afterContainerCreate(e){this._container=e,e.addEventListener("pointerdown",this._onContainerPointerDown)}_calculatePointerOffset(e){const{direction:t}=this,i=e.target,r=("vertical"===t?i.clientHeight:i.clientWidth)/2,n=i.getBoundingClientRect(),o=e.clientX-n.left,s=e.clientY-n.top;this._pointerOffset="vertical"===t?s-r:o-r}_onContainerPointerDown(e){e.preventDefault(),this._container&&document.activeElement!==this.container&&this._container.focus(),this._calculatePointerOffset(e),document.addEventListener("pointerup",this._onContainerPointerUp),document.addEventListener("pointermove",this._onContainerPointerMove)}_onContainerPointerUp(e){e.preventDefault(),document.removeEventListener("pointerup",this._onContainerPointerUp),document.removeEventListener("pointermove",this._onContainerPointerMove)}_onContainerPointerMove(e){e.preventDefault();const{_pointerOffset:t,container:i,direction:r}=this,{clientX:n,clientY:o}=e,{top:s,left:a,width:l,height:d}=i.getBoundingClientRect(),c=("vertical"===r?o-s-t:n-a-t)/("vertical"===r?d:l)*100;this.position=c}_getKeyPosition(e){const i=t.eventKey(e),{position:r}=this,{max:n,min:o,step:s,stepMultiplier:a,direction:l}=this.viewModel,d=s*a;["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End","PageUp","PageDown"].includes(i)&&(e.preventDefault(),e.stopPropagation());if("vertical"===l?"ArrowDown"===i||"ArrowRight"===i:"ArrowUp"===i||"ArrowRight"===i){return r+(e.shiftKey?d:s)}if("vertical"===l?"ArrowUp"===i||"ArrowLeft"===i:"ArrowDown"===i||"ArrowLeft"===i){return r-(e.shiftKey?d:s)}if("Home"===i)return o;if("End"===i)return n;if("vertical"===l?"PageDown"===i:"PageUp"===i)return r+d;return("vertical"===l?"PageUp"===i:"PageDown"===i)?r-d:null}_onContainerKeyDown(e){const t=this._getKeyPosition(e);"number"==typeof t&&(this.position=t)}};e.__decorate([i.property()],w.prototype,"direction",null),e.__decorate([i.property()],w.prototype,"disabled",void 0),e.__decorate([i.property()],w.prototype,"dragLabel",null),e.__decorate([i.property()],w.prototype,"iconClass",void 0),e.__decorate([i.property()],w.prototype,"icon",void 0),e.__decorate([i.property()],w.prototype,"label",null),e.__decorate([i.property()],w.prototype,"leadingLayers",null),e.__decorate([i.property(),p.messageBundle("esri/widgets/Swipe/t9n/Swipe")],w.prototype,"messages",void 0),e.__decorate([i.property()],w.prototype,"position",null),e.__decorate([i.property()],w.prototype,"trailingLayers",null),e.__decorate([i.property()],w.prototype,"view",null),e.__decorate([i.property({type:v})],w.prototype,"viewModel",void 0),e.__decorate([i.property()],w.prototype,"visibleElements",null),w=e.__decorate([s.subclass("esri.widgets.Swipe")],w);return w}));
