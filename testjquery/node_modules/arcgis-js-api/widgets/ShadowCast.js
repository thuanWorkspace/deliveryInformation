/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../intl","../core/maybe","../core/reactiveUtils","../core/timeUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","../intl/substitute","./Slider","./Widget","./ShadowCast/css","./ShadowCast/ShadowCastState","./ShadowCast/ShadowCastViewModel","./ShadowCast/ShadowCastVisibleElements","./ShadowCast/ShadowVisualizationType","./ShadowCast/components/DiscreteConfigurator","./ShadowCast/components/DurationConfigurator","./ShadowCast/components/ShadowTooltip","./ShadowCast/components/ThresholdConfigurator","./support/componentsUtils","./support/DatePicker","./support/globalCss","./support/Heading","./support/timeWidgetUtils","./support/TimezonePicker","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","../intl/date"],(function(e,i,t,s,o,a,l,n,r,d,c,h,p,u,m,v,w,y,g,b,_,S,C,T,f,M,k,z,V,D,x,O,L){"use strict";var P;!function(e){e.Slider="slider"}(P||(P={}));const R={hour:"2-digit",minute:"2-digit",timeZone:"UTC"},E=/(.*)\s(.*)/,A={labelFormatFunction:z.formatSliderLabel,min:0,max:1439,steps:15,rangeLabelInputsEnabled:!1,visibleElements:{labels:!1,rangeLabels:!1},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:(e,i,t)=>{i.classList.add(M.globalCss.primaryTick),t.classList.add(M.globalCss.primaryTickLabel);const s=t.innerText.match(E);s&&(t.innerHTML=`${s[1]}<br><div class="${M.globalCss.primaryTickAmPm}">${s[2]}</div>`)}},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:(e,i)=>{i.classList.add(M.globalCss.secondaryTick)}}]};let H=class extends u{constructor(e,i){super(e,i),this.viewModel=null,this.headingLevel=4,this.iconClass=m.css.widgetIcon,this.icon=null,this.visibleElements=new y,this._defaultViewModel=null,this._timeSlider=new p({...A,container:document.createElement("div")}),this._tooltip=null,this._onTimezoneChange=e=>{this.viewModel.utcOffset=e},this._onDateChange=e=>{this.viewModel.date=e},e?.viewModel||(this._defaultViewModel=new w({view:e?.view}),this.viewModel=this._defaultViewModel)}initialize(){this.addHandles([o.watch((()=>({viewModel:this.viewModel,slider:this._timeSlider})),(e=>this._connectTimeSlider(e)),o.syncAndInitial),o.watch((()=>({container:this.view?.surface,viewModel:this.viewModel,tooltipVisible:this.visibleElements.tooltip})),(({container:e,viewModel:i,tooltipVisible:t})=>{this._tooltip=s.destroyMaybe(this._tooltip),null!=e&&t&&(this._tooltip=new S.ShadowTooltip({viewModel:i,container:e}))}),o.syncAndInitial),o.watch((()=>({viewModel:this.viewModel,visible:this.visible})),(({viewModel:e,visible:i})=>e.setRunning(i)),o.syncAndInitial)])}destroy(){this._timeSlider=s.destroyMaybe(this._timeSlider),null!=this._defaultViewModel&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}loadDependencies(){return T.loadCalciteComponents({select:()=>new Promise(((i,t)=>e(["../chunks/calcite-select"],i,t))),option:()=>new Promise(((i,t)=>e(["../chunks/calcite-option"],i,t)))})}render(){const{visibleElements:e,viewModel:i}=this,t=i.state===v.ShadowCastState.Disabled;return O.tsx("div",{class:this.classes(m.css.base,M.globalCss.widget,M.globalCss.panel,{[M.globalCss.widgetDisabled]:t}),key:this},this._renderTimeRangeSection(),e.visualizationOptions?this._renderVisualizationOptionsSection():null)}get view(){return this.viewModel?.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get testData(){return{tooltip:this._tooltip}}_connectTimeSlider({viewModel:e,slider:i}){if(this.removeHandles(P.Slider),null==i)return;const t=e=>a.convertTime(e,"milliseconds","minutes"),s=e=>a.convertTime(e,"minutes","milliseconds"),l=({index:i,value:t})=>{0===i?e.startTimeOfDay=s(t):e.endTimeOfDay=s(t)};this.addHandles([o.watch((()=>[e.startTimeOfDay,e.endTimeOfDay]),(e=>{i.values=e.map(t)}),o.syncAndInitial),i.on("thumb-change",l),i.on("thumb-drag",l),i.on("segment-drag",(()=>{[e.startTimeOfDay,e.endTimeOfDay]=i.values.map(s)}))],P.Slider)}_renderTimeRangeSection(){const{visibleElements:e}=this;return e.timeRangeSlider||e.datePicker?O.tsx("section",{class:m.css.timeRange,key:"time-range"},O.tsx(k.Heading,{level:this.headingLevel},this.messages.timeLabel),e.timeRangeSlider?this._renderTimeRange():null,e.datePicker?this._renderDatePicker():null):null}_renderTimeRange(){const{messages:e,viewModel:i,visibleElements:t}=this,{startTimeOfDay:s,endTimeOfDay:o}=i,[a,l]=[s,o].map((e=>L.formatDate(new Date(e),R)));return[O.tsx("div",{class:m.css.timeRangeIndicator,key:"time-range-indicator"},h.substitute(e.timeRange,{start:a,end:l}),t.timezone?O.tsx(V.TimezonePicker,{value:i.utcOffset,onChange:this._onTimezoneChange}):null),O.tsx("div",{afterCreate:this._timeSliderContainerAfterCreate,afterRemoved:this._timeSliderContainerAfterRemoved,bind:this,key:"time-slider-container"})]}_timeSliderContainerAfterCreate(e){const i=this._timeSlider?.container;i&&e.appendChild(i)}_timeSliderContainerAfterRemoved(e){const i=this._timeSlider?.container;i&&e.removeChild(i)}_renderDatePicker(){return O.tsx("div",{class:m.css.datePickerContainer,key:"date-picker"},O.tsx(f,{value:this.viewModel.date,onChange:this._onDateChange}))}_renderVisualizationOptionsSection(){const{headingLevel:e,messages:i,viewModel:t,visibleElements:s}=this,o=s.colorPicker,a=e=>this.classes(t.visualizationType===e?null:m.css.visualizationConfigHidden);return O.tsx("section",{class:m.css.visualization,key:"visualization"},O.tsx(k.Heading,{level:e},i.visualizationLabel),this._renderVisualizationSelect(),O.tsx("div",{class:a(g.ShadowVisualizationType.Threshold),key:"threshold-configurator"},O.tsx(C.ThresholdConfigurator,{colorPickerVisible:o,options:t.thresholdOptions})),O.tsx("div",{class:a(g.ShadowVisualizationType.Duration),key:"duration-configurator"},O.tsx(_.DurationConfigurator,{colorPickerVisible:o,options:t.durationOptions})),O.tsx("div",{class:a(g.ShadowVisualizationType.Discrete),key:"discrete-configurator"},O.tsx(b.DiscreteConfigurator,{colorPickerVisible:o,options:t.discreteOptions})))}_renderVisualizationSelect(){const e=this.messages,i=this.viewModel.visualizationType;return O.tsx("calcite-select",{bind:this,class:m.css.visualizationSelect,key:"visualization-select",label:e.visualizationLabel,onCalciteSelectChange:this._onVisualizationTypeChange},[{type:g.ShadowVisualizationType.Threshold,label:e.threshold.label},{type:g.ShadowVisualizationType.Duration,label:e.duration.label},{type:g.ShadowVisualizationType.Discrete,label:e.discrete.label}].map((({type:e,label:t})=>O.tsx("calcite-option",{selected:e===i,value:e},t))))}_onVisualizationTypeChange(e){const i=e.target.selectedOption?.value;this.viewModel.visualizationType=i??g.ShadowVisualizationType.Threshold}};i.__decorate([l.property()],H.prototype,"viewModel",void 0),i.__decorate([l.property()],H.prototype,"view",null),i.__decorate([l.property()],H.prototype,"headingLevel",void 0),i.__decorate([l.property()],H.prototype,"iconClass",void 0),i.__decorate([l.property()],H.prototype,"icon",void 0),i.__decorate([l.property()],H.prototype,"label",null),i.__decorate([l.property({type:y,nonNullable:!0})],H.prototype,"visibleElements",void 0),i.__decorate([l.property(),x.messageBundle("esri/widgets/ShadowCast/t9n/ShadowCast")],H.prototype,"messages",void 0),i.__decorate([l.property()],H.prototype,"_defaultViewModel",void 0),i.__decorate([l.property()],H.prototype,"_timeSlider",void 0),i.__decorate([l.property()],H.prototype,"_tooltip",void 0),H=i.__decorate([c.subclass("esri.widgets.ShadowCast")],H);return H}));
