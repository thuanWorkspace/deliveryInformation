/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../core/Collection","../core/events","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","./Widget","./BasemapLayerList/BasemapLayerListViewModel","./LayerList/ListItem","./LayerList/support/layerListUtils","./support/componentsUtils","./support/globalCss","./support/Heading","./support/legacyIcon","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/widgetUtils","../chunks/sortable.esm"],(function(e,t,i,s,n,r,o,a,l,c,d,h,u,g,m,_,p,b,y,I,f,v,C,L){"use strict";const T=i.ofType(u);function x(e,t,i){e.splice(i,0,e.splice(t,1)[0])}const S=".*\\S+.*",w="root-layers",A="data-layer-uid",$="layerUid",E="esri-basemap-layer-list",k=`${E}__item`,M=`${E}__list`,B={base:E,widgetIcon:b.legacyIcon.layers,newUI:`${E}--new-ui`,titleContainer:`${E}__title-container`,mainHeading:`${E}__main-heading`,editingCard:`${E}__editing-card`,editingInput:`${E}__editing-input`,editingActions:`${E}__editing-actions`,editButton:`${E}__edit-button`,editButtonIcon:`${E}__edit-button-icon`,submitButton:`${E}__submit-button`,cancelButton:`${E}__cancel-button`,noItems:`${E}__no-items`,horizontalRule:`${E}__hr`,list:M,listHeading:`${M}-heading`,listRoot:`${M}--root`,listExclusive:`${M}--exclusive`,listEmpty:`${E}__list--empty`,listEmptyState:`${E}__list-empty-state`,listInherited:`${M}--inherited`,listIndependent:`${M}--independent`,item:k,itemOnlyChild:`${k}--only-child`,itemContent:`${k}-content`,itemMessage:`${k}--has-message`,itemInvisible:`${k}--invisible`,itemInvisibleAtScale:`${k}--invisible-at-scale`,itemChildren:`${k}--has-children`,itemSelectable:`${k}--selectable`,itemContainer:`${k}-container`,actionsMenu:`${k}-actions-menu`,actionsMenuItem:`${k}-actions-menu-item`,actionsMenuItemActive:`${k}-actions-menu-item--active`,actions:`${k}-actions`,actionsList:`${k}-actions-list`,action:`${k}-action`,actionIcon:`${k}-action-icon`,actionImage:`${k}-action-image`,actionTitle:`${k}-action-title`,actionToggle:`${E}__action-toggle`,actionToggleOn:`${E}__action-toggle--on`,label:`${k}-label`,message:`${k}-message`,title:`${k}-title`,statusIndicator:`${E}__status-indicator`,publishing:`${E}__publishing`,updating:`${E}__updating`,connectionStatus:`${E}__connection-status`,connectionStatusConnected:`${E}__connection-status--connected`,toggleVisible:`${k}-toggle`,toggleVisibleIcon:`${k}-toggle-icon`,toggleIcon:`${k}-toggle-icon`,radioIcon:`${k}-radio-icon`,childToggle:`${E}__child-toggle`,childToggleOpen:`${E}__child-toggle--open`,childOpened:`${E}__child-toggle-icon--opened`,childClosed:`${E}__child-toggle-icon--closed`,childClosed_RTL:`${E}__child-toggle-icon--closed-rtl`,sortableChosen:`${E}--chosen`},R={actions:"actions",actionSection:"action-section",baseItems:"base-items",referenceItems:"reference-items"},O={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function H(e){const{actionsOpen:t,children:i}=e;t&&(e.actionsOpen=!1),i.forEach((e=>H(e)))}const N={baseLayers:!0,referenceLayers:!0,statusIndicators:!0,errors:!1};let U=class extends d{constructor(e,t){super(e,t),this._tooltipReferenceMap=new Map,this._editingTitle=!1,this._editTitleInput=null,this._editTitleButton=null,this._focusOnElement=null,this._sortableBaseLayers=null,this._sortableReferenceLayers=null,this._sortableBaseLayersNode=null,this._sortableReferenceLayersNode=null,this._focusSortUid=null,this.visibleItems=null,this.editingEnabled=!1,this.headingLevel=2,this.iconClass=B.widgetIcon,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.selectedItems=new T,this.style="classic",this.viewModel=new h,this.visibleElements={...N}}initialize(){const{baseItems:e,referenceItems:t}=this;this._setVisibleItems(),this.addHandles([n.watch((()=>this.visibleElements),(()=>{this._itemsChanged(e,R.baseItems),this._itemsChanged(t,R.referenceItems)})),n.on((()=>this.baseItems),"change",(()=>{this._itemsChanged(e,R.baseItems)})),n.on((()=>this.referenceItems),"change",(()=>this._itemsChanged(t,R.referenceItems))),n.watch((()=>this.editingEnabled),(()=>this._toggleSorting()),n.initial)])}loadDependencies(){return m.loadCalciteComponents({icon:()=>new Promise(((t,i)=>e(["../chunks/calcite-icon"],t,i))),tooltip:()=>new Promise(((t,i)=>e(["../chunks/calcite-tooltip"],t,i)))})}destroy(){this._destroyBaseSortable(),this._destroyReferenceSortable(),this._tooltipReferenceMap.clear()}get basemapTitle(){return this.viewModel.basemapTitle}set basemapTitle(e){this.viewModel.basemapTitle=e}get baseListItemCreatedFunction(){return this.viewModel.baseListItemCreatedFunction}set baseListItemCreatedFunction(e){this.viewModel.baseListItemCreatedFunction=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get referenceListItemCreatedFunction(){return this.viewModel.referenceListItemCreatedFunction}set referenceListItemCreatedFunction(e){this.viewModel.referenceListItemCreatedFunction=e}get baseItems(){return this.viewModel.baseItems}get referenceItems(){return this.viewModel.referenceItems}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...N,...e}}triggerAction(e,t){return this.viewModel.triggerAction(e,t)}render(){const{state:e}=this.viewModel,t={[B.newUI]:"modern"===this.style,[_.globalCss.hidden]:"loading"===e,[_.globalCss.disabled]:"disabled"===e},i=this._renderItemTooltips(),s=this._renderReferenceSection(),n=this._renderBaseSection(),r=s&&n?v.tsx("hr",{class:B.horizontalRule}):null,o=[this._renderTitleContainer(),s,r,n];return v.tsx("div",{class:this.classes(B.base,_.globalCss.widget,_.globalCss.panel,t)},[i,o])}_renderItemTooltip(e){const{_tooltipReferenceMap:t,messages:i}=this;return e?v.tsx("calcite-tooltip",{referenceElement:t.get(e.uid)},i.layerIncompatibleTooltip):null}_renderItemTooltipNodes(e){const{incompatible:t,children:i}=e;return[t?this._renderItemTooltip(e):null,...!t&&i?i.toArray().map((e=>this._renderItemTooltipNodes(e))):[]]}_renderItemTooltips(){return this.visibleItems?.toArray().map((e=>this._renderItemTooltipNodes(e)))??[]}_renderEditingInput(){const{messages:e}=this,{basemapTitle:t}=this.viewModel;return v.tsx("label",{class:B.editingInput},e.basemapTitle,v.tsx("input",{afterCreate:this._storeEditTitleInput,afterUpdate:this._focusEditElement,"aria-label":e.basemapTitle,bind:this,class:_.globalCss.input,pattern:S,placeholder:e.basemapTitle,required:!0,role:"textbox",title:e.basemapTitle,type:"text",value:t??void 0}))}_renderCancelButton(){const{messagesCommon:e}=this;return v.tsx("button",{"aria-label":e.cancel,bind:this,class:this.classes(_.globalCss.button,_.globalCss.buttonTertiary),onclick:this._toggleEditingTitle,title:e.cancel,type:"button"},e.cancel)}_renderSubmitButton(){const{messagesCommon:e}=this;return v.tsx("button",{"aria-label":e.form.submit,bind:this,class:_.globalCss.button,title:e.form.submit,type:"submit"},e.form.ok)}_renderEditingForm(){return v.tsx("div",{class:B.editingCard},v.tsx("form",{bind:this,onsubmit:this._formSubmit},this._renderEditingInput(),v.tsx("div",{class:B.editingActions},this._renderCancelButton(),this._renderSubmitButton())))}_renderBasemapTitle(){const{basemapTitle:e}=this.viewModel;return v.tsx(p.Heading,{class:this.classes(_.globalCss.heading,B.mainHeading),level:this.headingLevel},e)}_renderEditTitleButton(){const{_editingTitle:e,editingEnabled:t,messagesCommon:i}=this;return t&&!e?v.tsx("button",{afterCreate:this._storeEditTitleButton,afterUpdate:this._focusEditElement,"aria-label":i.edit,bind:this,class:B.editButton,"data-node-ref":"_editButtonNode",onclick:this._toggleEditingTitle,title:i.edit,type:"button"},v.tsx("span",{"aria-hidden":"true",class:this.classes(b.legacyIcon.edit,B.editButtonIcon)})):null}_renderTitleContainer(){return v.tsx("div",{class:B.titleContainer},this._editingTitle?this._renderEditingForm():this._renderBasemapTitle(),this._renderEditTitleButton())}_renderNoLayersInfo(e,t){return v.tsx("div",{class:B.noItems,key:t},e)}_renderList(e,t){const{messages:i}=this,s="reference"===t?this._destroyReferenceSortable:this._destroyBaseSortable;return v.tsx("ul",{afterCreate:this._sortNodeCreated,afterRemoved:s,"aria-label":i.widgetLabel,bind:this,class:this.classes(B.list,B.listRoot,B.listIndependent),"data-node-ref":t,key:t,role:this.editingEnabled&&e.length?"listbox":void 0},e.map((i=>this._renderItem({item:i,parent:null,itemType:t,isOnlyChild:1===e.length}))))}_renderBaseHeader(){return v.tsx(p.Heading,{class:this.classes(_.globalCss.heading,B.listHeading),key:"base-heading",level:p.incrementHeadingLevel(this.headingLevel)},this.messages.baseHeading)}_renderBaseSection(){const{baseItems:e,messages:t,visibleElements:i}=this;if(!i.baseLayers)return null;const s=this._getItems(e),n="base";return[this._renderBaseHeader(),[0===s.length?this._renderNoLayersInfo(t.noBaseLayers,n):null,this._renderList(s,n)]]}_renderReferenceHeader(){return v.tsx(p.Heading,{class:this.classes(_.globalCss.heading,B.listHeading),key:"reference-heading",level:p.incrementHeadingLevel(this.headingLevel)},this.messages.referenceHeading)}_renderReferenceSection(){const{referenceItems:e,messages:t,visibleElements:i}=this;if(!i.referenceLayers)return null;const s=this._getItems(e),n="reference";return[this._renderReferenceHeader(),[0===s.length?this._renderNoLayersInfo(t.noReferenceLayers,n):null,this._renderList(s,n)]]}_renderChildrenToggle(e,t){const{messagesCommon:i}=this,{children:s}=e,n=!!e.error,r=!!s.length&&!n,o={[B.childToggleOpen]:e.open},a=e.open?i.collapse:i.expand;return r?v.tsx("span",{"aria-controls":t,"aria-label":a,class:this.classes(B.childToggle,o),"data-item":e,key:"toggle-children",onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,role:"button",tabIndex:0,title:a},v.tsx("span",{"aria-hidden":"true",class:this.classes(B.childClosed,b.legacyIcon.rightTriangleArrow)}),v.tsx("span",{"aria-hidden":"true",class:this.classes(B.childOpened,b.legacyIcon.downArrow)}),v.tsx("span",{"aria-hidden":"true",class:this.classes(B.childClosed_RTL,b.legacyIcon.leftTriangleArrow)})):null}_renderItemMessage(e){return e.error?v.tsx("div",{class:B.message,key:"esri-basemap-layer-list__error",role:"alert"},v.tsx("span",{"aria-hidden":"true",class:b.legacyIcon.noticeTriangle}),this.messages.layerError):e.incompatible?v.tsx("div",{class:B.message,key:"esri-basemap-layer-list__incompatible",role:"alert"},v.tsx("span",{afterCreate:t=>this._setTooltipReference(t,e),"aria-hidden":"true",bind:this,class:b.legacyIcon.noticeTriangle,tabIndex:0}),this.messages.layerIncompatible):null}_renderActionsMenuIcon(e,t){const{messagesCommon:i}=this,s={[B.actionsMenuItemActive]:e.actionsOpen};return v.tsx("div",{"aria-controls":t,"aria-label":i.options,bind:this,class:this.classes(B.actionsMenuItem,s),"data-item":e,key:"actions-menu-toggle",onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,role:"button",tabIndex:0,title:i.options},v.tsx("span",{"aria-hidden":"true",class:b.legacyIcon.handleHorizontal}))}_renderActionsMenu(e,t,i,s){const{panel:n}=e,r=n&&n.visible?this._renderPanelButton(n):null,o=1===i&&this._getSingleActionButton(t),a=o?this._renderAction({item:e,action:o,singleAction:!0}):null,l=!o&&i?this._renderActionsMenuIcon(e,s):null;return l||r||o?v.tsx("div",{class:B.actionsMenu,key:"actions-menu"},r,a,l):null}_renderChildList(e,t){const{editingEnabled:i}=this,{visibilityMode:s,children:n}=e,r=this._hasChildren(e),o=!r&&i&&"group"===e.layer?.type,{exclusive:a,inherited:l}=O,c={[B.listEmpty]:!r,[B.listExclusive]:s===a,[B.listInherited]:s===l,[B.listIndependent]:s!==l&&s!==a};return r||o?r?v.tsx("ul",{afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,"aria-expanded":e.open?"true":"false",bind:this,class:this.classes(B.list,c),"data-group":e.uid,"data-item":e,hidden:!e.open||null,id:t,key:"list-items",role:i?"listbox":s===a?"radiogroup":"group"},n?.map((t=>this._renderItem({item:t,parent:e}))).toArray()):v.tsx("div",{bind:this,class:B.listEmptyState,id:t,key:"list-items"},this.messages.noItemsToDisplay):null}_renderItemContent(e,t,i){const{id:s}=this,n=`${s}_${e.uid}`,r=`${n}_actions`,o=`${n}__list`,{panel:a}=e,l=this._filterActions(e.actionsSections),c=this._countActions(l);return[v.tsx("div",{class:B.itemContainer,key:"list-item-container"},this._renderChildrenToggle(e,o),this._renderLabel(e,t,i),this._renderActionsMenu(e,l,c,r)),this._renderItemMessage(e),c?this._renderActionsSections(e,l,r):null,a&&a.open&&!a.disabled?a.render():null,this._renderChildList(e,o)]}_renderItem({item:e,parent:t,itemType:i,isOnlyChild:s}){const{style:n,id:r,editingEnabled:o,selectedItems:a}=this,l=`${`${r}_${e.uid}`}__title`,c=this._hasMessage(e),d=this._hasChildren(e),h={[B.itemChildren]:d,[B.itemMessage]:!!c,[B.itemInvisible]:"modern"===n&&!e.visible,[B.itemInvisibleAtScale]:!e.visibleAtCurrentScale,[B.itemSelectable]:o};if(o){const n={[A]:e.layer?.uid};return v.tsx("li",{afterCreate:this._focusListItem,afterUpdate:this._focusListItem,"aria-labelledby":l,"aria-selected":g.findSelectedItem(e,a)?"true":"false",bind:this,class:this.classes(B.item,h,{[B.itemOnlyChild]:!!s}),"data-item":e,"data-item-type":i,key:`item-with-selection-${e.uid}`,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,role:"option",tabIndex:0,...n},this._renderItemContent(e,t,l))}return v.tsx("li",{afterCreate:this._focusListItem,afterUpdate:this._focusListItem,"aria-labelledby":l,bind:this,class:this.classes(B.item,h),key:`item-no-selection-${e.uid}`},this._renderItemContent(e,t,l))}_renderConnectionIcon(e){const{connectionStatus:t}=e;return null!=t?v.tsx("calcite-icon",{icon:"connected"===t?"check-circle":"offline",scale:"s"}):null}_renderItemStatus(e,t){const{visibleElements:i}=this;if(!i.statusIndicators)return null;const{connectionStatus:s,publishing:n,updating:r}=e,o=r&&!t,a=!!s;return v.tsx("span",{class:this.classes({[B.statusIndicator]:!0,[B.publishing]:n,[B.updating]:o,[B.connectionStatus]:a,[B.connectionStatusConnected]:a&&"connected"===s}),key:"layer-item-status"},this._renderConnectionIcon(e))}_renderItemTitle(e,t){const{messages:i}=this,s=e.title||i.untitledLayer,n=e.visibleAtCurrentScale?s:`${s} (${i.layerInvisibleAtScale})`;return v.tsx("span",{"aria-label":n,class:B.title,id:t,key:"layer-title-container",title:n},s)}_renderItemToggleIcon({visible:e},t){const{style:i}=this,{exclusive:s}=O,n=t?.visibilityMode,r="modern"===i,o=n===s,a={[B.toggleIcon]:r&&!o,[B.radioIcon]:r&&o,[b.legacyIcon.radioChecked]:o&&e,[b.legacyIcon.radioUnchecked]:o&&!e,[b.legacyIcon.visible]:!o&&e,[b.legacyIcon.nonVisible]:!o&&!e};return v.tsx("span",{"aria-hidden":"true",class:this.classes(a),key:"item-toggle-icon"})}_renderItemToggle(e,t,i){const{editingEnabled:s,messages:n}=this,{exclusive:r}=O,o=t?.visibilityMode,a=o===r?"radio":"switch";return s?v.tsx("span",{"aria-checked":e.visible?"true":"false","aria-labelledby":i,bind:this,class:B.toggleVisible,"data-item":e,"data-parent-visibility":o,key:"item-toggle-selection-enabled",onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,role:a,tabIndex:0,title:n.layerVisibility},this._renderItemToggleIcon(e,t)):v.tsx("span",{class:B.toggleVisible,key:"item-toggle"},this._renderItemToggleIcon(e,t))}_renderLabel(e,t,i){const{editingEnabled:s,style:n,messages:r}=this,{inherited:o,exclusive:a}=O,l=t?.visibilityMode,c=l===a?"radio":"switch",d=this._renderItemTitle(e,i),h=this._renderItemStatus(e,t),u=this._renderItemToggle(e,t,i),g="modern"===n?[d,h,u]:[u,d,h],m=s?v.tsx("div",{class:B.label,key:`item-label-no-selection-${e.uid}`},g):v.tsx("div",{"aria-checked":e.visible?"true":"false","aria-labelledby":i,bind:this,class:B.label,"data-item":e,"data-parent-visibility":l,key:`item-label-with-selection-${e.uid}`,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,role:c,tabIndex:0,title:r.layerVisibility},g);return l===o||e.error?v.tsx("div",{class:B.label,key:`item-label-container-${e.uid}`},this._renderItemTitle(e,i),this._renderItemStatus(e,t)):m}_renderPanelButton(e){const{className:t,open:i,title:s,image:n,disabled:r}=e,o=n||t?t:b.legacyIcon.defaultAction,a=this._getIconImageStyles(e),l={[B.actionsMenuItemActive]:i&&!r},c={[B.actionImage]:!!a["background-image"],[_.globalCss.disabledElement]:e.disabled};return o&&(c[o]=!!o),v.tsx("div",{"aria-disabled":e.disabled.toString(),"aria-label":s,bind:this,class:this.classes(B.actionsMenuItem,l),"data-panel":e,key:`panel-${e.uid}`,onclick:this._triggerPanel,onkeydown:this._triggerPanel,role:"button",tabIndex:e.disabled?void 0:0,title:s},v.tsx("span",{class:this.classes(c),styles:a}))}_renderActionsSections(e,t,i){const s=t.toArray().map(((t,i)=>v.tsx("ul",{class:B.actionsList,key:`${e}-action-section-${i}`},this._renderActionSection(e,t))));return v.tsx("div",{"aria-expanded":e.actionsOpen?"true":"false",class:B.actions,hidden:!e.actionsOpen||null,id:i,key:"actions-section",role:"group"},s)}_renderActionSection(e,t){return(t&&t.toArray()).map((t=>this._renderAction({item:e,action:t})))}_renderActionIcon(e){const{active:t,className:i}=e,s=this._getIconImageStyles(e),n="button"!==e.type||e.image||i?i:b.legacyIcon.defaultAction,r={[B.actionImage]:!t&&!!s["background-image"],[b.legacyIcon.loadingIndicator]:t,[_.globalCss.rotating]:t};return n&&!t&&(r[n]=!0),v.tsx("span",{"aria-hidden":"true",class:this.classes(B.actionIcon,r),key:"action-icon",styles:s})}_renderActionTitle(e,t){return t?null:v.tsx("span",{class:B.actionTitle,key:"action-title"},e)}_renderAction(e){const{item:t,action:i,singleAction:s}=e,{active:n,disabled:r,title:o}=i,a={[B.actionsMenuItem]:s&&"button"===i.type,[B.action]:n||!s&&"toggle"!==i.type,[B.actionToggle]:!n&&"toggle"===i.type,[B.actionToggleOn]:!n&&"toggle"===i.type&&i.value,[_.globalCss.disabledElement]:r},l=[this._renderActionIcon(i),this._renderActionTitle(o,s)];return s?v.tsx("div",{"aria-label":o,bind:this,classes:a,"data-action":i,"data-item":t,key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:0,title:o??void 0},l):v.tsx("li",{"aria-label":o,bind:this,classes:a,"data-action":i,"data-item":t,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:0,title:o??void 0},l)}_setVisibleItems(){const{referenceItems:e,baseItems:t,visibleElements:i}=this,s=e.concat(t);this.visibleItems=s?.filter((e=>!e.hidden&&(i.errors||!e.error)))}_setTooltipReference(e,t){this._tooltipReferenceMap.set(t.uid,e),this.scheduleRender()}_hasMessage(e){return!!e.error||e.incompatible}_hasChildren(e){return!!e.children.length&&!this._hasMessage(e)}_filterActions(e){return e.map((e=>e.filter((e=>e.visible))))}_destroyReferenceSortable(){const{_sortableReferenceLayers:e}=this;e?.el&&e.destroy(),this._sortableReferenceLayersNode=null}_destroyBaseSortable(){const{_sortableBaseLayers:e}=this;e?.el&&e.destroy(),this._sortableBaseLayersNode=null}_toggleEditingTitle(){const{_editingTitle:e}=this,t=!e;this._editingTitle=t,this._focusOnElement=t?"edit-input":"edit-button",this.scheduleRender()}_storeEditTitleInput(e){this._editTitleInput=e,this._focusEditElement()}_focusEditElement(){this._editTitleInput&&"edit-input"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleInput.focus()),this._editTitleButton&&"edit-button"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleButton.focus())}_storeEditTitleButton(e){this._editTitleButton=e,this._focusEditElement()}_formSubmit(e){e.preventDefault();const t=this._editTitleInput?.value;t?.trim()&&(this.basemapTitle=t),this._toggleEditingTitle()}_itemMovedList(e){const t=F(e.item);if(!t)return;const i=e.to.dataset.nodeRef,s=e.from.dataset.nodeRef,n=e.newIndex;this.viewModel.transferListItem({listItem:t,from:s,to:i,newIndex:n})}_toggleSortingBaseLayers(){const{_sortableBaseLayers:e,_sortableBaseLayersNode:t,editingEnabled:i}=this;if(!t)return;const s=!i;if(e)e.option("disabled",s);else{const e=L.Sortable.create(t,{dataIdAttr:A,group:w,filter:`.${B.itemOnlyChild}`,fallbackTolerance:4,disabled:s,onSort:()=>this._sortLayersToItems({type:"base",itemIds:e.toArray()}),onAdd:e=>this._itemMovedList(e),chosenClass:B.sortableChosen});this._sortableBaseLayers=e}}_toggleSortingReferenceLayers(){const{_sortableReferenceLayers:e,_sortableReferenceLayersNode:t,editingEnabled:i}=this;if(!t)return;const s=!i;if(e)e.option("disabled",s);else{const e=L.Sortable.create(t,{dataIdAttr:A,group:w,disabled:s,fallbackTolerance:4,onSort:()=>this._sortLayersToItems({type:"reference",itemIds:e.toArray()}),onAdd:e=>this._itemMovedList(e),chosenClass:B.sortableChosen});this._sortableReferenceLayers=e}}_toggleSorting(){this._toggleSortingBaseLayers(),this._toggleSortingReferenceLayers()}_sortNodeCreated(e){const t=e.getAttribute("data-node-ref");"base"===t&&(this._sortableBaseLayersNode=e),"reference"===t&&(this._sortableReferenceLayersNode=e),this._toggleSorting()}_getItems(e){return e.toArray().filter((e=>!e.hidden&&(this.visibleElements.errors||!e.error)))}_getSingleActionButton(e){return e.reduce((e=>e)).filter((e=>e&&"button"===e.type)).at(0)}_sortLayersToItems({type:e,itemIds:t}){const i="base"===e?this.view?.map?.basemap?.baseLayers:"reference"===e?this.view?.map?.basemap?.referenceLayers:null;i&&i.sort(((e,i)=>{const s=t.indexOf(e.uid),n=t.indexOf(i.uid);return s>n?-1:s<n?1:0}))}_focusListItem(e){const{_focusSortUid:t}=this;if(!e||!t)return;const i=F(e);i?.layer?.uid===t&&(e.focus(),this._focusSortUid=null)}_selectionKeydown(e){const t=["ArrowDown","ArrowUp"],i=s.eventKey(e);if(!t.includes(i))return void this._toggleSelection(e);e.stopPropagation();const n=e.currentTarget,r=F(n),o=n.dataset.itemType,{_sortableBaseLayers:a,_sortableReferenceLayers:l,selectedItems:c}=this,d="base"===o?a:"reference"===o?l:null;if(!d||!r)return;const h=g.findSelectedItem(r,c),u=d.toArray(),m=e.target,_=u.indexOf(m.dataset[$]),{baseItems:p,referenceItems:b}=this.viewModel;if(-1!==_){if("ArrowDown"===i){const e=_+1,t=e>=u.length;if(t&&"reference"===o&&h){const e=p.length;return this.viewModel.transferListItem({listItem:r,from:"reference",to:"base",newIndex:e}),this._focusSortUid=r.layer?.uid,void this.scheduleRender()}if(t&&"reference"===o){const e=p.at(0);return this._focusSortUid=e?.layer?.uid,void this.scheduleRender()}if(t)return;return h&&(x(u,_,e),d.sort(u),this._sortLayersToItems({type:o,itemIds:d.toArray()})),this._focusSortUid=r.layer?.uid,void this.scheduleRender()}if("ArrowUp"===i){const e=_-1,t=e<0;if(t&&"base"===o&&h){if(1===p.length)return;const e=0;return this.viewModel.transferListItem({listItem:r,from:"base",to:"reference",newIndex:e}),this._focusSortUid=r.layer?.uid,void this.scheduleRender()}if(t&&"base"===o){const e=b.at(-1);return this._focusSortUid=e?.layer?.uid,void this.scheduleRender()}if(t)return;h&&(x(u,_,e),d.sort(u),this._sortLayersToItems({type:o,itemIds:d.toArray()})),this._focusSortUid=r.layer?.uid,this.scheduleRender()}}}_watchActionSectionChanges(e,t){this.addHandles(e.on("change",(()=>this.scheduleRender())),t),e.forEach((e=>this._renderOnActionChanges(e,t)))}_renderOnActionChanges(e,t){"toggle"!==e.type?"slider"!==e.type?this.addHandles([n.watch((()=>[e.className,e.image,e.id,e.title,e.visible]),(()=>this.scheduleRender()),n.initial)],t):this.addHandles([n.watch((()=>[e.className,e.id,e.title,e.visible,e.value,e.displayValueEnabled,e.max,e.min,e.step]),(()=>this.scheduleRender()),n.initial)],t):this.addHandles([n.watch((()=>[e.className,e.image,e.id,e.title,e.visible,e.value]),(()=>this.scheduleRender()),n.initial)],t)}_renderOnItemChanges(e,t){this.addHandles([n.watch((()=>[e.actionsOpen,e.visible,e.open,e.updating,e.connectionStatus,e.publishing,e.title,e.visibleAtCurrentScale,e.error,e.visibilityMode,e.panel,e.panel?.title,e.panel?.content,e.panel?.className]),(()=>this.scheduleRender()),n.initial),n.watch((()=>[e.hidden,e.error]),(()=>this._setVisibleItems())),e.actionsSections.on("change",(()=>this.scheduleRender())),e.children.on("change",(()=>this.scheduleRender()))],t),e.children.forEach((e=>this._renderOnItemChanges(e,t))),e.actionsSections.forEach((e=>this._watchActionSectionChanges(e,t)))}_itemsChanged(e,t){this.removeHandles(t),this._tooltipReferenceMap.clear(),this._setVisibleItems(),e.forEach((e=>this._renderOnItemChanges(e,t))),this.scheduleRender()}_countActions(e){return e.reduce(((e,t)=>e+t.length),0)}_getIconImageStyles(e){const t="esri.widgets.LayerList.ListItemPanel"===e.declaredClass||"esri.support.Action.ActionButton"===e.declaredClass||"esri.support.Action.ActionToggle"===e.declaredClass?e.image:null;return{"background-image":t?`url("${t}")`:""}}_toggleActionsOpen(e){e.stopPropagation();const t=F(e.currentTarget);if(!t)return;const{actionsOpen:i}=t,s=!i,{baseItems:n,referenceItems:r}=this;s&&(n.forEach((e=>H(e))),r.forEach((e=>H(e)))),t.actionsOpen=s}_triggerPanel(e){e.stopPropagation();const t=P(e.currentTarget);t&&!t.disabled&&(t.open=!t.open)}_triggerAction(e){e.stopPropagation();const t=e.currentTarget,i=V(t),s=F(t);s&&i&&("toggle"===i.type&&(i.value=!i.value),this.triggerAction(i,s))}_toggleVisibility(e){e.stopPropagation();const t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),s=F(t);s&&(i===O.exclusive&&s.visible||(s.visible=!s.visible))}_toggleChildrenClick(e){e.stopPropagation();const t=F(e.currentTarget);t&&(t.open=!t.open)}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,s=t&&(e.metaKey||e.ctrlKey),n=F(e.currentTarget);if(!n)return;const r=g.findSelectedItem(n,i),{length:o}=i;if(!s)return o&&!(r&&1===o)?(i.removeAll(),void i.add(n)):void(r?i.remove(r):i.add(n));r?i.remove(r):i.add(n)}get test(){return{visibleItems:this.visibleItems}}};function V(e){return e["data-action"]}function P(e){return e["data-panel"]}function F(e){return e["data-item"]}t.__decorate([r.property()],U.prototype,"visibleItems",void 0),t.__decorate([r.property()],U.prototype,"basemapTitle",null),t.__decorate([r.property()],U.prototype,"baseListItemCreatedFunction",null),t.__decorate([r.property()],U.prototype,"editingEnabled",void 0),t.__decorate([r.property()],U.prototype,"headingLevel",void 0),t.__decorate([r.property()],U.prototype,"iconClass",void 0),t.__decorate([r.property()],U.prototype,"label",null),t.__decorate([r.property(),I.messageBundle("esri/widgets/BasemapLayerList/t9n/BasemapLayerList")],U.prototype,"messages",void 0),t.__decorate([r.property(),I.messageBundle("esri/t9n/common")],U.prototype,"messagesCommon",void 0),t.__decorate([r.property()],U.prototype,"multipleSelectionEnabled",void 0),t.__decorate([r.property()],U.prototype,"referenceListItemCreatedFunction",null),t.__decorate([r.property({readOnly:!0})],U.prototype,"baseItems",null),t.__decorate([r.property({readOnly:!0})],U.prototype,"referenceItems",null),t.__decorate([r.property()],U.prototype,"selectedItems",void 0),t.__decorate([r.property()],U.prototype,"style",void 0),t.__decorate([r.property()],U.prototype,"view",null),t.__decorate([f.vmEvent("trigger-action"),r.property({type:h})],U.prototype,"viewModel",void 0),t.__decorate([r.property()],U.prototype,"visibleElements",void 0),t.__decorate([o.cast("visibleElements")],U.prototype,"castVisibleElements",null),t.__decorate([y.accessibleHandler()],U.prototype,"_toggleActionsOpen",null),t.__decorate([y.accessibleHandler()],U.prototype,"_triggerPanel",null),t.__decorate([y.accessibleHandler()],U.prototype,"_triggerAction",null),t.__decorate([y.accessibleHandler()],U.prototype,"_toggleVisibility",null),t.__decorate([y.accessibleHandler()],U.prototype,"_toggleChildrenClick",null),t.__decorate([y.accessibleHandler()],U.prototype,"_toggleSelection",null),U=t.__decorate([c.subclass("esri.widgets.BasemapLayerList")],U);return U}));
