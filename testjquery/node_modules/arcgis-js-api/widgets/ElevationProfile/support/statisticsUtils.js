/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/arrayUtils","../../../core/unitUtils","./constants"],(function(t,e,n,l){"use strict";function i(t,e){const i=t.length;if(0===i)return null;const a=t[0],o=a.sampledZ;let u=o,v=o,m=0,g=0,p=null,f=null,h=null!=o?o:0,E=0,S=0,x=null!=o?1:0,_=0,d=0;const P=n.getMetersPerUnitForSR(e),C=n.getMetersPerVerticalUnitForSR(e),M=l.getConfig().minSlopeSampleDistance/P,D=2*M,U=new c,N=new c,y=()=>{R(),U.copy(N),N.reset()},H=(t,e)=>{y(),t>0&&t-U.start<=D&&(t=U.start+M),N.restart(t,e)},R=()=>{if(U.isHole||N.isHole)return;const t=N.avgElevation-U.avgElevation,e=N.start-U.start,l=t*C,i=e*P,a=n.convertUnit(Math.atan2(l,i),"radians","degrees");a>0?(E+=a,p=r(p,a),_++):a<0&&(S-=a,f=r(f,-a),d++)};null!=a.sampledZ&&H(a.distance,a.sampledZ);for(let n=1;n<i;++n){const e=t[n-1],l=t[n],i=l.sampledZ;if(null==i){N.isHole||y();continue}x++,h+=i,u=s(u,i),v=r(v,i),N.isHole||l.distance-N.start>=M?H(l.distance,i):N.insert(i);const a=e.sampledZ;if(null!=a){const t=i-a;t>0?m+=t:t<0&&(g-=t)}}return y(),0===x?null:{maxDistance:t[i-1].distance,minElevation:u,maxElevation:v,avgElevation:0===x?null:h/x,elevationGain:m,elevationLoss:g,maxPositiveSlope:p,maxNegativeSlope:f,avgPositiveSlope:0===_?null:E/_,avgNegativeSlope:0===d?null:S/d}}function a(t){const n=t.filter(e.isSome),l=n.length;if(0===l)return null;const i=n[0];if(1===l)return i;let a=i.maxDistance,o=i.minElevation,u=i.maxElevation,c=i.maxPositiveSlope,v=i.maxNegativeSlope;for(let e=1;e<n.length;++e){const t=n[e];a=r(a,t.maxDistance),o=s(o,t.minElevation),u=r(u,t.maxElevation),c=r(c,t.maxPositiveSlope),v=r(v,t.maxNegativeSlope)}return{maxDistance:a,minElevation:o,maxElevation:u,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:c,maxNegativeSlope:v,avgPositiveSlope:null,avgNegativeSlope:null}}function o(t){let e=null,l=null,i=null;for(const a of t){if(null==a)continue;const{statistics:t,spatialReference:o}=a;if(null==t)continue;const c=n.getMetersPerUnitForSR(o);e=r(e,u(t.maxDistance,c));const v=n.getMetersPerVerticalUnitForSR(o);i=s(i,u(t.minElevation,v)),l=r(l,u(t.maxElevation,v))}return{minDistance:0,maxDistance:e??0,minElevation:i??0,maxElevation:l??0}}function s(t,e){return null==e?t:null!=t?Math.min(t,e):e}function r(t,e){return null==e?t:null!=t?Math.max(t,e):e}function u(t,e){return null!=t&&null!=e?t*e:null}class c{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return 0===this._sampleCount}get start(){return this._start}copy(t){this._start=t._start,this._sampleCount=t._sampleCount,this._totalElevation=t._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(t,e){this._start=t,this._sampleCount=1,this._totalElevation=e}insert(t){++this._sampleCount,this._totalElevation+=t}}t.getBoundsInMeters=o,t.getStatistics=i,t.mergeStatistics=a,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
