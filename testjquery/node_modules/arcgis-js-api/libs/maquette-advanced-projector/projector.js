/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../maquette/dom","../maquette/projector","./advanced-projector-options","./utils"],(function(e,t,r,o,n){"use strict";const d=(e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r},s=(e,t)=>e.find(t),c=(e,t,r=!1)=>{let o=e;return t.forEach(((e,n)=>{const d=o?.children?s(o.children,(t=>t.domNode===e)):void 0;r&&!d&&n!==t.length-1||(o=d)})),o},i=e=>{let r;const s={...o.defaultAdvancedProjectorOptions,...e},i=n.applyDefaultProjectionOptions(s),a=i.performanceLogger;let l,p=!0,m=!1;const u=[],f=[],v=(e,t,o)=>{let n;i.eventHandlerInterceptor=(e,t,o,i)=>function(e){let t;a("domEvent",e);const o=d(e.currentTarget,n.domNode),i=o.some((e=>customElements.get(e?.tagName?.toLowerCase())));if(e.eventPhase===Event.CAPTURING_PHASE||!i)o.reverse(),t=c(n.getLastRender(),o);else{const r=e.composedPath(),o=r.slice(r.indexOf(e.currentTarget),r.indexOf(n.domNode)).reverse();t=c(n.getLastRender(),o,!0)}let l;return t&&(l=s.handleInterceptedEvent(r,t,this,e)),a("domEventProcessed",e),l},s.postProcessProjectionOptions?.(i);const l=o();n=e(t,l,i),i.eventHandlerInterceptor=void 0,u.push(n),f.push(o),s.afterFirstVNodeRendered&&s.afterFirstVNodeRendered(n,l)};let h=()=>{if(l=void 0,p){p=!1,a("renderStart",void 0);for(let e=0;e<u.length;e++){const t=f[e]();a("rendered",void 0),u[e].update(t),a("patched",void 0)}a("renderDone",void 0),p=!0}};return s.modifyDoRenderImplementation&&(h=s.modifyDoRenderImplementation(h,u,f)),r={renderNow:h,scheduleRender:()=>{l||m||(l=requestAnimationFrame(h))},stop:()=>{l&&(cancelAnimationFrame(l),l=void 0),m=!0},resume:()=>{m=!1,p=!0,r.scheduleRender()},append:(e,r)=>{v(t.dom.append,e,r)},insertBefore:(e,r)=>{v(t.dom.insertBefore,e,r)},merge:(e,r)=>{v(t.dom.merge,e,r)},replace:(e,r)=>{v(t.dom.replace,e,r)},detach:e=>{for(let t=0;t<f.length;t++)if(f[t]===e)return f.splice(t,1),u.splice(t,1)[0];throw new Error("renderFunction was not found")}},r};e.createAdvancedProjector=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
