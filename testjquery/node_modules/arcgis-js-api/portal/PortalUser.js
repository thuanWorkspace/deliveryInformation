/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../core/Error","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","./PortalFolder","./PortalGroup"],(function(t,e,r,o,l,s,p,n,i,a,u){"use strict";const d=t=>Object.freeze(Object.defineProperty({__proto__:null,default:t},Symbol.toStringTag,{value:"Module"}));var c;let h=c=class extends o.JSONSupport{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.portal?.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.portal?.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t?.data,o=t?.folder,l={method:"post"};e&&(l.query=e.createPostQuery(),null!=r&&("string"==typeof r?l.query.text=r:"object"==typeof r&&(l.query.text=JSON.stringify(r))));let s=this.userContentUrl;return o&&(s+="/"+("string"==typeof o?o:o.id)),this.portal.request(s+"/addItem",l).then((t=>(e.id=t.id,e.portal=this.portal,e.loaded?e.reload():e.load())))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then((()=>{t.id=null,t.portal=null}))}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map((t=>t.id));if(r.length){const o={method:"post",query:{items:r.join(",")}};return this.portal.request(e,o).then((()=>{t.forEach((t=>{t.id=null,t.portal=null}))}))}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then((t=>{let e;return e=t&&t.folders?t.folders.map((t=>{const e=a.fromJSON(t);return e.portal=this.portal,e})):[],e}))}fetchGroups(){return this.portal.request(this.url??"").then((t=>{let e;return e=t&&t.groups?t.groups.map((t=>{const e=u.fromJSON(t);return e.portal=this.portal,e})):[],e}))}fetchItems(e){const r=e??{};let o,l=this.userContentUrl??"";return r.folder&&(l+="/"+r.folder.id),new Promise(((e,r)=>t(["./PortalItem"],(t=>e(d(t))),r))).then((({default:t})=>{o=t;const e={folders:!1,num:r.num||10,start:r.start||1,sortField:r.sortField||"created",sortOrder:r.sortOrder||"asc"};return this.portal.request(l,{query:e})})).then((t=>{let e;return t?.items?(e=t.items.map((t=>{const e=o.fromJSON(t);return e.portal=this.portal,e})),Promise.all(e.map((t=>t.load()))).catch((t=>t)).then((()=>({items:e,nextStart:t.nextStart,total:t.total})))):{items:[],nextStart:-1,total:0}}))}fetchTags(){return this.portal.request(this.url+"/tags").then((t=>t.tags))}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new u({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new r("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new r("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new c;return e.sourceJSON=t,e.read(t),e}};e.__decorate([l.property()],h.prototype,"access",void 0),e.__decorate([l.property({type:Date})],h.prototype,"created",void 0),e.__decorate([l.property()],h.prototype,"culture",void 0),e.__decorate([l.property()],h.prototype,"description",void 0),e.__decorate([l.property()],h.prototype,"email",void 0),e.__decorate([l.property()],h.prototype,"favGroupId",void 0),e.__decorate([l.property()],h.prototype,"fullName",void 0),e.__decorate([l.property({type:Date})],h.prototype,"modified",void 0),e.__decorate([l.property()],h.prototype,"orgId",void 0),e.__decorate([l.property()],h.prototype,"portal",void 0),e.__decorate([l.property()],h.prototype,"preferredView",void 0),e.__decorate([l.property()],h.prototype,"privileges",void 0),e.__decorate([l.property()],h.prototype,"region",void 0),e.__decorate([l.property()],h.prototype,"role",void 0),e.__decorate([l.property()],h.prototype,"roleId",void 0),e.__decorate([l.property()],h.prototype,"sourceJSON",void 0),e.__decorate([l.property()],h.prototype,"thumbnail",void 0),e.__decorate([l.property({readOnly:!0})],h.prototype,"thumbnailUrl",null),e.__decorate([l.property()],h.prototype,"units",void 0),e.__decorate([l.property({readOnly:!0})],h.prototype,"userContentUrl",null),e.__decorate([l.property({readOnly:!0})],h.prototype,"url",null),e.__decorate([l.property()],h.prototype,"username",void 0),e.__decorate([l.property()],h.prototype,"userType",void 0),h=c=e.__decorate([i.subclass("esri.portal.PortalUser")],h);return h}));
