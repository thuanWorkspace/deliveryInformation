/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../layers/support/associatedFeatureServiceUtils"],(function(e,t){"use strict";function a(e){const t={id:e.id,name:e.name};return"Oriented Imagery Layer"===e.type&&(t.layerType="OrientedImageryLayer"),t}async function r(e,t,r){if(null==e?.layers||null==e?.tables){const l=await r.fetchServiceMetadata(t);(e=e||{}).layers=e.layers||l?.layers?.map(a),e.tables=e.tables||l?.tables?.map(a)}return e}function l(e){const t=e.layers;if(t?.length)return t[0].id;const a=e.tables;return a?.length?a[0].id:null}function n(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function s(e){const t=[];return e?.layers?.forEach((e=>{"SubtypeGroupLayer"===e.layerType&&t.push(e.id)})),t}function i(e){return e?.layers?.filter((({layerType:e})=>"OrientedImageryLayer"===e)).map((({id:e})=>e))}async function u(e,r,l){if(!e?.url)return r??{};if(r??(r={}),!r.layers){const t=await l.fetchServiceMetadata(e.url);r.layers=t.layers?.map(a)}const{serverUrl:n,portalItem:s}=await t.findAssociatedFeatureService(e.url,{sceneLayerItem:e}).catch((()=>({serverUrl:null,portalItem:null})));if(null==n)return r.tables=[],r;if(!r.tables&&s){const e=await s.fetchData();if(e?.tables)r.tables=e.tables.map(a);else{const e=await l.fetchServiceMetadata(n);r.tables=e?.tables?.map(a)}}if(r.tables)for(const t of r.tables)t.url=`${n}/${t.id}`;return r}e.createSublayerData=a,e.getFirstLayerOrTableId=l,e.getNumLayersAndTables=n,e.getOrientedImageryLayerIds=i,e.getSubtypeGroupLayerIds=s,e.populateSceneServiceItemData=u,e.preprocessFSItemData=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
