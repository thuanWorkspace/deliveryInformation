/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../request","../../core/Error","../../core/urlUtils"],(function(e,t,r,o){"use strict";async function a(e,t={},r){await e.load(r);const a=o.join(e.itemUrl,"resources"),{start:n=1,num:s=10,sortOrder:i="asc",sortField:l="created"}=t,u={query:{start:n,num:s,sortOrder:i,sortField:l,token:e.apiKey},signal:r?.signal},c=await e.portal.request(a,u);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map((({created:t,size:r,resource:o})=>({created:new Date(t),size:r,resource:e.resourceFromPath(o)})))}}async function n(e,t,a,n){if(!e.hasPath())throw new r(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const s=e.portalItem;await s.load(n);const i=o.join(s.userItemUrl,"add"===t?"addResources":"updateResources"),[u,c]=l(e.path),p=new FormData;return u&&"."!==u&&p.append("resourcesPrefix",u),null!=n&&n.compress&&p.append("compress","true"),p.append("fileName",c),p.append("file",a,c),p.append("f","json"),n?.access&&p.append("access",n.access),await s.portal.request(i,{method:"post",body:p,signal:n?.signal}),e}async function s(e,t,a){if(!t.hasPath())throw new r("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(a);const n=o.join(e.userItemUrl,"removeResources");await e.portal.request(n,{method:"post",query:{resource:t.path},signal:a?.signal}),t.portalItem=null}async function i(e,t){await e.load(t);const r=o.join(e.userItemUrl,"removeResources");return e.portal.request(r,{method:"post",query:{deleteAll:!0},signal:t?.signal})}function l(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function u(e){const[t,r]=c(e),[o,a]=l(t);return[o,a,r]}function c(e){const t=o.getPathExtension(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function p(e){if("blob"===e.type)return e.blob;if("json"===e.type)return new Blob([e.jsonString],{type:"application/json"});return(await t(e.url,{responseType:"blob"})).data}function d(e,t){if(!e.hasPath())return null;const[r,,a]=u(e.path);return e.portalItem.resourceFromPath(o.join(r,t+a))}function m(e,t){if(!e.hasPath())return null;const[r,,a]=u(e.path);return e.portalItem.resourceFromPath(o.join(r,t+a))}e.addOrUpdateResource=n,e.contentToBlob=p,e.fetchResources=a,e.getSiblingOfSameType=d,e.getSiblingOfSameTypeI=m,e.removeAllResources=i,e.removeResource=s,e.splitPrefixFileNameAndExtension=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
