/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","./asyncUtils","./Collection","./events","./handleUtils","./maybe","./promiseUtils","./accessorSupport/watch","./accessorSupport/trackingUtils"],(function(n,e,t,o,r,c,i,s,a){"use strict";function l(n,e,t={}){return d(n,e,t,v)}function u(n,e,t={}){return d(n,e,t,b)}function d(n,e,t={},o){let r=null;const i=t.once?(n,t)=>{o(n)&&(c.removeMaybe(r),e(n,t))}:(n,t)=>{o(n)&&e(n,t)};if(r=s.watchTracked(n,i,t.sync,t.equals),t.initial){const e=n();i(e,e)}return r}function f(n,e,t,i={}){let s=null,a=null,u=null;function d(){s&&a&&(a.remove(),i.onListenerRemove?.(s),s=null,a=null)}function f(n){i.once&&i.once&&c.removeMaybe(u),t(n)}const m=l(n,((n,t)=>{d(),o.isEventTarget(n)&&(s=n,a=o.on(n,e,f),i.onListenerAdd?.(n))}),{sync:i.sync,initial:!0});return u=r.makeHandle((()=>{m.remove(),d()})),u}function m(n,e){return p(n,null,e)}function y(n,e){return p(n,b,e)}function p(n,e,t){if(i.isAborted(t))return Promise.reject(i.createAbortError());const o=n();if(e?.(o))return Promise.resolve(o);let s=null;function a(){s=c.removeMaybe(s)}return new Promise(((o,c)=>{s=r.handlesGroup([i.onAbort(t,(()=>{a(),c(i.createAbortError())})),d(n,(n=>{a(),o(n)}),{sync:!1,once:!0},e??v)])}))}function v(n){return!0}function b(n){return!!n}function A(n,e,t={}){let o=!1;const r=l(n,((n,t)=>{o||e(n,t)}),t);return{remove(){r.remove()},pause(){o=!0},resume(){o=!1}}}function w(n,e){const o=new t,r=f(n,"after-splice",(({added:n,start:t,deleteCount:r})=>{const c=o.splice(t,r);for(const e of c)e.remove();if(n?.length){const r=n.map(e);o.addMany(r,t)}}),{sync:!0,onListenerRemove:()=>o.drain((n=>n.remove())),onListenerAdd:n=>o.addMany(n.items.map(e))});return o.addHandles(r),o}function h(n,o){const c=new t,s=w(n,(n=>e.createTask((async e=>{const t=await o(n,e);if(i.isAborted(e))throw t.remove(),i.createAbortError();return t})))),a=()=>null,l=async n=>{const e=await n.promise,t=s.indexOf(n);t<0||c.splice(t,1,e)};c.addMany(s.items.map(a));for(const e of s)i.ignoreAbortErrors(l(e));const u=s.on("after-splice",(({added:n,start:e,deleteCount:t})=>{const o=c.splice(e,t);for(const r of o)r?.remove();if(n?.length){c.addMany(n.map(a),e);for(const e of n)i.ignoreAbortErrors(l(e))}}));return c.addHandles([r.destroyHandle(s),u]),c}const g={sync:!0},M={initial:!0},E={sync:!0,initial:!0};n.autorun=a.autorun,n.initial=M,n.mapCollection=w,n.mapCollectionAsync=h,n.on=f,n.once=m,n.pausable=A,n.sync=g,n.syncAndInitial=E,n.watch=l,n.when=u,n.whenOnce=y,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})}));
