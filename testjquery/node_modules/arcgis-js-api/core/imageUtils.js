/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["require","exports","../request","./Error","./promiseUtils","./urlUtils","../support/base64Utils"],(function(e,t,a,r,n,i,o){"use strict";let s=null,c=!0;function u(e,t,a){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t)}catch(r){c=!1}return d(e,t,a)}function f(e,t,a,r){if(!t||!a)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t,a)}catch(i){c=!1}const n=d(t,a,r);return n.data.set(e,0),n}function m(){return s||(s=document.createElement("canvas"),s.width=1,s.height=1),s}function d(e,t,a){return a||(a=m()),a.getContext("2d").createImageData(e,t)}async function g(e,t){const i=window.URL.createObjectURL(e);try{const{data:e}=await a(i,{...t,responseType:"image"});return e}catch(o){if(!n.isAbortError(o))throw new r("invalid-image",`Could not fetch requested image at ${i}`);throw o}finally{window.URL.revokeObjectURL(i)}}async function w(t,a){const{arrayBuffer:r,mediaType:n}=await p(t,a),i="image/png"===n;if("image/gif"===n){const{isAnimatedGIF:t,parseGif:n}=await new Promise(((t,a)=>e(["./image/gif"],t,a)));if(t(r))return n(r,a)}if(i){const{isAnimatedPNG:t,parseApng:n}=await new Promise(((t,a)=>e(["./image/apng"],t,a)));if(t(r))return n(r,a)}return g(new Blob([r],{type:n}),a)}async function p(e,t){const r=i.dataComponents(e);if(r?.isBase64)return{arrayBuffer:o.base64ToArrayBuffer(r.data),mediaType:r.mediaType};const n=await a(e,{responseType:"array-buffer",...t});return{arrayBuffer:n.data,mediaType:n.getHeader("Content-Type")}}t.createEmptyImageData=u,t.getImageData=w,t.wrapImageData=f,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
