/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../Accessor","../Collection","./utils"],(function(e,t,n,o){"use strict";const r=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function f(e){return e instanceof t}function i(e){return e instanceof n?Object.keys(e.items):f(e)?o.getProperties(e).keys():e?Object.keys(e):[]}function l(e,t){return e instanceof n?e.items[t]:e[t]}function u(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function c(e){return e?e.declaredClass:null}function s(e,t){const n=e.diff;if(n&&"function"==typeof n)return n(e,t);const o=i(e),a=i(t);if(0===o.length&&0===a.length)return;if(!o.length||!a.length||u(e,t))return{type:"complete",oldValue:e,newValue:t};const p=a.filter((e=>!o.includes(e))),y=o.filter((e=>!a.includes(e))),d=o.filter((n=>a.includes(n)&&l(e,n)!==l(t,n))).concat(p,y).sort(),m=c(e);if(m&&r.has(m)&&d.length)return{type:"complete",oldValue:e,newValue:t};let h;const g=f(e)&&f(t);for(const r of d){const o=l(e,r),f=l(t,r);let i;if((g||"function"!=typeof o&&"function"!=typeof f)&&(o!==f&&(null!=o||null!=f))){if(n&&n[r]&&"function"==typeof n[r])i=n[r]?.(o,f);else if(o instanceof Date&&f instanceof Date){if(o.getTime()===f.getTime())continue;i={type:"complete",oldValue:o,newValue:f}}else i="object"==typeof o&&"object"==typeof f&&c(o)===c(f)?s(o,f):{type:"complete",oldValue:o,newValue:f};null!=i&&(null!=h?h.diff[r]=i:h={type:"partial",diff:{[r]:i}})}}return h}function a(e,t){if(null==e)return!1;const n=t.split(".");let o=e;for(const r of n){if("complete"===o.type)return!0;if("partial"!==o.type)return!1;{const e=o.diff[r];if(!e)return!1;o=e}}return!0}function p(e,t){for(const n of t)if(a(e,n))return!0;return!1}function y(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&c(e)!==c(t)?{type:"complete",oldValue:e,newValue:t}:s(e,t)}function d(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!d(e))return!1;for(const e of t.removed)if(!d(e))return!1;for(const e of t.changed)if(!d(e))return!1;return!0}case"partial":for(const t in e.diff){if(!d(e.diff[t]))return!1}return!0}}e.diff=y,e.hasDiff=a,e.hasDiffAny=p,e.isEmpty=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
