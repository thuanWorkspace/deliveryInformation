/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../arrayUtils","../Error","../Logger","./get","./PropertyOrigin","./utils","./extensions/serializableProperty"],(function(e,r,i,t,n,o,s,u){"use strict";function l(e,r,i,t,n){const o={};return r.write?.writer?.call(e,t,o,i,n),o}function a(e,r,s,u,l,a){if(!u?.write)return!1;const g=n.get(e,s);if(!l&&u.write.overridePolicy){const r=u.write.overridePolicy.call(e,g,s,a??void 0);void 0!==r&&(l=r)}if(l||(l=u.write),!l||!1===l.enabled)return!1;if(l.layerContainerTypes&&a?.layerContainerType&&!l.layerContainerTypes.includes(a.layerContainerType))return!1;if((null===g&&!l.allowNull&&!l.writerEnsuresNonNull||void 0===g)&&l.isRequired){const r=new i("web-document-write:property-required",`Missing value for required property '${s}' on '${e.declaredClass}'`,{propertyName:s,target:e});return r&&a?.messages?a.messages.push(r):r&&!a&&t.getLogger("esri.core.accessorSupport.write").error(r.name,r.message),!1}if(void 0===g)return!1;if(null===g&&!l.allowNull&&!l.writerEnsuresNonNull)return!1;if(!l.alwaysWriteDefaults&&(!r.store.multipleOriginsSupported||r.store.originOf(s)===o.OriginId.DEFAULTS)&&p(e,s,a,u,g))return!1;if(!l.ignoreOrigin&&a?.origin&&r.store.multipleOriginsSupported){if(r.store.originOf(s)<o.nameToId(a.origin))return!1}return!0}function p(e,i,t,n,o){const s=n.default;if(void 0===s)return!1;if(null!=n.defaultEquals)return n.defaultEquals(o);if("function"==typeof s){if(Array.isArray(o)){const n=s.call(e,i,t??void 0);return r.equals(n,o)}return!1}return s===o}function g(e,r,i,t){const n=s.getProperties(e),o=n.metadatas,l=u.originSpecificWritePropertyDefinition(o[r],t);return!!l&&a(e,n,r,l,i,t)}function f(e,r,i){if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return s.merge(r,e.toJSON(i));const t=s.getProperties(e),p=t.metadatas;for(const g in p){const f=u.originSpecificWritePropertyDefinition(p[g],i);if(!a(e,t,g,f,void 0,i))continue;const c=n.get(e,g),d=l(e,f,f.write&&"string"==typeof f.write.target?f.write.target:g,c,i);Object.keys(d).length>0&&(r=s.merge(r,d),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then((()=>s.merge(r,d,(()=>"replace-arrays"))))),i?.writtenProperties&&i.writtenProperties.push({target:e,propName:g,oldOrigin:o.idToReadableName(t.store.originOf(g)),newOrigin:i.origin}))}return r}e.willPropertyWrite=g,e.write=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
