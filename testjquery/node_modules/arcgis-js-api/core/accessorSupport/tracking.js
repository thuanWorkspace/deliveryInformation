/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../has","../Logger","./utils","./tracking/Flags"],(function(n,t,e,r,c){"use strict";const i={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},s=[];let o=i;function a(n){o.onObservableAccessed(n)}let l=!1,g=!1;function u(n,t,e){if(l)return p(n,t,e);d(n);const r=t.call(e);return k(),r}function f(n,t){return u(i,n,t)}function p(n,t,r){const c=l;l=!0,d(n);let i=null;try{i=t.call(r)}catch(s){g&&e.getLogger("esri.core.accessorSupport.tracking").error(s)}return k(),l=c,i}function d(n){o=n,s.push(n)}function k(){const n=s.length;if(n>1){const t=s.pop();o=s[n-2],t.onTrackingEnd()}else if(1===n){const n=s.pop();o=i,n.onTrackingEnd()}else o=i}function y(n,t){if(t.flags&c.Flags.DepTrackingInitialized)return;const e=g;g=!1,t.flags&c.Flags.AutoTracked?p(t,t.metadata.get,n):A(n,t),g=e}const T=[];function A(n,t){t.flags&c.Flags.ExplicitlyTracking||(t.flags|=c.Flags.ExplicitlyTracking,p(t,(()=>{const e=t.metadata.dependsOn||T;for(const t of e)if("string"!=typeof t||t.includes(".")){const e=r.pathToArray(t);for(let t=0,r=n;t<e.length&&null!=r&&"object"==typeof r;++t)r=h(r,e[t],t!==e.length-1)}else h(n,t,!1)})),t.flags&=~c.Flags.ExplicitlyTracking)}function h(n,t,e){const c="?"===t[t.length-1]?t.slice(0,-1):t;if(null!=n.getItemAt||Array.isArray(n)){const t=parseInt(c,10);if(!isNaN(t))return Array.isArray(n)?n[t]:n.at(t)}const i=r.getProperties(n);if(i){const t=i.propertiesByName.get(c);t&&(a(t),y(n,t))}return e?n[c]:void 0}n.initializeDependencyTracking=y,n.runTracked=u,n.runTrackedNoThrow=p,n.runUntracked=f,n.trackAccess=a,n.trackExplicitDependencies=A,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})}));
