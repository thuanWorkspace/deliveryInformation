/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../arcade/featureset/support/errorsupport","../string","./DateOnly","./sqlCompareUtils","./sqlDateParsingUtils","./TimeOnly","../../chunks/datetime"],(function(a,e,r,n,t,l,s,o){"use strict";function u(a,r,n){const t=C[a.toLowerCase()];if(null==t)throw new e.SqlError(e.SqlErrorCodes.FunctionNotRecognized);if(r.length<t.minParams||r.length>t.maxParams)throw new e.SqlError(e.SqlErrorCodes.InvalidParameterCount,{name:a.toUpperCase()});return t.evaluate(r,n)}function i(a,e){const r=C[a.toLowerCase()];return null!=r&&e>=r.minParams&&e<=r.maxParams}function m(a){return"string"==typeof a||a instanceof String}function c(a){return!l.isDate(a)&&(!l.isDateOnly(a)&&(!l.isDateTime(a)&&(!l.isTimeOnly(a)&&!l.isTimestampOffset(a))))}function f(a){return l.isDateOnly(a)||l.isTimeOnly(a)?a.toString():l.isTimestampOffset(a)?a.toSQLValue():l.isDateTime(a)?0===a.millisecond?a.toFormat("yyyy-LL-dd HH:mm:ss"):a.toSQL({includeOffset:!1}):l.isDate(a)?f(o.DateTime.fromJSDate(a)):a.toString()}function E(a){if(l.isDate(a))return n.DateOnly.fromDateJS(a);if(l.isDateTime(a))return n.DateOnly.fromParts(a.year,a.month,a.day);if(l.isDateOnly(a))return a;if(l.isTimeOnly(a))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);if(l.isTimestampOffset(a)){if(null===n.DateOnly.fromParts(a.year,a.month,a.day))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue)}if(m(a)){const e=n.DateOnly.fromReader(a);if(null!==e&&e.isValid)return e}throw new e.SqlError(e.SqlErrorCodes.CannotCastValue)}function h(a,r,n){if(l.isDate(a))return l.convertToExecutingTimeZone(a,r);if(l.isDateTime(a))return a;if(l.isDateOnly(a))return a.toDateTimeLuxon("unknown");if(l.isTimeOnly(a))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);if(l.isTimestampOffset(a))return a;if(m(a))return l.parseTimestamp(a,"unknown",n);throw new e.SqlError(e.SqlErrorCodes.CannotCastValue)}function P(a){if(l.isDate(a))return s.TimeOnly.fromDateJS(a);if(l.isDateTime(a))return s.TimeOnly.fromDateTime(a);if(l.isDateOnly(a))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);if(l.isTimeOnly(a))return a;if(l.isTimestampOffset(a))return s.TimeOnly.fromSqlTimeStampOffset(a);if(m(a))return l.parseTime(a);throw new e.SqlError(e.SqlErrorCodes.CannotCastValue)}const C={extract:{minParams:2,maxParams:2,evaluate:([a,r])=>{if(null==r)return null;if(l.isDate(r))switch(a.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear();case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":return 0}else if(l.isDateTime(r))switch(a.toUpperCase()){case"SECOND":return r.second;case"MINUTE":return r.minute;case"HOUR":return r.hour;case"DAY":return r.day;case"MONTH":return r.month;case"YEAR":return r.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new e.SqlError(e.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"})}else if(l.isDateOnly(r))switch(a.toUpperCase()){case"DAY":return r.day;case"MONTH":return r.month;case"YEAR":return r.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new e.SqlError(e.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"})}else if(l.isTimeOnly(r))switch(a.toUpperCase()){case"SECOND":return r.second;case"MINUTE":return r.minute;case"HOUR":return r.hour}else if(l.isTimestampOffset(r))switch(a.toUpperCase()){case"SECOND":return r.second;case"MINUTE":return r.minute;case"HOUR":return r.hour;case"DAY":return r.day;case"MONTH":return r.month;case"YEAR":return r.year;case"TIMEZONE_HOUR":return r.timezoneOffsetHour;case"TIMEZONE_MINUTE":return r.timezoneOffsetMinutes}throw new e.SqlError(e.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"})}},substring:{minParams:2,maxParams:3,evaluate:a=>{if(2===a.length){const[e,r]=a;return null==e||null==r?null:e.toString().substring(r-1)}if(3===a.length){const[e,r,n]=a;return null==e||null==r||null==n?null:n<=0?"":e.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:([a,e])=>null==a||null==e?null:e.indexOf(a)+1},trim:{minParams:2,maxParams:3,evaluate:a=>{const n=3===a.length,t=n?a[1]:" ",l=n?a[2]:a[1];if(null==t||null==l)return null;const s=`(${r.escapeRegExpString(t)})`;switch(a[0]){case"BOTH":return l.replaceAll(new RegExp(`^${s}*|${s}*$`,"g"),"");case"LEADING":return l.replaceAll(new RegExp(`^${s}*`,"g"),"");case"TRAILING":return l.replaceAll(new RegExp(`${s}*$`,"g"),"")}throw new e.SqlError(e.SqlErrorCodes.InvalidFunctionParameters,{function:"TRIM"})}},abs:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.abs(a[0])},ceiling:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.ceil(a[0])},floor:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.floor(a[0])},log:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.log(a[0])},log10:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.log(a[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.sin(a[0])},cos:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.cos(a[0])},tan:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.tan(a[0])},asin:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.asin(a[0])},acos:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.acos(a[0])},atan:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.atan(a[0])},sign:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0]>0?1:a[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:a=>null==a[0]||null==a[1]?null:a[0]**a[1]},mod:{minParams:2,maxParams:2,evaluate:a=>null==a[0]||null==a[1]?null:a[0]%a[1]},round:{minParams:1,maxParams:2,evaluate:a=>{const e=a[0],r=2===a.length?10**a[1]:1;return null==e?null:Math.round(e*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:a=>null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))},char_length:{minParams:1,maxParams:1,evaluate:a=>m(a[0])?a[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:a=>{let e="";for(let r=0;r<a.length;r++){if(null==a[r])return null;e+=a[r].toString()}return e}},lower:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:a=>{for(const e of a)if(null!==e)return e;return null}},cosh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.cosh(a[0])},sinh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.sinh(a[0])},tanh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.tanh(a[0])},nullif:{minParams:2,maxParams:2,evaluate:(a,e)=>t.sqlCompare(a[0],a[1],"=")?null:a[0]},cast:{minParams:2,maxParams:2,evaluate:(a,r)=>{const n=a[0],t=a[1];if(null===n)return null;switch(t.type){case"integer":{if(!c(n))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);const a=parseInt(n,10);if(isNaN(a))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);return a}case"smallint":{if(!c(n))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);const a=parseInt(n,10);if(isNaN(a))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);if(a>32767||a<-32767)throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);return a}case"float":case"real":{if(!c(n))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);const a=parseFloat(n);if(isNaN(a))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);return a}case"time":return P(n);case"date":return E(n);case"timestamp":return h(n,r,!0===t.withtimezone);case"varchar":{const a=f(n);if(a.length>t.size)throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);return a}default:throw new e.SqlError(e.SqlErrorCodes.InvalidDataType)}}}};a.evaluateFunction=u,a.isStandardized=i,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})}));
