/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../chunks/tslib.es6","./Accessor","./promiseUtils","./accessorSupport/decorators/subclass"],(function(s,e,r,i,t){"use strict";var o;!function(s){s[s.PENDING=0]="PENDING",s[s.RESOLVED=1]="RESOLVED",s[s.REJECTED=2]="REJECTED"}(o||(o={}));class l{constructor(){this._resolver=i.createResolver(),this._status=o.PENDING,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=o.RESOLVED,this._cleanUp()}),(()=>{this._status=o.REJECTED,this._cleanUp()})),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(s){this._resolvingPromises.push(s),this._tryResolve()}isResolved(){return this._status===o.RESOLVED}isRejected(){return this._status===o.REJECTED}isFulfilled(){return this._status!==o.PENDING}abort(){this._resolver.reject(i.createAbortError())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const s=i.createResolver(),e=[...this._resolvingPromises,s.promise],r=this._allPromise=Promise.all(e);r.then((()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()}),(s=>{this.isFulfilled()||this._allPromise!==r||i.isAbortError(s)||this._resolver.reject(s)})),s.resolve()}}const h=s=>{let r=class extends s{constructor(...s){super(...s),this._promiseProps=new l,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(s,e){return this._promiseProps.promise.then((()=>this)).then(s,e)}catch(s){return this.when(null,s)}addResolvingPromise(s){s&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in s?s.when():s)}};return r=e.__decorate([t.subclass("esri.core.Promise")],r),r};s.EsriPromise=class extends(h(r)){},s.EsriPromise=e.__decorate([t.subclass("esri.core.Promise")],s.EsriPromise),s.EsriPromiseMixin=h,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})}));
