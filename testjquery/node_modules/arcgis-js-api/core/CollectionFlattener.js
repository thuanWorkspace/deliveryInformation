/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["../chunks/tslib.es6","./Collection","./asyncUtils","./Error","./Logger","./accessorSupport/watch","./accessorSupport/trackingUtils","./accessorSupport/decorators/property","./accessorSupport/decorators/subclass"],(function(t,e,o,r,s,i,n,c,l){"use strict";let u=class extends e{constructor(t){super(t),this.getCollections=null}initialize(){this.addHandles(n.autorun((()=>this._refresh())))}destroy(){this.getCollections=null}_refresh(){const t=null!=this.getCollections?this.getCollections():null;if(null==t)return void this.removeAll();let e=0;for(const o of t)null!=o&&(e=this._processCollection(e,o));this.splice(e,this.length)}_createNewInstance(t){return new e(t)}_processCollection(t,e){if(!e)return t;const o=this.itemFilterFunction??(t=>!!t);for(const r of e)if(r){if(o(r)){const e=this.indexOf(r,t);e>=0?e!==t&&this.reorder(r,t):this.add(r,t),++t}if(this.getChildrenFunction){const e=this.getChildrenFunction(r);if(Array.isArray(e))for(const o of e)t=this._processCollection(t,o);else t=this._processCollection(t,e)}}return t}};t.__decorate([c.property()],u.prototype,"getCollections",void 0),t.__decorate([c.property()],u.prototype,"getChildrenFunction",void 0),t.__decorate([c.property()],u.prototype,"itemFilterFunction",void 0),u=t.__decorate([l.subclass("esri.core.CollectionFlattener")],u);return u}));
