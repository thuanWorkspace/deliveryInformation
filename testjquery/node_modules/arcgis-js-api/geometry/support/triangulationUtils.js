/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../chunks/earcut","./Axis","./coordsUtils","./DoubleArray","./Indices","./meshUtils/deduplicate","../../views/3d/layers/graphics/polygonUtils"],(function(e,n,t,o,i,s,r,l){"use strict";function c(t){const o=u(t.rings,t.hasZ,e.CounterClockwiseMode.CCW_IS_HOLE,t.spatialReference),l=new Array;let c=0,f=0;for(const e of o.polygons){const t=e.count,r=e.index,a=i.doubleSubArray(o.position,3*r,3*t),u=e.holeIndices.map((e=>e-r)),g=s.compactIndices(n.earcut(a,u,3));l.push({position:a,faces:g}),c+=a.length,f+=g.length}const g=a(l,c,f),h=Array.isArray(g.position)?r.deduplicate(g.position,3,{originalIndices:g.faces}):r.deduplicate(g.position.buffer,6,{originalIndices:g.faces});return g.position=i.doubleArrayFrom(new Float64Array(h.buffer)),g.faces=h.indices,g}function a(e,n,t){if(1===e.length)return e[0];const o=i.newDoubleArray(n),r=new Array(t);let l=0,c=0,a=0;for(const i of e){for(let e=0;e<i.position.length;e++)o[l++]=i.position[e];for(const e of i.faces)r[c++]=e+a;a=l/3}return{position:o,faces:s.compactIndices(r)}}function u(n,t,o,s){const r=n.length,l=new Array(r),c=new Array(r),a=new Array(r);let u=0,h=0,d=0,p=0;for(let e=0;e<r;++e)p+=n[e].length;const A=i.newDoubleArray(3*p);let C=0;for(let i=r-1;i>=0;i--){const p=n[i],y=o===e.CounterClockwiseMode.CCW_IS_HOLE&&g(p,t,s);if(y&&1!==r)l[u++]=p;else{let e=p.length;for(let t=0;t<u;++t)e+=l[t].length;const n={index:C,pathLengths:new Array(u+1),count:e,holeIndices:new Array(u)};n.pathLengths[0]=p.length,p.length>0&&(a[d++]={index:C,count:p.length}),C=y?f(p,p.length-1,-1,A,C,p.length,t):f(p,0,1,A,C,p.length,t);for(let o=0;o<u;++o){const e=l[o];n.holeIndices[o]=C,n.pathLengths[o+1]=e.length,e.length>0&&(a[d++]={index:C,count:e.length}),C=f(e,0,1,A,C,e.length,t)}u=0,n.count>0&&(c[h++]=n)}}for(let e=0;e<u;++e){const n=l[e];n.length>0&&(a[d++]={index:C,count:n.length}),C=f(n,0,1,A,C,n.length,t)}return c.length=h,a.length=d,{position:A,polygons:c,outlines:a}}function f(e,n,t,o,i,s,r){i*=3;for(let l=0;l<s;++l){const s=e[n];o[i++]=s[0],o[i++]=s[1],o[i++]=r?s[2]:0,n+=t}return i/3}function g(e,n,i){if(n){const n=e.length-1,s=l.leastSignificantAxis(e,n,i);if(s===t.Axis.X)return!o.isClockwise(e,t.Axis.Y,t.Axis.Z);if(s===t.Axis.Y)return!o.isClockwise(e,t.Axis.X,t.Axis.Z)}return!o.isClockwise(e,t.Axis.X,t.Axis.Y)}var h;e.CounterClockwiseMode=void 0,(h=e.CounterClockwiseMode||(e.CounterClockwiseMode={}))[h.NONE=0]="NONE",h[h.CCW_IS_HOLE=1]="CCW_IS_HOLE",e.isCounterClockwise=g,e.pathsToTriangulationInfo=u,e.triangulate=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
