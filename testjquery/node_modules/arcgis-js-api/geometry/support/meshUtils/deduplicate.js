/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../Indices"],(function(t,e,n){"use strict";function r(t,r,c){const u=Array.isArray(t),s=u?t.length/r:t.byteLength/(4*r),a=u?t:new Uint32Array(t,0,s*r),y=c?.minReduction??0,d=c?.originalIndices||null,h=d?d.length:0,g=c?.componentOffsets||null;let A=0;if(g)for(let e=0;e<g.length-1;e++){const t=g[e+1]-g[e];t>A&&(A=t)}else A=s;const w=Math.floor(1.1*A)+1;(null==f||f.length<2*w)&&(f=new Uint32Array(e.nextHighestPowerOfTwo(2*w)));for(let e=0;e<2*w;e++)f[e]=0;let b=0;const m=!!g&&!!d,p=m?h:s;let U=n.newIndexArray(s);const I=new Uint32Array(h),M=1.96;let x=0!==y?Math.ceil(4*M*M/(y*y)*y*(1-y)):p,O=1,q=g?g[1]:p;for(let e=0;e<p;e++){if(e===x){const t=1-b/e;if(t+M*Math.sqrt(t*(1-t)/e)<y)return null;x*=2}if(e===q){for(let t=0;t<2*w;t++)f[t]=0;if(d)for(let t=g[O-1];t<g[O];t++)I[t]=U[d[t]];q=g[++O]}const t=m?d[e]:e,n=t*r,o=i(a,n,r);let c=o%w,u=b;for(;0!==f[2*c+1];){if(f[2*c]===o){const t=f[2*c+1]-1;if(l(a,n,t*r,r)){u=U[t];break}}c++,c>=w&&(c-=w)}u===b&&(f[2*c]=o,f[2*c+1]=t+1,b++),U[t]=u}if(0!==y&&1-b/s<y)return null;if(m){for(let t=g[O-1];t<I.length;t++)I[t]=U[d[t]];U=n.compactIndices(I)}const P=u?new Array(b):new Uint32Array(b*r);b=0;for(let e=0;e<p;e++)if(U[e]===b){o(a,(m?d[e]:e)*r,P,b*r,r),b++}if(d&&!m){const t=new Uint32Array(h);for(let e=0;e<t.length;e++)t[e]=U[d[e]];U=n.compactIndices(t)}return{buffer:Array.isArray(P)?P:P.buffer,indices:U,uniqueCount:b}}function l(t,e,n,r){for(let l=0;l<r;l++)if(t[e+l]!==t[n+l])return!1;return!0}function o(t,e,n,r,l){for(let o=0;o<l;o++)n[r+o]=t[e+o]}function i(t,e,n){let r=0;for(let l=0;l<n;l++)r=t[e+l]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let f=null;t.deduplicate=r,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
