/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../request","../../../core/arrayUtils","../../../core/promiseUtils","../../../layers/support/infoFor3D"],(function(t,e,r,s,n){"use strict";class a{constructor(t,e,r){this.assetName=t,this.assetMimeType=e,this.parts=r}equals(t){return this===t||this.assetName===t.assetName&&this.assetMimeType===t.assetMimeType&&r.equals(this.parts,t.parts,((t,e)=>t.equals(e)))}isOnService(t){return this.parts.every((e=>e.isOnService(t)))}makeHash(){let t="";for(const e of this.parts)t+=e.partHash;return t}async toBlob(t){const{parts:e}=this;if(1===e.length)return e[0].toBlob(t);const r=await Promise.all(e.map((e=>e.toBlob(t))));return s.throwIfAborted(t),new Blob(r)}}class i{constructor(t,e){this.partUrl=t,this.partHash=e}equals(t){return this===t||this.partUrl===t.partUrl&&this.partHash===t.partHash}isOnService(t){return this.partUrl.startsWith(`${t.path}/assets/`)}async toBlob(t){const{data:r}=await e(this.partUrl,{responseType:"blob"});return s.throwIfAborted(t),r}}function o(t){return f(t?.source)}function u(t){if(!Array.isArray(t))return!1;return t.every((t=>t instanceof a))}const c=/^(model\/gltf\+json)|(model\/gltf-binary)$/,l=/\.(gltf|glb)/i;function f(t){if(!t)return!1;if(Array.isArray(t)){return t.some(p)}return p(t)}function p(t){if(t instanceof File){const{type:e,name:r}=t;return c.test(e)||l.test(r)}return c.test(t.assetMimeType)||l.test(t.assetName)}function h(t,e){if(!t)return!1;const{source:r}=t;return y(r,e)}function m(t,e){if(t===e)return!0;const{source:r}=t,{source:s}=e;if(r===s)return!0;if(u(r)&&u(s)){if(r.length!==s.length)return!1;const t=(t,e)=>t.assetName<e.assetName?-1:t.assetName>e.assetName?1:0,e=[...r].sort(t),n=[...s].sort(t);for(let r=0;r<e.length;++r)if(!e[r].equals(n[r]))return!1;return!0}return!1}function y(t,e){if(Array.isArray(t)){const r=t;return r.length>0&&r.every((t=>g(t,e)))}return g(t,e)}function g(t,e){return t instanceof a&&t.isOnService(e)}function A(t,e){return t instanceof File?n.getFileFormatId(t,e):n.getMimeTypeFormatId(t.assetMimeType,e)??n.getFilenameFormatId(t.assetName,e)}function S(t){return Array.isArray(t)?t:[t]}function b(t){return!!t.original}t.ServiceAsset=a,t.ServiceAssetPart=i,t.assetFormatId=A,t.assetIsOnService=g,t.externalIsOnService=h,t.externalSourceToMultiPart=S,t.externalSourcesAreEqual=m,t.isDisplayAsset=p,t.isDisplayExternal=o,t.isDisplaySource=f,t.isOriginalExternal=b,t.sourceIsOnService=y,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
