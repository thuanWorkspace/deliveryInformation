/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/workers/workers","../../../chunks/vec3f64","../ray","../triangle","./ElevationSamplerWorker","../../../layers/support/ElevationSampler"],(function(e,t,n,a,r,o,l){"use strict";async function i(e,t){const n=await c(),a=await f.createIndex(e,n);return u(n),new s(e,a,t)}class s extends l.ElevationSamplerBase{constructor(e,t,n){super(),this._rindex=t,this.demResolution={min:0,max:0},this.spatialReference=e.spatialReference.clone(),this.extent=e.extent.clone(),this.noDataValue=n?.noDataValue||0}elevationAt(e,t){let n=Number.NEGATIVE_INFINITY;return a.fromValues([e,t,0],[0,0,-1],d),this._rindex.search({minX:e,maxX:e,minY:t,maxY:t},(e=>{r.intersectRay(e,d,E)&&E[2]>n&&(n=E[2])})),n===Number.NEGATIVE_INFINITY?this.noDataValue:n}}function c(){return++p,m(),h||(h=t.open("ElevationSamplerWorker").catch((()=>null)),h)}function u(e){--p,null!=e&&0===p&&(x=setTimeout((()=>{e.close(),h=null,x=0}),I))}function m(){x&&(clearTimeout(x),x=0)}const f=new o;let p=0,h=null,x=0;const I=1e4,d=a.fromValues([0,0,0],[0,0,-1]),E=n.create();e.create=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
