/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../geometry","../../../Ground","../../../core/Logger","../../../core/unitUtils","../../Mesh","../../projection","../Indices","../MeshComponent","../MeshVertexAttributes","../../Point"],(function(e,t,n,o,i,a,r,s,l,c,u){"use strict";async function m(e,t,i){let a;if(f(e)||e instanceof n){const n=await p(e);return a=await n.createElevationSampler(t,{demResolution:i?.demResolution??"finest-contiguous"}),d(a,t,{material:i?.material})}return"string"==typeof i?.demResolution?(o.getLogger("esri.geometry.support.meshUtils.elevation").error("create()","demResolution must be a number when used directly with a sampler"),null):d(e,t,{material:i?.material,demResolution:i?.demResolution})}function d(e,t,n){const o=i.getMetersPerUnitForSR(t.spatialReference),u=(n?.demResolution??e.demResolution.min)/o,m=Math.round(t.width/u),d=Math.round(t.height/u),p=m+1,f=d+1,h=new Float64Array(p*f*3),R=new Float32Array(p*f*2);let g=0,w=0;const v=new Uint32Array(m*d*2*3);let b=0,A=0;const M=!e.spatialReference.equals(t.spatialReference);y.spatialReference=t.spatialReference;const{xmin:x,ymin:S,height:P,width:U}=t;for(let i=0;i<f;i++){const t=S+P*(i/d);for(let n=0;n<p;n++){const o=x+U*(n/m);if(h[g++]=o,h[g++]=t,M){y.x=o,y.y=t;const n=r.project(y,e.spatialReference);h[g++]=e.elevationAt(n.x,n.y)??0}else h[g++]=e.elevationAt(o,t)??0;const a=n/m,s=i/d;R[w++]=a,R[w++]=s,i!==d&&n!==m&&(v[A++]=b+1,v[A++]=b+p+1,v[A++]=b+p,v[A++]=b,v[A++]=b+1,v[A++]=b+p),b++}}return new a({vertexAttributes:new c.MeshVertexAttributes({position:h,uv:R}),components:[new l({faces:s.compactIndices(v),shading:"smooth",material:n?.material??null})],spatialReference:t.spatialReference})}async function p(e){return f(e)?e.load():(await e.load(),await Promise.allSettled(e.layers.items.map((e=>e.load()))),e)}function f(e){return"type"in e&&("elevation"===e.type||"base-elevation"===e.type)}const y=new u;e.create=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
