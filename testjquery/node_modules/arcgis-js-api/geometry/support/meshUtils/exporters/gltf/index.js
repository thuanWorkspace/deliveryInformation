/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../../Point","./glb","./gltf","./types","./imageutils","./asset","./scene","./node"],(function(e,t,r,u,n,a,o,p,f){"use strict";const i="model.gltf",s="model.glb";async function y(e,o,p){o=o||{};const f=new u.GLTF(e,o,p);let y=f.params;y?y.origin||(y.origin=new t({x:-1,y:-1,z:-1})):y={origin:new t({x:-1,y:-1,z:-1})};const l=y.origin,c=f.gltf,g=c.extras?.promises??[];let d=1,m=1,O=null;await Promise.allSettled(g);const b={origin:l};delete c.extras;const T="number"==typeof o.jsonSpacing?o.jsonSpacing:4,B=JSON.stringify(c,((e,t)=>{if("extras"!==e){if(t instanceof ArrayBuffer){if(a.isArrayBufferPNG(t))switch(o.imageOutputType){case n.ImageOutputType.DataURI:case n.ImageOutputType.GLB:break;case n.ImageOutputType.External:default:{const e=`img${m}.png`;return m++,b[e]=t,e}}switch(o.bufferOutputType){case n.BufferOutputType.DataURI:return a.encodeBase64DataUri(t);case n.BufferOutputType.GLB:if(O)throw new Error("Already encountered an ArrayBuffer, there should only be one in the GLB format.");return void(O=t);case n.BufferOutputType.External:default:{const e=`data${d}.bin`;return d++,b[e]=t,e}}}return t}}),T);return o.bufferOutputType===n.BufferOutputType.GLB||o.imageOutputType===n.ImageOutputType.GLB?b[s]=new r.GLB(B,O).buffer:b[i]=B,b}function l(e,t){return y(e,{bufferOutputType:n.BufferOutputType.GLB,imageOutputType:n.ImageOutputType.GLB,jsonSpacing:0},t)}Object.defineProperty(e,"AlphaMode",{enumerable:!0,get:()=>n.AlphaMode}),Object.defineProperty(e,"AttributeType",{enumerable:!0,get:()=>n.AttributeType}),Object.defineProperty(e,"BufferOutputType",{enumerable:!0,get:()=>n.BufferOutputType}),Object.defineProperty(e,"ColorMode",{enumerable:!0,get:()=>n.ColorMode}),Object.defineProperty(e,"ImageOutputType",{enumerable:!0,get:()=>n.ImageOutputType}),Object.defineProperty(e,"MeshMode",{enumerable:!0,get:()=>n.MeshMode}),e.Asset=o.Asset,e.Scene=p.Scene,e.Node=f.Node,e.exportGLB=l,e.exportGLTF=y,e.modelNameGlb=s,e.modelNameGltf=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
