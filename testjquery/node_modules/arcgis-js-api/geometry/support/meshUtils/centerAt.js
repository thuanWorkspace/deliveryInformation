/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../chunks/vec3","../../../chunks/vec3f64","../../projection/projectPointToVector","./geographicUtils","./georeference"],(function(e,t,i,r,o,n,c){"use strict";const a="esri.geometry.support.meshUtils.centerAt";function s(e,t,i){if(!e.vertexAttributes?.position)return;const{vertexSpace:r}=e,o=i?.origin??e.origin;if(r.isRelative)n.validateGeographicFlag(r,a,i),l(e,t,o);else{n.isGeographicMesh(e.spatialReference,i)?p(e,t,o):g(e,t,o)}}function l(e,n,c){const{vertexSpace:s}=e;if(!s.isRelative)return;const l=u,p=d;if(!o.projectPointToVector(n,p,e.spatialReference))return void t.getLogger(a).error(`Failed to project centerAt location (wkid:${n.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`);if(!o.projectPointToVector(c,l,e.spatialReference)){const i=e.origin;l[0]=i.x,l[1]=i.y,l[2]=i.z,t.getLogger(a).error(`Failed to project specified origin (wkid:${c.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}const g=i.subtract(b,p,l),f=s.origin;s.origin=i.add(r.create(),f,g)}function p(e,t,i){const r=c.ungeoreference(e.vertexAttributes,i,{geographic:!0}),{position:o,normal:n,tangent:a}=c.georeference(r,t,{geographic:!0});e.vertexAttributes.position=o,e.vertexAttributes.normal=n,e.vertexAttributes.tangent=a,e.vertexAttributesChanged()}function g(e,i,r){const n=u,c=d;if(o.projectPointToVector(i,c,e.spatialReference)){if(!o.projectPointToVector(r,n,e.spatialReference)){const i=e.origin;n[0]=i.x,n[1]=i.y,n[2]=i.z,t.getLogger(a).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}f(e.vertexAttributes.position,c,n),e.vertexAttributesChanged()}else t.getLogger(a).error(`Failed to project centerAt location (wkid:${i.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}function f(e,t,i){if(e)for(let r=0;r<e.length;r+=3)for(let o=0;o<3;o++)e[r+o]+=t[o]-i[o]}const d=r.create(),u=r.create(),b=r.create();e.centerAt=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
