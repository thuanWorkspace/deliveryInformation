/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../chunks/vec3","../../../chunks/vec3f64","../../spatialReferenceEllipsoidUtils","../../projection/projectPointToVector","../MeshTransform","./geographicUtils","./projection"],(function(e,t,r,o,n,i,l,c,a){"use strict";const s="esri.geometry.support.meshUtils.scale";function p(e,t,r){if(!e.vertexAttributes?.position)return;const{spatialReference:o,vertexSpace:n}=e;if(n.isRelative){c.validateGeographicFlag(n,s,r);const o=r?.origin??e.origin;e.transform??(e.transform=new l),u(e.transform,n,t,o)}else{const n=c.isGeographicMesh(o,r),i=r?.origin??e.origin;n?g(e,t,i):f(e,t,i)}}function u(e,t,n,i){const l=t.origin,c=r.set(d,i.x,i.y,i.z),a=r.subtract(d,c,l);e.applyLocalInverse(a,h);const s=r.scale(o.create(),e.scale,n);e.scale=s,e.applyLocalInverse(a,a),r.subtract(a,a,h),e.translation=r.add(o.create(),e.translation,a)}function g(e,t,r){const o=e.spatialReference,l=n.getSphericalPCPF(o),c=j;i.projectPointToVector(r,c,l)||i.projectPointToVector(e.origin,c,l);const s=e.vertexAttributes.position,p=e.vertexAttributes.normal,u=e.vertexAttributes.tangent,g=new Float64Array(s.length),f=null!=p?new Float32Array(p.length):null,d=null!=u?new Float32Array(u.length):null;a.projectToPCPF(s,o,g),null!=p&&null!=f&&a.projectNormalToPCPF(p,s,g,o,f),null!=u&&null!=d&&a.projectTangentToPCPF(u,s,g,o,d),P(g,t,c),a.projectFromPCPF(g,s,o),null!=p&&null!=f&&a.projectNormalFromPCPF(f,s,g,o,p),null!=u&&null!=d&&a.projectTangentFromPCPF(d,s,g,o,u),e.vertexAttributesChanged()}function f(e,r,o){const n=j;if(!i.projectPointToVector(o,n,e.spatialReference)){const r=e.origin;n[0]=r.x,n[1]=r.y,n[2]=r.z,t.getLogger(s).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}P(e.vertexAttributes.position,r,n),e.vertexAttributesChanged()}function P(e,t,n=o.ZEROS){if(e)for(let o=0;o<e.length;o+=3){for(let t=0;t<3;t++)d[t]=e[o+t]-n[t];r.scale(d,d,t);for(let t=0;t<3;t++)e[o+t]=d[t]+n[t]}}const d=o.create(),h=o.create(),j=o.create();e.scale=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
