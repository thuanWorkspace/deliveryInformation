/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../chunks/mat3","../../../chunks/mat3f64","../../../chunks/mat4","../../../chunks/mat4f64","../../../chunks/vec3","../../../chunks/vec3f64","../../spatialReferenceEllipsoidUtils","../../projection/computeTranslationToOriginAndRotation","../../projection/projectPointToVector","../axisAngleDegrees","../MeshTransform","./geographicUtils","./projection"],(function(t,e,o,r,n,i,a,c,s,l,p,u,g,f,m){"use strict";const h="esri.geometry.support.meshUtils.rotate";function P(t,e,o){if(!t.vertexAttributes?.position||0===e[3])return;const{spatialReference:r,vertexSpace:n}=t;if(n.isRelative){f.validateGeographicFlag(n,h,o);const r=o?.origin??t.origin;t.transform??(t.transform=new g),d(t.transform,n,e,r)}else{const n=o?.origin??t.origin;f.isGeographicMesh(r,o)?j(t,e,n):v(t,e,n)}}function d(t,e,o,r){const n=e.origin,i=a.set(b,r.x,r.y,r.z??0),s=a.subtract(b,i,n);t.applyLocalInverse(s,A),t.rotation=u.compose(t.rotation,o,u.create()),t.applyLocalInverse(s,s),a.subtract(s,s,A),t.translation=a.add(c.create(),t.translation,s)}function j(t,e,r){const n=t.spatialReference,i=s.getSphericalPCPF(n),c=y;p.projectPointToVector(r,c,i)||p.projectPointToVector(t.origin,c,i);const g=t.vertexAttributes.position,f=t.vertexAttributes.normal,h=t.vertexAttributes.tangent,P=new Float64Array(g.length),d=null!=f?new Float32Array(f.length):null,j=null!=h?new Float32Array(h.length):null;l.computeTranslationToOriginAndRotation(i,c,T,i),o.fromMat4(R,T);const v=F;a.transformMat3(u.axis(F),u.axis(e),R),v[3]=e[3],m.projectToPCPF(g,n,P),null!=f&&null!=d&&m.projectNormalToPCPF(f,g,P,n,d),null!=h&&null!=j&&m.projectTangentToPCPF(h,g,P,n,j),x(P,v,3,c),m.projectFromPCPF(P,g,n),null!=f&&null!=d&&(x(d,v,3),m.projectNormalFromPCPF(d,g,P,n,f)),null!=h&&null!=j&&(x(j,v,4),m.projectTangentFromPCPF(j,g,P,n,h)),t.vertexAttributesChanged()}function v(t,o,r){const n=y;if(!p.projectPointToVector(r,n,t.spatialReference)){const o=t.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,e.getLogger(h).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}x(t.vertexAttributes.position,o,3,n),x(t.vertexAttributes.normal,o,3),x(t.vertexAttributes.tangent,o,4),t.vertexAttributesChanged()}function x(t,e,o,r=c.ZEROS){if(null!=t){n.fromRotation(T,u.angleRad(e),u.axis(e));for(let e=0;e<t.length;e+=o){for(let o=0;o<3;o++)b[o]=t[e+o]-r[o];a.transformMat4(b,b,T);for(let o=0;o<3;o++)t[e+o]=b[o]+r[o]}}}const b=c.create(),A=c.create(),F=u.create(),T=i.create(),R=r.create(),y=c.create();t.rotate=P,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
