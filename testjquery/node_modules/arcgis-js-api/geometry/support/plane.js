/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
define(["exports","../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64","../../chunks/vec4","../../chunks/common","../../chunks/sphere","./vector","./vectorStacks","../../views/3d/support/mathUtils"],(function(t,n,e,r,o,c,i,s,u,a){"use strict";function f(t=Q){return[t[0],t[1],t[2],t[3]]}const d=o.exactEquals,l=o.equals;function g(t=Q[0],n=Q[1],e=Q[2],r=Q[3]){return N(t,n,e,r,u.sv4d.get())}function I(t,n){return N(n[0],n[1],n[2],n[3],t)}function N(t,n,e,r,o=f()){return o[0]=t,o[1]=n,o[2]=e,o[3]=r,o}function h(t,n,r){return e.copy(r,t),r[3]=n,r}function M(t,n,e){const r=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],o=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return e[0]=n[0]*o,e[1]=n[1]*o,e[2]=n[2]*o,e[3]=-(e[0]*t[0]+e[1]*t[1]+e[2]*t[2]),e}function m(t,n,e,r=f()){const o=e[0]-n[0],c=e[1]-n[1],i=e[2]-n[2],s=t[0]-n[0],u=t[1]-n[1],a=t[2]-n[2],d=c*a-i*u,l=i*s-o*a,g=o*u-c*s,I=d*d+l*l+g*g,N=Math.abs(I-1)>1e-5&&I>1e-12?1/Math.sqrt(I):1;return r[0]=d*N,r[1]=l*N,r[2]=g*N,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function p(t,n,r,o=0,c=Math.floor(r*(1/3)),i=Math.floor(r*(2/3))){if(r<3)return!1;n(P,o);let s=c,u=!1;for(;s<r-1&&!u;)n(b,s),s++,u=!e.exactEquals(P,b);if(!u)return!1;for(s=Math.max(s,i),u=!1;s<r&&!u;)n(y,s),s++,e.subtract(A,P,b),e.normalize(A,A),e.subtract(F,b,y),e.normalize(F,F),u=!e.exactEquals(P,y)&&!e.exactEquals(b,y)&&Math.abs(e.dot(A,F))<E;return u?(m(P,b,y,t),!0):(0!==o||1!==c||2!==i)&&p(t,n,r,0,1,2)}function v(t,n,r=!0){const o=n.length/3;return p(t,((t,r)=>e.set(t,n[3*r+0],n[3*r+1],n[3*r+2])),r?o-1:o)}const E=.99619469809,P=r.create(),b=r.create(),y=r.create(),A=r.create(),F=r.create();function L(t,n,r){return n!==t&&I(t,n),t[3]=-e.dot(J(t),r),t}function q(t,n){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n}function S(t,n,r,o){return e.cross(y,n,t),M(r,y,o)}function T(t,n,r,o){return H(t,n,e.subtract(u.sv3d.get(),r,n),Y,o)}function _(t,n,e){return null!=n&&H(t,n.origin,n.direction,Z,e)}function O(t,n,e){return H(t,n.origin,n.vector,W.NONE,e)}function j(t,n,e){return H(t,n.origin,n.vector,W.CLAMP,e)}const x=(()=>{const t=r.create();return(n,r,o)=>{const i=J(n),s=J(r);e.cross(t,i,s);if(e.squaredLength(t)<c.getEpsilon())return!1;e.normalize(t,t);const[u,a,f]=t,d=o.origin,l=Math.abs(u),g=Math.abs(a),I=Math.abs(f),[N,h,M]=i,[m,p,v]=s,E=n[3],P=r[3];return l>g&&l>I?(d[1]=(P*M-E*v)/u,d[2]=(E*p-P*h)/u):g>I?(d[0]=(E*v-P*M)/a,d[2]=(P*N-E*m)/a):(d[0]=(P*h-E*p)/f,d[1]=(E*m-P*N)/f),e.copy(o.direction,t),!0}})();function C(t,n){return G(t,i.getCenter(n))-n[3]>=0}function k(t,n){return G(t,i.getCenter(n))+n[3]<0}function X(t,n){return G(t,n)>=0}function V(t,n){return G(t,n)<0}function z(t,n){const r=e.dot(J(t),n.ray.direction),o=-G(t,n.ray.origin);if(o<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return o>0;if((o<0||r<0)&&!(o<0&&r<0))return!0;const c=o/r;return r>0?c<n.c1&&(n.c1=c):c>n.c0&&(n.c0=c),n.c0<=n.c1}function w(t,n){const r=e.dot(J(t),n.ray.direction),o=-G(t,n.ray.origin);if(r>-1e-6&&r<1e-6)return o>0;const c=o/r;return r>0?c<n.c1&&(n.c1=c):c>n.c0&&(n.c0=c),n.c0<=n.c1}function U(t,n,r){const o=e.scale(u.sv3d.get(),J(t),-t[3]),c=R(t,e.subtract(u.sv3d.get(),n,o),u.sv3d.get());return e.add(r,c,o),r}function D(t,n,r,o){const c=J(t),i=u.sv3d.get(),f=u.sv3d.get();a.tangentFrame(c,i,f);const d=e.subtract(u.sv3d.get(),r,n),l=s.projectPointSignedLength(i,d),g=s.projectPointSignedLength(f,d),I=s.projectPointSignedLength(c,d);return e.set(o,l,g,I)}function R(t,n,r){const o=e.scale(u.sv3d.get(),J(t),e.dot(J(t),n));return e.subtract(r,n,o),r}function B(t,n){return Math.abs(G(t,n))}function G(t,n){return e.dot(J(t),n)+t[3]}function H(t,r,o,c,i){const s=e.dot(J(t),o);if(0===s)return!1;let u=-(e.dot(J(t),r)+t[3])/s;return c&W.CLAMP&&(u=n.clamp(u,0,1)),!(!(c&W.INFINITE_MIN)&&u<0||!(c&W.INFINITE_MAX)&&u>1)&&(e.add(i,r,e.scale(i,o,u)),!0)}function J(t){return t}function K(t){return Math.abs(J(t)[2])<c.getEpsilon()}const Q=[0,0,1,0];var W;!function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"}(W||(W={}));const Y=W.INFINITE_MIN|W.INFINITE_MAX,Z=W.INFINITE_MAX;t.clip=z,t.clipInfinite=w,t.copy=I,t.create=f,t.distance=B,t.equals=l,t.exactEquals=d,t.fromArray=v,t.fromManyPoints=p,t.fromNormalAndOffset=h,t.fromPoints=m,t.fromPositionAndNormal=M,t.fromValues=N,t.fromVectorsAndPoint=S,t.intersectLine=T,t.intersectLineSegment=O,t.intersectLineSegmentClamp=j,t.intersectPlanes=x,t.intersectRay=_,t.isPointInside=X,t.isPointOutside=V,t.isSphereFullyInside=C,t.isSphereFullyOutside=k,t.isVertical=K,t.negate=q,t.normal=J,t.projectPoint=U,t.projectPointLocal=D,t.projectVector=R,t.setOffsetFromPoint=L,t.signedDistance=G,t.up=Q,t.wrap=g,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
